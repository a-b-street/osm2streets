import{S as A,i as z,s as R,p as y,y as j,M as g,Z as I,a as b,B as $,D as N,af as Y,E as L,d as v,j as J,R as D,ag as te,a0 as K,ah as ne,a2 as x,h as le,z as F,ai as ae,K as M,e as ee,N as S,g as P,b as k,c as q,t as h,P as O,x as re,a3 as se,o as oe,T as ie,a4 as ue,a5 as fe,a6 as ce,a7 as de,ad as pe,a8 as me,a9 as $e,aa as _e,ab as ge,ac as ye,I as he,ae as we,aj as ke,_ as be,U as ve,V as We,W as Ce}from"./RenderLanePolygons-6addba79.js";function Me(u){let e,t=u[0].size+"",n,l,a,r,s,c;return{c(){e=y("div"),n=j(t),l=j(" ways edited"),a=g(),r=y("button"),r.textContent="Download .osc",I(r,"type","button")},m(d,f){b(d,e,f),$(e,n),$(e,l),b(d,a,f),b(d,r,f),s||(c=N(r,"click",u[1]),s=!0)},p(d,[f]){f&1&&t!==(t=d[0].size+"")&&Y(n,t)},i:L,o:L,d(d){d&&(v(e),v(a),v(r)),s=!1,c()}}}function Se(u,e,t){let n;J(u,D,s=>t(3,n=s));let l=new Set;function a(s){l.add(s.detail),t(0,l)}function r(){let s=`<osmChange version="0.6" generator="osm2streets">
`;s+=`<create/>
`,s+=`<modify>
`;for(let c of l)s+=n.wayToXml(c),s+=`
`;s+=`</modify>
`,s+="</osmChange>",te("lane_edits.osc",s)}return[l,r,a]}class Oe extends A{constructor(e){super(),z(this,e,Se,Me,R,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function U(u,e,t){const n=u.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function X(u,e){let t,n,l,a,r,s,c,d,f,p,w,i;function o(){e[5].call(l,e[12],e[13])}function _(){e[6].call(s,e[12],e[13])}function m(){return e[7](e[11])}return{key:u,first:null,c(){t=y("tr"),n=y("td"),l=y("input"),a=g(),r=y("td"),s=y("input"),c=g(),d=y("td"),f=y("button"),f.textContent="Delete",p=g(),I(l,"type","text"),I(s,"type","text"),I(f,"type","button"),this.first=t},m(C,E){b(C,t,E),$(t,n),$(n,l),F(l,e[11].key),$(t,a),$(t,r),$(r,s),F(s,e[11].value),$(t,c),$(t,d),$(d,f),$(t,p),w||(i=[N(l,"input",o),N(s,"input",_),N(f,"click",m)],w=!0)},p(C,E){e=C,E&1&&l.value!==e[11].key&&F(l,e[11].key),E&1&&s.value!==e[11].value&&F(s,e[11].value)},d(C){C&&v(t),w=!1,x(i)}}}function Te(u){let e,t,n=[],l=new Map,a,r,s,c,d,f,p=K(u[0]);const w=i=>i[11].id;for(let i=0;i<p.length;i+=1){let o=U(u,p,i),_=w(o);l.set(_,n[i]=X(_,o))}return{c(){e=y("table"),t=y("tbody");for(let i=0;i<n.length;i+=1)n[i].c();a=g(),r=y("button"),r.textContent="Add new tag",s=g(),c=y("button"),c.textContent="Recalculate",I(r,"type","button"),I(c,"type","button")},m(i,o){b(i,e,o),$(e,t);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(t,null);b(i,a,o),b(i,r,o),b(i,s,o),b(i,c,o),d||(f=[N(r,"click",u[2]),N(c,"click",u[3])],d=!0)},p(i,[o]){o&3&&(p=K(i[0]),n=ne(n,o,w,1,i,p,l,t,ae,X,null,U))},i:L,o:L,d(i){i&&(v(e),v(a),v(r),v(s),v(c));for(let o=0;o<n.length;o+=1)n[o].d();d=!1,x(f)}}}function Ee(u,e,t){let n;J(u,D,o=>t(9,n=o));const l=le();let{way:a}=e,r=[],s=0;for(let[o,_]of Object.entries(JSON.parse(n.getOsmTagsForWay(a))))r.push({id:s++,key:o,value:_});function c(o){t(0,r=r.filter(_=>_.id!=o))}function d(){r.push({id:s++,key:"",value:""}),t(0,r)}function f(){let o={};for(let _ of r)_.key&&_.value&&(o[_.key]=_.value);n.overwriteOsmTagsForWay(a,JSON.stringify(o)),D.set(n),l("editedWay",a)}function p(o,_){o[_].key=this.value,t(0,r)}function w(o,_){o[_].value=this.value,t(0,r)}const i=o=>c(o.id);return u.$$set=o=>{"way"in o&&t(4,a=o.way)},[r,c,d,f,a,p,w,i]}class Ie extends A{constructor(e){super(),z(this,e,Ee,Te,R,{way:4})}}function Le(u){let e;return{c(){e=j("Click a road to edit")},m(t,n){b(t,e,n)},p:L,i:L,o:L,d(t){t&&v(e)}}}function Ne(u){let e,t,n,l,a,r=u[0],s,c,d=Z(u);return{c(){e=y("a"),t=j("Way "),n=j(u[0]),a=g(),d.c(),s=ee(),I(e,"href",l="http://openstreetmap.org/way/"+u[0]),I(e,"target","_blank")},m(f,p){b(f,e,p),$(e,t),$(e,n),b(f,a,p),d.m(f,p),b(f,s,p),c=!0},p(f,p){(!c||p&1)&&Y(n,f[0]),(!c||p&1&&l!==(l="http://openstreetmap.org/way/"+f[0]))&&I(e,"href",l),p&1&&R(r,r=f[0])?(P(),k(d,1,1,L),q(),d=Z(f),d.c(),h(d,1),d.m(s.parentNode,s)):d.p(f,p)},i(f){c||(h(d),c=!0)},o(f){k(d),c=!1},d(f){f&&(v(e),v(a),v(s)),d.d(f)}}}function Z(u){let e,t;return e=new Ie({props:{way:u[0]}}),e.$on("editedWay",u[3]),{c(){M(e.$$.fragment)},m(n,l){S(e,n,l),t=!0},p(n,l){const a={};l&1&&(a.way=n[0]),e.$set(a)},i(n){t||(h(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function je(u){let e,t,n,l,a,r,s,c,d={};e=new Oe({props:d}),u[2](e);const f=[Ne,Le],p=[];function w(i,o){return i[0]?0:1}return a=w(u),r=p[a]=f[a](u),{c(){M(e.$$.fragment),t=g(),n=y("hr"),l=g(),r.c(),s=ee()},m(i,o){S(e,i,o),b(i,t,o),b(i,n,o),b(i,l,o),p[a].m(i,o),b(i,s,o),c=!0},p(i,[o]){const _={};e.$set(_);let m=a;a=w(i),a===m?p[a].p(i,o):(P(),k(p[m],1,1,()=>{p[m]=null}),q(),r=p[a],r?r.p(i,o):(r=p[a]=f[a](i),r.c()),h(r,1),r.m(s.parentNode,s))},i(i){c||(h(e.$$.fragment,i),h(r),c=!0)},o(i){k(e.$$.fragment,i),k(r),c=!1},d(i){i&&(v(t),v(n),v(l),v(s)),u[2](null),O(e,i),p[a].d(i)}}}function De(u,e,t){let{way:n}=e,l;function a(s){re[s?"unshift":"push"](()=>{l=s,t(1,l)})}const r=s=>l.handleEditedWay(s);return u.$$set=s=>{"way"in s&&t(0,n=s.way)},[n,l,a,r]}class Re extends A{constructor(e){super(),z(this,e,De,je,R,{way:0})}}function Q(u){let e,t;return e=new pe({}),{c(){M(e.$$.fragment)},m(n,l){S(e,n,l),t=!0},i(n){t||(h(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function Ge(u){let e,t,n,l,a,r,s,c,d,f,p,w,i,o,_,m,C,E,H,G;l=new ue({}),f=new fe({}),o=new Re({props:{way:u[0]}});let W=u[2]&&Q();return{c(){e=y("div"),t=y("h1"),t.textContent="osm2streets lane editor",n=g(),M(l.$$.fragment),a=g(),r=y("p"),r.innerHTML=`Improve OSM lane tagging with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>
      and <a href="https://gitlab.com/LeLuxNet/Muv" target="_blank">Muv</a>.`,s=g(),c=y("hr"),d=g(),M(f.$$.fragment),p=g(),w=y("hr"),i=g(),M(o.$$.fragment),_=g(),m=y("hr"),C=g(),E=y("div"),E.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",H=g(),W&&W.c(),I(e,"slot","left")},m(T,B){b(T,e,B),$(e,t),$(e,n),S(l,e,null),$(e,a),$(e,r),$(e,s),$(e,c),$(e,d),S(f,e,null),$(e,p),$(e,w),$(e,i),S(o,e,null),$(e,_),$(e,m),$(e,C),$(e,E),$(e,H),W&&W.m(e,null),G=!0},p(T,B){const V={};B&1&&(V.way=T[0]),o.$set(V),T[2]?W?B&4&&h(W,1):(W=Q(),W.c(),h(W,1),W.m(e,null)):W&&(P(),k(W,1,1,()=>{W=null}),q())},i(T){G||(h(l.$$.fragment,T),h(f.$$.fragment,T),h(o.$$.fragment,T),h(W),G=!0)},o(T){k(l.$$.fragment,T),k(f.$$.fragment,T),k(o.$$.fragment,T),k(W),G=!1},d(T){T&&v(e),O(l),O(f),O(o),W&&W.d()}}}function Be(u){let e,t;const n=[ve("current-way"),{paint:{"fill-color":"red","fill-opacity":.3}}];let l={};for(let a=0;a<n.length;a+=1)l=We(l,n[a]);return e=new Ce({props:l}),{c(){M(e.$$.fragment)},m(a,r){S(e,a,r),t=!0},p(a,r){const s={};e.$set(s)},i(a){t||(h(e.$$.fragment,a),t=!0)},o(a){k(e.$$.fragment,a),t=!1},d(a){O(e,a)}}}function Fe(u){let e,t,n,l,a,r,s,c,d,f,p,w,i,o,_;return t=new me({}),l=new $e({}),r=new _e({}),c=new ge({props:{hoverCursor:"pointer"}}),c.$on("click",u[3]),f=new ye({}),w=new he({props:{data:u[1],$$slots:{default:[Be]},$$scope:{ctx:u}}}),o=new we({}),{c(){e=y("div"),M(t.$$.fragment),n=g(),M(l.$$.fragment),a=g(),M(r.$$.fragment),s=g(),M(c.$$.fragment),d=g(),M(f.$$.fragment),p=g(),M(w.$$.fragment),i=g(),M(o.$$.fragment),ke(e,"display","none")},m(m,C){b(m,e,C),S(t,e,null),$(e,n),S(l,e,null),$(e,a),S(r,e,null),$(e,s),S(c,e,null),$(e,d),S(f,e,null),$(e,p),S(w,e,null),b(m,i,C),S(o,m,C),_=!0},p(m,C){const E={};C&2&&(E.data=m[1]),C&32&&(E.$$scope={dirty:C,ctx:m}),w.$set(E)},i(m){_||(h(t.$$.fragment,m),h(l.$$.fragment,m),h(r.$$.fragment,m),h(c.$$.fragment,m),h(f.$$.fragment,m),h(w.$$.fragment,m),h(o.$$.fragment,m),_=!0)},o(m){k(t.$$.fragment,m),k(l.$$.fragment,m),k(r.$$.fragment,m),k(c.$$.fragment,m),k(f.$$.fragment,m),k(w.$$.fragment,m),k(o.$$.fragment,m),_=!1},d(m){m&&(v(e),v(i)),O(t),O(l),O(r),O(c),O(f),O(w),O(o,m)}}}function Je(u){let e,t,n;return t=new ce({props:{$$slots:{default:[Fe]},$$scope:{ctx:u}}}),{c(){e=y("div"),M(t.$$.fragment),I(e,"slot","main")},m(l,a){b(l,e,a),S(t,e,null),n=!0},p(l,a){const r={};a&34&&(r.$$scope={dirty:a,ctx:l}),t.$set(r)},i(l){n||(h(t.$$.fragment,l),n=!0)},o(l){k(t.$$.fragment,l),n=!1},d(l){l&&v(e),O(t)}}}function Ae(u){let e,t;return e=new se({props:{$$slots:{main:[Je],left:[Ge]},$$scope:{ctx:u}}}),{c(){M(e.$$.fragment)},m(n,l){S(e,n,l),t=!0},p(n,[l]){const a={};l&39&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){t||(h(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function ze(u,e,t){let n,l,a;J(u,D,c=>t(4,l=c)),J(u,be,c=>t(2,a=c)),oe(async()=>{await de()});let r=null;D.subscribe(c=>{t(0,r=null)});function s(c){let d=JSON.parse(c.detail.features[0].properties.osm_way_ids);d.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):t(0,r=BigInt(d[0]))}return u.$$.update=()=>{u.$$.dirty&17&&t(1,n=r?JSON.parse(l.getGeometryForWay(r)):ie())},[r,n,a,s,l]}class Pe extends A{constructor(e){super(),z(this,e,ze,Ae,R,{})}}new Pe({target:document.getElementById("app")});
