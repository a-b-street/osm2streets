var J1=Object.defineProperty;var Q1=(t,e,n)=>e in t?J1(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var gm=(t,e,n)=>(Q1(t,typeof e!="symbol"?e+"":e,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const l of document.querySelectorAll('link[rel="modulepreload"]'))o(l);new MutationObserver(l=>{for(const h of l)if(h.type==="childList")for(const _ of h.addedNodes)_.tagName==="LINK"&&_.rel==="modulepreload"&&o(_)}).observe(document,{childList:!0,subtree:!0});function n(l){const h={};return l.integrity&&(h.integrity=l.integrity),l.referrerPolicy&&(h.referrerPolicy=l.referrerPolicy),l.crossOrigin==="use-credentials"?h.credentials="include":l.crossOrigin==="anonymous"?h.credentials="omit":h.credentials="same-origin",h}function o(l){if(l.ep)return;l.ep=!0;const h=n(l);fetch(l.href,h)}})();function Tn(){}function tb(t,e){for(const n in e)t[n]=e[n];return t}function J0(t){return t()}function Wy(){return Object.create(null)}function ua(t){t.forEach(J0)}function Q0(t){return typeof t=="function"}function si(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}let Td;function zs(t,e){return t===e?!0:(Td||(Td=document.createElement("a")),Td.href=e,t===Td.href)}function eb(t){return Object.keys(t).length===0}function tv(t,...e){if(t==null){for(const o of e)o(void 0);return Tn}const n=t.subscribe(...e);return n.unsubscribe?()=>n.unsubscribe():n}function nb(t){let e;return tv(t,n=>e=n)(),e}function xs(t,e,n){t.$$.on_destroy.push(tv(e,n))}function Bd(t,e,n,o){if(t){const l=ev(t,e,n,o);return t[0](l)}}function ev(t,e,n,o){return t[1]&&o?tb(n.ctx.slice(),t[1](o(e))):n.ctx}function Ud(t,e,n,o){if(t[2]&&o){const l=t[2](o(n));if(e.dirty===void 0)return l;if(typeof l=="object"){const h=[],_=Math.max(e.dirty.length,l.length);for(let u=0;u<_;u+=1)h[u]=e.dirty[u]|l[u];return h}return e.dirty|l}return e.dirty}function Vd(t,e,n,o,l,h){if(l){const _=ev(e,n,o,h);t.p(_,l)}}function Gd(t){if(t.ctx.length>32){const e=[],n=t.ctx.length/32;for(let o=0;o<n;o++)e[o]=-1;return e}return-1}function Hy(t){return t??""}const rb=typeof window<"u"?window:typeof globalThis<"u"?globalThis:global;function we(t,e){t.appendChild(e)}function tn(t,e,n){t.insertBefore(e,n||null)}function Ke(t){t.parentNode&&t.parentNode.removeChild(t)}function ib(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}function Ne(t){return document.createElement(t)}function cc(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function Ai(t){return document.createTextNode(t)}function qn(){return Ai(" ")}function nv(){return Ai("")}function lr(t,e,n,o){return t.addEventListener(e,n,o),()=>t.removeEventListener(e,n,o)}function ob(t){return function(e){return e.preventDefault(),t.call(this,e)}}function Xt(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function sb(t){let e;return{p(...n){e=n,e.forEach(o=>t.push(o))},r(){e.forEach(n=>t.splice(t.indexOf(n),1))}}}function ab(t){return Array.from(t.childNodes)}function Eu(t,e){e=""+e,t.data!==e&&(t.data=e)}function Iu(t,e){t.value=e??""}function OI(t,e,n,o){n==null?t.style.removeProperty(e):t.style.setProperty(e,n,o?"important":"")}function jd(t,e,n){for(let o=0;o<t.options.length;o+=1){const l=t.options[o];if(l.__value===e){l.selected=!0;return}}(!n||e!==void 0)&&(t.selectedIndex=-1)}function rv(t){const e=t.querySelector(":checked");return e&&e.__value}function oc(t,e,n){t.classList.toggle(e,!!n)}function lb(t,e,{bubbles:n=!1,cancelable:o=!1}={}){return new CustomEvent(t,{detail:e,bubbles:n,cancelable:o})}let Sf;function bf(t){Sf=t}function $m(){if(!Sf)throw new Error("Function called outside component initialization");return Sf}function ig(t){$m().$$.on_mount.push(t)}function og(t){$m().$$.on_destroy.push(t)}function Km(){const t=$m();return(e,n,{cancelable:o=!1}={})=>{const l=t.$$.callbacks[e];if(l){const h=lb(e,n,{cancelable:o});return l.slice().forEach(_=>{_.call(t,h)}),!h.defaultPrevented}return!0}}function $y(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(o=>o.call(this,e))}const Yh=[],yo=[];let Kh=[];const Em=[],ub=Promise.resolve();let Im=!1;function cb(){Im||(Im=!0,ub.then(iv))}function Tf(t){Kh.push(t)}function Js(t){Em.push(t)}const mm=new Set;let jh=0;function iv(){if(jh!==0)return;const t=Sf;do{try{for(;jh<Yh.length;){const e=Yh[jh];jh++,bf(e),hb(e.$$)}}catch(e){throw Yh.length=0,jh=0,e}for(bf(null),Yh.length=0,jh=0;yo.length;)yo.pop()();for(let e=0;e<Kh.length;e+=1){const n=Kh[e];mm.has(n)||(mm.add(n),n())}Kh.length=0}while(Yh.length);for(;Em.length;)Em.pop()();Im=!1,mm.clear(),bf(t)}function hb(t){if(t.fragment!==null){t.update(),ua(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Tf)}}function pb(t){const e=[],n=[];Kh.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),Kh=e}const kd=new Set;let Xc;function Jh(){Xc={r:0,c:[],p:Xc}}function Qh(){Xc.r||ua(Xc.c),Xc=Xc.p}function un(t,e){t&&t.i&&(kd.delete(t),t.i(e))}function dn(t,e,n,o){if(t&&t.o){if(kd.has(t))return;kd.add(t),Xc.c.push(()=>{kd.delete(t),o&&(n&&t.d(1),o())}),t.o(e)}else o&&o()}function qd(t){return(t==null?void 0:t.length)!==void 0?t:Array.from(t)}function zI(t,e){t.d(1),e.delete(t.key)}function fb(t,e){dn(t,1,1,()=>{e.delete(t.key)})}function db(t,e,n,o,l,h,_,u,I,w,D,k){let G=t.length,H=h.length,j=G;const K={};for(;j--;)K[t[j].key]=j;const lt=[],dt=new Map,xt=new Map,gt=[];for(j=H;j--;){const Ut=k(l,h,j),Zt=n(Ut);let qt=_.get(Zt);qt?o&&gt.push(()=>qt.p(Ut,e)):(qt=w(Zt,Ut),qt.c()),dt.set(Zt,lt[j]=qt),Zt in K&&xt.set(Zt,Math.abs(j-K[Zt]))}const yt=new Set,Nt=new Set;function Gt(Ut){un(Ut,1),Ut.m(u,D),_.set(Ut.key,Ut),D=Ut.first,H--}for(;G&&H;){const Ut=lt[H-1],Zt=t[G-1],qt=Ut.key,Qt=Zt.key;Ut===Zt?(D=Ut.first,G--,H--):dt.has(Qt)?!_.has(qt)||yt.has(qt)?Gt(Ut):Nt.has(Qt)?G--:xt.get(qt)>xt.get(Qt)?(Nt.add(qt),Gt(Ut)):(yt.add(Qt),G--):(I(Zt,_),G--)}for(;G--;){const Ut=t[G];dt.has(Ut.key)||I(Ut,_)}for(;H;)Gt(lt[H-1]);return ua(gt),lt}function Qs(t,e,n){const o=t.$$.props[e];o!==void 0&&(t.$$.bound[o]=n,n(t.$$.ctx[o]))}function Lr(t){t&&t.c()}function wr(t,e,n){const{fragment:o,after_update:l}=t.$$;o&&o.m(e,n),Tf(()=>{const h=t.$$.on_mount.map(J0).filter(Q0);t.$$.on_destroy?t.$$.on_destroy.push(...h):ua(h),t.$$.on_mount=[]}),l.forEach(Tf)}function Er(t,e){const n=t.$$;n.fragment!==null&&(pb(n.after_update),ua(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function gb(t,e){t.$$.dirty[0]===-1&&(Yh.push(t),cb(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function gi(t,e,n,o,l,h,_=null,u=[-1]){const I=Sf;bf(t);const w=t.$$={fragment:null,ctx:[],props:h,update:Tn,not_equal:l,bound:Wy(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(I?I.$$.context:[])),callbacks:Wy(),dirty:u,skip_bound:!1,root:e.target||I.$$.root};_&&_(w.root);let D=!1;if(w.ctx=n?n(t,e.props||{},(k,G,...H)=>{const j=H.length?H[0]:G;return w.ctx&&l(w.ctx[k],w.ctx[k]=j)&&(!w.skip_bound&&w.bound[k]&&w.bound[k](j),D&&gb(t,k)),G}):[],w.update(),D=!0,ua(w.before_update),w.fragment=o?o(w.ctx):!1,e.target){if(e.hydrate){const k=ab(e.target);w.fragment&&w.fragment.l(k),k.forEach(Ke)}else w.fragment&&w.fragment.c();e.intro&&un(t.$$.fragment),wr(t,e.target,e.anchor),iv()}bf(I)}class mi{constructor(){gm(this,"$$");gm(this,"$$set")}$destroy(){Er(this,1),this.$destroy=Tn}$on(e,n){if(!Q0(n))return Tn;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const l=o.indexOf(n);l!==-1&&o.splice(l,1)}}$set(e){this.$$set&&!eb(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const mb="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(mb);let re;const ov=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&ov.decode();let gf=null;function Nd(){return(gf===null||gf.byteLength===0)&&(gf=new Uint8Array(re.memory.buffer)),gf}function ji(t,e){return t=t>>>0,ov.decode(Nd().subarray(t,t+e))}const vu=new Array(128).fill(void 0);vu.push(void 0,null,!0,!1);let wf=vu.length;function Qi(t){wf===vu.length&&vu.push(vu.length+1);const e=wf;return wf=vu[e],vu[e]=t,e}function rr(t){return vu[t]}function _b(t){t<132||(vu[t]=wf,wf=t)}function sg(t){const e=rr(t);return _b(t),e}function _m(t){return t==null}let mf=null;function yb(){return(mf===null||mf.byteLength===0)&&(mf=new Float64Array(re.memory.buffer)),mf}let _f=null;function bn(){return(_f===null||_f.byteLength===0)&&(_f=new Int32Array(re.memory.buffer)),_f}let ac=0;const Rd=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},vb=typeof Rd.encodeInto=="function"?function(t,e){return Rd.encodeInto(t,e)}:function(t,e){const n=Rd.encode(t);return e.set(n),{read:t.length,written:n.length}};function tp(t,e,n){if(n===void 0){const u=Rd.encode(t),I=e(u.length,1)>>>0;return Nd().subarray(I,I+u.length).set(u),ac=u.length,I}let o=t.length,l=e(o,1)>>>0;const h=Nd();let _=0;for(;_<o;_++){const u=t.charCodeAt(_);if(u>127)break;h[l+_]=u}if(_!==o){_!==0&&(t=t.slice(_)),l=n(l,o,o=_+t.length*3,1)>>>0;const u=Nd().subarray(l+_,l+o),I=vb(t,u);_+=I.written}return ac=_,l}function Sm(t){const e=typeof t;if(e=="number"||e=="boolean"||t==null)return`${t}`;if(e=="string")return`"${t}"`;if(e=="symbol"){const l=t.description;return l==null?"Symbol":`Symbol(${l})`}if(e=="function"){const l=t.name;return typeof l=="string"&&l.length>0?`Function(${l})`:"Function"}if(Array.isArray(t)){const l=t.length;let h="[";l>0&&(h+=Sm(t[0]));for(let _=1;_<l;_++)h+=", "+Sm(t[_]);return h+="]",h}const n=/\[object ([^\]]+)\]/.exec(toString.call(t));let o;if(n.length>1)o=n[1];else return toString.call(t);if(o=="Object")try{return"Object("+JSON.stringify(t)+")"}catch{return"Object"}return t instanceof Error?`${t.name}: ${t.message}
${t.stack}`:o}let yf=null;function xb(){return(yf===null||yf.byteLength===0)&&(yf=new Uint32Array(re.memory.buffer)),yf}function bb(t,e){t=t>>>0;const o=xb().subarray(t/4,t/4+e),l=[];for(let h=0;h<o.length;h++)l.push(sg(o[h]));return l}function qh(t,e){try{return t.apply(this,e)}catch(n){re.__wbindgen_exn_store(Qi(n))}}class Jm{static __wrap(e){e=e>>>0;const n=Object.create(Jm.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();re.__wbg_jsdebugstreets_free(e)}getLabel(){let e,n;try{const h=re.__wbindgen_add_to_stack_pointer(-16);re.jsdebugstreets_getLabel(h,this.__wbg_ptr);var o=bn()[h/4+0],l=bn()[h/4+1];return e=o,n=l,ji(o,l)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,n,1)}}getNetwork(){const e=re.jsdebugstreets_getNetwork(this.__wbg_ptr);return sg(e)}toDebugGeojson(){try{const o=re.__wbindgen_add_to_stack_pointer(-16);re.jsdebugstreets_toDebugGeojson(o,this.__wbg_ptr);var e=bn()[o/4+0],n=bn()[o/4+1];let l;return e!==0&&(l=ji(e,n).slice(),re.__wbindgen_free(e,n*1,1)),l}finally{re.__wbindgen_add_to_stack_pointer(16)}}}class ag{static __wrap(e){e=e>>>0;const n=Object.create(ag.prototype);return n.__wbg_ptr=e,n}__destroy_into_raw(){const e=this.__wbg_ptr;return this.__wbg_ptr=0,e}free(){const e=this.__destroy_into_raw();re.__wbg_jsstreetnetwork_free(e)}constructor(e,n,o){try{const u=re.__wbindgen_add_to_stack_pointer(-16),I=tp(e,re.__wbindgen_malloc,re.__wbindgen_realloc),w=ac,D=tp(n,re.__wbindgen_malloc,re.__wbindgen_realloc),k=ac;re.jsstreetnetwork_new(u,I,w,D,k,Qi(o));var l=bn()[u/4+0],h=bn()[u/4+1],_=bn()[u/4+2];if(_)throw sg(h);return this.__wbg_ptr=l>>>0,this}finally{re.__wbindgen_add_to_stack_pointer(16)}}toGeojsonPlain(){let e,n;try{const h=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_toGeojsonPlain(h,this.__wbg_ptr);var o=bn()[h/4+0],l=bn()[h/4+1];return e=o,n=l,ji(o,l)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,n,1)}}toLanePolygonsGeojson(){let e,n;try{const h=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_toLanePolygonsGeojson(h,this.__wbg_ptr);var o=bn()[h/4+0],l=bn()[h/4+1];return e=o,n=l,ji(o,l)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,n,1)}}toLaneMarkingsGeojson(){let e,n;try{const h=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_toLaneMarkingsGeojson(h,this.__wbg_ptr);var o=bn()[h/4+0],l=bn()[h/4+1];return e=o,n=l,ji(o,l)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,n,1)}}toIntersectionMarkingsGeojson(){let e,n;try{const h=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_toIntersectionMarkingsGeojson(h,this.__wbg_ptr);var o=bn()[h/4+0],l=bn()[h/4+1];return e=o,n=l,ji(o,l)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,n,1)}}toGraphviz(){let e,n;try{const h=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_toGraphviz(h,this.__wbg_ptr);var o=bn()[h/4+0],l=bn()[h/4+1];return e=o,n=l,ji(o,l)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,n,1)}}getDebugSteps(){try{const l=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_getDebugSteps(l,this.__wbg_ptr);var e=bn()[l/4+0],n=bn()[l/4+1],o=bb(e,n).slice();return re.__wbindgen_free(e,n*4,4),o}finally{re.__wbindgen_add_to_stack_pointer(16)}}debugClockwiseOrderingGeojson(){let e,n;try{const h=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_debugClockwiseOrderingGeojson(h,this.__wbg_ptr);var o=bn()[h/4+0],l=bn()[h/4+1];return e=o,n=l,ji(o,l)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,n,1)}}debugClockwiseOrderingForIntersectionGeojson(e){let n,o;try{const _=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_debugClockwiseOrderingForIntersectionGeojson(_,this.__wbg_ptr,e);var l=bn()[_/4+0],h=bn()[_/4+1];return n=l,o=h,ji(l,h)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(n,o,1)}}debugMovementsFromLaneGeojson(e,n){let o,l;try{const u=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_debugMovementsFromLaneGeojson(u,this.__wbg_ptr,e,n);var h=bn()[u/4+0],_=bn()[u/4+1];return o=h,l=_,ji(h,_)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(o,l,1)}}debugRoadsConnectedToIntersectionGeojson(e){let n,o;try{const _=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_debugRoadsConnectedToIntersectionGeojson(_,this.__wbg_ptr,e);var l=bn()[_/4+0],h=bn()[_/4+1];return n=l,o=h,ji(l,h)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(n,o,1)}}getOsmTagsForWay(e){let n,o;try{const _=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_getOsmTagsForWay(_,this.__wbg_ptr,e);var l=bn()[_/4+0],h=bn()[_/4+1];return n=l,o=h,ji(l,h)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(n,o,1)}}toJson(){let e,n;try{const h=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_toJson(h,this.__wbg_ptr);var o=bn()[h/4+0],l=bn()[h/4+1];return e=o,n=l,ji(o,l)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(e,n,1)}}getGeometryForWay(e){let n,o;try{const _=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_getGeometryForWay(_,this.__wbg_ptr,e);var l=bn()[_/4+0],h=bn()[_/4+1];return n=l,o=h,ji(l,h)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(n,o,1)}}wayToXml(e){let n,o;try{const _=re.__wbindgen_add_to_stack_pointer(-16);re.jsstreetnetwork_wayToXml(_,this.__wbg_ptr,e);var l=bn()[_/4+0],h=bn()[_/4+1];return n=l,o=h,ji(l,h)}finally{re.__wbindgen_add_to_stack_pointer(16),re.__wbindgen_free(n,o,1)}}overwriteOsmTagsForWay(e,n){const o=tp(n,re.__wbindgen_malloc,re.__wbindgen_realloc),l=ac;re.jsstreetnetwork_overwriteOsmTagsForWay(this.__wbg_ptr,e,o,l)}collapseShortRoad(e){re.jsstreetnetwork_collapseShortRoad(this.__wbg_ptr,e)}collapseIntersection(e){re.jsstreetnetwork_collapseIntersection(this.__wbg_ptr,e)}zipSidepath(e){re.jsstreetnetwork_zipSidepath(this.__wbg_ptr,e)}}async function wb(t,e){if(typeof Response=="function"&&t instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(t,e)}catch(o){if(t.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const n=await t.arrayBuffer();return await WebAssembly.instantiate(n,e)}else{const n=await WebAssembly.instantiate(t,e);return n instanceof WebAssembly.Instance?{instance:n,module:t}:n}}function Eb(){const t={};return t.wbg={},t.wbg.__wbg_jsdebugstreets_new=function(e){const n=Jm.__wrap(e);return Qi(n)},t.wbg.__wbindgen_string_new=function(e,n){const o=ji(e,n);return Qi(o)},t.wbg.__wbg_jsstreetnetwork_new=function(e){const n=ag.__wrap(e);return Qi(n)},t.wbg.__wbindgen_boolean_get=function(e){const n=rr(e);return typeof n=="boolean"?n?1:0:2},t.wbg.__wbindgen_object_drop_ref=function(e){sg(e)},t.wbg.__wbindgen_is_object=function(e){const n=rr(e);return typeof n=="object"&&n!==null},t.wbg.__wbindgen_is_undefined=function(e){return rr(e)===void 0},t.wbg.__wbindgen_in=function(e,n){return rr(e)in rr(n)},t.wbg.__wbindgen_error_new=function(e,n){const o=new Error(ji(e,n));return Qi(o)},t.wbg.__wbindgen_object_clone_ref=function(e){const n=rr(e);return Qi(n)},t.wbg.__wbindgen_jsval_loose_eq=function(e,n){return rr(e)==rr(n)},t.wbg.__wbindgen_number_get=function(e,n){const o=rr(n),l=typeof o=="number"?o:void 0;yb()[e/8+1]=_m(l)?0:l,bn()[e/4+0]=!_m(l)},t.wbg.__wbindgen_string_get=function(e,n){const o=rr(n),l=typeof o=="string"?o:void 0;var h=_m(l)?0:tp(l,re.__wbindgen_malloc,re.__wbindgen_realloc),_=ac;bn()[e/4+1]=_,bn()[e/4+0]=h},t.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(e,n){const o=rr(e)[rr(n)];return Qi(o)},t.wbg.__wbg_new_abda76e883ba8a5f=function(){const e=new Error;return Qi(e)},t.wbg.__wbg_stack_658279fe44541cf6=function(e,n){const o=rr(n).stack,l=tp(o,re.__wbindgen_malloc,re.__wbindgen_realloc),h=ac;bn()[e/4+1]=h,bn()[e/4+0]=l},t.wbg.__wbg_error_f851667af71bcfc6=function(e,n){let o,l;try{o=e,l=n,console.error(ji(e,n))}finally{re.__wbindgen_free(o,l,1)}},t.wbg.__wbg_debug_2ef5d777cf4811fa=function(e){console.debug(rr(e))},t.wbg.__wbg_error_f0a6627f4b23c19d=function(e){console.error(rr(e))},t.wbg.__wbg_info_3ca7870690403fee=function(e){console.info(rr(e))},t.wbg.__wbg_log_7811587c4c6d2844=function(e){console.log(rr(e))},t.wbg.__wbg_warn_4affe1093892a4ef=function(e){console.warn(rr(e))},t.wbg.__wbg_now_0669e62508913829=function(e){return rr(e).now()},t.wbg.__wbg_newnoargs_c62ea9419c21fbac=function(e,n){const o=new Function(ji(e,n));return Qi(o)},t.wbg.__wbg_get_7b48513de5dc5ea4=function(){return qh(function(e,n){const o=Reflect.get(rr(e),rr(n));return Qi(o)},arguments)},t.wbg.__wbg_call_90c26b09837aba1c=function(){return qh(function(e,n){const o=rr(e).call(rr(n));return Qi(o)},arguments)},t.wbg.__wbg_self_f0e34d89f33b99fd=function(){return qh(function(){const e=self.self;return Qi(e)},arguments)},t.wbg.__wbg_window_d3b084224f4774d7=function(){return qh(function(){const e=window.window;return Qi(e)},arguments)},t.wbg.__wbg_globalThis_9caa27ff917c6860=function(){return qh(function(){const e=globalThis.globalThis;return Qi(e)},arguments)},t.wbg.__wbg_global_35dfdd59a4da3e74=function(){return qh(function(){const e=global.global;return Qi(e)},arguments)},t.wbg.__wbg_instanceof_ArrayBuffer_e7d53d51371448e2=function(e){let n;try{n=rr(e)instanceof ArrayBuffer}catch{n=!1}return n},t.wbg.__wbg_buffer_a448f833075b71ba=function(e){const n=rr(e).buffer;return Qi(n)},t.wbg.__wbg_new_8f67e318f15d7254=function(e){const n=new Uint8Array(rr(e));return Qi(n)},t.wbg.__wbg_set_2357bf09366ee480=function(e,n,o){rr(e).set(rr(n),o>>>0)},t.wbg.__wbg_length_1d25fa9e4ac21ce7=function(e){return rr(e).length},t.wbg.__wbg_instanceof_Uint8Array_bced6f43aed8c1aa=function(e){let n;try{n=rr(e)instanceof Uint8Array}catch{n=!1}return n},t.wbg.__wbindgen_debug_string=function(e,n){const o=Sm(rr(n)),l=tp(o,re.__wbindgen_malloc,re.__wbindgen_realloc),h=ac;bn()[e/4+1]=h,bn()[e/4+0]=l},t.wbg.__wbindgen_throw=function(e,n){throw new Error(ji(e,n))},t.wbg.__wbindgen_memory=function(){const e=re.memory;return Qi(e)},t}function Ib(t,e){return re=t.exports,Sb.__wbindgen_wasm_module=e,mf=null,_f=null,yf=null,gf=null,re}async function Sb(t){if(re!==void 0)return re;typeof t>"u"&&(t="/osm2streets/assets/osm2streets_js_bg.wasm");const e=Eb();(typeof t=="string"||typeof Request=="function"&&t instanceof Request||typeof URL=="function"&&t instanceof URL)&&(t=fetch(t));const{instance:n,module:o}=await wb(await t,e);return Ib(n,o)}function Tb(t){let e,n,o,l,h,_,u;return{c(){e=Ne("div"),n=Ai(`App:
  `),o=Ne("select"),l=Ne("option"),l.textContent="Street Explorer",h=Ne("option"),h.textContent="Lane editor",l.__value="index.html",Iu(l,l.__value),h.__value="lane_editor.html",Iu(h,h.__value),t[0]===void 0&&Tf(()=>t[2].call(o))},m(I,w){tn(I,e,w),we(e,n),we(e,o),we(o,l),we(o,h),jd(o,t[0],!0),_||(u=[lr(o,"change",t[2]),lr(o,"change",t[1])],_=!0)},p(I,[w]){w&1&&jd(o,I[0])},i:Tn,o:Tn,d(I){I&&Ke(e),_=!1,ua(u)}}}function Cb(t,e,n){let o=window.location.pathname.split("/").pop()||"index.html",l=o;function h(){l!=o&&(window.location.href=l)}function _(){l=rv(this),n(0,l)}return[l,h,_]}class FI extends mi{constructor(e){super(),gi(this,e,Cb,Tb,si,{})}}var Wh=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function sv(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var av={exports:{}};(function(t,e){(function(n,o){t.exports=o()})(Wh,function(){var n,o,l;function h(u,I){if(!n)n=I;else if(!o)o=I;else{var w="var sharedChunk = {}; ("+n+")(sharedChunk); ("+o+")(sharedChunk);",D={};n(D),l=I(D),typeof window<"u"&&(l.workerUrl=window.URL.createObjectURL(new Blob([w],{type:"text/javascript"})))}}h(["exports"],function(u){function I(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}var w=D;function D(s,r){this.x=s,this.y=r}D.prototype={clone:function(){return new D(this.x,this.y)},add:function(s){return this.clone()._add(s)},sub:function(s){return this.clone()._sub(s)},multByPoint:function(s){return this.clone()._multByPoint(s)},divByPoint:function(s){return this.clone()._divByPoint(s)},mult:function(s){return this.clone()._mult(s)},div:function(s){return this.clone()._div(s)},rotate:function(s){return this.clone()._rotate(s)},rotateAround:function(s,r){return this.clone()._rotateAround(s,r)},matMult:function(s){return this.clone()._matMult(s)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(s){return this.x===s.x&&this.y===s.y},dist:function(s){return Math.sqrt(this.distSqr(s))},distSqr:function(s){var r=s.x-this.x,a=s.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith:function(s){return this.angleWithSep(s.x,s.y)},angleWithSep:function(s,r){return Math.atan2(this.x*r-this.y*s,this.x*s+this.y*r)},_matMult:function(s){var r=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=r,this},_add:function(s){return this.x+=s.x,this.y+=s.y,this},_sub:function(s){return this.x-=s.x,this.y-=s.y,this},_mult:function(s){return this.x*=s,this.y*=s,this},_div:function(s){return this.x/=s,this.y/=s,this},_multByPoint:function(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint:function(s){return this.x/=s.x,this.y/=s.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var s=this.y;return this.y=this.x,this.x=-s,this},_rotate:function(s){var r=Math.cos(s),a=Math.sin(s),p=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=p,this},_rotateAround:function(s,r){var a=Math.cos(s),p=Math.sin(s),g=r.y+p*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-p*(this.y-r.y),this.y=g,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},D.convert=function(s){return s instanceof D?s:Array.isArray(s)?new D(s[0],s[1]):s};var k=I(w),G=H;function H(s,r,a,p){this.cx=3*s,this.bx=3*(a-s)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(p-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=s,this.p1y=r,this.p2x=a,this.p2y=p}H.prototype={sampleCurveX:function(s){return((this.ax*s+this.bx)*s+this.cx)*s},sampleCurveY:function(s){return((this.ay*s+this.by)*s+this.cy)*s},sampleCurveDerivativeX:function(s){return(3*this.ax*s+2*this.bx)*s+this.cx},solveCurveX:function(s,r){if(r===void 0&&(r=1e-6),s<0)return 0;if(s>1)return 1;for(var a=s,p=0;p<8;p++){var g=this.sampleCurveX(a)-s;if(Math.abs(g)<r)return a;var y=this.sampleCurveDerivativeX(a);if(Math.abs(y)<1e-6)break;a-=g/y}var v=0,E=1;for(a=s,p=0;p<20&&(g=this.sampleCurveX(a),!(Math.abs(g-s)<r));p++)s>g?v=a:E=a,a=.5*(E-v)+v;return a},solve:function(s,r){return this.sampleCurveY(this.solveCurveX(s,r))}};var j=I(G);function K(s,r,a,p){const g=new j(s,r,a,p);return function(y){return g.solve(y)}}const lt=K(.25,.1,.25,1);function dt(s,r,a){return Math.min(a,Math.max(r,s))}function xt(s,r,a){const p=a-r,g=((s-r)%p+p)%p+r;return g===r?a:g}function gt(s,...r){for(const a of r)for(const p in a)s[p]=a[p];return s}let yt=1;function Nt(s,r){s.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function Gt(s,r,a){const p={};for(const g in s)p[g]=r.call(a||this,s[g],g,s);return p}function Ut(s,r,a){const p={};for(const g in s)r.call(a||this,s[g],g,s)&&(p[g]=s[g]);return p}function Zt(s){return Array.isArray(s)?s.map(Zt):typeof s=="object"&&s?Gt(s,Zt):s}const qt={};function Qt(s){qt[s]||(typeof console<"u"&&console.warn(s),qt[s]=!0)}function ie(s,r,a){return(a.y-s.y)*(r.x-s.x)>(r.y-s.y)*(a.x-s.x)}function ve(s){let r=0;for(let a,p,g=0,y=s.length,v=y-1;g<y;v=g++)a=s[g],p=s[v],r+=(p.x-a.x)*(a.y+p.y);return r}function Ue(){return typeof WorkerGlobalScope<"u"&&typeof self<"u"&&self instanceof WorkerGlobalScope}let Rt=null;function Se(s){if(Rt==null){const r=s.navigator?s.navigator.userAgent:null;Rt=!!s.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Rt}function Ye(s){return typeof ImageBitmap<"u"&&s instanceof ImageBitmap}const yn="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let tr,Xn;const _i={now:typeof performance<"u"&&performance&&performance.now?performance.now.bind(performance):Date.now.bind(Date),frame(s){const r=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(r)}},getImageData(s,r=0){return this.getImageCanvasContext(s).getImageData(-r,-r,s.width+2*r,s.height+2*r)},getImageCanvasContext(s){const r=window.document.createElement("canvas"),a=r.getContext("2d",{willReadFrequently:!0});if(!a)throw new Error("failed to create canvas 2d context");return r.width=s.width,r.height=s.height,a.drawImage(s,0,0,s.width,s.height),a},resolveURL:s=>(tr||(tr=document.createElement("a")),tr.href=s,tr.href),hardwareConcurrency:typeof navigator<"u"&&navigator.hardwareConcurrency||4,get prefersReducedMotion(){return!!matchMedia&&(Xn==null&&(Xn=matchMedia("(prefers-reduced-motion: reduce)")),Xn.matches)}},An={MAX_PARALLEL_IMAGE_REQUESTS:16,MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:8,MAX_TILE_CACHE_ZOOM_LEVELS:5,REGISTERED_PROTOCOLS:{},WORKER_URL:""};class pr extends Error{constructor(r,a,p,g){super(`AJAXError: ${a} (${r}): ${p}`),this.status=r,this.statusText=a,this.url=p,this.body=g}}const wn=Ue()?()=>self.worker&&self.worker.referrer:()=>(window.location.protocol==="blob:"?window.parent:window).location.href,Yn=s=>An.REGISTERED_PROTOCOLS[s.substring(0,s.indexOf("://"))];function ur(s,r){const a=new AbortController,p=new Request(s.url,{method:s.method||"GET",body:s.body,credentials:s.credentials,headers:s.headers,referrer:wn(),signal:a.signal});let g=!1,y=!1;return s.type==="json"&&p.headers.set("Accept","application/json"),y||fetch(p).then(v=>v.ok?(E=>{(s.type==="arrayBuffer"||s.type==="image"?E.arrayBuffer():s.type==="json"?E.json():E.text()).then(T=>{y||(g=!0,r(null,T,E.headers.get("Cache-Control"),E.headers.get("Expires")))}).catch(T=>{y||r(new Error(T.message))})})(v):v.blob().then(E=>r(new pr(v.status,v.statusText,s.url,E)))).catch(v=>{v.code!==20&&r(new Error(v.message))}),{cancel:()=>{y=!0,g||a.abort()}}}const Uo=function(s,r){if(/:\/\//.test(s.url)&&!/^https?:|^file:/.test(s.url)){if(Ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r);if(!Ue())return(Yn(s.url)||ur)(s,r)}if(!(/^file:/.test(a=s.url)||/^file:/.test(wn())&&!/^\w+:/.test(a))){if(fetch&&Request&&AbortController&&Object.prototype.hasOwnProperty.call(Request.prototype,"signal"))return ur(s,r);if(Ue()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",s,r,void 0,!0)}var a;return function(p,g){const y=new XMLHttpRequest;y.open(p.method||"GET",p.url,!0),p.type!=="arrayBuffer"&&p.type!=="image"||(y.responseType="arraybuffer");for(const v in p.headers)y.setRequestHeader(v,p.headers[v]);return p.type==="json"&&(y.responseType="text",y.setRequestHeader("Accept","application/json")),y.withCredentials=p.credentials==="include",y.onerror=()=>{g(new Error(y.statusText))},y.onload=()=>{if((y.status>=200&&y.status<300||y.status===0)&&y.response!==null){let v=y.response;if(p.type==="json")try{v=JSON.parse(y.response)}catch(E){return g(E)}g(null,v,y.getResponseHeader("Cache-Control"),y.getResponseHeader("Expires"))}else{const v=new Blob([y.response],{type:y.getResponseHeader("Content-Type")});g(new pr(y.status,y.statusText,p.url,v))}},y.send(p.body),{cancel:()=>y.abort()}}(s,r)},Ur=function(s,r){return Uo(gt(s,{type:"arrayBuffer"}),r)};function Qe(s){if(!s||s.indexOf("://")<=0||s.indexOf("data:image/")===0||s.indexOf("blob:")===0)return!0;const r=new URL(s),a=window.location;return r.protocol===a.protocol&&r.host===a.host}function Ni(s,r,a){a[s]&&a[s].indexOf(r)!==-1||(a[s]=a[s]||[],a[s].push(r))}function _n(s,r,a){if(a&&a[s]){const p=a[s].indexOf(r);p!==-1&&a[s].splice(p,1)}}class cr{constructor(r,a={}){gt(this,a),this.type=r}}class We extends cr{constructor(r,a={}){super("error",gt({error:r},a))}}class js{on(r,a){return this._listeners=this._listeners||{},Ni(r,a,this._listeners),this}off(r,a){return _n(r,a,this._listeners),_n(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Ni(r,a,this._oneTimeListeners),this):new Promise(p=>this.once(r,p))}fire(r,a){typeof r=="string"&&(r=new cr(r,a||{}));const p=r.type;if(this.listens(p)){r.target=this;const g=this._listeners&&this._listeners[p]?this._listeners[p].slice():[];for(const E of g)E.call(this,r);const y=this._oneTimeListeners&&this._oneTimeListeners[p]?this._oneTimeListeners[p].slice():[];for(const E of y)_n(p,E,this._oneTimeListeners),E.call(this,r);const v=this._eventedParent;v&&(gt(r,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),v.fire(r))}else r instanceof We&&console.error(r.error);return this}listens(r){return this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r)}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var St={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},terrain:{type:"terrain"},sources:{required:!0,type:"sources"},sprite:{type:"sprite"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{required:!0,type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image",{"!":"icon-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"padding",default:[2],units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},"viewport-glyph":{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field",{"!":"text-overlap"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-overlap":{type:"enum",values:{never:{},always:{},cooperative:{}},requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},terrain:{source:{type:"string",required:!0},exaggeration:{type:"number",minimum:0,default:1}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}};const Gn=["type","source","source-layer","minzoom","maxzoom","filter","layout"];function Sr(s,r){const a={};for(const p in s)p!=="ref"&&(a[p]=s[p]);return Gn.forEach(p=>{p in r&&(a[p]=r[p])}),a}function Ln(s,r){if(Array.isArray(s)){if(!Array.isArray(r)||s.length!==r.length)return!1;for(let a=0;a<s.length;a++)if(!Ln(s[a],r[a]))return!1;return!0}if(typeof s=="object"&&s!==null&&r!==null){if(typeof r!="object"||Object.keys(s).length!==Object.keys(r).length)return!1;for(const a in s)if(!Ln(s[a],r[a]))return!1;return!0}return s===r}const pn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function io(s,r,a){a.push({command:pn.addSource,args:[s,r[s]]})}function rs(s,r,a){r.push({command:pn.removeSource,args:[s]}),a[s]=!0}function is(s,r,a,p){rs(s,a,p),io(s,r,a)}function Tr(s,r,a){let p;for(p in s[a])if(Object.prototype.hasOwnProperty.call(s[a],p)&&p!=="data"&&!Ln(s[a][p],r[a][p]))return!1;for(p in r[a])if(Object.prototype.hasOwnProperty.call(r[a],p)&&p!=="data"&&!Ln(s[a][p],r[a][p]))return!1;return!0}function Nr(s,r,a,p,g,y){let v;for(v in r=r||{},s=s||{})Object.prototype.hasOwnProperty.call(s,v)&&(Ln(s[v],r[v])||a.push({command:y,args:[p,v,r[v],g]}));for(v in r)Object.prototype.hasOwnProperty.call(r,v)&&!Object.prototype.hasOwnProperty.call(s,v)&&(Ln(s[v],r[v])||a.push({command:y,args:[p,v,r[v],g]}))}function os(s){return s.id}function Co(s,r){return s[r.id]=r,s}class te{constructor(r,a,p,g){this.message=(r?`${r}: `:"")+p,g&&(this.identifier=g),a!=null&&a.__line__&&(this.line=a.__line__)}}function Ri(s,...r){for(const a of r)for(const p in a)s[p]=a[p];return s}class Vr extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}class ss{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[p,g]of a)this.bindings[p]=g}concat(r){return new ss(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}const Ki={kind:"null"},ee={kind:"number"},on={kind:"string"},Ve={kind:"boolean"},yi={kind:"color"},hr={kind:"object"},Xe={kind:"value"},oo={kind:"collator"},Gr={kind:"formatted"},Ii={kind:"padding"},as={kind:"resolvedImage"};function Jr(s,r){return{kind:"array",itemType:s,N:r}}function Jn(s){if(s.kind==="array"){const r=Jn(s.itemType);return typeof s.N=="number"?`array<${r}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${r}>`}return s.kind}const Wa=[Ki,ee,on,Ve,yi,Gr,hr,Jr(Xe),Ii,as];function Vo(s,r){if(r.kind==="error")return null;if(s.kind==="array"){if(r.kind==="array"&&(r.N===0&&r.itemType.kind==="value"||!Vo(s.itemType,r.itemType))&&(typeof s.N!="number"||s.N===r.N))return null}else{if(s.kind===r.kind)return null;if(s.kind==="value"){for(const a of Wa)if(!Vo(a,r))return null}}return`Expected ${Jn(s)} but found ${Jn(r)} instead.`}function V(s,r){return r.some(a=>a.kind===s.kind)}function z(s,r){return r.some(a=>a==="null"?s===null:a==="array"?Array.isArray(s):a==="object"?s&&!Array.isArray(s)&&typeof s=="object":a===typeof s)}function B(s,r){return s.kind==="array"&&r.kind==="array"?s.itemType.kind===r.itemType.kind&&typeof s.N=="number":s.kind===r.kind}const W=.96422,J=.82521,st=4/29,mt=6/29,ut=3*mt*mt,at=mt*mt*mt,vt=Math.PI/180,zt=180/Math.PI;function Bt(s){return(s%=360)<0&&(s+=360),s}function Vt([s,r,a,p]){let g,y;const v=$e((.2225045*(s=Ee(s))+.7168786*(r=Ee(r))+.0606169*(a=Ee(a)))/1);s===r&&r===a?g=y=v:(g=$e((.4360747*s+.3850649*r+.1430804*a)/W),y=$e((.0139322*s+.0971045*r+.7141733*a)/J));const E=116*v-16;return[E<0?0:E,500*(g-v),200*(v-y),p]}function Ee(s){return s<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function $e(s){return s>at?Math.pow(s,1/3):s/ut+st}function Ce([s,r,a,p]){let g=(s+16)/116,y=isNaN(r)?g:g+r/500,v=isNaN(a)?g:g-a/200;return g=1*Ze(g),y=W*Ze(y),v=J*Ze(v),[ke(3.1338561*y-1.6168667*g-.4906146*v),ke(-.9787684*y+1.9161415*g+.033454*v),ke(.0719453*y-.2289914*g+1.4052427*v),p]}function ke(s){return(s=s<=.00304?12.92*s:1.055*Math.pow(s,1/2.4)-.055)<0?0:s>1?1:s}function Ze(s){return s>mt?s*s*s:ut*(s-st)}function En(s){return parseInt(s.padEnd(2,s),16)/255}function hn(s,r){return In(r?s/100:s,0,1)}function In(s,r,a){return Math.min(Math.max(r,s),a)}function Wn(s){return!s.some(Number.isNaN)}const Rr={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],rebeccapurple:[102,51,153],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};class Te{constructor(r,a,p,g=1,y=!0){this.r=r,this.g=a,this.b=p,this.a=g,y||(this.r*=g,this.g*=g,this.b*=g,g||this.overwriteGetter("rgb",[r,a,p,g]))}static parse(r){if(r instanceof Te)return r;if(typeof r!="string")return;const a=function(p){if((p=p.toLowerCase())==="transparent")return[0,0,0,0];const g=Rr[p];if(g){const[v,E,T]=g;return[v/255,E/255,T/255,1]}if(p.startsWith("#")&&/^#(?:[0-9a-f]{3,4}|[0-9a-f]{6}|[0-9a-f]{8})$/.test(p)){const v=p.length<6?1:2;let E=1;return[En(p.slice(E,E+=v)),En(p.slice(E,E+=v)),En(p.slice(E,E+=v)),En(p.slice(E,E+v)||"ff")]}if(p.startsWith("rgb")){const v=p.match(/^rgba?\(\s*([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s+|\s*(,)\s*)([\de.+-]+)(%)?(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(v){const[E,T,L,N,F,U,q,Y,nt,tt,ft,bt]=v,ct=[N||" ",q||" ",tt].join("");if(ct==="  "||ct==="  /"||ct===",,"||ct===",,,"){const Ct=[L,U,nt].join(""),At=Ct==="%%%"?100:Ct===""?255:0;if(At){const Ft=[In(+T/At,0,1),In(+F/At,0,1),In(+Y/At,0,1),ft?hn(+ft,bt):1];if(Wn(Ft))return Ft}}return}}const y=p.match(/^hsla?\(\s*([\de.+-]+)(?:deg)?(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s+|\s*(,)\s*)([\de.+-]+)%(?:\s*([,\/])\s*([\de.+-]+)(%)?)?\s*\)$/);if(y){const[v,E,T,L,N,F,U,q,Y]=y,nt=[T||" ",N||" ",U].join("");if(nt==="  "||nt==="  /"||nt===",,"||nt===",,,"){const tt=[+E,In(+L,0,100),In(+F,0,100),q?hn(+q,Y):1];if(Wn(tt))return function([ft,bt,ct,Ct]){function At(Ft){const Ie=(Ft+ft/30)%12,Me=bt*Math.min(ct,1-ct);return ct-Me*Math.max(-1,Math.min(Ie-3,9-Ie,1))}return ft=Bt(ft),bt/=100,ct/=100,[At(0),At(8),At(4),Ct]}(tt)}}}(r);return a?new Te(...a,!1):void 0}get rgb(){const{r,g:a,b:p,a:g}=this,y=g||1/0;return this.overwriteGetter("rgb",[r/y,a/y,p/y,g])}get hcl(){return this.overwriteGetter("hcl",function(r){const[a,p,g,y]=Vt(r),v=Math.sqrt(p*p+g*g);return[Math.round(1e4*v)?Bt(Math.atan2(g,p)*zt):NaN,v,a,y]}(this.rgb))}get lab(){return this.overwriteGetter("lab",Vt(this.rgb))}overwriteGetter(r,a){return Object.defineProperty(this,r,{value:a}),a}toString(){const[r,a,p,g]=this.rgb;return`rgba(${[r,a,p].map(y=>Math.round(255*y)).join(",")},${g})`}}Te.black=new Te(0,0,0,1),Te.white=new Te(1,1,1,1),Te.transparent=new Te(0,0,0,0),Te.red=new Te(1,0,0,1);class _r{constructor(r,a,p){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=p,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class pa{constructor(r,a,p,g,y){this.text=r,this.image=a,this.scale=p,this.fontStack=g,this.textColor=y}}class yr{constructor(r){this.sections=r}static fromString(r){return new yr([new pa(r,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(r=>r.text.length!==0||r.image&&r.image.name.length!==0)}static factory(r){return r instanceof yr?r:yr.fromString(r)}toString(){return this.sections.length===0?"":this.sections.map(r=>r.text).join("")}}class Or{constructor(r){this.values=r.slice()}static parse(r){if(r instanceof Or)return r;if(typeof r=="number")return new Or([r,r,r,r]);if(Array.isArray(r)&&!(r.length<1||r.length>4)){for(const a of r)if(typeof a!="number")return;switch(r.length){case 1:r=[r[0],r[0],r[0],r[0]];break;case 2:r=[r[0],r[1],r[0],r[1]];break;case 3:r=[r[0],r[1],r[2],r[1]]}return new Or(r)}}toString(){return JSON.stringify(this.values)}}class Ji{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new Ji({name:r,available:!1}):null}}function Go(s,r,a,p){return typeof s=="number"&&s>=0&&s<=255&&typeof r=="number"&&r>=0&&r<=255&&typeof a=="number"&&a>=0&&a<=255?p===void 0||typeof p=="number"&&p>=0&&p<=1?null:`Invalid rgba value [${[s,r,a,p].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof p=="number"?[s,r,a,p]:[s,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ps(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Te||s instanceof _r||s instanceof yr||s instanceof Or||s instanceof Ji)return!0;if(Array.isArray(s)){for(const r of s)if(!Ps(r))return!1;return!0}if(typeof s=="object"){for(const r in s)if(!Ps(s[r]))return!1;return!0}return!1}function jr(s){if(s===null)return Ki;if(typeof s=="string")return on;if(typeof s=="boolean")return Ve;if(typeof s=="number")return ee;if(s instanceof Te)return yi;if(s instanceof _r)return oo;if(s instanceof yr)return Gr;if(s instanceof Or)return Ii;if(s instanceof Ji)return as;if(Array.isArray(s)){const r=s.length;let a;for(const p of s){const g=jr(p);if(a){if(a===g)continue;a=Xe;break}a=g}return Jr(a||Xe,r)}return hr}function Ql(s){const r=typeof s;return s===null?"":r==="string"||r==="number"||r==="boolean"?String(s):s instanceof Te||s instanceof yr||s instanceof Or||s instanceof Ji?s.toString():JSON.stringify(s)}class fa{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(r.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!Ps(r[1]))return a.error("invalid value");const p=r[1];let g=jr(p);const y=a.expectedType;return g.kind!=="array"||g.N!==0||!y||y.kind!=="array"||typeof y.N=="number"&&y.N!==0||(g=y),new fa(g,p)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}}class qr{constructor(r){this.name="ExpressionEvaluationError",this.message=r}toJSON(){return this.message}}const tu={string:on,number:ee,boolean:Ve,object:hr};class so{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let p,g=1;const y=r[0];if(y==="array"){let E,T;if(r.length>2){const L=r[1];if(typeof L!="string"||!(L in tu)||L==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);E=tu[L],g++}else E=Xe;if(r.length>3){if(r[2]!==null&&(typeof r[2]!="number"||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);T=r[2],g++}p=Jr(E,T)}else{if(!tu[y])throw new Error(`Types doesn't contain name = ${y}`);p=tu[y]}const v=[];for(;g<r.length;g++){const E=a.parse(r[g],g,Xe);if(!E)return null;v.push(E)}return new so(p,v)}evaluate(r){for(let a=0;a<this.args.length;a++){const p=this.args[a].evaluate(r);if(!Vo(this.type,jr(p)))return p;if(a===this.args.length-1)throw new qr(`Expected value to be of type ${Jn(this.type)}, but found ${Jn(jr(p))} instead.`)}throw new Error}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const ph={"to-boolean":Ve,"to-color":yi,"to-number":ee,"to-string":on};class vi{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const p=r[0];if(!ph[p])throw new Error(`Can't parse ${p} as it is not part of the known types`);if((p==="to-boolean"||p==="to-string")&&r.length!==2)return a.error("Expected one argument.");const g=ph[p],y=[];for(let v=1;v<r.length;v++){const E=a.parse(r[v],v,Xe);if(!E)return null;y.push(E)}return new vi(g,y)}evaluate(r){if(this.type.kind==="boolean")return!!this.args[0].evaluate(r);if(this.type.kind==="color"){let a,p;for(const g of this.args){if(a=g.evaluate(r),p=null,a instanceof Te)return a;if(typeof a=="string"){const y=r.parseColor(a);if(y)return y}else if(Array.isArray(a)&&(p=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Go(a[0],a[1],a[2],a[3]),!p))return new Te(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new qr(p||`Could not parse color from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}if(this.type.kind==="padding"){let a;for(const p of this.args){a=p.evaluate(r);const g=Or.parse(a);if(g)return g}throw new qr(`Could not parse padding from value '${typeof a=="string"?a:JSON.stringify(a)}'`)}if(this.type.kind==="number"){let a=null;for(const p of this.args){if(a=p.evaluate(r),a===null)return 0;const g=Number(a);if(!isNaN(g))return g}throw new qr(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?yr.fromString(Ql(this.args[0].evaluate(r))):this.type.kind==="resolvedImage"?Ji.fromString(Ql(this.args[0].evaluate(r))):Ql(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}const Ec=["Unknown","Point","LineString","Polygon"];class Ru{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null}id(){return this.feature&&"id"in this.feature?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?Ec[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}parseColor(r){let a=this._parseColorCache[r];return a||(a=this._parseColorCache[r]=Te.parse(r)),a}}class da{constructor(r,a,p=[],g,y=new ss,v=[]){this.registry=r,this.path=p,this.key=p.map(E=>`[${E}]`).join(""),this.scope=y,this.errors=v,this.expectedType=g,this._isConstant=a}parse(r,a,p,g,y={}){return a?this.concat(a,p,g)._parse(r,y):this._parse(r,y)}_parse(r,a){function p(g,y,v){return v==="assert"?new so(y,[g]):v==="coerce"?new vi(y,[g]):g}if(r!==null&&typeof r!="string"&&typeof r!="boolean"&&typeof r!="number"||(r=["literal",r]),Array.isArray(r)){if(r.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const g=r[0];if(typeof g!="string")return this.error(`Expression name must be a string, but found ${typeof g} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const y=this.registry[g];if(y){let v=y.parse(r,this);if(!v)return null;if(this.expectedType){const E=this.expectedType,T=v.type;if(E.kind!=="string"&&E.kind!=="number"&&E.kind!=="boolean"&&E.kind!=="object"&&E.kind!=="array"||T.kind!=="value")if(E.kind!=="color"&&E.kind!=="formatted"&&E.kind!=="resolvedImage"||T.kind!=="value"&&T.kind!=="string")if(E.kind!=="padding"||T.kind!=="value"&&T.kind!=="number"&&T.kind!=="array"){if(this.checkSubtype(E,T))return null}else v=p(v,E,a.typeAnnotation||"coerce");else v=p(v,E,a.typeAnnotation||"coerce");else v=p(v,E,a.typeAnnotation||"assert")}if(!(v instanceof fa)&&v.type.kind!=="resolvedImage"&&this._isConstant(v)){const E=new Ru;try{v=new fa(v.type,v.evaluate(E))}catch(T){return this.error(T.message),null}}return v}return this.error(`Unknown expression "${g}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(r===void 0?"'undefined' value invalid. Use null instead.":typeof r=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,p){const g=typeof r=="number"?this.path.concat(r):this.path,y=p?this.scope.concat(p):this.scope;return new da(this.registry,this._isConstant,g,a||null,y,this.errors)}error(r,...a){const p=`${this.key}${a.map(g=>`[${g}]`).join("")}`;this.errors.push(new Vr(p,r))}checkSubtype(r,a){const p=Vo(r,a);return p&&this.error(p),p}}class Pn{constructor(r,a,p){this.type=oo,this.locale=p,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(r.length!==2)return a.error("Expected one argument.");const p=r[1];if(typeof p!="object"||Array.isArray(p))return a.error("Collator options argument must be an object.");const g=a.parse(p["case-sensitive"]!==void 0&&p["case-sensitive"],1,Ve);if(!g)return null;const y=a.parse(p["diacritic-sensitive"]!==void 0&&p["diacritic-sensitive"],1,Ve);if(!y)return null;let v=null;return p.locale&&(v=a.parse(p.locale,1,on),!v)?null:new Pn(g,y,v)}evaluate(r){return new _r(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}}const b=8192;function M(s,r){s[0]=Math.min(s[0],r[0]),s[1]=Math.min(s[1],r[1]),s[2]=Math.max(s[2],r[0]),s[3]=Math.max(s[3],r[1])}function Z(s,r){return!(s[0]<=r[0]||s[2]>=r[2]||s[1]<=r[1]||s[3]>=r[3])}function it(s,r){const a=(180+s[0])/360,p=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,g=Math.pow(2,r.z);return[Math.round(a*g*b),Math.round(p*g*b)]}function ht(s,r,a){const p=s[0]-r[0],g=s[1]-r[1],y=s[0]-a[0],v=s[1]-a[1];return p*v-y*g==0&&p*y<=0&&g*v<=0}function _t(s,r){let a=!1;for(let v=0,E=r.length;v<E;v++){const T=r[v];for(let L=0,N=T.length;L<N-1;L++){if(ht(s,T[L],T[L+1]))return!1;(g=T[L])[1]>(p=s)[1]!=(y=T[L+1])[1]>p[1]&&p[0]<(y[0]-g[0])*(p[1]-g[1])/(y[1]-g[1])+g[0]&&(a=!a)}}var p,g,y;return a}function wt(s,r){for(let a=0;a<r.length;a++)if(_t(s,r[a]))return!0;return!1}function Wt(s,r,a,p){const g=p[0]-a[0],y=p[1]-a[1],v=(s[0]-a[0])*y-g*(s[1]-a[1]),E=(r[0]-a[0])*y-g*(r[1]-a[1]);return v>0&&E<0||v<0&&E>0}function ne(s,r,a){for(const L of a)for(let N=0;N<L.length-1;++N)if((E=[(v=L[N+1])[0]-(y=L[N])[0],v[1]-y[1]])[0]*(T=[(g=r)[0]-(p=s)[0],g[1]-p[1]])[1]-E[1]*T[0]!=0&&Wt(p,g,y,v)&&Wt(y,v,p,g))return!0;var p,g,y,v,E,T;return!1}function me(s,r){for(let a=0;a<s.length;++a)if(!_t(s[a],r))return!1;for(let a=0;a<s.length-1;++a)if(ne(s[a],s[a+1],r))return!1;return!0}function fe(s,r){for(let a=0;a<r.length;a++)if(me(s,r[a]))return!0;return!1}function ae(s,r,a){const p=[];for(let g=0;g<s.length;g++){const y=[];for(let v=0;v<s[g].length;v++){const E=it(s[g][v],a);M(r,E),y.push(E)}p.push(y)}return p}function He(s,r,a){const p=[];for(let g=0;g<s.length;g++){const y=ae(s[g],r,a);p.push(y)}return p}function fr(s,r,a,p){if(s[0]<a[0]||s[0]>a[2]){const g=.5*p;let y=s[0]-a[0]>g?-p:a[0]-s[0]>g?p:0;y===0&&(y=s[0]-a[2]>g?-p:a[2]-s[0]>g?p:0),s[0]+=y}M(r,s)}function sn(s,r,a,p){const g=Math.pow(2,p.z)*b,y=[p.x*b,p.y*b],v=[];for(const E of s)for(const T of E){const L=[T.x+y[0],T.y+y[1]];fr(L,r,a,g),v.push(L)}return v}function Zr(s,r,a,p){const g=Math.pow(2,p.z)*b,y=[p.x*b,p.y*b],v=[];for(const T of s){const L=[];for(const N of T){const F=[N.x+y[0],N.y+y[1]];M(r,F),L.push(F)}v.push(L)}if(r[2]-r[0]<=g/2){(E=r)[0]=E[1]=1/0,E[2]=E[3]=-1/0;for(const T of v)for(const L of T)fr(L,r,a,g)}var E;return v}class Ot{constructor(r,a){this.type=Ve,this.geojson=r,this.geometries=a}static parse(r,a){if(r.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if(Ps(r[1])){const p=r[1];if(p.type==="FeatureCollection")for(let g=0;g<p.features.length;++g){const y=p.features[g].geometry.type;if(y==="Polygon"||y==="MultiPolygon")return new Ot(p,p.features[g].geometry)}else if(p.type==="Feature"){const g=p.geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new Ot(p,p.geometry)}else if(p.type==="Polygon"||p.type==="MultiPolygon")return new Ot(p,p)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(r.geometry()!=null&&r.canonicalID()!=null){if(r.geometryType()==="Point")return function(a,p){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(p.type==="Polygon"){const E=ae(p.coordinates,y,v),T=sn(a.geometry(),g,y,v);if(!Z(g,y))return!1;for(const L of T)if(!_t(L,E))return!1}if(p.type==="MultiPolygon"){const E=He(p.coordinates,y,v),T=sn(a.geometry(),g,y,v);if(!Z(g,y))return!1;for(const L of T)if(!wt(L,E))return!1}return!0}(r,this.geometries);if(r.geometryType()==="LineString")return function(a,p){const g=[1/0,1/0,-1/0,-1/0],y=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(p.type==="Polygon"){const E=ae(p.coordinates,y,v),T=Zr(a.geometry(),g,y,v);if(!Z(g,y))return!1;for(const L of T)if(!me(L,E))return!1}if(p.type==="MultiPolygon"){const E=He(p.coordinates,y,v),T=Zr(a.geometry(),g,y,v);if(!Z(g,y))return!1;for(const L of T)if(!fe(L,E))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}}class Pe{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(r.length!==2||typeof r[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const p=r[1];return a.scope.has(p)?new Pe(p,a.scope.get(p)):a.error(`Unknown variable "${p}". Make sure "${p}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}}class fn{constructor(r,a,p,g){this.name=r,this.type=a,this._evaluate=p,this.args=g}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}static parse(r,a){const p=r[0],g=fn.definitions[p];if(!g)return a.error(`Unknown expression "${p}". If you wanted a literal array, use ["literal", [...]].`,0);const y=Array.isArray(g)?g[0]:g.type,v=Array.isArray(g)?[[g[1],g[2]]]:g.overloads,E=v.filter(([L])=>!Array.isArray(L)||L.length===r.length-1);let T=null;for(const[L,N]of E){T=new da(a.registry,Xr,a.path,null,a.scope);const F=[];let U=!1;for(let q=1;q<r.length;q++){const Y=r[q],nt=Array.isArray(L)?L[q-1]:L.type,tt=T.parse(Y,1+F.length,nt);if(!tt){U=!0;break}F.push(tt)}if(!U)if(Array.isArray(L)&&L.length!==F.length)T.error(`Expected ${L.length} arguments, but found ${F.length} instead.`);else{for(let q=0;q<F.length;q++){const Y=Array.isArray(L)?L[q]:L.type,nt=F[q];T.concat(q+1).checkSubtype(Y,nt.type)}if(T.errors.length===0)return new fn(p,y,N,F)}}if(E.length===1)a.errors.push(...T.errors);else{const L=(E.length?E:v).map(([F])=>{return U=F,Array.isArray(U)?`(${U.map(Jn).join(", ")})`:`(${Jn(U.type)}...)`;var U}).join(" | "),N=[];for(let F=1;F<r.length;F++){const U=a.parse(r[F],1+N.length);if(!U)return null;N.push(Jn(U.type))}a.error(`Expected arguments of type ${L}, but found (${N.join(", ")}) instead.`)}return null}static register(r,a){fn.definitions=a;for(const p in a)r[p]=fn}}function Xr(s){if(s instanceof Pe)return Xr(s.boundExpression);if(s instanceof fn&&s.name==="error"||s instanceof Pn||s instanceof Ot)return!1;const r=s instanceof vi||s instanceof so;let a=!0;return s.eachChild(p=>{a=r?a&&Xr(p):a&&p instanceof fa}),!!a&&vr(s)&&Ou(s,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}function vr(s){if(s instanceof fn&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Ot)return!1;let r=!0;return s.eachChild(a=>{r&&!vr(a)&&(r=!1)}),r}function ga(s){if(s instanceof fn&&s.name==="feature-state")return!1;let r=!0;return s.eachChild(a=>{r&&!ga(a)&&(r=!1)}),r}function Ou(s,r){if(s instanceof fn&&r.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild(p=>{a&&!Ou(p,r)&&(a=!1)}),a}function er(s,r){const a=s.length-1;let p,g,y=0,v=a,E=0;for(;y<=v;)if(E=Math.floor((y+v)/2),p=s[E],g=s[E+1],p<=r){if(E===a||r<g)return E;y=E+1}else{if(!(p>r))throw new qr("Input is not a number.");v=E-1}return 0}class Ha{constructor(r,a,p){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[g,y]of p)this.labels.push(g),this.outputs.push(y)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const p=a.parse(r[1],1,ee);if(!p)return null;const g=[];let y=null;a.expectedType&&a.expectedType.kind!=="value"&&(y=a.expectedType);for(let v=1;v<r.length;v+=2){const E=v===1?-1/0:r[v],T=r[v+1],L=v,N=v+1;if(typeof E!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(g.length&&g[g.length-1][0]>=E)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);const F=a.parse(T,N,y);if(!F)return null;y=y||F.type,g.push([E,F])}return new Ha(y,p,g)}evaluate(r){const a=this.labels,p=this.outputs;if(a.length===1)return p[0].evaluate(r);const g=this.input.evaluate(r);if(g<=a[0])return p[0].evaluate(r);const y=a.length;return g>=a[y-1]?p[y-1].evaluate(r):p[er(a,g)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function Sl(s,r,a){return s+a*(r-s)}function jo(s,r,a){return s.map((p,g)=>Sl(p,r[g],a))}const ao={number:Sl,color:function(s,r,a,p="rgb"){switch(p){case"rgb":{const[g,y,v,E]=jo(s.rgb,r.rgb,a);return new Te(g,y,v,E,!1)}case"hcl":{const[g,y,v,E]=s.hcl,[T,L,N,F]=r.hcl;let U,q;if(isNaN(g)||isNaN(T))isNaN(g)?isNaN(T)?U=NaN:(U=T,v!==1&&v!==0||(q=L)):(U=g,N!==1&&N!==0||(q=y));else{let bt=T-g;T>g&&bt>180?bt-=360:T<g&&g-T>180&&(bt+=360),U=g+a*bt}const[Y,nt,tt,ft]=function([bt,ct,Ct,At]){return bt=isNaN(bt)?0:bt*vt,Ce([Ct,Math.cos(bt)*ct,Math.sin(bt)*ct,At])}([U,q??Sl(y,L,a),Sl(v,N,a),Sl(E,F,a)]);return new Te(Y,nt,tt,ft,!1)}case"lab":{const[g,y,v,E]=Ce(jo(s.lab,r.lab,a));return new Te(g,y,v,E,!1)}}},array:jo,padding:function(s,r,a){return new Or(jo(s.values,r.values,a))}};class lo{constructor(r,a,p,g,y){this.type=r,this.operator=a,this.interpolation=p,this.input=g,this.labels=[],this.outputs=[];for(const[v,E]of y)this.labels.push(v),this.outputs.push(E)}static interpolationFactor(r,a,p,g){let y=0;if(r.name==="exponential")y=zu(a,r.base,p,g);else if(r.name==="linear")y=zu(a,1,p,g);else if(r.name==="cubic-bezier"){const v=r.controlPoints;y=new j(v[0],v[1],v[2],v[3]).solve(zu(a,1,p,g))}return y}static parse(r,a){let[p,g,y,...v]=r;if(!Array.isArray(g)||g.length===0)return a.error("Expected an interpolation type expression.",1);if(g[0]==="linear")g={name:"linear"};else if(g[0]==="exponential"){const L=g[1];if(typeof L!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);g={name:"exponential",base:L}}else{if(g[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(g[0])}`,1,0);{const L=g.slice(1);if(L.length!==4||L.some(N=>typeof N!="number"||N<0||N>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);g={name:"cubic-bezier",controlPoints:L}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(y=a.parse(y,2,ee),!y)return null;const E=[];let T=null;p==="interpolate-hcl"||p==="interpolate-lab"?T=yi:a.expectedType&&a.expectedType.kind!=="value"&&(T=a.expectedType);for(let L=0;L<v.length;L+=2){const N=v[L],F=v[L+1],U=L+3,q=L+4;if(typeof N!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',U);if(E.length&&E[E.length-1][0]>=N)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',U);const Y=a.parse(F,q,T);if(!Y)return null;T=T||Y.type,E.push([N,Y])}return B(T,ee)||B(T,yi)||B(T,Ii)||B(T,Jr(ee))?new lo(T,p,g,y,E):a.error(`Type ${Jn(T)} is not interpolatable.`)}evaluate(r){const a=this.labels,p=this.outputs;if(a.length===1)return p[0].evaluate(r);const g=this.input.evaluate(r);if(g<=a[0])return p[0].evaluate(r);const y=a.length;if(g>=a[y-1])return p[y-1].evaluate(r);const v=er(a,g),E=lo.interpolationFactor(this.interpolation,g,a[v],a[v+1]),T=p[v].evaluate(r),L=p[v+1].evaluate(r);switch(this.operator){case"interpolate":return ao[this.type.kind](T,L,E);case"interpolate-hcl":return ao.color(T,L,E,"hcl");case"interpolate-lab":return ao.color(T,L,E,"lab")}}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}}function zu(s,r,a,p){const g=p-a,y=s-a;return g===0?0:r===1?y/g:(Math.pow(r,y)-1)/(Math.pow(r,g)-1)}class Tl{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let p=null;const g=a.expectedType;g&&g.kind!=="value"&&(p=g);const y=[];for(const E of r.slice(1)){const T=a.parse(E,1+y.length,p,void 0,{typeAnnotation:"omit"});if(!T)return null;p=p||T.type,y.push(T)}if(!p)throw new Error("No output type");const v=g&&y.some(E=>Vo(g,E.type));return new Tl(v?Xe:p,y)}evaluate(r){let a,p=null,g=0;for(const y of this.args)if(g++,p=y.evaluate(r),p&&p instanceof Ji&&!p.available&&(a||(a=p.name),p=null,g===this.args.length&&(p=a)),p!==null)break;return p}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}}class eu{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const p=[];for(let y=1;y<r.length-1;y+=2){const v=r[y];if(typeof v!="string")return a.error(`Expected string, but found ${typeof v} instead.`,y);if(/[^a-zA-Z0-9_]/.test(v))return a.error("Variable names must contain only alphanumeric characters or '_'.",y);const E=a.parse(r[y+1],y+1);if(!E)return null;p.push([v,E])}const g=a.parse(r[r.length-1],r.length-1,a.expectedType,p);return g?new eu(p,g):null}outputDefined(){return this.result.outputDefined()}}class Fu{constructor(r,a,p){this.type=r,this.index=a,this.input=p}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=a.parse(r[1],1,ee),g=a.parse(r[2],2,Jr(a.expectedType||Xe));return p&&g?new Fu(g.type.itemType,p,g):null}evaluate(r){const a=this.index.evaluate(r),p=this.input.evaluate(r);if(a<0)throw new qr(`Array index out of bounds: ${a} < 0.`);if(a>=p.length)throw new qr(`Array index out of bounds: ${a} > ${p.length-1}.`);if(a!==Math.floor(a))throw new qr(`Array index must be an integer, but found ${a} instead.`);return p[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}}class nu{constructor(r,a){this.type=Ve,this.needle=r,this.haystack=a}static parse(r,a){if(r.length!==3)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const p=a.parse(r[1],1,Xe),g=a.parse(r[2],2,Xe);return p&&g?V(p.type,[Ve,on,ee,Ki,Xe])?new nu(p,g):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(p.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!p)return!1;if(!z(a,["boolean","string","number","null"]))throw new qr(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(jr(a))} instead.`);if(!z(p,["string","array"]))throw new qr(`Expected second argument to be of type array or string, but found ${Jn(jr(p))} instead.`);return p.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}}class $a{constructor(r,a,p){this.type=ee,this.needle=r,this.haystack=a,this.fromIndex=p}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=a.parse(r[1],1,Xe),g=a.parse(r[2],2,Xe);if(!p||!g)return null;if(!V(p.type,[Ve,on,ee,Ki,Xe]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(p.type)} instead`);if(r.length===4){const y=a.parse(r[3],3,ee);return y?new $a(p,g,y):null}return new $a(p,g)}evaluate(r){const a=this.needle.evaluate(r),p=this.haystack.evaluate(r);if(!z(a,["boolean","string","number","null"]))throw new qr(`Expected first argument to be of type boolean, string, number or null, but found ${Jn(jr(a))} instead.`);if(!z(p,["string","array"]))throw new qr(`Expected second argument to be of type array or string, but found ${Jn(jr(p))} instead.`);if(this.fromIndex){const g=this.fromIndex.evaluate(r);return p.indexOf(a,g)}return p.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}}class Mn{constructor(r,a,p,g,y,v){this.inputType=r,this.type=a,this.input=p,this.cases=g,this.outputs=y,this.otherwise=v}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let p,g;a.expectedType&&a.expectedType.kind!=="value"&&(g=a.expectedType);const y={},v=[];for(let L=2;L<r.length-1;L+=2){let N=r[L];const F=r[L+1];Array.isArray(N)||(N=[N]);const U=a.concat(L);if(N.length===0)return U.error("Expected at least one branch label.");for(const Y of N){if(typeof Y!="number"&&typeof Y!="string")return U.error("Branch labels must be numbers or strings.");if(typeof Y=="number"&&Math.abs(Y)>Number.MAX_SAFE_INTEGER)return U.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof Y=="number"&&Math.floor(Y)!==Y)return U.error("Numeric branch labels must be integer values.");if(p){if(U.checkSubtype(p,jr(Y)))return null}else p=jr(Y);if(y[String(Y)]!==void 0)return U.error("Branch labels must be unique.");y[String(Y)]=v.length}const q=a.parse(F,L,g);if(!q)return null;g=g||q.type,v.push(q)}const E=a.parse(r[1],1,Xe);if(!E)return null;const T=a.parse(r[r.length-1],r.length-1,g);return T?E.type.kind!=="value"&&a.concat(1).checkSubtype(p,E.type)?null:new Mn(p,g,E,y,v,T):null}evaluate(r){const a=this.input.evaluate(r);return(jr(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}}class Bu{constructor(r,a,p){this.type=r,this.branches=a,this.otherwise=p}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let p;a.expectedType&&a.expectedType.kind!=="value"&&(p=a.expectedType);const g=[];for(let v=1;v<r.length-1;v+=2){const E=a.parse(r[v],v,Ve);if(!E)return null;const T=a.parse(r[v+1],v+1,p);if(!T)return null;g.push([E,T]),p=p||T.type}const y=a.parse(r[r.length-1],r.length-1,p);if(!y)return null;if(!p)throw new Error("Can't infer output type");return new Bu(p,g,y)}evaluate(r){for(const[a,p]of this.branches)if(a.evaluate(r))return p.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,p]of this.branches)r(a),r(p);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}}class ru{constructor(r,a,p,g){this.type=r,this.input=a,this.beginIndex=p,this.endIndex=g}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const p=a.parse(r[1],1,Xe),g=a.parse(r[2],2,ee);if(!p||!g)return null;if(!V(p.type,[Jr(Xe),on,Xe]))return a.error(`Expected first argument to be of type array or string, but found ${Jn(p.type)} instead`);if(r.length===4){const y=a.parse(r[3],3,ee);return y?new ru(p.type,p,g,y):null}return new ru(p.type,p,g)}evaluate(r){const a=this.input.evaluate(r),p=this.beginIndex.evaluate(r);if(!z(a,["string","array"]))throw new qr(`Expected first argument to be of type array or string, but found ${Jn(jr(a))} instead.`);if(this.endIndex){const g=this.endIndex.evaluate(r);return a.slice(p,g)}return a.slice(p)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}}function Ic(s,r){return s==="=="||s==="!="?r.kind==="boolean"||r.kind==="string"||r.kind==="number"||r.kind==="null"||r.kind==="value":r.kind==="string"||r.kind==="number"||r.kind==="value"}function fh(s,r,a,p){return p.compare(r,a)===0}function Cl(s,r,a){const p=s!=="=="&&s!=="!=";return class lv{constructor(y,v,E){this.type=Ve,this.lhs=y,this.rhs=v,this.collator=E,this.hasUntypedArgument=y.type.kind==="value"||v.type.kind==="value"}static parse(y,v){if(y.length!==3&&y.length!==4)return v.error("Expected two or three arguments.");const E=y[0];let T=v.parse(y[1],1,Xe);if(!T)return null;if(!Ic(E,T.type))return v.concat(1).error(`"${E}" comparisons are not supported for type '${Jn(T.type)}'.`);let L=v.parse(y[2],2,Xe);if(!L)return null;if(!Ic(E,L.type))return v.concat(2).error(`"${E}" comparisons are not supported for type '${Jn(L.type)}'.`);if(T.type.kind!==L.type.kind&&T.type.kind!=="value"&&L.type.kind!=="value")return v.error(`Cannot compare types '${Jn(T.type)}' and '${Jn(L.type)}'.`);p&&(T.type.kind==="value"&&L.type.kind!=="value"?T=new so(L.type,[T]):T.type.kind!=="value"&&L.type.kind==="value"&&(L=new so(T.type,[L])));let N=null;if(y.length===4){if(T.type.kind!=="string"&&L.type.kind!=="string"&&T.type.kind!=="value"&&L.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(N=v.parse(y[3],3,oo),!N)return null}return new lv(T,L,N)}evaluate(y){const v=this.lhs.evaluate(y),E=this.rhs.evaluate(y);if(p&&this.hasUntypedArgument){const T=jr(v),L=jr(E);if(T.kind!==L.kind||T.kind!=="string"&&T.kind!=="number")throw new qr(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${T.kind}, ${L.kind}) instead.`)}if(this.collator&&!p&&this.hasUntypedArgument){const T=jr(v),L=jr(E);if(T.kind!=="string"||L.kind!=="string")return r(y,v,E)}return this.collator?a(y,v,E,this.collator.evaluate(y)):r(y,v,E)}eachChild(y){y(this.lhs),y(this.rhs),this.collator&&y(this.collator)}outputDefined(){return!0}}}const Uu=Cl("==",function(s,r,a){return r===a},fh),Sc=Cl("!=",function(s,r,a){return r!==a},function(s,r,a,p){return!fh(0,r,a,p)}),dh=Cl("<",function(s,r,a){return r<a},function(s,r,a,p){return p.compare(r,a)<0}),Ms=Cl(">",function(s,r,a){return r>a},function(s,r,a,p){return p.compare(r,a)>0}),gh=Cl("<=",function(s,r,a){return r<=a},function(s,r,a,p){return p.compare(r,a)<=0}),mh=Cl(">=",function(s,r,a){return r>=a},function(s,r,a,p){return p.compare(r,a)>=0});class Tc{constructor(r,a,p,g,y){this.type=on,this.number=r,this.locale=a,this.currency=p,this.minFractionDigits=g,this.maxFractionDigits=y}static parse(r,a){if(r.length!==3)return a.error("Expected two arguments.");const p=a.parse(r[1],1,ee);if(!p)return null;const g=r[2];if(typeof g!="object"||Array.isArray(g))return a.error("NumberFormat options argument must be an object.");let y=null;if(g.locale&&(y=a.parse(g.locale,1,on),!y))return null;let v=null;if(g.currency&&(v=a.parse(g.currency,1,on),!v))return null;let E=null;if(g["min-fraction-digits"]&&(E=a.parse(g["min-fraction-digits"],1,ee),!E))return null;let T=null;return g["max-fraction-digits"]&&(T=a.parse(g["max-fraction-digits"],1,ee),!T)?null:new Tc(p,y,v,E,T)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}}class iu{constructor(r){this.type=Gr,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const p=r[1];if(!Array.isArray(p)&&typeof p=="object")return a.error("First argument must be an image or text section.");const g=[];let y=!1;for(let v=1;v<=r.length-1;++v){const E=r[v];if(y&&typeof E=="object"&&!Array.isArray(E)){y=!1;let T=null;if(E["font-scale"]&&(T=a.parse(E["font-scale"],1,ee),!T))return null;let L=null;if(E["text-font"]&&(L=a.parse(E["text-font"],1,Jr(on)),!L))return null;let N=null;if(E["text-color"]&&(N=a.parse(E["text-color"],1,yi),!N))return null;const F=g[g.length-1];F.scale=T,F.font=L,F.textColor=N}else{const T=a.parse(r[v],1,Xe);if(!T)return null;const L=T.type.kind;if(L!=="string"&&L!=="value"&&L!=="null"&&L!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");y=!0,g.push({content:T,scale:null,font:null,textColor:null})}}return new iu(g)}evaluate(r){return new yr(this.sections.map(a=>{const p=a.content.evaluate(r);return jr(p)===as?new pa("",p,null,null,null):new pa(Ql(p),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}}class Pl{constructor(r){this.type=as,this.input=r}static parse(r,a){if(r.length!==2)return a.error("Expected two arguments.");const p=a.parse(r[1],1,on);return p?new Pl(p):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),p=Ji.fromString(a);return p&&r.availableImages&&(p.available=r.availableImages.indexOf(a)>-1),p}eachChild(r){r(this.input)}outputDefined(){return!1}}class Vu{constructor(r){this.type=ee,this.input=r}static parse(r,a){if(r.length!==2)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const p=a.parse(r[1],1);return p?p.type.kind!=="array"&&p.type.kind!=="string"&&p.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${Jn(p.type)} instead.`):new Vu(p):null}evaluate(r){const a=this.input.evaluate(r);if(typeof a=="string"||Array.isArray(a))return a.length;throw new qr(`Expected value to be of type string or array, but found ${Jn(jr(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}}const Ka={"==":Uu,"!=":Sc,">":Ms,"<":dh,">=":mh,"<=":gh,array:so,at:Fu,boolean:so,case:Bu,coalesce:Tl,collator:Pn,format:iu,image:Pl,in:nu,"index-of":$a,interpolate:lo,"interpolate-hcl":lo,"interpolate-lab":lo,length:Vu,let:eu,literal:fa,match:Mn,number:so,"number-format":Tc,object:so,slice:ru,step:Ha,string:so,"to-boolean":vi,"to-color":vi,"to-number":vi,"to-string":vi,var:Pe,within:Ot};function _h(s,[r,a,p,g]){r=r.evaluate(s),a=a.evaluate(s),p=p.evaluate(s);const y=g?g.evaluate(s):1,v=Go(r,a,p,y);if(v)throw new qr(v);return new Te(r/255,a/255,p/255,y,!1)}function ma(s,r){return s in r}function Gu(s,r){const a=r[s];return a===void 0?null:a}function Ja(s){return{type:s}}function yh(s){return{result:"success",value:s}}function _a(s){return{result:"error",value:s}}function As(s){return s["property-type"]==="data-driven"||s["property-type"]==="cross-faded-data-driven"}function ju(s){return!!s.expression&&s.expression.parameters.indexOf("zoom")>-1}function ou(s){return!!s.expression&&s.expression.interpolated}function Dn(s){return s instanceof Number?"number":s instanceof String?"string":s instanceof Boolean?"boolean":Array.isArray(s)?"array":s===null?"null":typeof s}function ya(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function Mp(s){return s}function vh(s,r){const a=r.type==="color",p=s.stops&&typeof s.stops[0][0]=="object",g=p||!(p||s.property!==void 0),y=s.type||(ou(r)?"exponential":"interval");if(a||r.type==="padding"){const N=a?Te.parse:Or.parse;(s=Ri({},s)).stops&&(s.stops=s.stops.map(F=>[F[0],N(F[1])])),s.default=N(s.default?s.default:r.default)}if(s.colorSpace&&(v=s.colorSpace)!=="rgb"&&v!=="hcl"&&v!=="lab")throw new Error(`Unknown color space: "${s.colorSpace}"`);var v;let E,T,L;if(y==="exponential")E=Pc;else if(y==="interval")E=Cc;else if(y==="categorical"){E=Ap,T=Object.create(null);for(const N of s.stops)T[N[0]]=N[1];L=typeof s.stops[0][0]}else{if(y!=="identity")throw new Error(`Unknown function type "${y}"`);E=Mc}if(p){const N={},F=[];for(let Y=0;Y<s.stops.length;Y++){const nt=s.stops[Y],tt=nt[0].zoom;N[tt]===void 0&&(N[tt]={zoom:tt,type:s.type,property:s.property,default:s.default,stops:[]},F.push(tt)),N[tt].stops.push([nt[0].value,nt[1]])}const U=[];for(const Y of F)U.push([N[Y].zoom,vh(N[Y],r)]);const q={name:"linear"};return{kind:"composite",interpolationType:q,interpolationFactor:lo.interpolationFactor.bind(void 0,q),zoomStops:U.map(Y=>Y[0]),evaluate:({zoom:Y},nt)=>Pc({stops:U,base:s.base},r,Y).evaluate(Y,nt)}}if(g){const N=y==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:N,interpolationFactor:lo.interpolationFactor.bind(void 0,N),zoomStops:s.stops.map(F=>F[0]),evaluate:({zoom:F})=>E(s,r,F,T,L)}}return{kind:"source",evaluate(N,F){const U=F&&F.properties?F.properties[s.property]:void 0;return U===void 0?su(s.default,r.default):E(s,r,U,T,L)}}}function su(s,r,a){return s!==void 0?s:r!==void 0?r:a!==void 0?a:void 0}function Ap(s,r,a,p,g){return su(typeof a===g?p[a]:void 0,s.default,r.default)}function Cc(s,r,a){if(Dn(a)!=="number")return su(s.default,r.default);const p=s.stops.length;if(p===1||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[p-1][0])return s.stops[p-1][1];const g=er(s.stops.map(y=>y[0]),a);return s.stops[g][1]}function Pc(s,r,a){const p=s.base!==void 0?s.base:1;if(Dn(a)!=="number")return su(s.default,r.default);const g=s.stops.length;if(g===1||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[g-1][0])return s.stops[g-1][1];const y=er(s.stops.map(N=>N[0]),a),v=function(N,F,U,q){const Y=q-U,nt=N-U;return Y===0?0:F===1?nt/Y:(Math.pow(F,nt)-1)/(Math.pow(F,Y)-1)}(a,p,s.stops[y][0],s.stops[y+1][0]),E=s.stops[y][1],T=s.stops[y+1][1],L=ao[r.type]||Mp;return typeof E.evaluate=="function"?{evaluate(...N){const F=E.evaluate.apply(void 0,N),U=T.evaluate.apply(void 0,N);if(F!==void 0&&U!==void 0)return L(F,U,v,s.colorSpace)}}:L(E,T,v,s.colorSpace)}function Mc(s,r,a){switch(r.type){case"color":a=Te.parse(a);break;case"formatted":a=yr.fromString(a.toString());break;case"resolvedImage":a=Ji.fromString(a.toString());break;case"padding":a=Or.parse(a);break;default:Dn(a)===r.type||r.type==="enum"&&r.values[a]||(a=void 0)}return su(a,s.default,r.default)}fn.register(Ka,{error:[{kind:"error"},[on],(s,[r])=>{throw new qr(r.evaluate(s))}],typeof:[on,[Xe],(s,[r])=>Jn(jr(r.evaluate(s)))],"to-rgba":[Jr(ee,4),[yi],(s,[r])=>{const[a,p,g,y]=r.evaluate(s).rgb;return[255*a,255*p,255*g,y]}],rgb:[yi,[ee,ee,ee],_h],rgba:[yi,[ee,ee,ee,ee],_h],has:{type:Ve,overloads:[[[on],(s,[r])=>ma(r.evaluate(s),s.properties())],[[on,hr],(s,[r,a])=>ma(r.evaluate(s),a.evaluate(s))]]},get:{type:Xe,overloads:[[[on],(s,[r])=>Gu(r.evaluate(s),s.properties())],[[on,hr],(s,[r,a])=>Gu(r.evaluate(s),a.evaluate(s))]]},"feature-state":[Xe,[on],(s,[r])=>Gu(r.evaluate(s),s.featureState||{})],properties:[hr,[],s=>s.properties()],"geometry-type":[on,[],s=>s.geometryType()],id:[Xe,[],s=>s.id()],zoom:[ee,[],s=>s.globals.zoom],"heatmap-density":[ee,[],s=>s.globals.heatmapDensity||0],"line-progress":[ee,[],s=>s.globals.lineProgress||0],accumulated:[Xe,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[ee,Ja(ee),(s,r)=>{let a=0;for(const p of r)a+=p.evaluate(s);return a}],"*":[ee,Ja(ee),(s,r)=>{let a=1;for(const p of r)a*=p.evaluate(s);return a}],"-":{type:ee,overloads:[[[ee,ee],(s,[r,a])=>r.evaluate(s)-a.evaluate(s)],[[ee],(s,[r])=>-r.evaluate(s)]]},"/":[ee,[ee,ee],(s,[r,a])=>r.evaluate(s)/a.evaluate(s)],"%":[ee,[ee,ee],(s,[r,a])=>r.evaluate(s)%a.evaluate(s)],ln2:[ee,[],()=>Math.LN2],pi:[ee,[],()=>Math.PI],e:[ee,[],()=>Math.E],"^":[ee,[ee,ee],(s,[r,a])=>Math.pow(r.evaluate(s),a.evaluate(s))],sqrt:[ee,[ee],(s,[r])=>Math.sqrt(r.evaluate(s))],log10:[ee,[ee],(s,[r])=>Math.log(r.evaluate(s))/Math.LN10],ln:[ee,[ee],(s,[r])=>Math.log(r.evaluate(s))],log2:[ee,[ee],(s,[r])=>Math.log(r.evaluate(s))/Math.LN2],sin:[ee,[ee],(s,[r])=>Math.sin(r.evaluate(s))],cos:[ee,[ee],(s,[r])=>Math.cos(r.evaluate(s))],tan:[ee,[ee],(s,[r])=>Math.tan(r.evaluate(s))],asin:[ee,[ee],(s,[r])=>Math.asin(r.evaluate(s))],acos:[ee,[ee],(s,[r])=>Math.acos(r.evaluate(s))],atan:[ee,[ee],(s,[r])=>Math.atan(r.evaluate(s))],min:[ee,Ja(ee),(s,r)=>Math.min(...r.map(a=>a.evaluate(s)))],max:[ee,Ja(ee),(s,r)=>Math.max(...r.map(a=>a.evaluate(s)))],abs:[ee,[ee],(s,[r])=>Math.abs(r.evaluate(s))],round:[ee,[ee],(s,[r])=>{const a=r.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[ee,[ee],(s,[r])=>Math.floor(r.evaluate(s))],ceil:[ee,[ee],(s,[r])=>Math.ceil(r.evaluate(s))],"filter-==":[Ve,[on,Xe],(s,[r,a])=>s.properties()[r.value]===a.value],"filter-id-==":[Ve,[Xe],(s,[r])=>s.id()===r.value],"filter-type-==":[Ve,[on],(s,[r])=>s.geometryType()===r.value],"filter-<":[Ve,[on,Xe],(s,[r,a])=>{const p=s.properties()[r.value],g=a.value;return typeof p==typeof g&&p<g}],"filter-id-<":[Ve,[Xe],(s,[r])=>{const a=s.id(),p=r.value;return typeof a==typeof p&&a<p}],"filter->":[Ve,[on,Xe],(s,[r,a])=>{const p=s.properties()[r.value],g=a.value;return typeof p==typeof g&&p>g}],"filter-id->":[Ve,[Xe],(s,[r])=>{const a=s.id(),p=r.value;return typeof a==typeof p&&a>p}],"filter-<=":[Ve,[on,Xe],(s,[r,a])=>{const p=s.properties()[r.value],g=a.value;return typeof p==typeof g&&p<=g}],"filter-id-<=":[Ve,[Xe],(s,[r])=>{const a=s.id(),p=r.value;return typeof a==typeof p&&a<=p}],"filter->=":[Ve,[on,Xe],(s,[r,a])=>{const p=s.properties()[r.value],g=a.value;return typeof p==typeof g&&p>=g}],"filter-id->=":[Ve,[Xe],(s,[r])=>{const a=s.id(),p=r.value;return typeof a==typeof p&&a>=p}],"filter-has":[Ve,[Xe],(s,[r])=>r.value in s.properties()],"filter-has-id":[Ve,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Ve,[Jr(on)],(s,[r])=>r.value.indexOf(s.geometryType())>=0],"filter-id-in":[Ve,[Jr(Xe)],(s,[r])=>r.value.indexOf(s.id())>=0],"filter-in-small":[Ve,[on,Jr(Xe)],(s,[r,a])=>a.value.indexOf(s.properties()[r.value])>=0],"filter-in-large":[Ve,[on,Jr(Xe)],(s,[r,a])=>function(p,g,y,v){for(;y<=v;){const E=y+v>>1;if(g[E]===p)return!0;g[E]>p?v=E-1:y=E+1}return!1}(s.properties()[r.value],a.value,0,a.value.length-1)],all:{type:Ve,overloads:[[[Ve,Ve],(s,[r,a])=>r.evaluate(s)&&a.evaluate(s)],[Ja(Ve),(s,r)=>{for(const a of r)if(!a.evaluate(s))return!1;return!0}]]},any:{type:Ve,overloads:[[[Ve,Ve],(s,[r,a])=>r.evaluate(s)||a.evaluate(s)],[Ja(Ve),(s,r)=>{for(const a of r)if(a.evaluate(s))return!0;return!1}]]},"!":[Ve,[Ve],(s,[r])=>!r.evaluate(s)],"is-supported-script":[Ve,[on],(s,[r])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(r.evaluate(s))}],upcase:[on,[on],(s,[r])=>r.evaluate(s).toUpperCase()],downcase:[on,[on],(s,[r])=>r.evaluate(s).toLowerCase()],concat:[on,Ja(Xe),(s,r)=>r.map(a=>Ql(a.evaluate(s))).join("")],"resolved-locale":[on,[oo],(s,[r])=>r.evaluate(s).resolvedLocale()]});class qs{constructor(r,a){var p;this.expression=r,this._warningHistory={},this._evaluator=new Ru,this._defaultValue=a?(p=a).type==="color"&&ya(p.default)?new Te(0,0,0,0):p.type==="color"?Te.parse(p.default)||null:p.type==="padding"?Or.parse(p.default)||null:p.default===void 0?null:p.default:null,this._enumValues=a&&a.type==="enum"?a.values:null}evaluateWithoutErrorHandling(r,a,p,g,y,v){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=p,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v,this.expression.evaluate(this._evaluator)}evaluate(r,a,p,g,y,v){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=p||null,this._evaluator.canonical=g,this._evaluator.availableImages=y||null,this._evaluator.formattedSection=v||null;try{const E=this.expression.evaluate(this._evaluator);if(E==null||typeof E=="number"&&E!=E)return this._defaultValue;if(this._enumValues&&!(E in this._enumValues))throw new qr(`Expected value to be one of ${Object.keys(this._enumValues).map(T=>JSON.stringify(T)).join(", ")}, but found ${JSON.stringify(E)} instead.`);return E}catch(E){return this._warningHistory[E.message]||(this._warningHistory[E.message]=!0,typeof console<"u"&&console.warn(E.message)),this._defaultValue}}}function qo(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in Ka}function Hn(s,r){const a=new da(Ka,Xr,[],r?function(g){const y={color:yi,string:on,number:ee,enum:on,boolean:Ve,formatted:Gr,padding:Ii,resolvedImage:as};return g.type==="array"?Jr(y[g.value]||Xe,g.length):y[g.type]}(r):void 0),p=a.parse(s,void 0,void 0,void 0,r&&r.type==="string"?{typeAnnotation:"coerce"}:void 0);return p?yh(new qs(p,r)):_a(a.errors)}class Ml{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent=r!=="constant"&&!ga(a.expression)}evaluateWithoutErrorHandling(r,a,p,g,y,v){return this._styleExpression.evaluateWithoutErrorHandling(r,a,p,g,y,v)}evaluate(r,a,p,g,y,v){return this._styleExpression.evaluate(r,a,p,g,y,v)}}class en{constructor(r,a,p,g){this.kind=r,this.zoomStops=p,this._styleExpression=a,this.isStateDependent=r!=="camera"&&!ga(a.expression),this.interpolationType=g}evaluateWithoutErrorHandling(r,a,p,g,y,v){return this._styleExpression.evaluateWithoutErrorHandling(r,a,p,g,y,v)}evaluate(r,a,p,g,y,v){return this._styleExpression.evaluate(r,a,p,g,y,v)}interpolationFactor(r,a,p){return this.interpolationType?lo.interpolationFactor(this.interpolationType,r,a,p):0}}function qu(s,r){const a=Hn(s,r);if(a.result==="error")return a;const p=a.value.expression,g=vr(p);if(!g&&!As(r))return _a([new Vr("","data expressions not supported")]);const y=Ou(p,["zoom"]);if(!y&&!ju(r))return _a([new Vr("","zoom expressions not supported")]);const v=Fn(p);return v||y?v instanceof Vr?_a([v]):v instanceof lo&&!ou(r)?_a([new Vr("",'"interpolate" expressions cannot be used with this property')]):yh(v?new en(g?"camera":"composite",a.value,v.labels,v instanceof lo?v.interpolation:void 0):new Ml(g?"constant":"source",a.value)):_a([new Vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class $n{constructor(r,a){this._parameters=r,this._specification=a,Ri(this,vh(this._parameters,this._specification))}static deserialize(r){return new $n(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function Fn(s){let r=null;if(s instanceof eu)r=Fn(s.result);else if(s instanceof Tl){for(const a of s.args)if(r=Fn(a),r)break}else(s instanceof Ha||s instanceof lo)&&s.input instanceof fn&&s.input.name==="zoom"&&(r=s);return r instanceof Vr||s.eachChild(a=>{const p=Fn(a);p instanceof Vr?r=p:!r&&p?r=new Vr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&p&&r!==p&&(r=new Vr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}function Qa(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const r of s.slice(1))if(!Qa(r)&&typeof r!="boolean")return!1;return!0;default:return!0}}const Ac={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function Lc(s){if(s==null)return{filter:()=>!0,needGeometry:!1};Qa(s)||(s=au(s));const r=Hn(s,Ac);if(r.result==="error")throw new Error(r.value.map(a=>`${a.key}: ${a.message}`).join(", "));return{filter:(a,p,g)=>r.value.evaluate(a,p,{},g),needGeometry:Dc(s)}}function Lp(s,r){return s<r?-1:s>r?1:0}function Dc(s){if(!Array.isArray(s))return!1;if(s[0]==="within")return!0;for(let r=1;r<s.length;r++)if(Dc(s[r]))return!0;return!1}function au(s){if(!s)return!0;const r=s[0];return s.length<=1?r!=="any":r==="=="?tl(s[1],s[2],"=="):r==="!="?Zo(tl(s[1],s[2],"==")):r==="<"||r===">"||r==="<="||r===">="?tl(s[1],s[2],r):r==="any"?(a=s.slice(1),["any"].concat(a.map(au))):r==="all"?["all"].concat(s.slice(1).map(au)):r==="none"?["all"].concat(s.slice(1).map(au).map(Zo)):r==="in"?va(s[1],s.slice(2)):r==="!in"?Zo(va(s[1],s.slice(2))):r==="has"?kc(s[1]):r==="!has"?Zo(kc(s[1])):r!=="within"||s;var a}function tl(s,r,a){switch(s){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,s,r]}}function va(s,r){if(r.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",s,["literal",r.sort(Lp)]]:["filter-in-small",s,["literal",r]]}}function kc(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function Zo(s){return["!",s]}function lu(s){const r=typeof s;if(r==="number"||r==="boolean"||r==="string"||s==null)return JSON.stringify(s);if(Array.isArray(s)){let g="[";for(const y of s)g+=`${lu(y)},`;return`${g}]`}const a=Object.keys(s).sort();let p="{";for(let g=0;g<a.length;g++)p+=`${JSON.stringify(a[g])}:${lu(s[a[g]])},`;return`${p}}`}function el(s){let r="";for(const a of Gn)r+=`/${lu(s[a])}`;return r}function Nc(s){const r=s.value;return r?[new te(s.key,r,"constants have been deprecated as of v8")]:[]}function Yr(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function Ls(s){if(Array.isArray(s))return s.map(Ls);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const r={};for(const a in s)r[a]=Ls(s[a]);return r}return Yr(s)}function uo(s){const r=s.key,a=s.value,p=s.valueSpec||{},g=s.objectElementValidators||{},y=s.style,v=s.styleSpec,E=s.validateSpec;let T=[];const L=Dn(a);if(L!=="object")return[new te(r,a,`object expected, ${L} found`)];for(const N in a){const F=N.split(".")[0],U=p[F]||p["*"];let q;if(g[F])q=g[F];else if(p[F])q=E;else if(g["*"])q=g["*"];else{if(!p["*"]){T.push(new te(r,a[N],`unknown property "${N}"`));continue}q=E}T=T.concat(q({key:(r&&`${r}.`)+N,value:a[N],valueSpec:U,style:y,styleSpec:v,object:a,objectKey:N,validateSpec:E},a))}for(const N in p)g[N]||p[N].required&&p[N].default===void 0&&a[N]===void 0&&T.push(new te(r,a,`missing required property "${N}"`));return T}function Rc(s){const r=s.value,a=s.valueSpec,p=s.style,g=s.styleSpec,y=s.key,v=s.arrayElementValidator||s.validateSpec;if(Dn(r)!=="array")return[new te(y,r,`array expected, ${Dn(r)} found`)];if(a.length&&r.length!==a.length)return[new te(y,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new te(y,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let E={type:a.value,values:a.values};g.$version<7&&(E.function=a.function),Dn(a.value)==="object"&&(E=a.value);let T=[];for(let L=0;L<r.length;L++)T=T.concat(v({array:r,arrayIndex:L,value:r[L],valueSpec:E,validateSpec:s.validateSpec,style:p,styleSpec:g,key:`${y}[${L}]`}));return T}function Zu(s){const r=s.key,a=s.value,p=s.valueSpec;let g=Dn(a);return g==="number"&&a!=a&&(g="NaN"),g!=="number"?[new te(r,a,`number expected, ${g} found`)]:"minimum"in p&&a<p.minimum?[new te(r,a,`${a} is less than the minimum value ${p.minimum}`)]:"maximum"in p&&a>p.maximum?[new te(r,a,`${a} is greater than the maximum value ${p.maximum}`)]:[]}function Oc(s){const r=s.valueSpec,a=Yr(s.value.type);let p,g,y,v={};const E=a!=="categorical"&&s.value.property===void 0,T=!E,L=Dn(s.value.stops)==="array"&&Dn(s.value.stops[0])==="array"&&Dn(s.value.stops[0][0])==="object",N=uo({key:s.key,value:s.value,valueSpec:s.styleSpec.function,validateSpec:s.validateSpec,style:s.style,styleSpec:s.styleSpec,objectElementValidators:{stops:function(q){if(a==="identity")return[new te(q.key,q.value,'identity function may not have a "stops" property')];let Y=[];const nt=q.value;return Y=Y.concat(Rc({key:q.key,value:nt,valueSpec:q.valueSpec,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,arrayElementValidator:F})),Dn(nt)==="array"&&nt.length===0&&Y.push(new te(q.key,nt,"array must have at least one stop")),Y},default:function(q){return q.validateSpec({key:q.key,value:q.value,valueSpec:r,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec})}}});return a==="identity"&&E&&N.push(new te(s.key,s.value,'missing required property "property"')),a==="identity"||s.value.stops||N.push(new te(s.key,s.value,'missing required property "stops"')),a==="exponential"&&s.valueSpec.expression&&!ou(s.valueSpec)&&N.push(new te(s.key,s.value,"exponential functions not supported")),s.styleSpec.$version>=8&&(T&&!As(s.valueSpec)?N.push(new te(s.key,s.value,"property functions not supported")):E&&!ju(s.valueSpec)&&N.push(new te(s.key,s.value,"zoom functions not supported"))),a!=="categorical"&&!L||s.value.property!==void 0||N.push(new te(s.key,s.value,'"property" property is required')),N;function F(q){let Y=[];const nt=q.value,tt=q.key;if(Dn(nt)!=="array")return[new te(tt,nt,`array expected, ${Dn(nt)} found`)];if(nt.length!==2)return[new te(tt,nt,`array length 2 expected, length ${nt.length} found`)];if(L){if(Dn(nt[0])!=="object")return[new te(tt,nt,`object expected, ${Dn(nt[0])} found`)];if(nt[0].zoom===void 0)return[new te(tt,nt,"object stop key must have zoom")];if(nt[0].value===void 0)return[new te(tt,nt,"object stop key must have value")];if(y&&y>Yr(nt[0].zoom))return[new te(tt,nt[0].zoom,"stop zoom values must appear in ascending order")];Yr(nt[0].zoom)!==y&&(y=Yr(nt[0].zoom),g=void 0,v={}),Y=Y.concat(uo({key:`${tt}[0]`,value:nt[0],valueSpec:{zoom:{}},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec,objectElementValidators:{zoom:Zu,value:U}}))}else Y=Y.concat(U({key:`${tt}[0]`,value:nt[0],valueSpec:{},validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec},nt));return qo(Ls(nt[1]))?Y.concat([new te(`${tt}[1]`,nt[1],"expressions are not allowed in function stops.")]):Y.concat(q.validateSpec({key:`${tt}[1]`,value:nt[1],valueSpec:r,validateSpec:q.validateSpec,style:q.style,styleSpec:q.styleSpec}))}function U(q,Y){const nt=Dn(q.value),tt=Yr(q.value),ft=q.value!==null?q.value:Y;if(p){if(nt!==p)return[new te(q.key,ft,`${nt} stop domain type must match previous stop domain type ${p}`)]}else p=nt;if(nt!=="number"&&nt!=="string"&&nt!=="boolean")return[new te(q.key,ft,"stop domain value must be a number, string, or boolean")];if(nt!=="number"&&a!=="categorical"){let bt=`number expected, ${nt} found`;return As(r)&&a===void 0&&(bt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new te(q.key,ft,bt)]}return a!=="categorical"||nt!=="number"||isFinite(tt)&&Math.floor(tt)===tt?a!=="categorical"&&nt==="number"&&g!==void 0&&tt<g?[new te(q.key,ft,"stop domain values must appear in ascending order")]:(g=tt,a==="categorical"&&tt in v?[new te(q.key,ft,"stop domain values must be unique")]:(v[tt]=!0,[])):[new te(q.key,ft,`integer expected, found ${tt}`)]}}function ls(s){const r=(s.expressionContext==="property"?qu:Hn)(Ls(s.value),s.valueSpec);if(r.result==="error")return r.value.map(p=>new te(`${s.key}${p.key}`,s.value,p.message));const a=r.value.expression||r.value._styleExpression.expression;if(s.expressionContext==="property"&&s.propertyKey==="text-font"&&!a.outputDefined())return[new te(s.key,s.value,`Invalid data expression for "${s.propertyKey}". Output values must be contained as literals within the expression.`)];if(s.expressionContext==="property"&&s.propertyType==="layout"&&!ga(a))return[new te(s.key,s.value,'"feature-state" data expressions are not supported with layout properties.')];if(s.expressionContext==="filter"&&!ga(a))return[new te(s.key,s.value,'"feature-state" data expressions are not supported with filters.')];if(s.expressionContext&&s.expressionContext.indexOf("cluster")===0){if(!Ou(a,["zoom","feature-state"]))return[new te(s.key,s.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(s.expressionContext==="cluster-initial"&&!vr(a))return[new te(s.key,s.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Al(s){const r=s.key,a=s.value,p=s.valueSpec,g=[];return Array.isArray(p.values)?p.values.indexOf(Yr(a))===-1&&g.push(new te(r,a,`expected one of [${p.values.join(", ")}], ${JSON.stringify(a)} found`)):Object.keys(p.values).indexOf(Yr(a))===-1&&g.push(new te(r,a,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(a)} found`)),g}function Ll(s){return Qa(Ls(s.value))?ls(Ri({},s,{expressionContext:"filter",valueSpec:{value:"boolean"}})):Et(s)}function Et(s){const r=s.value,a=s.key;if(Dn(r)!=="array")return[new te(a,r,`array expected, ${Dn(r)} found`)];const p=s.styleSpec;let g,y=[];if(r.length<1)return[new te(a,r,"filter array must have at least 1 element")];switch(y=y.concat(Al({key:`${a}[0]`,value:r[0],valueSpec:p.filter_operator,style:s.style,styleSpec:s.styleSpec})),Yr(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&Yr(r[1])==="$type"&&y.push(new te(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&y.push(new te(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(g=Dn(r[1]),g!=="string"&&y.push(new te(`${a}[1]`,r[1],`string expected, ${g} found`)));for(let v=2;v<r.length;v++)g=Dn(r[v]),Yr(r[1])==="$type"?y=y.concat(Al({key:`${a}[${v}]`,value:r[v],valueSpec:p.geometry_type,style:s.style,styleSpec:s.styleSpec})):g!=="string"&&g!=="number"&&g!=="boolean"&&y.push(new te(`${a}[${v}]`,r[v],`string, number, or boolean expected, ${g} found`));break;case"any":case"all":case"none":for(let v=1;v<r.length;v++)y=y.concat(Et({key:`${a}[${v}]`,value:r[v],style:s.style,styleSpec:s.styleSpec}));break;case"has":case"!has":g=Dn(r[1]),r.length!==2?y.push(new te(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="string"&&y.push(new te(`${a}[1]`,r[1],`string expected, ${g} found`));break;case"within":g=Dn(r[1]),r.length!==2?y.push(new te(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):g!=="object"&&y.push(new te(`${a}[1]`,r[1],`object expected, ${g} found`))}return y}function kt(s,r){const a=s.key,p=s.validateSpec,g=s.style,y=s.styleSpec,v=s.value,E=s.objectKey,T=y[`${r}_${s.layerType}`];if(!T)return[];const L=E.match(/^(.*)-transition$/);if(r==="paint"&&L&&T[L[1]]&&T[L[1]].transition)return p({key:a,value:v,valueSpec:y.transition,style:g,styleSpec:y});const N=s.valueSpec||T[E];if(!N)return[new te(a,v,`unknown property "${E}"`)];let F;if(Dn(v)==="string"&&As(N)&&!N.tokens&&(F=/^{([^}]+)}$/.exec(v)))return[new te(a,v,`"${E}" does not support interpolation syntax
Use an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(F[1])} }\`.`)];const U=[];return s.layerType==="symbol"&&(E==="text-field"&&g&&!g.glyphs&&U.push(new te(a,v,'use of "text-field" requires a style "glyphs" property')),E==="text-font"&&ya(Ls(v))&&Yr(v.type)==="identity"&&U.push(new te(a,v,'"text-font" does not support identity functions'))),U.concat(p({key:s.key,value:v,valueSpec:N,style:g,styleSpec:y,expressionContext:"property",propertyType:r,propertyKey:E}))}function ce(s){return kt(s,"paint")}function Fe(s){return kt(s,"layout")}function nr(s){let r=[];const a=s.value,p=s.key,g=s.style,y=s.styleSpec;a.type||a.ref||r.push(new te(p,a,'either "type" or "ref" is required'));let v=Yr(a.type);const E=Yr(a.ref);if(a.id){const T=Yr(a.id);for(let L=0;L<s.arrayIndex;L++){const N=g.layers[L];Yr(N.id)===T&&r.push(new te(p,a.id,`duplicate layer id "${a.id}", previously used at line ${N.id.__line__}`))}}if("ref"in a){let T;["type","source","source-layer","filter","layout"].forEach(L=>{L in a&&r.push(new te(p,a[L],`"${L}" is prohibited for ref layers`))}),g.layers.forEach(L=>{Yr(L.id)===E&&(T=L)}),T?T.ref?r.push(new te(p,a.ref,"ref cannot reference another ref layer")):v=Yr(T.type):r.push(new te(p,a.ref,`ref layer "${E}" not found`))}else if(v!=="background")if(a.source){const T=g.sources&&g.sources[a.source],L=T&&Yr(T.type);T?L==="vector"&&v==="raster"?r.push(new te(p,a.source,`layer "${a.id}" requires a raster source`)):L==="raster"&&v!=="raster"?r.push(new te(p,a.source,`layer "${a.id}" requires a vector source`)):L!=="vector"||a["source-layer"]?L==="raster-dem"&&v!=="hillshade"?r.push(new te(p,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):v!=="line"||!a.paint||!a.paint["line-gradient"]||L==="geojson"&&T.lineMetrics||r.push(new te(p,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new te(p,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new te(p,a.source,`source "${a.source}" not found`))}else r.push(new te(p,a,'missing required property "source"'));return r=r.concat(uo({key:p,value:a,valueSpec:y.layer,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,objectElementValidators:{"*":()=>[],type:()=>s.validateSpec({key:`${p}.type`,value:a.type,valueSpec:y.layer.type,style:s.style,styleSpec:s.styleSpec,validateSpec:s.validateSpec,object:a,objectKey:"type"}),filter:Ll,layout:T=>uo({layer:a,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":L=>Fe(Ri({layerType:v},L))}}),paint:T=>uo({layer:a,key:T.key,value:T.value,style:T.style,styleSpec:T.styleSpec,validateSpec:T.validateSpec,objectElementValidators:{"*":L=>ce(Ri({layerType:v},L))}})}})),r}function an(s){const r=s.value,a=s.key,p=Dn(r);return p!=="string"?[new te(a,r,`string expected, ${p} found`)]:[]}const dr={promoteId:function({key:s,value:r}){if(Dn(r)==="string")return an({key:s,value:r});{const a=[];for(const p in r)a.push(...an({key:`${s}.${p}`,value:r[p]}));return a}}};function Cr(s){const r=s.value,a=s.key,p=s.styleSpec,g=s.style,y=s.validateSpec;if(!r.type)return[new te(a,r,'"type" is required')];const v=Yr(r.type);let E;switch(v){case"vector":case"raster":case"raster-dem":return E=uo({key:a,value:r,valueSpec:p[`source_${v.replace("-","_")}`],style:s.style,styleSpec:p,objectElementValidators:dr,validateSpec:y}),E;case"geojson":if(E=uo({key:a,value:r,valueSpec:p.source_geojson,style:g,styleSpec:p,validateSpec:y,objectElementValidators:dr}),r.cluster)for(const T in r.clusterProperties){const[L,N]=r.clusterProperties[T],F=typeof L=="string"?[L,["accumulated"],["get",T]]:L;E.push(...ls({key:`${a}.${T}.map`,value:N,validateSpec:y,expressionContext:"cluster-map"})),E.push(...ls({key:`${a}.${T}.reduce`,value:F,validateSpec:y,expressionContext:"cluster-reduce"}))}return E;case"video":return uo({key:a,value:r,valueSpec:p.source_video,style:g,validateSpec:y,styleSpec:p});case"image":return uo({key:a,value:r,valueSpec:p.source_image,style:g,validateSpec:y,styleSpec:p});case"canvas":return[new te(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Al({key:`${a}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:g,validateSpec:y,styleSpec:p})}}function Xo(s){const r=s.value,a=s.styleSpec,p=a.light,g=s.style;let y=[];const v=Dn(r);if(r===void 0)return y;if(v!=="object")return y=y.concat([new te("light",r,`object expected, ${v} found`)]),y;for(const E in r){const T=E.match(/^(.*)-transition$/);y=y.concat(T&&p[T[1]]&&p[T[1]].transition?s.validateSpec({key:E,value:r[E],valueSpec:a.transition,validateSpec:s.validateSpec,style:g,styleSpec:a}):p[E]?s.validateSpec({key:E,value:r[E],valueSpec:p[E],validateSpec:s.validateSpec,style:g,styleSpec:a}):[new te(E,r[E],`unknown property "${E}"`)])}return y}function Pr(s){const r=s.value,a=s.styleSpec,p=a.terrain,g=s.style;let y=[];const v=Dn(r);if(r===void 0)return y;if(v!=="object")return y=y.concat([new te("terrain",r,`object expected, ${v} found`)]),y;for(const E in r)y=y.concat(p[E]?s.validateSpec({key:E,value:r[E],valueSpec:p[E],validateSpec:s.validateSpec,style:g,styleSpec:a}):[new te(E,r[E],`unknown property "${E}"`)]);return y}function Qr(s){let r=[];const a=s.value,p=s.key;if(Array.isArray(a)){const g=[],y=[];for(const v in a)a[v].id&&g.includes(a[v].id)&&r.push(new te(p,a,`all the sprites' ids must be unique, but ${a[v].id} is duplicated`)),g.push(a[v].id),a[v].url&&y.includes(a[v].url)&&r.push(new te(p,a,`all the sprites' URLs must be unique, but ${a[v].url} is duplicated`)),y.push(a[v].url),r=r.concat(uo({key:`${p}[${v}]`,value:a[v],valueSpec:{id:{type:"string",required:!0},url:{type:"string",required:!0}},validateSpec:s.validateSpec}));return r}return an({key:p,value:a})}const us={"*":()=>[],array:Rc,boolean:function(s){const r=s.value,a=s.key,p=Dn(r);return p!=="boolean"?[new te(a,r,`boolean expected, ${p} found`)]:[]},number:Zu,color:function(s){const r=s.key,a=s.value,p=Dn(a);return p!=="string"?[new te(r,a,`color expected, ${p} found`)]:Te.parse(String(a))?[]:[new te(r,a,`color expected, "${a}" found`)]},constants:Nc,enum:Al,filter:Ll,function:Oc,layer:nr,object:uo,source:Cr,light:Xo,terrain:Pr,string:an,formatted:function(s){return an(s).length===0?[]:ls(s)},resolvedImage:function(s){return an(s).length===0?[]:ls(s)},padding:function(s){const r=s.key,a=s.value;if(Dn(a)==="array"){if(a.length<1||a.length>4)return[new te(r,a,`padding requires 1 to 4 values; ${a.length} values found`)];const p={type:"number"};let g=[];for(let y=0;y<a.length;y++)g=g.concat(s.validateSpec({key:`${r}[${y}]`,value:a[y],validateSpec:s.validateSpec,valueSpec:p}));return g}return Zu({key:r,value:a,valueSpec:{}})},sprite:Qr};function Po(s){const r=s.value,a=s.valueSpec,p=s.styleSpec;return s.validateSpec=Po,a.expression&&ya(Yr(r))?Oc(s):a.expression&&qo(Ls(r))?ls(s):a.type&&us[a.type]?us[a.type](s):uo(Ri({},s,{valueSpec:a.type?p[a.type]:a}))}function Oi(s){const r=s.value,a=s.key,p=an(s);return p.length||(r.indexOf("{fontstack}")===-1&&p.push(new te(a,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&p.push(new te(a,r,'"glyphs" url must include a "{range}" token'))),p}function xi(s,r=St){let a=[];return a=a.concat(Po({key:"",value:s,valueSpec:r.$root,styleSpec:r,style:s,validateSpec:Po,objectElementValidators:{glyphs:Oi,"*":()=>[]}})),s.constants&&(a=a.concat(Nc({key:"constants",value:s.constants,style:s,styleSpec:r,validateSpec:Po}))),xa(a)}function Si(s){return function(r){return s({...r,validateSpec:Po})}}function xa(s){return[].concat(s).sort((r,a)=>r.line-a.line)}function gr(s){return function(...r){return xa(s.apply(this,r))}}xi.source=gr(Si(Cr)),xi.sprite=gr(Si(Qr)),xi.glyphs=gr(Si(Oi)),xi.light=gr(Si(Xo)),xi.terrain=gr(Si(Pr)),xi.layer=gr(Si(nr)),xi.filter=gr(Si(Ll)),xi.paintProperty=gr(Si(ce)),xi.layoutProperty=gr(Si(Fe));const Yo=xi,xh=Yo.light,Dp=Yo.paintProperty,kp=Yo.layoutProperty;function Bn(s,r){let a=!1;if(r&&r.length)for(const p of r)s.fire(new We(new Error(p.message))),a=!0;return a}class kn{constructor(r,a,p){const g=this.cells=[];if(r instanceof ArrayBuffer){this.arrayBuffer=r;const v=new Int32Array(this.arrayBuffer);r=v[0],this.d=(a=v[1])+2*(p=v[2]);for(let T=0;T<this.d*this.d;T++){const L=v[3+T],N=v[3+T+1];g.push(L===N?null:v.subarray(L,N))}const E=v[3+g.length+1];this.keys=v.subarray(v[3+g.length],E),this.bboxes=v.subarray(E),this.insert=this._insertReadonly}else{this.d=a+2*p;for(let v=0;v<this.d*this.d;v++)g.push([]);this.keys=[],this.bboxes=[]}this.n=a,this.extent=r,this.padding=p,this.scale=a/r,this.uid=0;const y=p/a*r;this.min=-y,this.max=r+y}insert(r,a,p,g,y){this._forEachCell(a,p,g,y,this._insertCell,this.uid++,void 0,void 0),this.keys.push(r),this.bboxes.push(a),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(y)}_insertReadonly(){throw new Error("Cannot insert into a GridIndex created from an ArrayBuffer.")}_insertCell(r,a,p,g,y,v){this.cells[y].push(v)}query(r,a,p,g,y){const v=this.min,E=this.max;if(r<=v&&a<=v&&E<=p&&E<=g&&!y)return Array.prototype.slice.call(this.keys);{const T=[];return this._forEachCell(r,a,p,g,this._queryCell,T,{},y),T}}_queryCell(r,a,p,g,y,v,E,T){const L=this.cells[y];if(L!==null){const N=this.keys,F=this.bboxes;for(let U=0;U<L.length;U++){const q=L[U];if(E[q]===void 0){const Y=4*q;(T?T(F[Y+0],F[Y+1],F[Y+2],F[Y+3]):r<=F[Y+2]&&a<=F[Y+3]&&p>=F[Y+0]&&g>=F[Y+1])?(E[q]=!0,v.push(N[q])):E[q]=!1}}}}_forEachCell(r,a,p,g,y,v,E,T){const L=this._convertToCellCoord(r),N=this._convertToCellCoord(a),F=this._convertToCellCoord(p),U=this._convertToCellCoord(g);for(let q=L;q<=F;q++)for(let Y=N;Y<=U;Y++){const nt=this.d*Y+q;if((!T||T(this._convertFromCellCoord(q),this._convertFromCellCoord(Y),this._convertFromCellCoord(q+1),this._convertFromCellCoord(Y+1)))&&y.call(this,r,a,p,g,nt,v,E,T))return}}_convertFromCellCoord(r){return(r-this.padding)/this.scale}_convertToCellCoord(r){return Math.max(0,Math.min(this.d-1,Math.floor(r*this.scale)+this.padding))}toArrayBuffer(){if(this.arrayBuffer)return this.arrayBuffer;const r=this.cells,a=3+this.cells.length+1+1;let p=0;for(let v=0;v<this.cells.length;v++)p+=this.cells[v].length;const g=new Int32Array(a+p+this.keys.length+this.bboxes.length);g[0]=this.extent,g[1]=this.n,g[2]=this.padding;let y=a;for(let v=0;v<r.length;v++){const E=r[v];g[3+v]=y,g.set(E,y),y+=E.length}return g[3+r.length]=y,g.set(this.keys,y),y+=this.keys.length,g[3+r.length+1]=y,g.set(this.bboxes,y),y+=this.bboxes.length,g.buffer}static serialize(r,a){const p=r.toArrayBuffer();return a&&a.push(p),{buffer:p}}static deserialize(r){return new kn(r.buffer)}}const Mo={};function de(s,r,a={}){if(Mo[s])throw new Error(`${s} is already registered.`);Object.defineProperty(r,"_classRegistryKey",{value:s,writeable:!1}),Mo[s]={klass:r,omit:a.omit||[],shallow:a.shallow||[]}}de("Object",Object),de("TransferableGridIndex",kn),de("Color",Te),de("Error",Error),de("AJAXError",pr),de("ResolvedImage",Ji),de("StylePropertyFunction",$n),de("StyleExpression",qs,{omit:["_evaluator"]}),de("ZoomDependentExpression",en),de("ZoomConstantExpression",Ml),de("CompoundExpression",fn,{omit:["_evaluate"]});for(const s in Ka)Ka[s]._classRegistryKey||de(`Expression_${s}`,Ka[s]);function Dl(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function zi(s,r){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob)return s;if(Dl(s)||Ye(s))return r&&r.push(s),s;if(ArrayBuffer.isView(s)){const a=s;return r&&r.push(a.buffer),a}if(s instanceof ImageData)return r&&r.push(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const p of s)a.push(zi(p,r));return a}if(typeof s=="object"){const a=s.constructor,p=a._classRegistryKey;if(!p)throw new Error("can't serialize object of unregistered class");if(!Mo[p])throw new Error(`${p} is not registered.`);const g=a.serialize?a.serialize(s,r):{};if(a.serialize){if(r&&g===r[r.length-1])throw new Error("statically serialized object won't survive transfer of $name property")}else{for(const y in s){if(!s.hasOwnProperty(y)||Mo[p].omit.indexOf(y)>=0)continue;const v=s[y];g[y]=Mo[p].shallow.indexOf(y)>=0?v:zi(v,r)}s instanceof Error&&(g.message=s.message)}if(g.$name)throw new Error("$name property is reserved for worker serialization logic.");return p!=="Object"&&(g.$name=p),g}throw new Error("can't serialize object of type "+typeof s)}function Ti(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||s instanceof Blob||Dl(s)||Ye(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Ti);if(typeof s=="object"){const r=s.$name||"Object";if(!Mo[r])throw new Error(`can't deserialize unregistered class ${r}`);const{klass:a}=Mo[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(s);const p=Object.create(a.prototype);for(const g of Object.keys(s)){if(g==="$name")continue;const y=s[g];p[g]=Mo[r].shallow.indexOf(g)>=0?y:Ti(y)}return p}throw new Error("can't deserialize object of type "+typeof s)}class Zs{constructor(){this.first=!0}update(r,a){const p=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=p,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=p,!0):(this.lastFloorZoom>p?(this.lastIntegerZoom=p+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<p&&(this.lastIntegerZoom=p,this.lastIntegerZoomTime=a),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=p,!0))}}const le={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519};function nl(s){for(const r of s)if(uu(r.charCodeAt(0)))return!0;return!1}function ba(s){for(const r of s)if(!wa(r.charCodeAt(0)))return!1;return!0}function wa(s){return!(le.Arabic(s)||le["Arabic Supplement"](s)||le["Arabic Extended-A"](s)||le["Arabic Presentation Forms-A"](s)||le["Arabic Presentation Forms-B"](s))}function uu(s){return!(s!==746&&s!==747&&(s<4352||!(le["Bopomofo Extended"](s)||le.Bopomofo(s)||le["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||le["CJK Compatibility Ideographs"](s)||le["CJK Compatibility"](s)||le["CJK Radicals Supplement"](s)||le["CJK Strokes"](s)||!(!le["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||le["CJK Unified Ideographs Extension A"](s)||le["CJK Unified Ideographs"](s)||le["Enclosed CJK Letters and Months"](s)||le["Hangul Compatibility Jamo"](s)||le["Hangul Jamo Extended-A"](s)||le["Hangul Jamo Extended-B"](s)||le["Hangul Jamo"](s)||le["Hangul Syllables"](s)||le.Hiragana(s)||le["Ideographic Description Characters"](s)||le.Kanbun(s)||le["Kangxi Radicals"](s)||le["Katakana Phonetic Extensions"](s)||le.Katakana(s)&&s!==12540||!(!le["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!le["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||le["Unified Canadian Aboriginal Syllabics"](s)||le["Unified Canadian Aboriginal Syllabics Extended"](s)||le["Vertical Forms"](s)||le["Yijing Hexagram Symbols"](s)||le["Yi Syllables"](s)||le["Yi Radicals"](s))))}function cu(s){return!(uu(s)||function(r){return!!(le["Latin-1 Supplement"](r)&&(r===167||r===169||r===174||r===177||r===188||r===189||r===190||r===215||r===247)||le["General Punctuation"](r)&&(r===8214||r===8224||r===8225||r===8240||r===8241||r===8251||r===8252||r===8258||r===8263||r===8264||r===8265||r===8273)||le["Letterlike Symbols"](r)||le["Number Forms"](r)||le["Miscellaneous Technical"](r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||r===9003||r>=9085&&r<=9114||r>=9150&&r<=9165||r===9167||r>=9169&&r<=9179||r>=9186&&r<=9215)||le["Control Pictures"](r)&&r!==9251||le["Optical Character Recognition"](r)||le["Enclosed Alphanumerics"](r)||le["Geometric Shapes"](r)||le["Miscellaneous Symbols"](r)&&!(r>=9754&&r<=9759)||le["Miscellaneous Symbols and Arrows"](r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||le["CJK Symbols and Punctuation"](r)||le.Katakana(r)||le["Private Use Area"](r)||le["CJK Compatibility Forms"](r)||le["Small Form Variants"](r)||le["Halfwidth and Fullwidth Forms"](r)||r===8734||r===8756||r===8757||r>=9984&&r<=10087||r>=10102&&r<=10131||r===65532||r===65533)}(s))}function kl(s){return s>=1424&&s<=2303||le["Arabic Presentation Forms-A"](s)||le["Arabic Presentation Forms-B"](s)}function rl(s,r){return!(!r&&kl(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||le.Khmer(s))}function hu(s){for(const r of s)if(kl(r.charCodeAt(0)))return!0;return!1}const Xu="deferred",il="loading",Nl="loaded";let zc=null,Wo="unavailable",Rl=null;const Jf=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(Wo="error"),zc&&zc(s)};function Np(){bh.fire(new cr("pluginStateChange",{pluginStatus:Wo,pluginURL:Rl}))}const bh=new js,Rp=function(){return Wo},Qf=function(){if(Wo!==Xu||!Rl)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Wo=il,Np(),Rl&&Ur({url:Rl},s=>{s?Jf(s):(Wo=Nl,Np())})},Ds={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Wo===Nl||Ds.applyArabicShaping!=null,isLoading:()=>Wo===il,setState(s){if(!Ue())throw new Error("Cannot set the state of the rtl-text-plugin when not in the web-worker context");Wo=s.pluginStatus,Rl=s.pluginURL},isParsed(){if(!Ue())throw new Error("rtl-text-plugin is only parsed on the worker-threads");return Ds.applyArabicShaping!=null&&Ds.processBidirectionalText!=null&&Ds.processStyledBidirectionalText!=null},getPluginURL(){if(!Ue())throw new Error("rtl-text-plugin url can only be queried from the worker threads");return Rl}};class Mr{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Zs,this.transition={})}isSupportedScript(r){return function(a,p){for(const g of a)if(!rl(g.charCodeAt(0),p))return!1;return!0}(r,Ds.isLoaded())}crossFadingFactor(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,a=r-Math.floor(r),p=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*p}:{fromScale:.5,toScale:1,t:1-(1-p)*a}}}class wh{constructor(r,a){this.property=r,this.value=a,this.expression=function(p,g){if(ya(p))return new $n(p,g);if(qo(p)){const y=qu(p,g);if(y.result==="error")throw new Error(y.value.map(v=>`${v.key}: ${v.message}`).join(", "));return y.value}{let y=p;return g.type==="color"&&typeof p=="string"?y=Te.parse(p):g.type!=="padding"||typeof p!="number"&&!Array.isArray(p)||(y=Or.parse(p)),{kind:"constant",evaluate:()=>y}}}(a===void 0?r.specification.default:a,r.specification)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(r,a,p){return this.property.possiblyEvaluate(this,r,a,p)}}class Op{constructor(r){this.property=r,this.value=new wh(r,void 0)}transitioned(r,a){return new Fc(this.property,this.value,a,gt({},r.transition,this.transition),r.now)}untransitioned(){return new Fc(this.property,this.value,null,{},0)}}class td{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return Zt(this._values[r].value.value)}setValue(r,a){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Op(this._values[r].property)),this._values[r].value=new wh(this._values[r].property,a===null?void 0:Zt(a))}getTransition(r){return Zt(this._values[r].transition)}setTransition(r,a){Object.prototype.hasOwnProperty.call(this._values,r)||(this._values[r]=new Op(this._values[r].property)),this._values[r].transition=Zt(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const p=this.getValue(a);p!==void 0&&(r[a]=p);const g=this.getTransition(a);g!==void 0&&(r[`${a}-transition`]=g)}return r}transitioned(r,a){const p=new ed(this._properties);for(const g of Object.keys(this._values))p._values[g]=this._values[g].transitioned(r,a._values[g]);return p}untransitioned(){const r=new ed(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class Fc{constructor(r,a,p,g,y){this.property=r,this.value=a,this.begin=y+g.delay||0,this.end=this.begin+g.duration||0,r.specification.transition&&(g.delay||g.duration)&&(this.prior=p)}possiblyEvaluate(r,a,p){const g=r.now||0,y=this.value.possiblyEvaluate(r,a,p),v=this.prior;if(v){if(g>this.end)return this.prior=null,y;if(this.value.isDataDriven())return this.prior=null,y;if(g<this.begin)return v.possiblyEvaluate(r,a,p);{const E=(g-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(r,a,p),y,function(T){if(T<=0)return 0;if(T>=1)return 1;const L=T*T,N=L*T;return 4*(T<.5?N:3*(T-L)+N-.75)}(E))}}return y}}class ed{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,p){const g=new Eh(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,a,p);return g}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class zp{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return Zt(this._values[r].value)}setValue(r,a){this._values[r]=new wh(this._values[r].property,a===null?void 0:Zt(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const p=this.getValue(a);p!==void 0&&(r[a]=p)}return r}possiblyEvaluate(r,a,p){const g=new Eh(this._properties);for(const y of Object.keys(this._values))g._values[y]=this._values[y].possiblyEvaluate(r,a,p);return g}}class Ea{constructor(r,a,p){this.property=r,this.value=a,this.parameters=p}isConstant(){return this.value.kind==="constant"}constantOr(r){return this.value.kind==="constant"?this.value.value:r}evaluate(r,a,p,g){return this.property.evaluate(this.value,this.parameters,r,a,p,g)}}class Eh{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class Le{constructor(r){this.specification=r}possiblyEvaluate(r,a){if(r.isDataDriven())throw new Error("Value should not be data driven");return r.expression.evaluate(a)}interpolate(r,a,p){const g=ao[this.specification.type];return g?g(r,a,p):r}}class Be{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,p,g){return new Ea(this,r.expression.kind==="constant"||r.expression.kind==="camera"?{kind:"constant",value:r.expression.evaluate(a,null,{},p,g)}:r.expression,a)}interpolate(r,a,p){if(r.value.kind!=="constant"||a.value.kind!=="constant")return r;if(r.value.value===void 0||a.value.value===void 0)return new Ea(this,{kind:"constant",value:void 0},r.parameters);const g=ao[this.specification.type];if(g){const y=g(r.value.value,a.value.value,p);return new Ea(this,{kind:"constant",value:y},r.parameters)}return r}evaluate(r,a,p,g,y,v){return r.kind==="constant"?r.value:r.evaluate(a,p,g,y,v)}}class Bc extends Be{possiblyEvaluate(r,a,p,g){if(r.value===void 0)return new Ea(this,{kind:"constant",value:void 0},a);if(r.expression.kind==="constant"){const y=r.expression.evaluate(a,null,{},p,g),v=r.property.specification.type==="resolvedImage"&&typeof y!="string"?y.name:y,E=this._calculate(v,v,v,a);return new Ea(this,{kind:"constant",value:E},a)}if(r.expression.kind==="camera"){const y=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new Ea(this,{kind:"constant",value:y},a)}return new Ea(this,r.expression,a)}evaluate(r,a,p,g,y,v){if(r.kind==="source"){const E=r.evaluate(a,p,g,y,v);return this._calculate(E,E,E,a)}return r.kind==="composite"?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},p,g),r.evaluate({zoom:Math.floor(a.zoom)},p,g),r.evaluate({zoom:Math.floor(a.zoom)+1},p,g),a):r.value}_calculate(r,a,p,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:p,to:a}}interpolate(r){return r}}class Fp{constructor(r){this.specification=r}possiblyEvaluate(r,a,p,g){if(r.value!==void 0){if(r.expression.kind==="constant"){const y=r.expression.evaluate(a,null,{},p,g);return this._calculate(y,y,y,a)}return this._calculate(r.expression.evaluate(new Mr(Math.floor(a.zoom-1),a)),r.expression.evaluate(new Mr(Math.floor(a.zoom),a)),r.expression.evaluate(new Mr(Math.floor(a.zoom+1),a)),a)}}_calculate(r,a,p,g){return g.zoom>g.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:p,to:a}}interpolate(r){return r}}class Bp{constructor(r){this.specification=r}possiblyEvaluate(r,a,p,g){return!!r.expression.evaluate(a,null,{},p,g)}interpolate(){return!1}}class Ho{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const a in r){const p=r[a];p.specification.overridable&&this.overridableProperties.push(a);const g=this.defaultPropertyValues[a]=new wh(p,void 0),y=this.defaultTransitionablePropertyValues[a]=new Op(p);this.defaultTransitioningPropertyValues[a]=y.untransitioned(),this.defaultPossiblyEvaluatedValues[a]=g.possiblyEvaluate({})}}}de("DataDrivenProperty",Be),de("DataConstantProperty",Le),de("CrossFadedDataDrivenProperty",Bc),de("CrossFadedProperty",Fp),de("ColorRampProperty",Bp);const nd="-transition";class Ia extends js{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1},r.type!=="custom"&&(this.metadata=r.metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,r.type!=="background"&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new zp(a.layout)),a.paint)){this._transitionablePaint=new td(a.paint);for(const p in r.paint)this.setPaintProperty(p,r.paint[p],{validate:!1});for(const p in r.layout)this.setLayoutProperty(p,r.layout[p],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Eh(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return r==="visibility"?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,p={}){a!=null&&this._validate(kp,`layers.${this.id}.layout.${r}`,r,a,p)||(r!=="visibility"?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return r.endsWith(nd)?this._transitionablePaint.getTransition(r.slice(0,-11)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,p={}){if(a!=null&&this._validate(Dp,`layers.${this.id}.paint.${r}`,r,a,p))return!1;if(r.endsWith(nd))return this._transitionablePaint.setTransition(r.slice(0,-11),a||void 0),!1;{const g=this._transitionablePaint._values[r],y=g.property.specification["property-type"]==="cross-faded-data-driven",v=g.value.isDataDriven(),E=g.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const T=this._transitionablePaint._values[r].value;return T.isDataDriven()||v||y||this._handleOverridablePaintPropertyUpdate(r,E,T)}}_handleSpecialPaintPropertyUpdate(r){}_handleOverridablePaintPropertyUpdate(r,a,p){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||this.visibility==="none"}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),Ut(r,(a,p)=>!(a===void 0||p==="layout"&&!Object.keys(a).length||p==="paint"&&!Object.keys(a).length))}_validate(r,a,p,g,y={}){return(!y||y.validate!==!1)&&Bn(this,r.call(Yo,{key:a,layerType:this.type,objectKey:p,value:g,styleSpec:St,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof Ea&&As(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}}const Eg={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class ol{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class ti{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}}function bi(s,r=1){let a=0,p=0;return{members:s.map(g=>{const y=Eg[g.type].BYTES_PER_ELEMENT,v=a=rd(a,Math.max(r,y)),E=g.components||1;return p=Math.max(p,y),a+=y*E,{name:g.name,type:g.type,components:E,offset:v}}),size:rd(a,Math.max(p,r)),alignment:r}}function rd(s,r){return Math.ceil(s/r)*r}class Yu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const p=this.length;return this.resize(p+1),this.emplace(p,r,a)}emplace(r,a,p){const g=2*r;return this.int16[g+0]=a,this.int16[g+1]=p,r}}Yu.prototype.bytesPerElement=4,de("StructArrayLayout2i4",Yu);class Ih extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,p)}emplace(r,a,p,g){const y=3*r;return this.int16[y+0]=a,this.int16[y+1]=p,this.int16[y+2]=g,r}}Ih.prototype.bytesPerElement=6,de("StructArrayLayout3i6",Ih);class Up extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,p,g)}emplace(r,a,p,g,y){const v=4*r;return this.int16[v+0]=a,this.int16[v+1]=p,this.int16[v+2]=g,this.int16[v+3]=y,r}}Up.prototype.bytesPerElement=8,de("StructArrayLayout4i8",Up);class Sa extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,g,y,v){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,p,g,y,v)}emplace(r,a,p,g,y,v,E){const T=6*r;return this.int16[T+0]=a,this.int16[T+1]=p,this.int16[T+2]=g,this.int16[T+3]=y,this.int16[T+4]=v,this.int16[T+5]=E,r}}Sa.prototype.bytesPerElement=12,de("StructArrayLayout2i4i12",Sa);class Sh extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,g,y,v){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,p,g,y,v)}emplace(r,a,p,g,y,v,E){const T=4*r,L=8*r;return this.int16[T+0]=a,this.int16[T+1]=p,this.uint8[L+4]=g,this.uint8[L+5]=y,this.uint8[L+6]=v,this.uint8[L+7]=E,r}}Sh.prototype.bytesPerElement=8,de("StructArrayLayout2i4ub8",Sh);class pu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const p=this.length;return this.resize(p+1),this.emplace(p,r,a)}emplace(r,a,p){const g=2*r;return this.float32[g+0]=a,this.float32[g+1]=p,r}}pu.prototype.bytesPerElement=8,de("StructArrayLayout2f8",pu);class Th extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p,g,y,v,E,T,L,N){const F=this.length;return this.resize(F+1),this.emplace(F,r,a,p,g,y,v,E,T,L,N)}emplace(r,a,p,g,y,v,E,T,L,N,F){const U=10*r;return this.uint16[U+0]=a,this.uint16[U+1]=p,this.uint16[U+2]=g,this.uint16[U+3]=y,this.uint16[U+4]=v,this.uint16[U+5]=E,this.uint16[U+6]=T,this.uint16[U+7]=L,this.uint16[U+8]=N,this.uint16[U+9]=F,r}}Th.prototype.bytesPerElement=20,de("StructArrayLayout10ui20",Th);class Uc extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p,g,y,v,E,T,L,N,F,U){const q=this.length;return this.resize(q+1),this.emplace(q,r,a,p,g,y,v,E,T,L,N,F,U)}emplace(r,a,p,g,y,v,E,T,L,N,F,U,q){const Y=12*r;return this.int16[Y+0]=a,this.int16[Y+1]=p,this.int16[Y+2]=g,this.int16[Y+3]=y,this.uint16[Y+4]=v,this.uint16[Y+5]=E,this.uint16[Y+6]=T,this.uint16[Y+7]=L,this.int16[Y+8]=N,this.int16[Y+9]=F,this.int16[Y+10]=U,this.int16[Y+11]=q,r}}Uc.prototype.bytesPerElement=24,de("StructArrayLayout4i4ui4i24",Uc);class Vp extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,p)}emplace(r,a,p,g){const y=3*r;return this.float32[y+0]=a,this.float32[y+1]=p,this.float32[y+2]=g,r}}Vp.prototype.bytesPerElement=12,de("StructArrayLayout3f12",Vp);class Wu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}Wu.prototype.bytesPerElement=4,de("StructArrayLayout1ul4",Wu);class fu extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p,g,y,v,E,T,L){const N=this.length;return this.resize(N+1),this.emplace(N,r,a,p,g,y,v,E,T,L)}emplace(r,a,p,g,y,v,E,T,L,N){const F=10*r,U=5*r;return this.int16[F+0]=a,this.int16[F+1]=p,this.int16[F+2]=g,this.int16[F+3]=y,this.int16[F+4]=v,this.int16[F+5]=E,this.uint32[U+3]=T,this.uint16[F+8]=L,this.uint16[F+9]=N,r}}fu.prototype.bytesPerElement=20,de("StructArrayLayout6i1ul2ui20",fu);class Gp extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,g,y,v){const E=this.length;return this.resize(E+1),this.emplace(E,r,a,p,g,y,v)}emplace(r,a,p,g,y,v,E){const T=6*r;return this.int16[T+0]=a,this.int16[T+1]=p,this.int16[T+2]=g,this.int16[T+3]=y,this.int16[T+4]=v,this.int16[T+5]=E,r}}Gp.prototype.bytesPerElement=12,de("StructArrayLayout2i2i2i12",Gp);class Ch extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,p,g,y){const v=this.length;return this.resize(v+1),this.emplace(v,r,a,p,g,y)}emplace(r,a,p,g,y,v){const E=4*r,T=8*r;return this.float32[E+0]=a,this.float32[E+1]=p,this.float32[E+2]=g,this.int16[T+6]=y,this.int16[T+7]=v,r}}Ch.prototype.bytesPerElement=16,de("StructArrayLayout2f1f2i16",Ch);class du extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,p,g)}emplace(r,a,p,g,y){const v=12*r,E=3*r;return this.uint8[v+0]=a,this.uint8[v+1]=p,this.float32[E+1]=g,this.float32[E+2]=y,r}}du.prototype.bytesPerElement=12,de("StructArrayLayout2ub2f12",du);class Ph extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,p)}emplace(r,a,p,g){const y=3*r;return this.uint16[y+0]=a,this.uint16[y+1]=p,this.uint16[y+2]=g,r}}Ph.prototype.bytesPerElement=6,de("StructArrayLayout3ui6",Ph);class jp extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p,g,y,v,E,T,L,N,F,U,q,Y,nt,tt,ft){const bt=this.length;return this.resize(bt+1),this.emplace(bt,r,a,p,g,y,v,E,T,L,N,F,U,q,Y,nt,tt,ft)}emplace(r,a,p,g,y,v,E,T,L,N,F,U,q,Y,nt,tt,ft,bt){const ct=24*r,Ct=12*r,At=48*r;return this.int16[ct+0]=a,this.int16[ct+1]=p,this.uint16[ct+2]=g,this.uint16[ct+3]=y,this.uint32[Ct+2]=v,this.uint32[Ct+3]=E,this.uint32[Ct+4]=T,this.uint16[ct+10]=L,this.uint16[ct+11]=N,this.uint16[ct+12]=F,this.float32[Ct+7]=U,this.float32[Ct+8]=q,this.uint8[At+36]=Y,this.uint8[At+37]=nt,this.uint8[At+38]=tt,this.uint32[Ct+10]=ft,this.int16[ct+22]=bt,r}}jp.prototype.bytesPerElement=48,de("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",jp);class Mh extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p,g,y,v,E,T,L,N,F,U,q,Y,nt,tt,ft,bt,ct,Ct,At,Ft,Ie,Me,_e,he,oe,ye){const pe=this.length;return this.resize(pe+1),this.emplace(pe,r,a,p,g,y,v,E,T,L,N,F,U,q,Y,nt,tt,ft,bt,ct,Ct,At,Ft,Ie,Me,_e,he,oe,ye)}emplace(r,a,p,g,y,v,E,T,L,N,F,U,q,Y,nt,tt,ft,bt,ct,Ct,At,Ft,Ie,Me,_e,he,oe,ye,pe){const $t=34*r,ze=17*r;return this.int16[$t+0]=a,this.int16[$t+1]=p,this.int16[$t+2]=g,this.int16[$t+3]=y,this.int16[$t+4]=v,this.int16[$t+5]=E,this.int16[$t+6]=T,this.int16[$t+7]=L,this.uint16[$t+8]=N,this.uint16[$t+9]=F,this.uint16[$t+10]=U,this.uint16[$t+11]=q,this.uint16[$t+12]=Y,this.uint16[$t+13]=nt,this.uint16[$t+14]=tt,this.uint16[$t+15]=ft,this.uint16[$t+16]=bt,this.uint16[$t+17]=ct,this.uint16[$t+18]=Ct,this.uint16[$t+19]=At,this.uint16[$t+20]=Ft,this.uint16[$t+21]=Ie,this.uint16[$t+22]=Me,this.uint32[ze+12]=_e,this.float32[ze+13]=he,this.float32[ze+14]=oe,this.float32[ze+15]=ye,this.float32[ze+16]=pe,r}}Mh.prototype.bytesPerElement=68,de("StructArrayLayout8i15ui1ul4f68",Mh);class Ah extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Ah.prototype.bytesPerElement=4,de("StructArrayLayout1f4",Ah);class Lh extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,p){const g=this.length;return this.resize(g+1),this.emplace(g,r,a,p)}emplace(r,a,p,g){const y=4*r;return this.uint32[2*r+0]=a,this.uint16[y+2]=p,this.uint16[y+3]=g,r}}Lh.prototype.bytesPerElement=8,de("StructArrayLayout1ul2ui8",Lh);class d extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const p=this.length;return this.resize(p+1),this.emplace(p,r,a)}emplace(r,a,p){const g=2*r;return this.uint16[g+0]=a,this.uint16[g+1]=p,r}}d.prototype.bytesPerElement=4,de("StructArrayLayout2ui4",d);class i extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}i.prototype.bytesPerElement=2,de("StructArrayLayout1ui2",i);class c extends ti{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,p,g){const y=this.length;return this.resize(y+1),this.emplace(y,r,a,p,g)}emplace(r,a,p,g,y){const v=4*r;return this.float32[v+0]=a,this.float32[v+1]=p,this.float32[v+2]=g,this.float32[v+3]=y,r}}c.prototype.bytesPerElement=16,de("StructArrayLayout4f16",c);class f extends ol{get anchorPointX(){return this._structArray.int16[this._pos2+0]}get anchorPointY(){return this._structArray.int16[this._pos2+1]}get x1(){return this._structArray.int16[this._pos2+2]}get y1(){return this._structArray.int16[this._pos2+3]}get x2(){return this._structArray.int16[this._pos2+4]}get y2(){return this._structArray.int16[this._pos2+5]}get featureIndex(){return this._structArray.uint32[this._pos4+3]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+8]}get bucketIndex(){return this._structArray.uint16[this._pos2+9]}get anchorPoint(){return new k(this.anchorPointX,this.anchorPointY)}}f.prototype.size=20;class m extends fu{get(r){return new f(this,r)}}de("CollisionBoxArray",m);class x extends ol{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+2]}get numGlyphs(){return this._structArray.uint16[this._pos2+3]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+2]}get lineStartIndex(){return this._structArray.uint32[this._pos4+3]}get lineLength(){return this._structArray.uint32[this._pos4+4]}get segment(){return this._structArray.uint16[this._pos2+10]}get lowerSize(){return this._structArray.uint16[this._pos2+11]}get upperSize(){return this._structArray.uint16[this._pos2+12]}get lineOffsetX(){return this._structArray.float32[this._pos4+7]}get lineOffsetY(){return this._structArray.float32[this._pos4+8]}get writingMode(){return this._structArray.uint8[this._pos1+36]}get placedOrientation(){return this._structArray.uint8[this._pos1+37]}set placedOrientation(r){this._structArray.uint8[this._pos1+37]=r}get hidden(){return this._structArray.uint8[this._pos1+38]}set hidden(r){this._structArray.uint8[this._pos1+38]=r}get crossTileID(){return this._structArray.uint32[this._pos4+10]}set crossTileID(r){this._structArray.uint32[this._pos4+10]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+22]}}x.prototype.size=48;class S extends jp{get(r){return new x(this,r)}}de("PlacedSymbolArray",S);class P extends ol{get anchorX(){return this._structArray.int16[this._pos2+0]}get anchorY(){return this._structArray.int16[this._pos2+1]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+2]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+3]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+4]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+5]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+6]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+7]}get key(){return this._structArray.uint16[this._pos2+8]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+9]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+10]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+11]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+12]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+13]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+14]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get featureIndex(){return this._structArray.uint16[this._pos2+17]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+18]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+19]}get numIconVertices(){return this._structArray.uint16[this._pos2+20]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+21]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+22]}get crossTileID(){return this._structArray.uint32[this._pos4+12]}set crossTileID(r){this._structArray.uint32[this._pos4+12]=r}get textBoxScale(){return this._structArray.float32[this._pos4+13]}get textOffset0(){return this._structArray.float32[this._pos4+14]}get textOffset1(){return this._structArray.float32[this._pos4+15]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+16]}}P.prototype.size=68;class C extends Mh{get(r){return new P(this,r)}}de("SymbolInstanceArray",C);class A extends Ah{getoffsetX(r){return this.float32[1*r+0]}}de("GlyphOffsetArray",A);class O extends Ih{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}de("SymbolLineVertexArray",O);class R extends ol{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}}R.prototype.size=8;class X extends Lh{get(r){return new R(this,r)}}de("FeatureIndexArray",X);class et extends Yu{}class $ extends Yu{}class Q extends Yu{}class ot extends Sa{}class pt extends Sh{}class Pt extends pu{}class rt extends Th{}class Tt extends Uc{}class Lt extends Vp{}class jt extends Wu{}class Ht extends Gp{}class Jt extends du{}class Yt extends Ph{}class xe extends d{}const Oe=bi([{name:"a_pos",components:2,type:"Int16"}],4),{members:nn}=Oe;class ue{constructor(r=[]){this.segments=r}prepareSegment(r,a,p,g){let y=this.segments[this.segments.length-1];return r>ue.MAX_VERTEX_ARRAY_LENGTH&&Qt(`Max vertices per segment is ${ue.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!y||y.vertexLength+r>ue.MAX_VERTEX_ARRAY_LENGTH||y.sortKey!==g)&&(y={vertexOffset:a.length,primitiveOffset:p.length,vertexLength:0,primitiveLength:0},g!==void 0&&(y.sortKey=g),this.segments.push(y)),y}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,p,g){return new ue([{vertexOffset:r,primitiveOffset:a,vertexLength:p,primitiveLength:g,vaos:{},sortKey:0}])}}function je(s,r){return 256*(s=dt(Math.floor(s),0,255))+dt(Math.floor(r),0,255)}ue.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,de("SegmentVector",ue);const be=bi([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]);var Un={exports:{}},ai={exports:{}};ai.exports=function(s,r){var a,p,g,y,v,E,T,L;for(p=s.length-(a=3&s.length),g=r,v=3432918353,E=461845907,L=0;L<p;)T=255&s.charCodeAt(L)|(255&s.charCodeAt(++L))<<8|(255&s.charCodeAt(++L))<<16|(255&s.charCodeAt(++L))<<24,++L,g=27492+(65535&(y=5*(65535&(g=(g^=T=(65535&(T=(T=(65535&T)*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295)<<13|g>>>19))+((5*(g>>>16)&65535)<<16)&4294967295))+((58964+(y>>>16)&65535)<<16);switch(T=0,a){case 3:T^=(255&s.charCodeAt(L+2))<<16;case 2:T^=(255&s.charCodeAt(L+1))<<8;case 1:g^=T=(65535&(T=(T=(65535&(T^=255&s.charCodeAt(L)))*v+(((T>>>16)*v&65535)<<16)&4294967295)<<15|T>>>17))*E+(((T>>>16)*E&65535)<<16)&4294967295}return g^=s.length,g=2246822507*(65535&(g^=g>>>16))+((2246822507*(g>>>16)&65535)<<16)&4294967295,g=3266489909*(65535&(g^=g>>>13))+((3266489909*(g>>>16)&65535)<<16)&4294967295,(g^=g>>>16)>>>0};var Vn=ai.exports,ln={exports:{}};ln.exports=function(s,r){for(var a,p=s.length,g=r^p,y=0;p>=4;)a=1540483477*(65535&(a=255&s.charCodeAt(y)|(255&s.charCodeAt(++y))<<8|(255&s.charCodeAt(++y))<<16|(255&s.charCodeAt(++y))<<24))+((1540483477*(a>>>16)&65535)<<16),g=1540483477*(65535&g)+((1540483477*(g>>>16)&65535)<<16)^(a=1540483477*(65535&(a^=a>>>24))+((1540483477*(a>>>16)&65535)<<16)),p-=4,++y;switch(p){case 3:g^=(255&s.charCodeAt(y+2))<<16;case 2:g^=(255&s.charCodeAt(y+1))<<8;case 1:g=1540483477*(65535&(g^=255&s.charCodeAt(y)))+((1540483477*(g>>>16)&65535)<<16)}return g=1540483477*(65535&(g^=g>>>13))+((1540483477*(g>>>16)&65535)<<16),(g^=g>>>15)>>>0};var ei=Vn,Ao=ln.exports;Un.exports=ei,Un.exports.murmur3=ei,Un.exports.murmur2=Ao;var li=I(Un.exports);class Fi{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,p,g){this.ids.push(cs(r)),this.positions.push(a,p,g)}getPositions(r){if(!this.indexed)throw new Error("Trying to get index, but feature positions are not indexed");const a=cs(r);let p=0,g=this.ids.length-1;for(;p<g;){const v=p+g>>1;this.ids[v]>=a?g=v:p=v+1}const y=[];for(;this.ids[p]===a;)y.push({index:this.positions[3*p],start:this.positions[3*p+1],end:this.positions[3*p+2]}),p++;return y}static serialize(r,a){const p=new Float64Array(r.ids),g=new Uint32Array(r.positions);return Xs(p,g,0,p.length-1),a&&a.push(p.buffer,g.buffer),{ids:p,positions:g}}static deserialize(r){const a=new Fi;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function cs(s){const r=+s;return!isNaN(r)&&r<=Number.MAX_SAFE_INTEGER?r:li(String(s))}function Xs(s,r,a,p){for(;a<p;){const g=s[a+p>>1];let y=a-1,v=p+1;for(;;){do y++;while(s[y]<g);do v--;while(s[v]>g);if(y>=v)break;Ys(s,y,v),Ys(r,3*y,3*v),Ys(r,3*y+1,3*v+1),Ys(r,3*y+2,3*v+2)}v-a<p-v?(Xs(s,r,a,v),a=v+1):(Xs(s,r,v+1,p),p=v)}}function Ys(s,r,a){const p=s[r];s[r]=s[a],s[a]=p}de("FeaturePositionMap",Fi);class Lo{constructor(r,a){this.gl=r.gl,this.location=a}}class Ta extends Lo{constructor(r,a){super(r,a),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class Vc extends Lo{constructor(r,a){super(r,a),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class co extends Lo{constructor(r,a){super(r,a),this.current=Te.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Bi=new Float32Array(16);function jn(s){return[je(255*s.r,255*s.g),je(255*s.b,255*s.a)]}class Ci{constructor(r,a,p){this.value=r,this.uniformNames=a.map(g=>`u_${g}`),this.type=p}setUniform(r,a,p){r.set(p.constantOr(this.value))}getBinding(r,a,p){return this.type==="color"?new co(r,a):new Ta(r,a)}}class Ui{constructor(r,a){this.uniformNames=a.map(p=>`u_${p}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,a){this.pixelRatioFrom=a.pixelRatio,this.pixelRatioTo=r.pixelRatio,this.patternFrom=a.tlbr,this.patternTo=r.tlbr}setUniform(r,a,p,g){const y=g==="u_pattern_to"?this.patternTo:g==="u_pattern_from"?this.patternFrom:g==="u_pixel_ratio_to"?this.pixelRatioTo:g==="u_pixel_ratio_from"?this.pixelRatioFrom:null;y&&r.set(y)}getBinding(r,a,p){return p.substr(0,9)==="u_pattern"?new Vc(r,a):new Ta(r,a)}}class Kn{constructor(r,a,p,g){this.expression=r,this.type=p,this.maxValue=0,this.paintVertexAttributes=a.map(y=>({name:`a_${y}`,type:"Float32",components:p==="color"?2:1,offset:0})),this.paintVertexArray=new g}populatePaintArray(r,a,p,g,y){const v=this.paintVertexArray.length,E=this.expression.evaluate(new Mr(0),a,{},g,[],y);this.paintVertexArray.resize(r),this._setPaintValue(v,r,E)}updatePaintArray(r,a,p,g){const y=this.expression.evaluate({zoom:0},p,g);this._setPaintValue(r,a,y)}_setPaintValue(r,a,p){if(this.type==="color"){const g=jn(p);for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,g[0],g[1])}else{for(let g=r;g<a;g++)this.paintVertexArray.emplace(g,p);this.maxValue=Math.max(this.maxValue,Math.abs(p))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Pi{constructor(r,a,p,g,y,v){this.expression=r,this.uniformNames=a.map(E=>`u_${E}_t`),this.type=p,this.useIntegerZoom=g,this.zoom=y,this.maxValue=0,this.paintVertexAttributes=a.map(E=>({name:`a_${E}`,type:"Float32",components:p==="color"?4:2,offset:0})),this.paintVertexArray=new v}populatePaintArray(r,a,p,g,y){const v=this.expression.evaluate(new Mr(this.zoom),a,{},g,[],y),E=this.expression.evaluate(new Mr(this.zoom+1),a,{},g,[],y),T=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(T,r,v,E)}updatePaintArray(r,a,p,g){const y=this.expression.evaluate({zoom:this.zoom},p,g),v=this.expression.evaluate({zoom:this.zoom+1},p,g);this._setPaintValue(r,a,y,v)}_setPaintValue(r,a,p,g){if(this.type==="color"){const y=jn(p),v=jn(g);for(let E=r;E<a;E++)this.paintVertexArray.emplace(E,y[0],y[1],v[0],v[1])}else{for(let y=r;y<a;y++)this.paintVertexArray.emplace(y,p,g);this.maxValue=Math.max(this.maxValue,Math.abs(p),Math.abs(g))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a){const p=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,g=dt(this.expression.interpolationFactor(p,this.zoom,this.zoom+1),0,1);r.set(g)}getBinding(r,a,p){return new Ta(r,a)}}class hs{constructor(r,a,p,g,y,v){this.expression=r,this.type=a,this.useIntegerZoom=p,this.zoom=g,this.layerId=v,this.zoomInPaintVertexArray=new y,this.zoomOutPaintVertexArray=new y}populatePaintArray(r,a,p){const g=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(g,r,a.patterns&&a.patterns[this.layerId],p)}updatePaintArray(r,a,p,g,y){this._setPaintValues(r,a,p.patterns&&p.patterns[this.layerId],y)}_setPaintValues(r,a,p,g){if(!g||!p)return;const{min:y,mid:v,max:E}=p,T=g[y],L=g[v],N=g[E];if(T&&L&&N)for(let F=r;F<a;F++)this.zoomInPaintVertexArray.emplace(F,L.tl[0],L.tl[1],L.br[0],L.br[1],T.tl[0],T.tl[1],T.br[0],T.br[1],L.pixelRatio,T.pixelRatio),this.zoomOutPaintVertexArray.emplace(F,L.tl[0],L.tl[1],L.br[0],L.br[1],N.tl[0],N.tl[1],N.br[0],N.br[1],L.pixelRatio,N.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,be.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,be.members,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class Dh{constructor(r,a,p){this.binders={},this._buffers=[];const g=[];for(const y in r.paint._values){if(!p(y))continue;const v=r.paint.get(y);if(!(v instanceof Ea&&As(v.property.specification)))continue;const E=Ig(y,r.type),T=v.value,L=v.property.specification.type,N=v.property.useIntegerZoom,F=v.property.specification["property-type"],U=F==="cross-faded"||F==="cross-faded-data-driven";if(T.kind==="constant")this.binders[y]=U?new Ui(T.value,E):new Ci(T.value,E,L),g.push(`/u_${y}`);else if(T.kind==="source"||U){const q=id(y,L,"source");this.binders[y]=U?new hs(T,L,N,a,q,r.id):new Kn(T,E,L,q),g.push(`/a_${y}`)}else{const q=id(y,L,"composite");this.binders[y]=new Pi(T,E,L,N,a,q),g.push(`/z_${y}`)}}this.cacheKey=g.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof Kn||a instanceof Pi?a.maxValue:0}populatePaintArrays(r,a,p,g,y){for(const v in this.binders){const E=this.binders[v];(E instanceof Kn||E instanceof Pi||E instanceof hs)&&E.populatePaintArray(r,a,p,g,y)}}setConstantPatternPositions(r,a){for(const p in this.binders){const g=this.binders[p];g instanceof Ui&&g.setConstantPatternPositions(r,a)}}updatePaintArrays(r,a,p,g,y){let v=!1;for(const E in r){const T=a.getPositions(E);for(const L of T){const N=p.feature(L.index);for(const F in this.binders){const U=this.binders[F];if((U instanceof Kn||U instanceof Pi||U instanceof hs)&&U.expression.isStateDependent===!0){const q=g.paint.get(F);U.expression=q.value,U.updatePaintArray(L.start,L.end,N,r[E],y),v=!0}}}}return v}defines(){const r=[];for(const a in this.binders){const p=this.binders[a];(p instanceof Ci||p instanceof Ui)&&r.push(...p.uniformNames.map(g=>`#define HAS_UNIFORM_${g}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const p=this.binders[a];if(p instanceof Kn||p instanceof Pi)for(let g=0;g<p.paintVertexAttributes.length;g++)r.push(p.paintVertexAttributes[g].name);else if(p instanceof hs)for(let g=0;g<be.members.length;g++)r.push(be.members[g].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const p=this.binders[a];if(p instanceof Ci||p instanceof Ui||p instanceof Pi)for(const g of p.uniformNames)r.push(g)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,a){const p=[];for(const g in this.binders){const y=this.binders[g];if(y instanceof Ci||y instanceof Ui||y instanceof Pi){for(const v of y.uniformNames)if(a[v]){const E=y.getBinding(r,a[v],v);p.push({name:v,property:g,binding:E})}}}return p}setUniforms(r,a,p,g){for(const{name:y,property:v,binding:E}of a)this.binders[v].setUniform(E,g,p.get(v),y)}updatePaintBuffers(r){this._buffers=[];for(const a in this.binders){const p=this.binders[a];if(r&&p instanceof hs){const g=r.fromScale===2?p.zoomInPaintVertexBuffer:p.zoomOutPaintVertexBuffer;g&&this._buffers.push(g)}else(p instanceof Kn||p instanceof Pi)&&p.paintVertexBuffer&&this._buffers.push(p.paintVertexBuffer)}}upload(r){for(const a in this.binders){const p=this.binders[a];(p instanceof Kn||p instanceof Pi||p instanceof hs)&&p.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof Kn||a instanceof Pi||a instanceof hs)&&a.destroy()}}}class sl{constructor(r,a,p=()=>!0){this.programConfigurations={};for(const g of r)this.programConfigurations[g.id]=new Dh(g,a,p);this.needsUpload=!1,this._featureMap=new Fi,this._bufferOffset=0}populatePaintArrays(r,a,p,g,y,v){for(const E in this.programConfigurations)this.programConfigurations[E].populatePaintArrays(r,a,g,y,v);a.id!==void 0&&this._featureMap.add(a.id,p,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,p,g){for(const y of p)this.needsUpload=this.programConfigurations[y.id].updatePaintArrays(r,this._featureMap,a,y,g)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}function Ig(s,r){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[s]||[s.replace(`${r}-`,"").replace(/-/g,"_")]}function id(s,r,a){const p={color:{source:pu,composite:c},number:{source:Ah,composite:pu}},g=function(y){return{"line-pattern":{source:rt,composite:rt},"fill-pattern":{source:rt,composite:rt},"fill-extrusion-pattern":{source:rt,composite:rt}}[y]}(s);return g&&g[a]||p[r][a]}de("ConstantBinder",Ci),de("CrossFadedConstantBinder",Ui),de("SourceExpressionBinder",Kn),de("CrossFadedCompositeBinder",hs),de("CompositeExpressionBinder",Pi),de("ProgramConfiguration",Dh,{omit:["_buffers"]}),de("ProgramConfigurationSet",sl);var xr=8192;const qp=Math.pow(2,14)-1,Gc=-qp-1;function al(s){const r=xr/s.extent,a=s.loadGeometry();for(let p=0;p<a.length;p++){const g=a[p];for(let y=0;y<g.length;y++){const v=g[y],E=Math.round(v.x*r),T=Math.round(v.y*r);v.x=dt(E,Gc,qp),v.y=dt(T,Gc,qp),(E<v.x||E>v.x+1||T<v.y||T>v.y+1)&&Qt("Geometry exceeds allowed extent, reduce your vector tile buffer size")}}return a}function jc(s,r){return{type:s.type,id:s.id,properties:s.properties,geometry:r?al(s):[]}}function od(s,r,a,p,g){s.emplaceBack(2*r+(p+1)/2,2*a+(g+1)/2)}class Sg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new $,this.indexArray=new Yt,this.segments=new ue,this.programConfigurations=new sl(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,p){const g=this.layers[0],y=[];let v=null,E=!1;g.type==="circle"&&(v=g.layout.get("circle-sort-key"),E=!v.isConstant());for(const{feature:T,id:L,index:N,sourceLayerIndex:F}of r){const U=this.layers[0]._featureFilter.needGeometry,q=jc(T,U);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom),q,p))continue;const Y=E?v.evaluate(q,{},p):void 0,nt={id:L,properties:T.properties,type:T.type,sourceLayerIndex:F,index:N,geometry:U?q.geometry:al(T),patterns:{},sortKey:Y};y.push(nt)}E&&y.sort((T,L)=>T.sortKey-L.sortKey);for(const T of y){const{geometry:L,index:N,sourceLayerIndex:F}=T,U=r[N].feature;this.addFeature(T,L,N,p),a.featureIndex.insert(U,L,N,F,this.index)}}update(r,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,nn),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,p,g){for(const y of a)for(const v of y){const E=v.x,T=v.y;if(E<0||E>=xr||T<0||T>=xr)continue;const L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),N=L.vertexLength;od(this.layoutVertexArray,E,T,-1,-1),od(this.layoutVertexArray,E,T,1,-1),od(this.layoutVertexArray,E,T,1,1),od(this.layoutVertexArray,E,T,-1,1),this.indexArray.emplaceBack(N,N+1,N+2),this.indexArray.emplaceBack(N,N+3,N+2),L.vertexLength+=4,L.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,{},g)}}function __(s,r){for(let a=0;a<s.length;a++)if(kh(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(kh(s,r[a]))return!0;return!!Tg(s,r)}function gx(s,r,a){return!!kh(s,r)||!!Cg(r,s,a)}function y_(s,r){if(s.length===1)return x_(r,s[0]);for(let a=0;a<r.length;a++){const p=r[a];for(let g=0;g<p.length;g++)if(kh(s,p[g]))return!0}for(let a=0;a<s.length;a++)if(x_(r,s[a]))return!0;for(let a=0;a<r.length;a++)if(Tg(s,r[a]))return!0;return!1}function mx(s,r,a){if(s.length>1){if(Tg(s,r))return!0;for(let p=0;p<r.length;p++)if(Cg(r[p],s,a))return!0}for(let p=0;p<s.length;p++)if(Cg(s[p],r,a))return!0;return!1}function Tg(s,r){if(s.length===0||r.length===0)return!1;for(let a=0;a<s.length-1;a++){const p=s[a],g=s[a+1];for(let y=0;y<r.length-1;y++)if(_x(p,g,r[y],r[y+1]))return!0}return!1}function _x(s,r,a,p){return ie(s,a,p)!==ie(r,a,p)&&ie(s,r,a)!==ie(s,r,p)}function Cg(s,r,a){const p=a*a;if(r.length===1)return s.distSqr(r[0])<p;for(let g=1;g<r.length;g++)if(v_(s,r[g-1],r[g])<p)return!0;return!1}function v_(s,r,a){const p=r.distSqr(a);if(p===0)return s.distSqr(r);const g=((s.x-r.x)*(a.x-r.x)+(s.y-r.y)*(a.y-r.y))/p;return s.distSqr(g<0?r:g>1?a:a.sub(r)._mult(g)._add(r))}function x_(s,r){let a,p,g,y=!1;for(let v=0;v<s.length;v++){a=s[v];for(let E=0,T=a.length-1;E<a.length;T=E++)p=a[E],g=a[T],p.y>r.y!=g.y>r.y&&r.x<(g.x-p.x)*(r.y-p.y)/(g.y-p.y)+p.x&&(y=!y)}return y}function kh(s,r){let a=!1;for(let p=0,g=s.length-1;p<s.length;g=p++){const y=s[p],v=s[g];y.y>r.y!=v.y>r.y&&r.x<(v.x-y.x)*(r.y-y.y)/(v.y-y.y)+y.x&&(a=!a)}return a}function yx(s,r,a){const p=a[0],g=a[2];if(s.x<p.x&&r.x<p.x||s.x>g.x&&r.x>g.x||s.y<p.y&&r.y<p.y||s.y>g.y&&r.y>g.y)return!1;const y=ie(s,r,a[0]);return y!==ie(s,r,a[1])||y!==ie(s,r,a[2])||y!==ie(s,r,a[3])}function Zp(s,r,a){const p=r.paint.get(s).value;return p.kind==="constant"?p.value:a.programConfigurations.get(r.id).getMaxValue(s)}function sd(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function ad(s,r,a,p,g){if(!r[0]&&!r[1])return s;const y=k.convert(r)._mult(g);a==="viewport"&&y._rotate(-p);const v=[];for(let E=0;E<s.length;E++)v.push(s[E].sub(y));return v}let b_,w_;de("CircleBucket",Sg,{omit:["layers"]});var vx={get paint(){return w_=w_||new Ho({"circle-radius":new Be(St.paint_circle["circle-radius"]),"circle-color":new Be(St.paint_circle["circle-color"]),"circle-blur":new Be(St.paint_circle["circle-blur"]),"circle-opacity":new Be(St.paint_circle["circle-opacity"]),"circle-translate":new Le(St.paint_circle["circle-translate"]),"circle-translate-anchor":new Le(St.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Le(St.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Le(St.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Be(St.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Be(St.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Be(St.paint_circle["circle-stroke-opacity"])})},get layout(){return b_=b_||new Ho({"circle-sort-key":new Be(St.layout_circle["circle-sort-key"])})}},$o=1e-6,Nh=typeof Float32Array<"u"?Float32Array:Array;function Pg(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function E_(s,r,a){var p=r[0],g=r[1],y=r[2],v=r[3],E=r[4],T=r[5],L=r[6],N=r[7],F=r[8],U=r[9],q=r[10],Y=r[11],nt=r[12],tt=r[13],ft=r[14],bt=r[15],ct=a[0],Ct=a[1],At=a[2],Ft=a[3];return s[0]=ct*p+Ct*E+At*F+Ft*nt,s[1]=ct*g+Ct*T+At*U+Ft*tt,s[2]=ct*y+Ct*L+At*q+Ft*ft,s[3]=ct*v+Ct*N+At*Y+Ft*bt,s[4]=(ct=a[4])*p+(Ct=a[5])*E+(At=a[6])*F+(Ft=a[7])*nt,s[5]=ct*g+Ct*T+At*U+Ft*tt,s[6]=ct*y+Ct*L+At*q+Ft*ft,s[7]=ct*v+Ct*N+At*Y+Ft*bt,s[8]=(ct=a[8])*p+(Ct=a[9])*E+(At=a[10])*F+(Ft=a[11])*nt,s[9]=ct*g+Ct*T+At*U+Ft*tt,s[10]=ct*y+Ct*L+At*q+Ft*ft,s[11]=ct*v+Ct*N+At*Y+Ft*bt,s[12]=(ct=a[12])*p+(Ct=a[13])*E+(At=a[14])*F+(Ft=a[15])*nt,s[13]=ct*g+Ct*T+At*U+Ft*tt,s[14]=ct*y+Ct*L+At*q+Ft*ft,s[15]=ct*v+Ct*N+At*Y+Ft*bt,s}Math.hypot||(Math.hypot=function(){for(var s=0,r=arguments.length;r--;)s+=arguments[r]*arguments[r];return Math.sqrt(s)});var Xp,xx=E_;function ld(s,r,a){var p=r[0],g=r[1],y=r[2],v=r[3];return s[0]=a[0]*p+a[4]*g+a[8]*y+a[12]*v,s[1]=a[1]*p+a[5]*g+a[9]*y+a[13]*v,s[2]=a[2]*p+a[6]*g+a[10]*y+a[14]*v,s[3]=a[3]*p+a[7]*g+a[11]*y+a[15]*v,s}function I_(s,r){const a=ld([],[s.x,s.y,0,1],r);return new k(a[0]/a[3],a[1]/a[3])}Xp=new Nh(4),Nh!=Float32Array&&(Xp[0]=0,Xp[1]=0,Xp[2]=0,Xp[3]=0);class S_ extends Sg{}let T_;de("HeatmapBucket",S_,{omit:["layers"]});var bx={get paint(){return T_=T_||new Ho({"heatmap-radius":new Be(St.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Be(St.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Le(St.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Bp(St.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Le(St.paint_heatmap["heatmap-opacity"])})}};function Mg(s,{width:r,height:a},p,g){if(g){if(g instanceof Uint8ClampedArray)g=new Uint8Array(g.buffer);else if(g.length!==r*a*p)throw new RangeError(`mismatched image size. expected: ${g.length} but got: ${r*a*p}`)}else g=new Uint8Array(r*a*p);return s.width=r,s.height=a,s.data=g,s}function C_(s,{width:r,height:a},p){if(r===s.width&&a===s.height)return;const g=Mg({},{width:r,height:a},p);Ag(s,g,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,r),height:Math.min(s.height,a)},p),s.width=r,s.height=a,s.data=g.data}function Ag(s,r,a,p,g,y){if(g.width===0||g.height===0)return r;if(g.width>s.width||g.height>s.height||a.x>s.width-g.width||a.y>s.height-g.height)throw new RangeError("out of range source coordinates for image copy");if(g.width>r.width||g.height>r.height||p.x>r.width-g.width||p.y>r.height-g.height)throw new RangeError("out of range destination coordinates for image copy");const v=s.data,E=r.data;if(v===E)throw new Error("srcData equals dstData, so image is already copied");for(let T=0;T<g.height;T++){const L=((a.y+T)*s.width+a.x)*y,N=((p.y+T)*r.width+p.x)*y;for(let F=0;F<g.width*y;F++)E[N+F]=v[L+F]}return r}class Yp{constructor(r,a){Mg(this,r,1,a)}resize(r){C_(this,r,1)}clone(){return new Yp({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,p,g,y){Ag(r,a,p,g,y,1)}}class Ws{constructor(r,a){Mg(this,r,4,a)}resize(r){C_(this,r,4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new Ws({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,p,g,y){Ag(r,a,p,g,y,4)}}function P_(s){const r={},a=s.resolution||256,p=s.clips?s.clips.length:1,g=s.image||new Ws({width:a,height:p});if(Math.log(a)/Math.LN2%1!=0)throw new Error(`width is not a power of 2 - ${a}`);const y=(v,E,T)=>{r[s.evaluationKey]=T;const L=s.expression.evaluate(r);g.data[v+E+0]=Math.floor(255*L.r/L.a),g.data[v+E+1]=Math.floor(255*L.g/L.a),g.data[v+E+2]=Math.floor(255*L.b/L.a),g.data[v+E+3]=Math.floor(255*L.a)};if(s.clips)for(let v=0,E=0;v<p;++v,E+=4*a)for(let T=0,L=0;T<a;T++,L+=4){const N=T/(a-1),{start:F,end:U}=s.clips[v];y(E,L,F*(1-N)+U*N)}else for(let v=0,E=0;v<a;v++,E+=4)y(0,E,v/(a-1));return g}let M_;de("AlphaImage",Yp),de("RGBAImage",Ws);var wx={get paint(){return M_=M_||new Ho({"hillshade-illumination-direction":new Le(St.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Le(St.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Le(St.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Le(St.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Le(St.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Le(St.paint_hillshade["hillshade-accent-color"])})}};const Ex=bi([{name:"a_pos",components:2,type:"Int16"}],4),{members:Ix}=Ex;var Lg={exports:{}};function ud(s,r,a){a=a||2;var p,g,y,v,E,T,L,N=r&&r.length,F=N?r[0]*a:s.length,U=A_(s,0,F,a,!0),q=[];if(!U||U.next===U.prev)return q;if(N&&(U=function(nt,tt,ft,bt){var ct,Ct,At,Ft=[];for(ct=0,Ct=tt.length;ct<Ct;ct++)(At=A_(nt,tt[ct]*bt,ct<Ct-1?tt[ct+1]*bt:nt.length,bt,!1))===At.next&&(At.steiner=!0),Ft.push(Dx(At));for(Ft.sort(Mx),ct=0;ct<Ft.length;ct++)ft=Ax(Ft[ct],ft);return ft}(s,r,U,a)),s.length>80*a){p=y=s[0],g=v=s[1];for(var Y=a;Y<F;Y+=a)(E=s[Y])<p&&(p=E),(T=s[Y+1])<g&&(g=T),E>y&&(y=E),T>v&&(v=T);L=(L=Math.max(y-p,v-g))!==0?32767/L:0}return Wp(U,q,a,p,g,L,0),q}function A_(s,r,a,p,g){var y,v;if(g===Ng(s,r,a,p)>0)for(y=r;y<a;y+=p)v=k_(y,s[y],s[y+1],v);else for(y=a-p;y>=r;y-=p)v=k_(y,s[y],s[y+1],v);return v&&cd(v,v.next)&&($p(v),v=v.next),v}function qc(s,r){if(!s)return s;r||(r=s);var a,p=s;do if(a=!1,p.steiner||!cd(p,p.next)&&ui(p.prev,p,p.next)!==0)p=p.next;else{if($p(p),(p=r=p.prev)===p.next)break;a=!0}while(a||p!==r);return r}function Wp(s,r,a,p,g,y,v){if(s){!v&&y&&function(N,F,U,q){var Y=N;do Y.z===0&&(Y.z=Dg(Y.x,Y.y,F,U,q)),Y.prevZ=Y.prev,Y.nextZ=Y.next,Y=Y.next;while(Y!==N);Y.prevZ.nextZ=null,Y.prevZ=null,function(nt){var tt,ft,bt,ct,Ct,At,Ft,Ie,Me=1;do{for(ft=nt,nt=null,Ct=null,At=0;ft;){for(At++,bt=ft,Ft=0,tt=0;tt<Me&&(Ft++,bt=bt.nextZ);tt++);for(Ie=Me;Ft>0||Ie>0&&bt;)Ft!==0&&(Ie===0||!bt||ft.z<=bt.z)?(ct=ft,ft=ft.nextZ,Ft--):(ct=bt,bt=bt.nextZ,Ie--),Ct?Ct.nextZ=ct:nt=ct,ct.prevZ=Ct,Ct=ct;ft=bt}Ct.nextZ=null,Me*=2}while(At>1)}(Y)}(s,p,g,y);for(var E,T,L=s;s.prev!==s.next;)if(E=s.prev,T=s.next,y?Tx(s,p,g,y):Sx(s))r.push(E.i/a|0),r.push(s.i/a|0),r.push(T.i/a|0),$p(s),s=T.next,L=T.next;else if((s=T)===L){v?v===1?Wp(s=Cx(qc(s),r,a),r,a,p,g,y,2):v===2&&Px(s,r,a,p,g,y):Wp(qc(s),r,a,p,g,y,1);break}}}function Sx(s){var r=s.prev,a=s,p=s.next;if(ui(r,a,p)>=0)return!1;for(var g=r.x,y=a.x,v=p.x,E=r.y,T=a.y,L=p.y,N=g<y?g<v?g:v:y<v?y:v,F=E<T?E<L?E:L:T<L?T:L,U=g>y?g>v?g:v:y>v?y:v,q=E>T?E>L?E:L:T>L?T:L,Y=p.next;Y!==r;){if(Y.x>=N&&Y.x<=U&&Y.y>=F&&Y.y<=q&&Rh(g,E,y,T,v,L,Y.x,Y.y)&&ui(Y.prev,Y,Y.next)>=0)return!1;Y=Y.next}return!0}function Tx(s,r,a,p){var g=s.prev,y=s,v=s.next;if(ui(g,y,v)>=0)return!1;for(var E=g.x,T=y.x,L=v.x,N=g.y,F=y.y,U=v.y,q=E<T?E<L?E:L:T<L?T:L,Y=N<F?N<U?N:U:F<U?F:U,nt=E>T?E>L?E:L:T>L?T:L,tt=N>F?N>U?N:U:F>U?F:U,ft=Dg(q,Y,r,a,p),bt=Dg(nt,tt,r,a,p),ct=s.prevZ,Ct=s.nextZ;ct&&ct.z>=ft&&Ct&&Ct.z<=bt;){if(ct.x>=q&&ct.x<=nt&&ct.y>=Y&&ct.y<=tt&&ct!==g&&ct!==v&&Rh(E,N,T,F,L,U,ct.x,ct.y)&&ui(ct.prev,ct,ct.next)>=0||(ct=ct.prevZ,Ct.x>=q&&Ct.x<=nt&&Ct.y>=Y&&Ct.y<=tt&&Ct!==g&&Ct!==v&&Rh(E,N,T,F,L,U,Ct.x,Ct.y)&&ui(Ct.prev,Ct,Ct.next)>=0))return!1;Ct=Ct.nextZ}for(;ct&&ct.z>=ft;){if(ct.x>=q&&ct.x<=nt&&ct.y>=Y&&ct.y<=tt&&ct!==g&&ct!==v&&Rh(E,N,T,F,L,U,ct.x,ct.y)&&ui(ct.prev,ct,ct.next)>=0)return!1;ct=ct.prevZ}for(;Ct&&Ct.z<=bt;){if(Ct.x>=q&&Ct.x<=nt&&Ct.y>=Y&&Ct.y<=tt&&Ct!==g&&Ct!==v&&Rh(E,N,T,F,L,U,Ct.x,Ct.y)&&ui(Ct.prev,Ct,Ct.next)>=0)return!1;Ct=Ct.nextZ}return!0}function Cx(s,r,a){var p=s;do{var g=p.prev,y=p.next.next;!cd(g,y)&&L_(g,p,p.next,y)&&Hp(g,y)&&Hp(y,g)&&(r.push(g.i/a|0),r.push(p.i/a|0),r.push(y.i/a|0),$p(p),$p(p.next),p=s=y),p=p.next}while(p!==s);return qc(p)}function Px(s,r,a,p,g,y){var v=s;do{for(var E=v.next.next;E!==v.prev;){if(v.i!==E.i&&kx(v,E)){var T=D_(v,E);return v=qc(v,v.next),T=qc(T,T.next),Wp(v,r,a,p,g,y,0),void Wp(T,r,a,p,g,y,0)}E=E.next}v=v.next}while(v!==s)}function Mx(s,r){return s.x-r.x}function Ax(s,r){var a=function(g,y){var v,E=y,T=g.x,L=g.y,N=-1/0;do{if(L<=E.y&&L>=E.next.y&&E.next.y!==E.y){var F=E.x+(L-E.y)*(E.next.x-E.x)/(E.next.y-E.y);if(F<=T&&F>N&&(N=F,v=E.x<E.next.x?E:E.next,F===T))return v}E=E.next}while(E!==y);if(!v)return null;var U,q=v,Y=v.x,nt=v.y,tt=1/0;E=v;do T>=E.x&&E.x>=Y&&T!==E.x&&Rh(L<nt?T:N,L,Y,nt,L<nt?N:T,L,E.x,E.y)&&(U=Math.abs(L-E.y)/(T-E.x),Hp(E,g)&&(U<tt||U===tt&&(E.x>v.x||E.x===v.x&&Lx(v,E)))&&(v=E,tt=U)),E=E.next;while(E!==q);return v}(s,r);if(!a)return r;var p=D_(a,s);return qc(p,p.next),qc(a,a.next)}function Lx(s,r){return ui(s.prev,s,r.prev)<0&&ui(r.next,s,s.next)<0}function Dg(s,r,a,p,g){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-a)*g|0)|s<<8))|s<<4))|s<<2))|s<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=(r-p)*g|0)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function Dx(s){var r=s,a=s;do(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next;while(r!==s);return a}function Rh(s,r,a,p,g,y,v,E){return(g-v)*(r-E)>=(s-v)*(y-E)&&(s-v)*(p-E)>=(a-v)*(r-E)&&(a-v)*(y-E)>=(g-v)*(p-E)}function kx(s,r){return s.next.i!==r.i&&s.prev.i!==r.i&&!function(a,p){var g=a;do{if(g.i!==a.i&&g.next.i!==a.i&&g.i!==p.i&&g.next.i!==p.i&&L_(g,g.next,a,p))return!0;g=g.next}while(g!==a);return!1}(s,r)&&(Hp(s,r)&&Hp(r,s)&&function(a,p){var g=a,y=!1,v=(a.x+p.x)/2,E=(a.y+p.y)/2;do g.y>E!=g.next.y>E&&g.next.y!==g.y&&v<(g.next.x-g.x)*(E-g.y)/(g.next.y-g.y)+g.x&&(y=!y),g=g.next;while(g!==a);return y}(s,r)&&(ui(s.prev,s,r.prev)||ui(s,r.prev,r))||cd(s,r)&&ui(s.prev,s,s.next)>0&&ui(r.prev,r,r.next)>0)}function ui(s,r,a){return(r.y-s.y)*(a.x-r.x)-(r.x-s.x)*(a.y-r.y)}function cd(s,r){return s.x===r.x&&s.y===r.y}function L_(s,r,a,p){var g=pd(ui(s,r,a)),y=pd(ui(s,r,p)),v=pd(ui(a,p,s)),E=pd(ui(a,p,r));return g!==y&&v!==E||!(g!==0||!hd(s,a,r))||!(y!==0||!hd(s,p,r))||!(v!==0||!hd(a,s,p))||!(E!==0||!hd(a,r,p))}function hd(s,r,a){return r.x<=Math.max(s.x,a.x)&&r.x>=Math.min(s.x,a.x)&&r.y<=Math.max(s.y,a.y)&&r.y>=Math.min(s.y,a.y)}function pd(s){return s>0?1:s<0?-1:0}function Hp(s,r){return ui(s.prev,s,s.next)<0?ui(s,r,s.next)>=0&&ui(s,s.prev,r)>=0:ui(s,r,s.prev)<0||ui(s,s.next,r)<0}function D_(s,r){var a=new kg(s.i,s.x,s.y),p=new kg(r.i,r.x,r.y),g=s.next,y=r.prev;return s.next=r,r.prev=s,a.next=g,g.prev=a,p.next=a,a.prev=p,y.next=p,p.prev=y,p}function k_(s,r,a,p){var g=new kg(s,r,a);return p?(g.next=p.next,g.prev=p,p.next.prev=g,p.next=g):(g.prev=g,g.next=g),g}function $p(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function kg(s,r,a){this.i=s,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Ng(s,r,a,p){for(var g=0,y=r,v=a-p;y<a;y+=p)g+=(s[v]-s[y])*(s[y+1]+s[v+1]),v=y;return g}Lg.exports=ud,Lg.exports.default=ud,ud.deviation=function(s,r,a,p){var g=r&&r.length,y=Math.abs(Ng(s,0,g?r[0]*a:s.length,a));if(g)for(var v=0,E=r.length;v<E;v++)y-=Math.abs(Ng(s,r[v]*a,v<E-1?r[v+1]*a:s.length,a));var T=0;for(v=0;v<p.length;v+=3){var L=p[v]*a,N=p[v+1]*a,F=p[v+2]*a;T+=Math.abs((s[L]-s[F])*(s[N+1]-s[L+1])-(s[L]-s[N])*(s[F+1]-s[L+1]))}return y===0&&T===0?0:Math.abs((T-y)/y)},ud.flatten=function(s){for(var r=s[0][0].length,a={vertices:[],holes:[],dimensions:r},p=0,g=0;g<s.length;g++){for(var y=0;y<s[g].length;y++)for(var v=0;v<r;v++)a.vertices.push(s[g][y][v]);g>0&&a.holes.push(p+=s[g-1].length)}return a};var N_=I(Lg.exports);function Nx(s,r,a,p,g){R_(s,r,a||0,p||s.length-1,g||Rx)}function R_(s,r,a,p,g){for(;p>a;){if(p-a>600){var y=p-a+1,v=r-a+1,E=Math.log(y),T=.5*Math.exp(2*E/3),L=.5*Math.sqrt(E*T*(y-T)/y)*(v-y/2<0?-1:1);R_(s,r,Math.max(a,Math.floor(r-v*T/y+L)),Math.min(p,Math.floor(r+(y-v)*T/y+L)),g)}var N=s[r],F=a,U=p;for(Kp(s,a,r),g(s[p],N)>0&&Kp(s,a,p);F<U;){for(Kp(s,F,U),F++,U--;g(s[F],N)<0;)F++;for(;g(s[U],N)>0;)U--}g(s[a],N)===0?Kp(s,a,U):Kp(s,++U,p),U<=r&&(a=U+1),r<=U&&(p=U-1)}}function Kp(s,r,a){var p=s[r];s[r]=s[a],s[a]=p}function Rx(s,r){return s<r?-1:s>r?1:0}function Rg(s,r){const a=s.length;if(a<=1)return[s];const p=[];let g,y;for(let v=0;v<a;v++){const E=ve(s[v]);E!==0&&(s[v].area=Math.abs(E),y===void 0&&(y=E<0),y===E<0?(g&&p.push(g),g=[s[v]]):g.push(s[v]))}if(g&&p.push(g),r>1)for(let v=0;v<p.length;v++)p[v].length<=r||(Nx(p[v],r,1,p[v].length-1,Ox),p[v]=p[v].slice(0,r));return p}function Ox(s,r){return r.area-s.area}function Og(s,r,a){const p=a.patternDependencies;let g=!1;for(const y of r){const v=y.paint.get(`${s}-pattern`);v.isConstant()||(g=!0);const E=v.constantOr(null);E&&(g=!0,p[E.to]=!0,p[E.from]=!0)}return g}function zg(s,r,a,p,g){const y=g.patternDependencies;for(const v of r){const E=v.paint.get(`${s}-pattern`).value;if(E.kind!=="constant"){let T=E.evaluate({zoom:p-1},a,{},g.availableImages),L=E.evaluate({zoom:p},a,{},g.availableImages),N=E.evaluate({zoom:p+1},a,{},g.availableImages);T=T&&T.name?T.name:T,L=L&&L.name?L.name:L,N=N&&N.name?N.name:N,y[T]=!0,y[L]=!0,y[N]=!0,a.patterns[v.id]={min:T,mid:L,max:N}}}return a}class Fg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Q,this.indexArray=new Yt,this.indexArray2=new xe,this.programConfigurations=new sl(r.layers,r.zoom),this.segments=new ue,this.segments2=new ue,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,p){this.hasPattern=Og("fill",this.layers,a);const g=this.layers[0].layout.get("fill-sort-key"),y=!g.isConstant(),v=[];for(const{feature:E,id:T,index:L,sourceLayerIndex:N}of r){const F=this.layers[0]._featureFilter.needGeometry,U=jc(E,F);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom),U,p))continue;const q=y?g.evaluate(U,{},p,a.availableImages):void 0,Y={id:T,properties:E.properties,type:E.type,sourceLayerIndex:N,index:L,geometry:F?U.geometry:al(E),patterns:{},sortKey:q};v.push(Y)}y&&v.sort((E,T)=>E.sortKey-T.sortKey);for(const E of v){const{geometry:T,index:L,sourceLayerIndex:N}=E;if(this.hasPattern){const F=zg("fill",this.layers,E,this.zoom,a);this.patternFeatures.push(F)}else this.addFeature(E,T,L,p,{});a.featureIndex.insert(r[L].feature,T,L,N,this.index)}}update(r,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,p)}addFeatures(r,a,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,a,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ix),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,p,g,y){for(const v of Rg(a,500)){let E=0;for(const q of v)E+=q.length;const T=this.segments.prepareSegment(E,this.layoutVertexArray,this.indexArray),L=T.vertexLength,N=[],F=[];for(const q of v){if(q.length===0)continue;q!==v[0]&&F.push(N.length/2);const Y=this.segments2.prepareSegment(q.length,this.layoutVertexArray,this.indexArray2),nt=Y.vertexLength;this.layoutVertexArray.emplaceBack(q[0].x,q[0].y),this.indexArray2.emplaceBack(nt+q.length-1,nt),N.push(q[0].x),N.push(q[0].y);for(let tt=1;tt<q.length;tt++)this.layoutVertexArray.emplaceBack(q[tt].x,q[tt].y),this.indexArray2.emplaceBack(nt+tt-1,nt+tt),N.push(q[tt].x),N.push(q[tt].y);Y.vertexLength+=q.length,Y.primitiveLength+=q.length}const U=N_(N,F);for(let q=0;q<U.length;q+=3)this.indexArray.emplaceBack(L+U[q],L+U[q+1],L+U[q+2]);T.vertexLength+=E,T.primitiveLength+=U.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,y,g)}}let O_,z_;de("FillBucket",Fg,{omit:["layers","patternFeatures"]});var zx={get paint(){return z_=z_||new Ho({"fill-antialias":new Le(St.paint_fill["fill-antialias"]),"fill-opacity":new Be(St.paint_fill["fill-opacity"]),"fill-color":new Be(St.paint_fill["fill-color"]),"fill-outline-color":new Be(St.paint_fill["fill-outline-color"]),"fill-translate":new Le(St.paint_fill["fill-translate"]),"fill-translate-anchor":new Le(St.paint_fill["fill-translate-anchor"]),"fill-pattern":new Bc(St.paint_fill["fill-pattern"])})},get layout(){return O_=O_||new Ho({"fill-sort-key":new Be(St.layout_fill["fill-sort-key"])})}};const Fx=bi([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4),Bx=bi([{name:"a_centroid",components:2,type:"Int16"}],4),{members:Ux}=Fx;var Hu={},Vx=w,F_=Oh;function Oh(s,r,a,p,g){this.properties={},this.extent=a,this.type=0,this._pbf=s,this._geometry=-1,this._keys=p,this._values=g,s.readFields(Gx,this,r)}function Gx(s,r,a){s==1?r.id=a.readVarint():s==2?function(p,g){for(var y=p.readVarint()+p.pos;p.pos<y;){var v=g._keys[p.readVarint()],E=g._values[p.readVarint()];g.properties[v]=E}}(a,r):s==3?r.type=a.readVarint():s==4&&(r._geometry=a.pos)}function jx(s){for(var r,a,p=0,g=0,y=s.length,v=y-1;g<y;v=g++)p+=((a=s[v]).x-(r=s[g]).x)*(r.y+a.y);return p}Oh.types=["Unknown","Point","LineString","Polygon"],Oh.prototype.loadGeometry=function(){var s=this._pbf;s.pos=this._geometry;for(var r,a=s.readVarint()+s.pos,p=1,g=0,y=0,v=0,E=[];s.pos<a;){if(g<=0){var T=s.readVarint();p=7&T,g=T>>3}if(g--,p===1||p===2)y+=s.readSVarint(),v+=s.readSVarint(),p===1&&(r&&E.push(r),r=[]),r.push(new Vx(y,v));else{if(p!==7)throw new Error("unknown command "+p);r&&r.push(r[0].clone())}}return r&&E.push(r),E},Oh.prototype.bbox=function(){var s=this._pbf;s.pos=this._geometry;for(var r=s.readVarint()+s.pos,a=1,p=0,g=0,y=0,v=1/0,E=-1/0,T=1/0,L=-1/0;s.pos<r;){if(p<=0){var N=s.readVarint();a=7&N,p=N>>3}if(p--,a===1||a===2)(g+=s.readSVarint())<v&&(v=g),g>E&&(E=g),(y+=s.readSVarint())<T&&(T=y),y>L&&(L=y);else if(a!==7)throw new Error("unknown command "+a)}return[v,T,E,L]},Oh.prototype.toGeoJSON=function(s,r,a){var p,g,y=this.extent*Math.pow(2,a),v=this.extent*s,E=this.extent*r,T=this.loadGeometry(),L=Oh.types[this.type];function N(q){for(var Y=0;Y<q.length;Y++){var nt=q[Y];q[Y]=[360*(nt.x+v)/y-180,360/Math.PI*Math.atan(Math.exp((180-360*(nt.y+E)/y)*Math.PI/180))-90]}}switch(this.type){case 1:var F=[];for(p=0;p<T.length;p++)F[p]=T[p][0];N(T=F);break;case 2:for(p=0;p<T.length;p++)N(T[p]);break;case 3:for(T=function(q){var Y=q.length;if(Y<=1)return[q];for(var nt,tt,ft=[],bt=0;bt<Y;bt++){var ct=jx(q[bt]);ct!==0&&(tt===void 0&&(tt=ct<0),tt===ct<0?(nt&&ft.push(nt),nt=[q[bt]]):nt.push(q[bt]))}return nt&&ft.push(nt),ft}(T),p=0;p<T.length;p++)for(g=0;g<T[p].length;g++)N(T[p][g])}T.length===1?T=T[0]:L="Multi"+L;var U={type:"Feature",geometry:{type:L,coordinates:T},properties:this.properties};return"id"in this&&(U.id=this.id),U};var qx=F_,B_=U_;function U_(s,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=s,this._keys=[],this._values=[],this._features=[],s.readFields(Zx,this,r),this.length=this._features.length}function Zx(s,r,a){s===15?r.version=a.readVarint():s===1?r.name=a.readString():s===5?r.extent=a.readVarint():s===2?r._features.push(a.pos):s===3?r._keys.push(a.readString()):s===4&&r._values.push(function(p){for(var g=null,y=p.readVarint()+p.pos;p.pos<y;){var v=p.readVarint()>>3;g=v===1?p.readString():v===2?p.readFloat():v===3?p.readDouble():v===4?p.readVarint64():v===5?p.readVarint():v===6?p.readSVarint():v===7?p.readBoolean():null}return g}(a))}U_.prototype.feature=function(s){if(s<0||s>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[s];var r=this._pbf.readVarint()+this._pbf.pos;return new qx(this._pbf,r,this.extent,this._keys,this._values)};var Xx=B_;function Yx(s,r,a){if(s===3){var p=new Xx(a,a.readVarint()+a.pos);p.length&&(r[p.name]=p)}}Hu.VectorTile=function(s,r){this.layers=s.readFields(Yx,{},r)},Hu.VectorTileFeature=F_,Hu.VectorTileLayer=B_;const Wx=Hu.VectorTileFeature.types,Bg=Math.pow(2,13);function Jp(s,r,a,p,g,y,v,E){s.emplaceBack(r,a,2*Math.floor(p*Bg)+v,g*Bg*2,y*Bg*2,Math.round(E))}class Ug{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.layoutVertexArray=new ot,this.centroidVertexArray=new et,this.indexArray=new Yt,this.programConfigurations=new sl(r.layers,r.zoom),this.segments=new ue,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,p){this.features=[],this.hasPattern=Og("fill-extrusion",this.layers,a);for(const{feature:g,id:y,index:v,sourceLayerIndex:E}of r){const T=this.layers[0]._featureFilter.needGeometry,L=jc(g,T);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom),L,p))continue;const N={id:y,sourceLayerIndex:E,index:v,geometry:T?L.geometry:al(g),properties:g.properties,type:g.type,patterns:{}};this.hasPattern?this.features.push(zg("fill-extrusion",this.layers,N,this.zoom,a)):this.addFeature(N,N.geometry,v,p,{}),a.featureIndex.insert(g,N.geometry,v,E,this.index,!0)}}addFeatures(r,a,p){for(const g of this.features){const{geometry:y}=g;this.addFeature(g,y,g.index,a,p)}}update(r,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,p)}isEmpty(){return this.layoutVertexArray.length===0&&this.centroidVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Ux),this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Bx.members,!0),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.centroidVertexBuffer.destroy())}addFeature(r,a,p,g,y){const v={x:0,y:0,vertexCount:0};for(const E of Rg(a,500)){let T=0;for(const Y of E)T+=Y.length;let L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(const Y of E){if(Y.length===0||$x(Y))continue;let nt=0;for(let tt=0;tt<Y.length;tt++){const ft=Y[tt];if(tt>=1){const bt=Y[tt-1];if(!Hx(ft,bt)){L.vertexLength+4>ue.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const ct=ft.sub(bt)._perp()._unit(),Ct=bt.dist(ft);nt+Ct>32768&&(nt=0),Jp(this.layoutVertexArray,ft.x,ft.y,ct.x,ct.y,0,0,nt),Jp(this.layoutVertexArray,ft.x,ft.y,ct.x,ct.y,0,1,nt),v.x+=2*ft.x,v.y+=2*ft.y,v.vertexCount+=2,nt+=Ct,Jp(this.layoutVertexArray,bt.x,bt.y,ct.x,ct.y,0,0,nt),Jp(this.layoutVertexArray,bt.x,bt.y,ct.x,ct.y,0,1,nt),v.x+=2*bt.x,v.y+=2*bt.y,v.vertexCount+=2;const At=L.vertexLength;this.indexArray.emplaceBack(At,At+2,At+1),this.indexArray.emplaceBack(At+1,At+2,At+3),L.vertexLength+=4,L.primitiveLength+=2}}}}if(L.vertexLength+T>ue.MAX_VERTEX_ARRAY_LENGTH&&(L=this.segments.prepareSegment(T,this.layoutVertexArray,this.indexArray)),Wx[r.type]!=="Polygon")continue;const N=[],F=[],U=L.vertexLength;for(const Y of E)if(Y.length!==0){Y!==E[0]&&F.push(N.length/2);for(let nt=0;nt<Y.length;nt++){const tt=Y[nt];Jp(this.layoutVertexArray,tt.x,tt.y,0,0,1,1,0),v.x+=tt.x,v.y+=tt.y,v.vertexCount+=1,N.push(tt.x),N.push(tt.y)}}const q=N_(N,F);for(let Y=0;Y<q.length;Y+=3)this.indexArray.emplaceBack(U+q[Y],U+q[Y+2],U+q[Y+1]);L.primitiveLength+=q.length/3,L.vertexLength+=T}for(let E=0;E<v.vertexCount;E++)this.centroidVertexArray.emplaceBack(Math.floor(v.x/v.vertexCount),Math.floor(v.y/v.vertexCount));this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,y,g)}}function Hx(s,r){return s.x===r.x&&(s.x<0||s.x>xr)||s.y===r.y&&(s.y<0||s.y>xr)}function $x(s){return s.every(r=>r.x<0)||s.every(r=>r.x>xr)||s.every(r=>r.y<0)||s.every(r=>r.y>xr)}let V_;de("FillExtrusionBucket",Ug,{omit:["layers","features"]});var Kx={get paint(){return V_=V_||new Ho({"fill-extrusion-opacity":new Le(St["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Be(St["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Le(St["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Le(St["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Bc(St["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new Be(St["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Be(St["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Le(St["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})}};function Qp(s,r){return s.x*r.x+s.y*r.y}function G_(s,r){if(s.length===1){let a=0;const p=r[a++];let g;for(;!g||p.equals(g);)if(g=r[a++],!g)return 1/0;for(;a<r.length;a++){const y=r[a],v=s[0],E=g.sub(p),T=y.sub(p),L=v.sub(p),N=Qp(E,E),F=Qp(E,T),U=Qp(T,T),q=Qp(L,E),Y=Qp(L,T),nt=N*U-F*F,tt=(U*q-F*Y)/nt,ft=(N*Y-F*q)/nt,bt=p.z*(1-tt-ft)+g.z*tt+y.z*ft;if(isFinite(bt))return bt}return 1/0}{let a=1/0;for(const p of r)a=Math.min(a,p.z);return a}}const Jx=bi([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4),{members:Qx}=Jx,t1=bi([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]),{members:e1}=t1,n1=Hu.VectorTileFeature.types,r1=Math.cos(Math.PI/180*37.5),j_=Math.pow(2,14)/.5;class Vg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new pt,this.layoutVertexArray2=new Pt,this.indexArray=new Yt,this.programConfigurations=new sl(r.layers,r.zoom),this.segments=new ue,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,p){this.hasPattern=Og("line",this.layers,a);const g=this.layers[0].layout.get("line-sort-key"),y=!g.isConstant(),v=[];for(const{feature:E,id:T,index:L,sourceLayerIndex:N}of r){const F=this.layers[0]._featureFilter.needGeometry,U=jc(E,F);if(!this.layers[0]._featureFilter.filter(new Mr(this.zoom),U,p))continue;const q=y?g.evaluate(U,{},p):void 0,Y={id:T,properties:E.properties,type:E.type,sourceLayerIndex:N,index:L,geometry:F?U.geometry:al(E),patterns:{},sortKey:q};v.push(Y)}y&&v.sort((E,T)=>E.sortKey-T.sortKey);for(const E of v){const{geometry:T,index:L,sourceLayerIndex:N}=E;if(this.hasPattern){const F=zg("line",this.layers,E,this.zoom,a);this.patternFeatures.push(F)}else this.addFeature(E,T,L,p,{});a.featureIndex.insert(r[L].feature,T,L,N,this.index)}}update(r,a,p){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,p)}addFeatures(r,a,p){for(const g of this.patternFeatures)this.addFeature(g,g.geometry,g.index,a,p)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,e1)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Qx),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_start")&&Object.prototype.hasOwnProperty.call(r.properties,"mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,p,g,y){const v=this.layers[0].layout,E=v.get("line-join").evaluate(r,{}),T=v.get("line-cap"),L=v.get("line-miter-limit"),N=v.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const F of a)this.addLine(F,r,E,T,L,N);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,p,y,g)}addLine(r,a,p,g,y,v){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ft=0;ft<r.length-1;ft++)this.totalDistance+=r[ft].dist(r[ft+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const E=n1[a.type]==="Polygon";let T=r.length;for(;T>=2&&r[T-1].equals(r[T-2]);)T--;let L=0;for(;L<T-1&&r[L].equals(r[L+1]);)L++;if(T<(E?3:2))return;p==="bevel"&&(y=1.05);const N=this.overscaling<=16?15*xr/(512*this.overscaling):0,F=this.segments.prepareSegment(10*T,this.layoutVertexArray,this.indexArray);let U,q,Y,nt,tt;this.e1=this.e2=-1,E&&(U=r[T-2],tt=r[L].sub(U)._unit()._perp());for(let ft=L;ft<T;ft++){if(Y=ft===T-1?E?r[L+1]:void 0:r[ft+1],Y&&r[ft].equals(Y))continue;tt&&(nt=tt),U&&(q=U),U=r[ft],tt=Y?Y.sub(U)._unit()._perp():nt,nt=nt||tt;let bt=nt.add(tt);bt.x===0&&bt.y===0||bt._unit();const ct=nt.x*tt.x+nt.y*tt.y,Ct=bt.x*tt.x+bt.y*tt.y,At=Ct!==0?1/Ct:1/0,Ft=2*Math.sqrt(2-2*Ct),Ie=Ct<r1&&q&&Y,Me=nt.x*tt.y-nt.y*tt.x>0;if(Ie&&ft>L){const oe=U.dist(q);if(oe>2*N){const ye=U.sub(U.sub(q)._mult(N/oe)._round());this.updateDistance(q,ye),this.addCurrentVertex(ye,nt,0,0,F),q=ye}}const _e=q&&Y;let he=_e?p:E?"butt":g;if(_e&&he==="round"&&(At<v?he="miter":At<=2&&(he="fakeround")),he==="miter"&&At>y&&(he="bevel"),he==="bevel"&&(At>2&&(he="flipbevel"),At<y&&(he="miter")),q&&this.updateDistance(q,U),he==="miter")bt._mult(At),this.addCurrentVertex(U,bt,0,0,F);else if(he==="flipbevel"){if(At>100)bt=tt.mult(-1);else{const oe=At*nt.add(tt).mag()/nt.sub(tt).mag();bt._perp()._mult(oe*(Me?-1:1))}this.addCurrentVertex(U,bt,0,0,F),this.addCurrentVertex(U,bt.mult(-1),0,0,F)}else if(he==="bevel"||he==="fakeround"){const oe=-Math.sqrt(At*At-1),ye=Me?oe:0,pe=Me?0:oe;if(q&&this.addCurrentVertex(U,nt,ye,pe,F),he==="fakeround"){const $t=Math.round(180*Ft/Math.PI/20);for(let ze=1;ze<$t;ze++){let Ae=ze/$t;if(Ae!==.5){const br=Ae-.5;Ae+=Ae*br*(Ae-1)*((1.0904+ct*(ct*(3.55645-1.43519*ct)-3.2452))*br*br+(.848013+ct*(.215638*ct-1.06021)))}const vn=tt.sub(nt)._mult(Ae)._add(nt)._unit()._mult(Me?-1:1);this.addHalfVertex(U,vn.x,vn.y,!1,Me,0,F)}}Y&&this.addCurrentVertex(U,tt,-ye,-pe,F)}else if(he==="butt")this.addCurrentVertex(U,bt,0,0,F);else if(he==="square"){const oe=q?1:-1;this.addCurrentVertex(U,bt,oe,oe,F)}else he==="round"&&(q&&(this.addCurrentVertex(U,nt,0,0,F),this.addCurrentVertex(U,nt,1,1,F,!0)),Y&&(this.addCurrentVertex(U,tt,-1,-1,F,!0),this.addCurrentVertex(U,tt,0,0,F)));if(Ie&&ft<T-1){const oe=U.dist(Y);if(oe>2*N){const ye=U.add(Y.sub(U)._mult(N/oe)._round());this.updateDistance(U,ye),this.addCurrentVertex(ye,tt,0,0,F),U=ye}}}}addCurrentVertex(r,a,p,g,y,v=!1){const E=a.y*g-a.x,T=-a.y-a.x*g;this.addHalfVertex(r,a.x+a.y*p,a.y-a.x*p,v,!1,p,y),this.addHalfVertex(r,E,T,v,!0,-g,y),this.distance>j_/2&&this.totalDistance===0&&(this.distance=0,this.updateScaledDistance(),this.addCurrentVertex(r,a,p,g,y,v))}addHalfVertex({x:r,y:a},p,g,y,v,E,T){const L=.5*(this.lineClips?this.scaledDistance*(j_-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((r<<1)+(y?1:0),(a<<1)+(v?1:0),Math.round(63*p)+128,Math.round(63*g)+128,1+(E===0?0:E<0?-1:1)|(63&L)<<2,L>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);const N=T.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,N),T.primitiveLength++),v?this.e2=N:this.e1=N}updateScaledDistance(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}let q_,Z_;de("LineBucket",Vg,{omit:["layers","patternFeatures"]});var X_={get paint(){return Z_=Z_||new Ho({"line-opacity":new Be(St.paint_line["line-opacity"]),"line-color":new Be(St.paint_line["line-color"]),"line-translate":new Le(St.paint_line["line-translate"]),"line-translate-anchor":new Le(St.paint_line["line-translate-anchor"]),"line-width":new Be(St.paint_line["line-width"]),"line-gap-width":new Be(St.paint_line["line-gap-width"]),"line-offset":new Be(St.paint_line["line-offset"]),"line-blur":new Be(St.paint_line["line-blur"]),"line-dasharray":new Fp(St.paint_line["line-dasharray"]),"line-pattern":new Bc(St.paint_line["line-pattern"]),"line-gradient":new Bp(St.paint_line["line-gradient"])})},get layout(){return q_=q_||new Ho({"line-cap":new Le(St.layout_line["line-cap"]),"line-join":new Be(St.layout_line["line-join"]),"line-miter-limit":new Le(St.layout_line["line-miter-limit"]),"line-round-limit":new Le(St.layout_line["line-round-limit"]),"line-sort-key":new Be(St.layout_line["line-sort-key"])})}};class i1 extends Be{possiblyEvaluate(r,a){return a=new Mr(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,zoomHistory:a.zoomHistory,transition:a.transition}),super.possiblyEvaluate(r,a)}evaluate(r,a,p,g){return a=gt({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(r,a,p,g)}}let fd;function Y_(s,r){return r>0?r+2*s:s}const o1=bi([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),s1=bi([{name:"a_projected_pos",components:3,type:"Float32"}],4);bi([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const a1=bi([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]);bi([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const W_=bi([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),l1=bi([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function u1(s,r,a){return s.sections.forEach(p=>{p.text=function(g,y,v){const E=y.layout.get("text-transform").evaluate(v,{});return E==="uppercase"?g=g.toLocaleUpperCase():E==="lowercase"&&(g=g.toLocaleLowerCase()),Ds.applyArabicShaping&&(g=Ds.applyArabicShaping(g)),g}(p.text,r,a)}),s}bi([{name:"triangle",components:3,type:"Uint16"}]),bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),bi([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),bi([{type:"Float32",name:"offsetX"}]),bi([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const tf={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"};var Vi=24,H_=or,$_=function(s,r,a,p,g){var y,v,E=8*g-p-1,T=(1<<E)-1,L=T>>1,N=-7,F=a?g-1:0,U=a?-1:1,q=s[r+F];for(F+=U,y=q&(1<<-N)-1,q>>=-N,N+=E;N>0;y=256*y+s[r+F],F+=U,N-=8);for(v=y&(1<<-N)-1,y>>=-N,N+=p;N>0;v=256*v+s[r+F],F+=U,N-=8);if(y===0)y=1-L;else{if(y===T)return v?NaN:1/0*(q?-1:1);v+=Math.pow(2,p),y-=L}return(q?-1:1)*v*Math.pow(2,y-p)},K_=function(s,r,a,p,g,y){var v,E,T,L=8*y-g-1,N=(1<<L)-1,F=N>>1,U=g===23?Math.pow(2,-24)-Math.pow(2,-77):0,q=p?0:y-1,Y=p?1:-1,nt=r<0||r===0&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(E=isNaN(r)?1:0,v=N):(v=Math.floor(Math.log(r)/Math.LN2),r*(T=Math.pow(2,-v))<1&&(v--,T*=2),(r+=v+F>=1?U/T:U*Math.pow(2,1-F))*T>=2&&(v++,T/=2),v+F>=N?(E=0,v=N):v+F>=1?(E=(r*T-1)*Math.pow(2,g),v+=F):(E=r*Math.pow(2,F-1)*Math.pow(2,g),v=0));g>=8;s[a+q]=255&E,q+=Y,E/=256,g-=8);for(v=v<<g|E,L+=g;L>0;s[a+q]=255&v,q+=Y,v/=256,L-=8);s[a+q-Y]|=128*nt};function or(s){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(s)?s:new Uint8Array(s||0),this.pos=0,this.type=0,this.length=this.buf.length}or.Varint=0,or.Fixed64=1,or.Bytes=2,or.Fixed32=5;var Gg=4294967296,J_=1/Gg,Q_=typeof TextDecoder>"u"?null:new TextDecoder("utf8");function gu(s){return s.type===or.Bytes?s.readVarint()+s.pos:s.pos+1}function zh(s,r,a){return a?4294967296*r+(s>>>0):4294967296*(r>>>0)+(s>>>0)}function ty(s,r,a){var p=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(p);for(var g=a.pos-1;g>=s;g--)a.buf[g+p]=a.buf[g]}function c1(s,r){for(var a=0;a<s.length;a++)r.writeVarint(s[a])}function h1(s,r){for(var a=0;a<s.length;a++)r.writeSVarint(s[a])}function p1(s,r){for(var a=0;a<s.length;a++)r.writeFloat(s[a])}function f1(s,r){for(var a=0;a<s.length;a++)r.writeDouble(s[a])}function d1(s,r){for(var a=0;a<s.length;a++)r.writeBoolean(s[a])}function g1(s,r){for(var a=0;a<s.length;a++)r.writeFixed32(s[a])}function m1(s,r){for(var a=0;a<s.length;a++)r.writeSFixed32(s[a])}function _1(s,r){for(var a=0;a<s.length;a++)r.writeFixed64(s[a])}function y1(s,r){for(var a=0;a<s.length;a++)r.writeSFixed64(s[a])}function dd(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+16777216*s[r+3]}function Fh(s,r,a){s[a]=r,s[a+1]=r>>>8,s[a+2]=r>>>16,s[a+3]=r>>>24}function ey(s,r){return(s[r]|s[r+1]<<8|s[r+2]<<16)+(s[r+3]<<24)}or.prototype={destroy:function(){this.buf=null},readFields:function(s,r,a){for(a=a||this.length;this.pos<a;){var p=this.readVarint(),g=p>>3,y=this.pos;this.type=7&p,s(g,r,this),this.pos===y&&this.skip(p)}return r},readMessage:function(s,r){return this.readFields(s,r,this.readVarint()+this.pos)},readFixed32:function(){var s=dd(this.buf,this.pos);return this.pos+=4,s},readSFixed32:function(){var s=ey(this.buf,this.pos);return this.pos+=4,s},readFixed64:function(){var s=dd(this.buf,this.pos)+dd(this.buf,this.pos+4)*Gg;return this.pos+=8,s},readSFixed64:function(){var s=dd(this.buf,this.pos)+ey(this.buf,this.pos+4)*Gg;return this.pos+=8,s},readFloat:function(){var s=$_(this.buf,this.pos,!0,23,4);return this.pos+=4,s},readDouble:function(){var s=$_(this.buf,this.pos,!0,52,8);return this.pos+=8,s},readVarint:function(s){var r,a,p=this.buf;return r=127&(a=p[this.pos++]),a<128?r:(r|=(127&(a=p[this.pos++]))<<7,a<128?r:(r|=(127&(a=p[this.pos++]))<<14,a<128?r:(r|=(127&(a=p[this.pos++]))<<21,a<128?r:function(g,y,v){var E,T,L=v.buf;if(E=(112&(T=L[v.pos++]))>>4,T<128||(E|=(127&(T=L[v.pos++]))<<3,T<128)||(E|=(127&(T=L[v.pos++]))<<10,T<128)||(E|=(127&(T=L[v.pos++]))<<17,T<128)||(E|=(127&(T=L[v.pos++]))<<24,T<128)||(E|=(1&(T=L[v.pos++]))<<31,T<128))return zh(g,E,y);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=p[this.pos]))<<28,s,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var s=this.readVarint();return s%2==1?(s+1)/-2:s/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var s=this.readVarint()+this.pos,r=this.pos;return this.pos=s,s-r>=12&&Q_?function(a,p,g){return Q_.decode(a.subarray(p,g))}(this.buf,r,s):function(a,p,g){for(var y="",v=p;v<g;){var E,T,L,N=a[v],F=null,U=N>239?4:N>223?3:N>191?2:1;if(v+U>g)break;U===1?N<128&&(F=N):U===2?(192&(E=a[v+1]))==128&&(F=(31&N)<<6|63&E)<=127&&(F=null):U===3?(T=a[v+2],(192&(E=a[v+1]))==128&&(192&T)==128&&((F=(15&N)<<12|(63&E)<<6|63&T)<=2047||F>=55296&&F<=57343)&&(F=null)):U===4&&(T=a[v+2],L=a[v+3],(192&(E=a[v+1]))==128&&(192&T)==128&&(192&L)==128&&((F=(15&N)<<18|(63&E)<<12|(63&T)<<6|63&L)<=65535||F>=1114112)&&(F=null)),F===null?(F=65533,U=1):F>65535&&(F-=65536,y+=String.fromCharCode(F>>>10&1023|55296),F=56320|1023&F),y+=String.fromCharCode(F),v+=U}return y}(this.buf,r,s)},readBytes:function(){var s=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,s);return this.pos=s,r},readPackedVarint:function(s,r){if(this.type!==or.Bytes)return s.push(this.readVarint(r));var a=gu(this);for(s=s||[];this.pos<a;)s.push(this.readVarint(r));return s},readPackedSVarint:function(s){if(this.type!==or.Bytes)return s.push(this.readSVarint());var r=gu(this);for(s=s||[];this.pos<r;)s.push(this.readSVarint());return s},readPackedBoolean:function(s){if(this.type!==or.Bytes)return s.push(this.readBoolean());var r=gu(this);for(s=s||[];this.pos<r;)s.push(this.readBoolean());return s},readPackedFloat:function(s){if(this.type!==or.Bytes)return s.push(this.readFloat());var r=gu(this);for(s=s||[];this.pos<r;)s.push(this.readFloat());return s},readPackedDouble:function(s){if(this.type!==or.Bytes)return s.push(this.readDouble());var r=gu(this);for(s=s||[];this.pos<r;)s.push(this.readDouble());return s},readPackedFixed32:function(s){if(this.type!==or.Bytes)return s.push(this.readFixed32());var r=gu(this);for(s=s||[];this.pos<r;)s.push(this.readFixed32());return s},readPackedSFixed32:function(s){if(this.type!==or.Bytes)return s.push(this.readSFixed32());var r=gu(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed32());return s},readPackedFixed64:function(s){if(this.type!==or.Bytes)return s.push(this.readFixed64());var r=gu(this);for(s=s||[];this.pos<r;)s.push(this.readFixed64());return s},readPackedSFixed64:function(s){if(this.type!==or.Bytes)return s.push(this.readSFixed64());var r=gu(this);for(s=s||[];this.pos<r;)s.push(this.readSFixed64());return s},skip:function(s){var r=7&s;if(r===or.Varint)for(;this.buf[this.pos++]>127;);else if(r===or.Bytes)this.pos=this.readVarint()+this.pos;else if(r===or.Fixed32)this.pos+=4;else{if(r!==or.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(s,r){this.writeVarint(s<<3|r)},realloc:function(s){for(var r=this.length||16;r<this.pos+s;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(s){this.realloc(4),Fh(this.buf,s,this.pos),this.pos+=4},writeSFixed32:function(s){this.realloc(4),Fh(this.buf,s,this.pos),this.pos+=4},writeFixed64:function(s){this.realloc(8),Fh(this.buf,-1&s,this.pos),Fh(this.buf,Math.floor(s*J_),this.pos+4),this.pos+=8},writeSFixed64:function(s){this.realloc(8),Fh(this.buf,-1&s,this.pos),Fh(this.buf,Math.floor(s*J_),this.pos+4),this.pos+=8},writeVarint:function(s){(s=+s||0)>268435455||s<0?function(r,a){var p,g;if(r>=0?(p=r%4294967296|0,g=r/4294967296|0):(g=~(-r/4294967296),4294967295^(p=~(-r%4294967296))?p=p+1|0:(p=0,g=g+1|0)),r>=18446744073709552e3||r<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),function(y,v,E){E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,y>>>=7,E.buf[E.pos++]=127&y|128,E.buf[E.pos]=127&(y>>>=7)}(p,0,a),function(y,v){var E=(7&y)<<4;v.buf[v.pos++]|=E|((y>>>=3)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y|((y>>>=7)?128:0),y&&(v.buf[v.pos++]=127&y)))))}(g,a)}(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))},writeSVarint:function(s){this.writeVarint(s<0?2*-s-1:2*s)},writeBoolean:function(s){this.writeVarint(!!s)},writeString:function(s){s=String(s),this.realloc(4*s.length),this.pos++;var r=this.pos;this.pos=function(p,g,y){for(var v,E,T=0;T<g.length;T++){if((v=g.charCodeAt(T))>55295&&v<57344){if(!E){v>56319||T+1===g.length?(p[y++]=239,p[y++]=191,p[y++]=189):E=v;continue}if(v<56320){p[y++]=239,p[y++]=191,p[y++]=189,E=v;continue}v=E-55296<<10|v-56320|65536,E=null}else E&&(p[y++]=239,p[y++]=191,p[y++]=189,E=null);v<128?p[y++]=v:(v<2048?p[y++]=v>>6|192:(v<65536?p[y++]=v>>12|224:(p[y++]=v>>18|240,p[y++]=v>>12&63|128),p[y++]=v>>6&63|128),p[y++]=63&v|128)}return y}(this.buf,s,this.pos);var a=this.pos-r;a>=128&&ty(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(s){this.realloc(4),K_(this.buf,s,this.pos,!0,23,4),this.pos+=4},writeDouble:function(s){this.realloc(8),K_(this.buf,s,this.pos,!0,52,8),this.pos+=8},writeBytes:function(s){var r=s.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=s[a]},writeRawMessage:function(s,r){this.pos++;var a=this.pos;s(r,this);var p=this.pos-a;p>=128&&ty(a,p,this),this.pos=a-1,this.writeVarint(p),this.pos+=p},writeMessage:function(s,r,a){this.writeTag(s,or.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(s,r){r.length&&this.writeMessage(s,c1,r)},writePackedSVarint:function(s,r){r.length&&this.writeMessage(s,h1,r)},writePackedBoolean:function(s,r){r.length&&this.writeMessage(s,d1,r)},writePackedFloat:function(s,r){r.length&&this.writeMessage(s,p1,r)},writePackedDouble:function(s,r){r.length&&this.writeMessage(s,f1,r)},writePackedFixed32:function(s,r){r.length&&this.writeMessage(s,g1,r)},writePackedSFixed32:function(s,r){r.length&&this.writeMessage(s,m1,r)},writePackedFixed64:function(s,r){r.length&&this.writeMessage(s,_1,r)},writePackedSFixed64:function(s,r){r.length&&this.writeMessage(s,y1,r)},writeBytesField:function(s,r){this.writeTag(s,or.Bytes),this.writeBytes(r)},writeFixed32Field:function(s,r){this.writeTag(s,or.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(s,r){this.writeTag(s,or.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(s,r){this.writeTag(s,or.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(s,r){this.writeTag(s,or.Fixed64),this.writeSFixed64(r)},writeVarintField:function(s,r){this.writeTag(s,or.Varint),this.writeVarint(r)},writeSVarintField:function(s,r){this.writeTag(s,or.Varint),this.writeSVarint(r)},writeStringField:function(s,r){this.writeTag(s,or.Bytes),this.writeString(r)},writeFloatField:function(s,r){this.writeTag(s,or.Fixed32),this.writeFloat(r)},writeDoubleField:function(s,r){this.writeTag(s,or.Fixed64),this.writeDouble(r)},writeBooleanField:function(s,r){this.writeVarintField(s,!!r)}};var jg=I(H_);const qg=3;function v1(s,r,a){s===1&&a.readMessage(x1,r)}function x1(s,r,a){if(s===3){const{id:p,bitmap:g,width:y,height:v,left:E,top:T,advance:L}=a.readMessage(b1,{});r.push({id:p,bitmap:new Yp({width:y+2*qg,height:v+2*qg},g),metrics:{width:y,height:v,left:E,top:T,advance:L}})}}function b1(s,r,a){s===1?r.id=a.readVarint():s===2?r.bitmap=a.readBytes():s===3?r.width=a.readVarint():s===4?r.height=a.readVarint():s===5?r.left=a.readSVarint():s===6?r.top=a.readSVarint():s===7&&(r.advance=a.readVarint())}const ny=qg;function ry(s){let r=0,a=0;for(const v of s)r+=v.w*v.h,a=Math.max(a,v.w);s.sort((v,E)=>E.h-v.h);const p=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let g=0,y=0;for(const v of s)for(let E=p.length-1;E>=0;E--){const T=p[E];if(!(v.w>T.w||v.h>T.h)){if(v.x=T.x,v.y=T.y,y=Math.max(y,v.y+v.h),g=Math.max(g,v.x+v.w),v.w===T.w&&v.h===T.h){const L=p.pop();E<p.length&&(p[E]=L)}else v.h===T.h?(T.x+=v.w,T.w-=v.w):v.w===T.w?(T.y+=v.h,T.h-=v.h):(p.push({x:T.x+v.w,y:T.y,w:T.w-v.w,h:v.h}),T.y+=v.h,T.h-=v.h);break}}return{w:g,h:y,fill:r/(g*y)||0}}const ps=1;class Zg{constructor(r,{pixelRatio:a,version:p,stretchX:g,stretchY:y,content:v}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=g,this.stretchY=y,this.content=v,this.version=p}get tl(){return[this.paddedRect.x+ps,this.paddedRect.y+ps]}get br(){return[this.paddedRect.x+this.paddedRect.w-ps,this.paddedRect.y+this.paddedRect.h-ps]}get tlbr(){return this.tl.concat(this.br)}get displaySize(){return[(this.paddedRect.w-2*ps)/this.pixelRatio,(this.paddedRect.h-2*ps)/this.pixelRatio]}}class iy{constructor(r,a){const p={},g={};this.haveRenderCallbacks=[];const y=[];this.addImages(r,p,y),this.addImages(a,g,y);const{w:v,h:E}=ry(y),T=new Ws({width:v||1,height:E||1});for(const L in r){const N=r[L],F=p[L].paddedRect;Ws.copy(N.data,T,{x:0,y:0},{x:F.x+ps,y:F.y+ps},N.data)}for(const L in a){const N=a[L],F=g[L].paddedRect,U=F.x+ps,q=F.y+ps,Y=N.data.width,nt=N.data.height;Ws.copy(N.data,T,{x:0,y:0},{x:U,y:q},N.data),Ws.copy(N.data,T,{x:0,y:nt-1},{x:U,y:q-1},{width:Y,height:1}),Ws.copy(N.data,T,{x:0,y:0},{x:U,y:q+nt},{width:Y,height:1}),Ws.copy(N.data,T,{x:Y-1,y:0},{x:U-1,y:q},{width:1,height:nt}),Ws.copy(N.data,T,{x:0,y:0},{x:U+Y,y:q},{width:1,height:nt})}this.image=T,this.iconPositions=p,this.patternPositions=g}addImages(r,a,p){for(const g in r){const y=r[g],v={x:0,y:0,w:y.data.width+2*ps,h:y.data.height+2*ps};p.push(v),a[g]=new Zg(v,y),y.hasRenderCallback&&this.haveRenderCallbacks.push(g)}}patchUpdatedImages(r,a){r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const p in r.updatedImages)this.patchUpdatedImage(this.iconPositions[p],r.getImage(p),a),this.patchUpdatedImage(this.patternPositions[p],r.getImage(p),a)}patchUpdatedImage(r,a,p){if(!r||!a||r.version===a.version)return;r.version=a.version;const[g,y]=r.tl;p.update(a.data,void 0,{x:g,y})}}var $u;de("ImagePosition",Zg),de("ImageAtlas",iy),u.WritingMode=void 0,($u=u.WritingMode||(u.WritingMode={}))[$u.none=0]="none",$u[$u.horizontal=1]="horizontal",$u[$u.vertical=2]="vertical",$u[$u.horizontalOnly=3]="horizontalOnly";const ef=-17;class nf{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const p=new nf;return p.scale=r||1,p.fontStack=a,p}static forImage(r){const a=new nf;return a.imageName=r,a}}class Bh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const p=new Bh;for(let g=0;g<r.sections.length;g++){const y=r.sections[g];y.image?p.addImageSection(y):p.addTextSection(y,a)}return p}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(){this.text=function(r){let a="";for(let p=0;p<r.length;p++){const g=r.charCodeAt(p+1)||null,y=r.charCodeAt(p-1)||null;a+=g&&cu(g)&&!tf[r[p+1]]||y&&cu(y)&&!tf[r[p-1]]||!tf[r[p]]?r[p]:tf[r[p]]}return a}(this.text)}trim(){let r=0;for(let p=0;p<this.text.length&&md[this.text.charCodeAt(p)];p++)r++;let a=this.text.length;for(let p=this.text.length-1;p>=0&&p>=r&&md[this.text.charCodeAt(p)];p--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const p=new Bh;return p.text=this.text.substring(r,a),p.sectionIndex=this.sectionIndex.slice(r,a),p.sections=this.sections,p}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(nf.forText(r.scale,r.fontStack||a));const p=this.sections.length-1;for(let g=0;g<r.text.length;++g)this.sectionIndex.push(p)}addImageSection(r){const a=r.image?r.image.name:"";if(a.length===0)return void Qt("Can't add FormattedSection with an empty image.");const p=this.getNextImageSectionCharCode();p?(this.text+=String.fromCharCode(p),this.sections.push(nf.forImage(a)),this.sectionIndex.push(this.sections.length-1)):Qt("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function gd(s,r,a,p,g,y,v,E,T,L,N,F,U,q,Y,nt){const tt=Bh.fromFeature(s,g);let ft;F===u.WritingMode.vertical&&tt.verticalizePunctuation();const{processBidirectionalText:bt,processStyledBidirectionalText:ct}=Ds;if(bt&&tt.sections.length===1){ft=[];const Ft=bt(tt.toString(),Xg(tt,L,y,r,p,q,Y));for(const Ie of Ft){const Me=new Bh;Me.text=Ie,Me.sections=tt.sections;for(let _e=0;_e<Ie.length;_e++)Me.sectionIndex.push(0);ft.push(Me)}}else if(ct){ft=[];const Ft=ct(tt.text,tt.sectionIndex,Xg(tt,L,y,r,p,q,Y));for(const Ie of Ft){const Me=new Bh;Me.text=Ie[0],Me.sectionIndex=Ie[1],Me.sections=tt.sections,ft.push(Me)}}else ft=function(Ft,Ie){const Me=[],_e=Ft.text;let he=0;for(const oe of Ie)Me.push(Ft.substring(he,oe)),he=oe;return he<_e.length&&Me.push(Ft.substring(he,_e.length)),Me}(tt,Xg(tt,L,y,r,p,q,Y));const Ct=[],At={positionedLines:Ct,text:tt.toString(),top:N[1],bottom:N[1],left:N[0],right:N[0],writingMode:F,iconsInText:!1,verticalizable:!1};return function(Ft,Ie,Me,_e,he,oe,ye,pe,$t,ze,Ae,vn){let br=0,Ar=ef,Mi=0,$s=0;const ho=pe==="right"?1:pe==="left"?0:.5;let wi=0;for(const Ei of he){Ei.trim();const fo=Ei.getMaxScale(),ko=(fo-1)*Vi,Ko={positionedGlyphs:[],lineOffset:0};Ft.positionedLines[wi]=Ko;const ds=Ko.positionedGlyphs;let gs=0;if(!Ei.length()){Ar+=oe,++wi;continue}for(let go=0;go<Ei.length();go++){const xn=Ei.getSection(go),ks=Ei.getSectionIndex(go),mo=Ei.getCharCode(go);let No=0,Ca=null,ll=null,ul=null,mu=Vi;const Pa=!($t===u.WritingMode.horizontal||!Ae&&!uu(mo)||Ae&&(md[mo]||(Gi=mo,le.Arabic(Gi)||le["Arabic Supplement"](Gi)||le["Arabic Extended-A"](Gi)||le["Arabic Presentation Forms-A"](Gi)||le["Arabic Presentation Forms-B"](Gi))));if(xn.imageName){const Ks=_e[xn.imageName];if(!Ks)continue;ul=xn.imageName,Ft.iconsInText=Ft.iconsInText||!0,ll=Ks.paddedRect;const ms=Ks.displaySize;xn.scale=xn.scale*Vi/vn,Ca={width:ms[0],height:ms[1],left:ps,top:-ny,advance:Pa?ms[1]:ms[0]},No=ko+(Vi-ms[1]*xn.scale),mu=Ca.advance;const _u=Pa?ms[0]*xn.scale-Vi*fo:ms[1]*xn.scale-Vi*fo;_u>0&&_u>gs&&(gs=_u)}else{const Ks=Me[xn.fontStack],ms=Ks&&Ks[mo];if(ms&&ms.rect)ll=ms.rect,Ca=ms.metrics;else{const _u=Ie[xn.fontStack],lf=_u&&_u[mo];if(!lf)continue;Ca=lf.metrics}No=(fo-xn.scale)*Vi}Pa?(Ft.verticalizable=!0,ds.push({glyph:mo,imageName:ul,x:br,y:Ar+No,vertical:Pa,scale:xn.scale,fontStack:xn.fontStack,sectionIndex:ks,metrics:Ca,rect:ll}),br+=mu*xn.scale+ze):(ds.push({glyph:mo,imageName:ul,x:br,y:Ar+No,vertical:Pa,scale:xn.scale,fontStack:xn.fontStack,sectionIndex:ks,metrics:Ca,rect:ll}),br+=Ca.advance*xn.scale+ze)}ds.length!==0&&(Mi=Math.max(br-ze,Mi),I1(ds,0,ds.length-1,ho,gs)),br=0;const ni=oe*fo+gs;Ko.lineOffset=Math.max(gs,ko),Ar+=ni,$s=Math.max(ni,$s),++wi}var Gi;const po=Ar-ef,{horizontalAlign:Do,verticalAlign:fs}=Yg(ye);(function(Ei,fo,ko,Ko,ds,gs,ni,go,xn){const ks=(fo-ko)*ds;let mo=0;mo=gs!==ni?-go*Ko-ef:(-Ko*xn+.5)*ni;for(const No of Ei)for(const Ca of No.positionedGlyphs)Ca.x+=ks,Ca.y+=mo})(Ft.positionedLines,ho,Do,fs,Mi,$s,oe,po,he.length),Ft.top+=-fs*po,Ft.bottom=Ft.top+po,Ft.left+=-Do*Mi,Ft.right=Ft.left+Mi}(At,r,a,p,ft,v,E,T,F,L,U,nt),!function(Ft){for(const Ie of Ft)if(Ie.positionedGlyphs.length!==0)return!1;return!0}(Ct)&&At}const md={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},w1={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function oy(s,r,a,p,g,y){if(r.imageName){const v=p[r.imageName];return v?v.displaySize[0]*r.scale*Vi/y+g:0}{const v=a[r.fontStack],E=v&&v[s];return E?E.metrics.advance*r.scale+g:0}}function sy(s,r,a,p){const g=Math.pow(s-r,2);return p?s<r?g/2:2*g:g+Math.abs(a)*a}function E1(s,r,a){let p=0;return s===10&&(p-=1e4),a&&(p+=150),s!==40&&s!==65288||(p+=50),r!==41&&r!==65289||(p+=50),p}function ay(s,r,a,p,g,y){let v=null,E=sy(r,a,g,y);for(const T of p){const L=sy(r-T.x,a,g,y)+T.badness;L<=E&&(v=T,E=L)}return{index:s,x:r,priorBreak:v,badness:E}}function ly(s){return s?ly(s.priorBreak).concat(s.index):[]}function Xg(s,r,a,p,g,y,v){if(y!=="point")return[];if(!s)return[];const E=[],T=function(U,q,Y,nt,tt,ft){let bt=0;for(let ct=0;ct<U.length();ct++){const Ct=U.getSection(ct);bt+=oy(U.getCharCode(ct),Ct,nt,tt,q,ft)}return bt/Math.max(1,Math.ceil(bt/Y))}(s,r,a,p,g,v),L=s.text.indexOf("​")>=0;let N=0;for(let U=0;U<s.length();U++){const q=s.getSection(U),Y=s.getCharCode(U);if(md[Y]||(N+=oy(Y,q,p,g,r,v)),U<s.length()-1){const nt=!((F=Y)<11904||!(le["Bopomofo Extended"](F)||le.Bopomofo(F)||le["CJK Compatibility Forms"](F)||le["CJK Compatibility Ideographs"](F)||le["CJK Compatibility"](F)||le["CJK Radicals Supplement"](F)||le["CJK Strokes"](F)||le["CJK Symbols and Punctuation"](F)||le["CJK Unified Ideographs Extension A"](F)||le["CJK Unified Ideographs"](F)||le["Enclosed CJK Letters and Months"](F)||le["Halfwidth and Fullwidth Forms"](F)||le.Hiragana(F)||le["Ideographic Description Characters"](F)||le["Kangxi Radicals"](F)||le["Katakana Phonetic Extensions"](F)||le.Katakana(F)||le["Vertical Forms"](F)||le["Yi Radicals"](F)||le["Yi Syllables"](F)));(w1[Y]||nt||q.imageName)&&E.push(ay(U+1,N,T,E,E1(Y,s.getCharCode(U+1),nt&&L),!1))}}var F;return ly(ay(s.length(),N,T,E,0,!0))}function Yg(s){let r=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function I1(s,r,a,p,g){if(!p&&!g)return;const y=s[a],v=(s[a].x+y.metrics.advance*y.scale)*p;for(let E=r;E<=a;E++)s[E].x-=v,s[E].y+=g}function S1(s,r,a){const{horizontalAlign:p,verticalAlign:g}=Yg(a),y=r[0]-s.displaySize[0]*p,v=r[1]-s.displaySize[1]*g;return{image:s,top:v,bottom:v+s.displaySize[1],left:y,right:y+s.displaySize[0]}}function uy(s,r,a,p,g,y){const v=s.image;let E;if(v.content){const tt=v.content,ft=v.pixelRatio||1;E=[tt[0]/ft,tt[1]/ft,v.displaySize[0]-tt[2]/ft,v.displaySize[1]-tt[3]/ft]}const T=r.left*y,L=r.right*y;let N,F,U,q;a==="width"||a==="both"?(q=g[0]+T-p[3],F=g[0]+L+p[1]):(q=g[0]+(T+L-v.displaySize[0])/2,F=q+v.displaySize[0]);const Y=r.top*y,nt=r.bottom*y;return a==="height"||a==="both"?(N=g[1]+Y-p[0],U=g[1]+nt+p[2]):(N=g[1]+(Y+nt-v.displaySize[1])/2,U=N+v.displaySize[1]),{image:v,top:N,right:F,bottom:U,left:q,collisionPadding:E}}const rf=255,Ol=128,Ku=rf*Ol;function cy(s,r){const{expression:a}=r;if(a.kind==="constant")return{kind:"constant",layoutSize:a.evaluate(new Mr(s+1))};if(a.kind==="source")return{kind:"source"};{const{zoomStops:p,interpolationType:g}=a;let y=0;for(;y<p.length&&p[y]<=s;)y++;y=Math.max(0,y-1);let v=y;for(;v<p.length&&p[v]<s+1;)v++;v=Math.min(p.length-1,v);const E=p[y],T=p[v];return a.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:T,interpolationType:g}:{kind:"camera",minZoom:E,maxZoom:T,minSize:a.evaluate(new Mr(E)),maxSize:a.evaluate(new Mr(T)),interpolationType:g}}}function Wg(s,r,a){let p="never";const g=s.get(r);return g?p=g:s.get(a)&&(p="always"),p}const T1=Hu.VectorTileFeature.types,C1=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function _d(s,r,a,p,g,y,v,E,T,L,N,F,U){const q=E?Math.min(Ku,Math.round(E[0])):0,Y=E?Math.min(Ku,Math.round(E[1])):0;s.emplaceBack(r,a,Math.round(32*p),Math.round(32*g),y,v,(q<<1)+(T?1:0),Y,16*L,16*N,256*F,256*U)}function Hg(s,r,a){s.emplaceBack(r.x,r.y,a),s.emplaceBack(r.x,r.y,a),s.emplaceBack(r.x,r.y,a),s.emplaceBack(r.x,r.y,a)}function P1(s){for(const r of s.sections)if(hu(r.text))return!0;return!1}class $g{constructor(r){this.layoutVertexArray=new Tt,this.indexArray=new Yt,this.programConfigurations=r,this.segments=new ue,this.dynamicLayoutVertexArray=new Lt,this.opacityVertexArray=new jt,this.hasVisibleVertices=!1,this.placedSymbolArray=new S}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0}upload(r,a,p,g){this.isEmpty()||(p&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,o1.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,s1.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,C1,!0),this.opacityVertexBuffer.itemSize=1),(p||g)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}de("SymbolBuffers",$g);class Kg{constructor(r,a,p){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new p,this.segments=new ue,this.collisionVertexArray=new Jt}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,a1.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())}}de("CollisionBuffers",Kg);class Uh{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(v=>v.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Pg([]),this.placementViewportMatrix=Pg([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=cy(this.zoom,a["text-size"]),this.iconSizeData=cy(this.zoom,a["icon-size"]);const p=this.layers[0].layout,g=p.get("symbol-sort-key"),y=p.get("symbol-z-order");this.canOverlap=Wg(p,"text-overlap","text-allow-overlap")!=="never"||Wg(p,"icon-overlap","icon-allow-overlap")!=="never"||p.get("text-ignore-placement")||p.get("icon-ignore-placement"),this.sortFeaturesByKey=y!=="viewport-y"&&!g.isConstant(),this.sortFeaturesByY=(y==="viewport-y"||y==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,p.get("symbol-placement")==="point"&&(this.writingModes=p.get("text-writing-mode").map(v=>u.WritingMode[v])),this.stateDependentLayerIds=this.layers.filter(v=>v.isStateDependent()).map(v=>v.id),this.sourceID=r.sourceID}createArrays(){this.text=new $g(new sl(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new $g(new sl(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new A,this.lineVertexArray=new O,this.symbolInstances=new C}calculateGlyphDependencies(r,a,p,g,y){for(let v=0;v<r.length;v++)if(a[r.charCodeAt(v)]=!0,(p||g)&&y){const E=tf[r.charAt(v)];E&&(a[E.charCodeAt(0)]=!0)}}populate(r,a,p){const g=this.layers[0],y=g.layout,v=y.get("text-font"),E=y.get("text-field"),T=y.get("icon-image"),L=(E.value.kind!=="constant"||E.value.value instanceof yr&&!E.value.value.isEmpty()||E.value.value.toString().length>0)&&(v.value.kind!=="constant"||v.value.value.length>0),N=T.value.kind!=="constant"||!!T.value.value||Object.keys(T.parameters).length>0,F=y.get("symbol-sort-key");if(this.features=[],!L&&!N)return;const U=a.iconDependencies,q=a.glyphDependencies,Y=a.availableImages,nt=new Mr(this.zoom);for(const{feature:tt,id:ft,index:bt,sourceLayerIndex:ct}of r){const Ct=g._featureFilter.needGeometry,At=jc(tt,Ct);if(!g._featureFilter.filter(nt,At,p))continue;let Ft,Ie;if(Ct||(At.geometry=al(tt)),L){const _e=g.getValueAndResolveTokens("text-field",At,p,Y),he=yr.factory(_e);P1(he)&&(this.hasRTLText=!0),(!this.hasRTLText||Rp()==="unavailable"||this.hasRTLText&&Ds.isParsed())&&(Ft=u1(he,g,At))}if(N){const _e=g.getValueAndResolveTokens("icon-image",At,p,Y);Ie=_e instanceof Ji?_e:Ji.fromString(_e)}if(!Ft&&!Ie)continue;const Me=this.sortFeaturesByKey?F.evaluate(At,{},p):void 0;if(this.features.push({id:ft,text:Ft,icon:Ie,index:bt,sourceLayerIndex:ct,geometry:At.geometry,properties:tt.properties,type:T1[tt.type],sortKey:Me}),Ie&&(U[Ie.name]=!0),Ft){const _e=v.evaluate(At,{},p).join(","),he=y.get("text-rotation-alignment")!=="viewport"&&y.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(u.WritingMode.vertical)>=0;for(const oe of Ft.sections)if(oe.image)U[oe.image.name]=!0;else{const ye=nl(Ft.toString()),pe=oe.fontStack||_e,$t=q[pe]=q[pe]||{};this.calculateGlyphDependencies(oe.text,$t,he,this.allowVerticalPlacement,ye)}}}y.get("symbol-placement")==="line"&&(this.features=function(tt){const ft={},bt={},ct=[];let Ct=0;function At(_e){ct.push(tt[_e]),Ct++}function Ft(_e,he,oe){const ye=bt[_e];return delete bt[_e],bt[he]=ye,ct[ye].geometry[0].pop(),ct[ye].geometry[0]=ct[ye].geometry[0].concat(oe[0]),ye}function Ie(_e,he,oe){const ye=ft[he];return delete ft[he],ft[_e]=ye,ct[ye].geometry[0].shift(),ct[ye].geometry[0]=oe[0].concat(ct[ye].geometry[0]),ye}function Me(_e,he,oe){const ye=oe?he[0][he[0].length-1]:he[0][0];return`${_e}:${ye.x}:${ye.y}`}for(let _e=0;_e<tt.length;_e++){const he=tt[_e],oe=he.geometry,ye=he.text?he.text.toString():null;if(!ye){At(_e);continue}const pe=Me(ye,oe),$t=Me(ye,oe,!0);if(pe in bt&&$t in ft&&bt[pe]!==ft[$t]){const ze=Ie(pe,$t,oe),Ae=Ft(pe,$t,ct[ze].geometry);delete ft[pe],delete bt[$t],bt[Me(ye,ct[Ae].geometry,!0)]=Ae,ct[ze].geometry=null}else pe in bt?Ft(pe,$t,oe):$t in ft?Ie(pe,$t,oe):(At(_e),ft[pe]=Ct-1,bt[$t]=Ct-1)}return ct.filter(_e=>_e.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((tt,ft)=>tt.sortKey-ft.sortKey)}update(r,a,p){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,p),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,p))}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const p=this.lineVertexArray.length;if(r.segment!==void 0){let g=r.dist(a[r.segment+1]),y=r.dist(a[r.segment]);const v={};for(let E=r.segment+1;E<a.length;E++)v[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:g},E<a.length-1&&(g+=a[E+1].dist(a[E]));for(let E=r.segment||0;E>=0;E--)v[E]={x:a[E].x,y:a[E].y,tileUnitDistanceFromAnchor:y},E>0&&(y+=a[E-1].dist(a[E]));for(let E=0;E<a.length;E++){const T=v[E];this.lineVertexArray.emplaceBack(T.x,T.y,T.tileUnitDistanceFromAnchor)}}return{lineStartIndex:p,lineLength:this.lineVertexArray.length-p}}addSymbols(r,a,p,g,y,v,E,T,L,N,F,U){const q=r.indexArray,Y=r.layoutVertexArray,nt=r.segments.prepareSegment(4*a.length,Y,q,this.canOverlap?v.sortKey:void 0),tt=this.glyphOffsetArray.length,ft=nt.vertexLength,bt=this.allowVerticalPlacement&&E===u.WritingMode.vertical?Math.PI/2:0,ct=v.text&&v.text.sections;for(let Ct=0;Ct<a.length;Ct++){const{tl:At,tr:Ft,bl:Ie,br:Me,tex:_e,pixelOffsetTL:he,pixelOffsetBR:oe,minFontScaleX:ye,minFontScaleY:pe,glyphOffset:$t,isSDF:ze,sectionIndex:Ae}=a[Ct],vn=nt.vertexLength,br=$t[1];_d(Y,T.x,T.y,At.x,br+At.y,_e.x,_e.y,p,ze,he.x,he.y,ye,pe),_d(Y,T.x,T.y,Ft.x,br+Ft.y,_e.x+_e.w,_e.y,p,ze,oe.x,he.y,ye,pe),_d(Y,T.x,T.y,Ie.x,br+Ie.y,_e.x,_e.y+_e.h,p,ze,he.x,oe.y,ye,pe),_d(Y,T.x,T.y,Me.x,br+Me.y,_e.x+_e.w,_e.y+_e.h,p,ze,oe.x,oe.y,ye,pe),Hg(r.dynamicLayoutVertexArray,T,bt),q.emplaceBack(vn,vn+1,vn+2),q.emplaceBack(vn+1,vn+2,vn+3),nt.vertexLength+=4,nt.primitiveLength+=2,this.glyphOffsetArray.emplaceBack($t[0]),Ct!==a.length-1&&Ae===a[Ct+1].sectionIndex||r.programConfigurations.populatePaintArrays(Y.length,v,v.index,{},U,ct&&ct[Ae])}r.placedSymbolArray.emplaceBack(T.x,T.y,tt,this.glyphOffsetArray.length-tt,ft,L,N,T.segment,p?p[0]:0,p?p[1]:0,g[0],g[1],E,0,!1,0,F)}_addCollisionDebugVertex(r,a,p,g,y,v){return a.emplaceBack(0,0),r.emplaceBack(p.x,p.y,g,y,Math.round(v.x),Math.round(v.y))}addCollisionDebugVertices(r,a,p,g,y,v,E){const T=y.segments.prepareSegment(4,y.layoutVertexArray,y.indexArray),L=T.vertexLength,N=y.layoutVertexArray,F=y.collisionVertexArray,U=E.anchorX,q=E.anchorY;this._addCollisionDebugVertex(N,F,v,U,q,new k(r,a)),this._addCollisionDebugVertex(N,F,v,U,q,new k(p,a)),this._addCollisionDebugVertex(N,F,v,U,q,new k(p,g)),this._addCollisionDebugVertex(N,F,v,U,q,new k(r,g)),T.vertexLength+=4;const Y=y.indexArray;Y.emplaceBack(L,L+1),Y.emplaceBack(L+1,L+2),Y.emplaceBack(L+2,L+3),Y.emplaceBack(L+3,L),T.primitiveLength+=4}addDebugCollisionBoxes(r,a,p,g){for(let y=r;y<a;y++){const v=this.collisionBoxArray.get(y);this.addCollisionDebugVertices(v.x1,v.y1,v.x2,v.y2,g?this.textCollisionBox:this.iconCollisionBox,v.anchorPoint,p)}}generateCollisionDebugBuffers(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Kg(Ht,W_.members,xe),this.iconCollisionBox=new Kg(Ht,W_.members,xe);for(let r=0;r<this.symbolInstances.length;r++){const a=this.symbolInstances.get(r);this.addDebugCollisionBoxes(a.textBoxStartIndex,a.textBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,!0),this.addDebugCollisionBoxes(a.iconBoxStartIndex,a.iconBoxEndIndex,a,!1),this.addDebugCollisionBoxes(a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,!1)}}_deserializeCollisionBoxesForSymbol(r,a,p,g,y,v,E,T,L){const N={};for(let F=a;F<p;F++){const U=r.get(F);N.textBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},N.textFeatureIndex=U.featureIndex;break}for(let F=g;F<y;F++){const U=r.get(F);N.verticalTextBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},N.verticalTextFeatureIndex=U.featureIndex;break}for(let F=v;F<E;F++){const U=r.get(F);N.iconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},N.iconFeatureIndex=U.featureIndex;break}for(let F=T;F<L;F++){const U=r.get(F);N.verticalIconBox={x1:U.x1,y1:U.y1,x2:U.x2,y2:U.y2,anchorPointX:U.anchorPointX,anchorPointY:U.anchorPointY},N.verticalIconFeatureIndex=U.featureIndex;break}return N}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const p=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,p.textBoxStartIndex,p.textBoxEndIndex,p.verticalTextBoxStartIndex,p.verticalTextBoxEndIndex,p.iconBoxStartIndex,p.iconBoxEndIndex,p.verticalIconBoxStartIndex,p.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const p=r.placedSymbolArray.get(a),g=p.vertexStartIndex+4*p.numGlyphs;for(let y=p.vertexStartIndex;y<g;y+=4)r.indexArray.emplaceBack(y,y+1,y+2),r.indexArray.emplaceBack(y+1,y+2,y+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(r),p=Math.cos(r),g=[],y=[],v=[];for(let E=0;E<this.symbolInstances.length;++E){v.push(E);const T=this.symbolInstances.get(E);g.push(0|Math.round(a*T.anchorX+p*T.anchorY)),y.push(T.featureIndex)}return v.sort((E,T)=>g[E]-g[T]||y[T]-y[E]),v}addToSortKeyRanges(r,a){const p=this.sortKeyRanges[this.sortKeyRanges.length-1];p&&p.sortKey===a?p.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const p=this.symbolInstances.get(a);this.featureSortOrder.push(p.featureIndex),[p.rightJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.leftJustifiedTextSymbolIndex].forEach((g,y,v)=>{g>=0&&v.indexOf(g)===y&&this.addIndicesForPlacedSymbol(this.text,g)}),p.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,p.verticalPlacedTextSymbolIndex),p.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.placedIconSymbolIndex),p.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,p.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let hy,py;de("SymbolBucket",Uh,{omit:["layers","collisionBoxArray","features","compareText"]}),Uh.MAX_GLYPHS=65535,Uh.addDynamicAttributes=Hg;var Jg={get paint(){return py=py||new Ho({"icon-opacity":new Be(St.paint_symbol["icon-opacity"]),"icon-color":new Be(St.paint_symbol["icon-color"]),"icon-halo-color":new Be(St.paint_symbol["icon-halo-color"]),"icon-halo-width":new Be(St.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Be(St.paint_symbol["icon-halo-blur"]),"icon-translate":new Le(St.paint_symbol["icon-translate"]),"icon-translate-anchor":new Le(St.paint_symbol["icon-translate-anchor"]),"text-opacity":new Be(St.paint_symbol["text-opacity"]),"text-color":new Be(St.paint_symbol["text-color"],{runtimeType:yi,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Be(St.paint_symbol["text-halo-color"]),"text-halo-width":new Be(St.paint_symbol["text-halo-width"]),"text-halo-blur":new Be(St.paint_symbol["text-halo-blur"]),"text-translate":new Le(St.paint_symbol["text-translate"]),"text-translate-anchor":new Le(St.paint_symbol["text-translate-anchor"])})},get layout(){return hy=hy||new Ho({"symbol-placement":new Le(St.layout_symbol["symbol-placement"]),"symbol-spacing":new Le(St.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Le(St.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Be(St.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Le(St.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Le(St.layout_symbol["icon-allow-overlap"]),"icon-overlap":new Le(St.layout_symbol["icon-overlap"]),"icon-ignore-placement":new Le(St.layout_symbol["icon-ignore-placement"]),"icon-optional":new Le(St.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Le(St.layout_symbol["icon-rotation-alignment"]),"icon-size":new Be(St.layout_symbol["icon-size"]),"icon-text-fit":new Le(St.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Le(St.layout_symbol["icon-text-fit-padding"]),"icon-image":new Be(St.layout_symbol["icon-image"]),"icon-rotate":new Be(St.layout_symbol["icon-rotate"]),"icon-padding":new Be(St.layout_symbol["icon-padding"]),"icon-keep-upright":new Le(St.layout_symbol["icon-keep-upright"]),"icon-offset":new Be(St.layout_symbol["icon-offset"]),"icon-anchor":new Be(St.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Le(St.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Le(St.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Le(St.layout_symbol["text-rotation-alignment"]),"text-field":new Be(St.layout_symbol["text-field"]),"text-font":new Be(St.layout_symbol["text-font"]),"text-size":new Be(St.layout_symbol["text-size"]),"text-max-width":new Be(St.layout_symbol["text-max-width"]),"text-line-height":new Le(St.layout_symbol["text-line-height"]),"text-letter-spacing":new Be(St.layout_symbol["text-letter-spacing"]),"text-justify":new Be(St.layout_symbol["text-justify"]),"text-radial-offset":new Be(St.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Le(St.layout_symbol["text-variable-anchor"]),"text-anchor":new Be(St.layout_symbol["text-anchor"]),"text-max-angle":new Le(St.layout_symbol["text-max-angle"]),"text-writing-mode":new Le(St.layout_symbol["text-writing-mode"]),"text-rotate":new Be(St.layout_symbol["text-rotate"]),"text-padding":new Le(St.layout_symbol["text-padding"]),"text-keep-upright":new Le(St.layout_symbol["text-keep-upright"]),"text-transform":new Be(St.layout_symbol["text-transform"]),"text-offset":new Be(St.layout_symbol["text-offset"]),"text-allow-overlap":new Le(St.layout_symbol["text-allow-overlap"]),"text-overlap":new Le(St.layout_symbol["text-overlap"]),"text-ignore-placement":new Le(St.layout_symbol["text-ignore-placement"]),"text-optional":new Le(St.layout_symbol["text-optional"])})}};class fy{constructor(r){if(r.property.overrides===void 0)throw new Error("overrides must be provided to instantiate FormatSectionOverride class");this.type=r.property.overrides?r.property.overrides.runtimeType:Ki,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}de("FormatSectionOverride",fy,{omit:["defaultValue"]});class yd extends Ia{constructor(r){super(r,Jg)}recalculate(r,a){if(super.recalculate(r,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")==="map"?"map":"viewport"),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){const p=this.layout.get("text-writing-mode");if(p){const g=[];for(const y of p)g.indexOf(y)<0&&g.push(y);this.layout._values["text-writing-mode"]=g}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()}getValueAndResolveTokens(r,a,p,g){const y=this.layout.get(r).evaluate(a,{},p,g),v=this._unevaluatedLayout._values[r];return v.isDataDriven()||qo(v.value)||!y?y:function(E,T){return T.replace(/{([^{}]+)}/g,(L,N)=>N in E?String(E[N]):"")}(a.properties,y)}createBucket(r){return new Uh(r)}queryRadius(){return 0}queryIntersectsFeature(){throw new Error("Should take a different path in FeatureIndex")}_setPaintOverrides(){for(const r of Jg.paint.overridableProperties){if(!yd.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),p=new fy(a),g=new qs(p,a.property.specification);let y=null;y=a.value.kind==="constant"||a.value.kind==="source"?new Ml("source",g):new en("composite",g,a.value.zoomStops),this.paint._values[r]=new Ea(a.property,y,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,p){return!(!this.layout||a.isDataDriven()||p.isDataDriven())&&yd.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const p=r.get("text-field"),g=Jg.paint.properties[a];let y=!1;const v=E=>{for(const T of E)if(g.overrides&&g.overrides.hasOverride(T))return void(y=!0)};if(p.value.kind==="constant"&&p.value.value instanceof yr)v(p.value.value.sections);else if(p.value.kind==="source"){const E=L=>{y||(L instanceof fa&&jr(L.value)===Gr?v(L.value.sections):L instanceof iu?v(L.sections):L.eachChild(E))},T=p.value;T._styleExpression&&E(T._styleExpression.expression)}return y}}let dy;var M1={get paint(){return dy=dy||new Ho({"background-color":new Le(St.paint_background["background-color"]),"background-pattern":new Fp(St.paint_background["background-pattern"]),"background-opacity":new Le(St.paint_background["background-opacity"])})}};let gy;var A1={get paint(){return gy=gy||new Ho({"raster-opacity":new Le(St.paint_raster["raster-opacity"]),"raster-hue-rotate":new Le(St.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Le(St.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Le(St.paint_raster["raster-brightness-max"]),"raster-saturation":new Le(St.paint_raster["raster-saturation"]),"raster-contrast":new Le(St.paint_raster["raster-contrast"]),"raster-resampling":new Le(St.paint_raster["raster-resampling"]),"raster-fade-duration":new Le(St.paint_raster["raster-fade-duration"])})}};class L1 extends Ia{constructor(r){super(r,{}),this.onAdd=a=>{this.implementation.onAdd&&this.implementation.onAdd(a,a.painter.context.gl)},this.onRemove=a=>{this.implementation.onRemove&&this.implementation.onRemove(a,a.painter.context.gl)},this.implementation=r}is3D(){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){throw new Error("Custom layers cannot be serialized")}}const D1={circle:class extends Ia{constructor(s){super(s,vx)}createBucket(s){return new Sg(s)}queryRadius(s){const r=s;return Zp("circle-radius",this,r)+Zp("circle-stroke-width",this,r)+sd(this.paint.get("circle-translate"))}queryIntersectsFeature(s,r,a,p,g,y,v,E){const T=ad(s,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),y.angle,v),L=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a),N=this.paint.get("circle-pitch-alignment")==="map",F=N?T:function(q,Y){return q.map(nt=>I_(nt,Y))}(T,E),U=N?L*v:L;for(const q of p)for(const Y of q){const nt=N?Y:I_(Y,E);let tt=U;const ft=ld([],[Y.x,Y.y,0,1],E);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?tt*=ft[3]/y.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(tt*=y.cameraToCenterDistance/ft[3]),gx(F,nt,tt))return!0}return!1}},heatmap:class extends Ia{createBucket(s){return new S_(s)}constructor(s){super(s,bx),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=P_({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(){return 0}queryIntersectsFeature(){return!1}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}},hillshade:class extends Ia{constructor(s){super(s,wx)}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}},fill:class extends Ia{constructor(s){super(s,zx)}recalculate(s,r){super.recalculate(s,r);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new Fg(s)}queryRadius(){return sd(this.paint.get("fill-translate"))}queryIntersectsFeature(s,r,a,p,g,y,v){return y_(ad(s,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),y.angle,v),p)}isTileClipped(){return!0}},"fill-extrusion":class extends Ia{constructor(s){super(s,Kx)}createBucket(s){return new Ug(s)}queryRadius(){return sd(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}queryIntersectsFeature(s,r,a,p,g,y,v,E){const T=ad(s,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),y.angle,v),L=this.paint.get("fill-extrusion-height").evaluate(r,a),N=this.paint.get("fill-extrusion-base").evaluate(r,a),F=function(q,Y,nt,tt){const ft=[];for(const bt of q){const ct=[bt.x,bt.y,0,1];ld(ct,ct,Y),ft.push(new k(ct[0]/ct[3],ct[1]/ct[3]))}return ft}(T,E),U=function(q,Y,nt,tt){const ft=[],bt=[],ct=tt[8]*Y,Ct=tt[9]*Y,At=tt[10]*Y,Ft=tt[11]*Y,Ie=tt[8]*nt,Me=tt[9]*nt,_e=tt[10]*nt,he=tt[11]*nt;for(const oe of q){const ye=[],pe=[];for(const $t of oe){const ze=$t.x,Ae=$t.y,vn=tt[0]*ze+tt[4]*Ae+tt[12],br=tt[1]*ze+tt[5]*Ae+tt[13],Ar=tt[2]*ze+tt[6]*Ae+tt[14],Mi=tt[3]*ze+tt[7]*Ae+tt[15],$s=Ar+At,ho=Mi+Ft,wi=vn+Ie,Gi=br+Me,po=Ar+_e,Do=Mi+he,fs=new k((vn+ct)/ho,(br+Ct)/ho);fs.z=$s/ho,ye.push(fs);const Ei=new k(wi/Do,Gi/Do);Ei.z=po/Do,pe.push(Ei)}ft.push(ye),bt.push(pe)}return[ft,bt]}(p,N,L,E);return function(q,Y,nt){let tt=1/0;y_(nt,Y)&&(tt=G_(nt,Y[0]));for(let ft=0;ft<Y.length;ft++){const bt=Y[ft],ct=q[ft];for(let Ct=0;Ct<bt.length-1;Ct++){const At=bt[Ct],Ft=[At,bt[Ct+1],ct[Ct+1],ct[Ct],At];__(nt,Ft)&&(tt=Math.min(tt,G_(nt,Ft)))}}return tt!==1/0&&tt}(U[0],U[1],F)}},line:class extends Ia{constructor(s){super(s,X_),this.gradientVersion=0,fd||(fd=new i1(X_.paint.properties["line-width"].specification),fd.useIntegerZoom=!0)}_handleSpecialPaintPropertyUpdate(s){s==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ha,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER)}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(s,r){super.recalculate(s,r),this.paint._values["line-floorwidth"]=fd.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new Vg(s)}queryRadius(s){const r=s,a=Y_(Zp("line-width",this,r),Zp("line-gap-width",this,r)),p=Zp("line-offset",this,r);return a/2+Math.abs(p)+sd(this.paint.get("line-translate"))}queryIntersectsFeature(s,r,a,p,g,y,v){const E=ad(s,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),y.angle,v),T=v/2*Y_(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),L=this.paint.get("line-offset").evaluate(r,a);return L&&(p=function(N,F){const U=[];for(let q=0;q<N.length;q++){const Y=N[q],nt=[];for(let tt=0;tt<Y.length;tt++){const ft=Y[tt-1],bt=Y[tt],ct=Y[tt+1],Ct=tt===0?new k(0,0):bt.sub(ft)._unit()._perp(),At=tt===Y.length-1?new k(0,0):ct.sub(bt)._unit()._perp(),Ft=Ct._add(At)._unit(),Ie=Ft.x*At.x+Ft.y*At.y;Ie!==0&&Ft._mult(1/Ie),nt.push(Ft._mult(F)._add(bt))}U.push(nt)}return U}(p,L*v)),function(N,F,U){for(let q=0;q<F.length;q++){const Y=F[q];if(N.length>=3){for(let nt=0;nt<Y.length;nt++)if(kh(N,Y[nt]))return!0}if(mx(N,Y,U))return!0}return!1}(E,p,T)}isTileClipped(){return!0}},symbol:yd,background:class extends Ia{constructor(s){super(s,M1)}},raster:class extends Ia{constructor(s){super(s,A1)}}};class k1{constructor(r){this._callback=r,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){delete this._channel,this._callback=()=>{}}}const Qg=63710088e-1;class Ju{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Ju(xt(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,p=this.lat*a,g=r.lat*a,y=Math.sin(p)*Math.sin(g)+Math.cos(p)*Math.cos(g)*Math.cos((r.lng-this.lng)*a);return Qg*Math.acos(Math.min(y,1))}static convert(r){if(r instanceof Ju)return r;if(Array.isArray(r)&&(r.length===2||r.length===3))return new Ju(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&typeof r=="object"&&r!==null)return new Ju(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const my=2*Math.PI*Qg;function _y(s){return my*Math.cos(s*Math.PI/180)}function yy(s){return(180+s)/360}function vy(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function xy(s,r){return s/_y(r)}function tm(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}class vd{constructor(r,a,p=0){this.x=+r,this.y=+a,this.z=+p}static fromLngLat(r,a=0){const p=Ju.convert(r);return new vd(yy(p.lng),vy(p.lat),xy(a,p.lat))}toLngLat(){return new Ju(360*this.x-180,tm(this.y))}toAltitude(){return this.z*_y(tm(this.y))}meterInMercatorCoordinateUnits(){return 1/my*(r=tm(this.y),1/Math.cos(r*Math.PI/180));var r}}function by(s,r,a){var p=2*Math.PI*6378137/256/Math.pow(2,a);return[s*p-2*Math.PI*6378137/2,r*p-2*Math.PI*6378137/2]}class em{constructor(r,a,p){if(r<0||r>25||p<0||p>=Math.pow(2,r)||a<0||a>=Math.pow(2,r))throw new Error(`x=${a}, y=${p}, z=${r} outside of bounds. 0<=x<${Math.pow(2,r)}, 0<=y<${Math.pow(2,r)} 0<=z<=25 `);this.z=r,this.x=a,this.y=p,this.key=of(0,r,r,a,p)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a,p){const g=(v=this.y,E=this.z,T=by(256*(y=this.x),256*(v=Math.pow(2,E)-v-1),E),L=by(256*(y+1),256*(v+1),E),T[0]+","+T[1]+","+L[0]+","+L[1]);var y,v,E,T,L;const N=function(F,U,q){let Y,nt="";for(let tt=F;tt>0;tt--)Y=1<<tt-1,nt+=(U&Y?1:0)+(q&Y?2:0);return nt}(this.z,this.x,this.y);return r[(this.x+this.y)%r.length].replace(/{prefix}/g,(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(p==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace(/{ratio}/g,a>1?"@2x":"").replace(/{quadkey}/g,N).replace(/{bbox-epsg-3857}/g,g)}isChildOf(r){const a=this.z-r.z;return a>0&&r.x===this.x>>a&&r.y===this.y>>a}getTilePoint(r){const a=Math.pow(2,this.z);return new k((r.x*a-this.x)*xr,(r.y*a-this.y)*xr)}toString(){return`${this.z}/${this.x}/${this.y}`}}class wy{constructor(r,a){this.wrap=r,this.canonical=a,this.key=of(r,a.z,a.z,a.x,a.y)}}class Hs{constructor(r,a,p,g,y){if(r<p)throw new Error(`overscaledZ should be >= z; overscaledZ = ${r}; z = ${p}`);this.overscaledZ=r,this.wrap=a,this.canonical=new em(p,+g,+y),this.key=of(a,r,p,g,y)}clone(){return new Hs(this.overscaledZ,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const a=this.canonical.z-r;return r>this.canonical.z?new Hs(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Hs(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a){if(r>this.overscaledZ)throw new Error(`targetZ > this.overscaledZ; targetZ = ${r}; overscaledZ = ${this.overscaledZ}`);const p=this.canonical.z-r;return r>this.canonical.z?of(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y):of(this.wrap*+a,r,r,this.canonical.x>>p,this.canonical.y>>p)}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return r.overscaledZ===0||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Hs(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,p=2*this.canonical.x,g=2*this.canonical.y;return[new Hs(a,this.wrap,a,p,g),new Hs(a,this.wrap,a,p+1,g),new Hs(a,this.wrap,a,p,g+1),new Hs(a,this.wrap,a,p+1,g+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Hs(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Hs(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new wy(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}getTilePoint(r){return this.canonical.getTilePoint(new vd(r.x-this.wrap,r.y))}}function of(s,r,a,p,g){(s*=2)<0&&(s=-1*s-1);const y=1<<a;return(y*y*s+y*g+p).toString(36)+a.toString(36)+r.toString(36)}de("CanonicalTileID",em),de("OverscaledTileID",Hs,{omit:["posMatrix"]});class Ey{constructor(r,a,p){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(p&&p!=="mapbox"&&p!=="terrarium")return void Qt(`"${p}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const g=this.dim=a.height-2;this.data=new Uint32Array(a.data.buffer),this.encoding=p||"mapbox";for(let y=0;y<g;y++)this.data[this._idx(-1,y)]=this.data[this._idx(0,y)],this.data[this._idx(g,y)]=this.data[this._idx(g-1,y)],this.data[this._idx(y,-1)]=this.data[this._idx(y,0)],this.data[this._idx(y,g)]=this.data[this._idx(y,g-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(g,-1)]=this.data[this._idx(g-1,0)],this.data[this._idx(-1,g)]=this.data[this._idx(0,g-1)],this.data[this._idx(g,g)]=this.data[this._idx(g-1,g-1)],this.min=Number.MAX_SAFE_INTEGER,this.max=Number.MIN_SAFE_INTEGER;for(let y=0;y<g;y++)for(let v=0;v<g;v++){const E=this.get(y,v);E>this.max&&(this.max=E),E<this.min&&(this.min=E)}}get(r,a){const p=new Uint8Array(this.data.buffer),g=4*this._idx(r,a);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(p[g],p[g+1],p[g+2])}getUnpackVector(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}_unpackMapbox(r,a,p){return(256*r*256+256*a+p)/10-1e4}_unpackTerrarium(r,a,p){return 256*r+a+p/256-32768}getPixels(){return new Ws({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))}backfillBorder(r,a,p){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let g=a*this.dim,y=a*this.dim+this.dim,v=p*this.dim,E=p*this.dim+this.dim;switch(a){case-1:g=y-1;break;case 1:y=g+1}switch(p){case-1:v=E-1;break;case 1:E=v+1}const T=-a*this.dim,L=-p*this.dim;for(let N=v;N<E;N++)for(let F=g;F<y;F++)this.data[this._idx(F,N)]=r.data[this._idx(F+T,N+L)]}}de("DEMData",Ey);class Iy{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const p=r[a];this._stringToNumber[p]=a,this._numberToString[a]=p}}encode(r){return this._stringToNumber[r]}decode(r){if(r>=this._numberToString.length)throw new Error(`Out of bounds. Index requested n=${r} can't be >= this._numberToString.length ${this._numberToString.length}`);return this._numberToString[r]}}class Sy{constructor(r,a,p,g,y){this.type="Feature",this._vectorTileFeature=r,r._z=a,r._x=p,r._y=g,this.properties=r.properties,this.id=y}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={geometry:this.geometry};for(const a in this)a!=="_geometry"&&a!=="_vectorTileFeature"&&(r[a]=this[a]);return r}}class Ty{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new kn(xr,16,0),this.grid3D=new kn(xr,16,0),this.featureIndexArray=new X,this.promoteId=a}insert(r,a,p,g,y,v){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(p,g,y);const T=v?this.grid3D:this.grid;for(let L=0;L<a.length;L++){const N=a[L],F=[1/0,1/0,-1/0,-1/0];for(let U=0;U<N.length;U++){const q=N[U];F[0]=Math.min(F[0],q.x),F[1]=Math.min(F[1],q.y),F[2]=Math.max(F[2],q.x),F[3]=Math.max(F[3],q.y)}F[0]<xr&&F[1]<xr&&F[2]>=0&&F[3]>=0&&T.insert(E,F[0],F[1],F[2],F[3])}}loadVTLayers(){return this.vtLayers||(this.vtLayers=new Hu.VectorTile(new jg(this.rawTileData)).layers,this.sourceLayerCoder=new Iy(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers}query(r,a,p,g){this.loadVTLayers();const y=r.params||{},v=xr/r.tileSize/r.scale,E=Lc(y.filter),T=r.queryGeometry,L=r.queryPadding*v,N=Py(T),F=this.grid.query(N.minX-L,N.minY-L,N.maxX+L,N.maxY+L),U=Py(r.cameraQueryGeometry),q=this.grid3D.query(U.minX-L,U.minY-L,U.maxX+L,U.maxY+L,(tt,ft,bt,ct)=>function(Ct,At,Ft,Ie,Me){for(const he of Ct)if(At<=he.x&&Ft<=he.y&&Ie>=he.x&&Me>=he.y)return!0;const _e=[new k(At,Ft),new k(At,Me),new k(Ie,Me),new k(Ie,Ft)];if(Ct.length>2){for(const he of _e)if(kh(Ct,he))return!0}for(let he=0;he<Ct.length-1;he++)if(yx(Ct[he],Ct[he+1],_e))return!0;return!1}(r.cameraQueryGeometry,tt-L,ft-L,bt+L,ct+L));for(const tt of q)F.push(tt);F.sort(N1);const Y={};let nt;for(let tt=0;tt<F.length;tt++){const ft=F[tt];if(ft===nt)continue;nt=ft;const bt=this.featureIndexArray.get(ft);let ct=null;this.loadMatchingFeature(Y,bt.bucketIndex,bt.sourceLayerIndex,bt.featureIndex,E,y.layers,y.availableImages,a,p,g,(Ct,At,Ft)=>(ct||(ct=al(Ct)),At.queryIntersectsFeature(T,Ct,Ft,ct,this.z,r.transform,v,r.pixelPosMatrix)))}return Y}loadMatchingFeature(r,a,p,g,y,v,E,T,L,N,F){const U=this.bucketLayerIDs[a];if(v&&!function(tt,ft){for(let bt=0;bt<tt.length;bt++)if(ft.indexOf(tt[bt])>=0)return!0;return!1}(v,U))return;const q=this.sourceLayerCoder.decode(p),Y=this.vtLayers[q].feature(g);if(y.needGeometry){const tt=jc(Y,!0);if(!y.filter(new Mr(this.tileID.overscaledZ),tt,this.tileID.canonical))return}else if(!y.filter(new Mr(this.tileID.overscaledZ),Y))return;const nt=this.getId(Y,q);for(let tt=0;tt<U.length;tt++){const ft=U[tt];if(v&&v.indexOf(ft)<0)continue;const bt=T[ft];if(!bt)continue;let ct={};nt&&N&&(ct=N.getState(bt.sourceLayer||"_geojsonTileLayer",nt));const Ct=gt({},L[ft]);Ct.paint=Cy(Ct.paint,bt.paint,Y,ct,E),Ct.layout=Cy(Ct.layout,bt.layout,Y,ct,E);const At=!F||F(Y,bt,ct);if(!At)continue;const Ft=new Sy(Y,this.z,this.x,this.y,nt);Ft.layer=Ct;let Ie=r[ft];Ie===void 0&&(Ie=r[ft]=[]),Ie.push({featureIndex:g,feature:Ft,intersectionZ:At})}}lookupSymbolFeatures(r,a,p,g,y,v,E,T){const L={};this.loadVTLayers();const N=Lc(y);for(const F of r)this.loadMatchingFeature(L,p,g,F,N,v,E,T,a);return L}hasLayer(r){for(const a of this.bucketLayerIDs)for(const p of a)if(r===p)return!0;return!1}getId(r,a){let p=r.id;return this.promoteId&&(p=r.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[a]],typeof p=="boolean"&&(p=Number(p))),p}}function Cy(s,r,a,p,g){return Gt(s,(y,v)=>{const E=r instanceof Eh?r.get(v):null;return E&&E.evaluate?E.evaluate(a,p,g):E})}function Py(s){let r=1/0,a=1/0,p=-1/0,g=-1/0;for(const y of s)r=Math.min(r,y.x),a=Math.min(a,y.y),p=Math.max(p,y.x),g=Math.max(g,y.y);return{minX:r,minY:a,maxX:p,maxY:g}}function N1(s,r){return r-s}function My(s,r,a,p,g){const y=[];for(let v=0;v<s.length;v++){const E=s[v];let T;for(let L=0;L<E.length-1;L++){let N=E[L],F=E[L+1];N.x<r&&F.x<r||(N.x<r?N=new k(r,N.y+(r-N.x)/(F.x-N.x)*(F.y-N.y))._round():F.x<r&&(F=new k(r,N.y+(r-N.x)/(F.x-N.x)*(F.y-N.y))._round()),N.y<a&&F.y<a||(N.y<a?N=new k(N.x+(a-N.y)/(F.y-N.y)*(F.x-N.x),a)._round():F.y<a&&(F=new k(N.x+(a-N.y)/(F.y-N.y)*(F.x-N.x),a)._round()),N.x>=p&&F.x>=p||(N.x>=p?N=new k(p,N.y+(p-N.x)/(F.x-N.x)*(F.y-N.y))._round():F.x>=p&&(F=new k(p,N.y+(p-N.x)/(F.x-N.x)*(F.y-N.y))._round()),N.y>=g&&F.y>=g||(N.y>=g?N=new k(N.x+(g-N.y)/(F.y-N.y)*(F.x-N.x),g)._round():F.y>=g&&(F=new k(N.x+(g-N.y)/(F.y-N.y)*(F.x-N.x),g)._round()),T&&N.equals(T[T.length-1])||(T=[N],y.push(T)),T.push(F)))))}}return y}de("FeatureIndex",Ty,{omit:["rawTileData","sourceLayerCoder"]});class Qu extends k{constructor(r,a,p,g){super(r,a),this.angle=p,g!==void 0&&(this.segment=g)}clone(){return new Qu(this.x,this.y,this.angle,this.segment)}}function Ay(s,r,a,p,g){if(r.segment===void 0)return!0;let y=r,v=r.segment+1,E=0;for(;E>-a/2;){if(v--,v<0)return!1;E-=s[v].dist(y),y=s[v]}E+=s[v].dist(s[v+1]),v++;const T=[];let L=0;for(;E<a/2;){const N=s[v],F=s[v+1];if(!F)return!1;let U=s[v-1].angleTo(N)-N.angleTo(F);for(U=Math.abs((U+3*Math.PI)%(2*Math.PI)-Math.PI),T.push({distance:E,angleDelta:U}),L+=U;E-T[0].distance>p;)L-=T.shift().angleDelta;if(L>g)return!1;v++,E+=N.dist(F)}return!0}function Ly(s){let r=0;for(let a=0;a<s.length-1;a++)r+=s[a].dist(s[a+1]);return r}function Dy(s,r,a){return s?.6*r*a:0}function ky(s,r){return Math.max(s?s.right-s.left:0,r?r.right-r.left:0)}function R1(s,r,a,p,g,y){const v=Dy(a,g,y),E=ky(a,p)*y;let T=0;const L=Ly(s)/2;for(let N=0;N<s.length-1;N++){const F=s[N],U=s[N+1],q=F.dist(U);if(T+q>L){const Y=(L-T)/q,nt=ao.number(F.x,U.x,Y),tt=ao.number(F.y,U.y,Y),ft=new Qu(nt,tt,U.angleTo(F),N);return ft._round(),!v||Ay(s,ft,E,v,r)?ft:void 0}T+=q}}function O1(s,r,a,p,g,y,v,E,T){const L=Dy(p,y,v),N=ky(p,g),F=N*v,U=s[0].x===0||s[0].x===T||s[0].y===0||s[0].y===T;return r-F<r/4&&(r=F+r/4),Ny(s,U?r/2*E%r:(N/2+2*y)*v*E%r,r,L,a,F,U,!1,T)}function Ny(s,r,a,p,g,y,v,E,T){const L=y/2,N=Ly(s);let F=0,U=r-a,q=[];for(let Y=0;Y<s.length-1;Y++){const nt=s[Y],tt=s[Y+1],ft=nt.dist(tt),bt=tt.angleTo(nt);for(;U+a<F+ft;){U+=a;const ct=(U-F)/ft,Ct=ao.number(nt.x,tt.x,ct),At=ao.number(nt.y,tt.y,ct);if(Ct>=0&&Ct<T&&At>=0&&At<T&&U-L>=0&&U+L<=N){const Ft=new Qu(Ct,At,bt,Y);Ft._round(),p&&!Ay(s,Ft,y,p,g)||q.push(Ft)}}F+=ft}return E||q.length||v||(q=Ny(s,F/2,a,p,g,y,v,!0,T)),q}de("Anchor",Qu);const Vh=ps;function Ry(s,r,a,p){const g=[],y=s.image,v=y.pixelRatio,E=y.paddedRect.w-2*Vh,T=y.paddedRect.h-2*Vh,L=s.right-s.left,N=s.bottom-s.top,F=y.stretchX||[[0,E]],U=y.stretchY||[[0,T]],q=(oe,ye)=>oe+ye[1]-ye[0],Y=F.reduce(q,0),nt=U.reduce(q,0),tt=E-Y,ft=T-nt;let bt=0,ct=Y,Ct=0,At=nt,Ft=0,Ie=tt,Me=0,_e=ft;if(y.content&&p){const oe=y.content;bt=xd(F,0,oe[0]),Ct=xd(U,0,oe[1]),ct=xd(F,oe[0],oe[2]),At=xd(U,oe[1],oe[3]),Ft=oe[0]-bt,Me=oe[1]-Ct,Ie=oe[2]-oe[0]-ct,_e=oe[3]-oe[1]-At}const he=(oe,ye,pe,$t)=>{const ze=bd(oe.stretch-bt,ct,L,s.left),Ae=wd(oe.fixed-Ft,Ie,oe.stretch,Y),vn=bd(ye.stretch-Ct,At,N,s.top),br=wd(ye.fixed-Me,_e,ye.stretch,nt),Ar=bd(pe.stretch-bt,ct,L,s.left),Mi=wd(pe.fixed-Ft,Ie,pe.stretch,Y),$s=bd($t.stretch-Ct,At,N,s.top),ho=wd($t.fixed-Me,_e,$t.stretch,nt),wi=new k(ze,vn),Gi=new k(Ar,vn),po=new k(Ar,$s),Do=new k(ze,$s),fs=new k(Ae/v,br/v),Ei=new k(Mi/v,ho/v),fo=r*Math.PI/180;if(fo){const ds=Math.sin(fo),gs=Math.cos(fo),ni=[gs,-ds,ds,gs];wi._matMult(ni),Gi._matMult(ni),Do._matMult(ni),po._matMult(ni)}const ko=oe.stretch+oe.fixed,Ko=ye.stretch+ye.fixed;return{tl:wi,tr:Gi,bl:Do,br:po,tex:{x:y.paddedRect.x+Vh+ko,y:y.paddedRect.y+Vh+Ko,w:pe.stretch+pe.fixed-ko,h:$t.stretch+$t.fixed-Ko},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:fs,pixelOffsetBR:Ei,minFontScaleX:Ie/v/L,minFontScaleY:_e/v/N,isSDF:a}};if(p&&(y.stretchX||y.stretchY)){const oe=Oy(F,tt,Y),ye=Oy(U,ft,nt);for(let pe=0;pe<oe.length-1;pe++){const $t=oe[pe],ze=oe[pe+1];for(let Ae=0;Ae<ye.length-1;Ae++)g.push(he($t,ye[Ae],ze,ye[Ae+1]))}}else g.push(he({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:T+1}));return g}function xd(s,r,a){let p=0;for(const g of s)p+=Math.max(r,Math.min(a,g[1]))-Math.max(r,Math.min(a,g[0]));return p}function Oy(s,r,a){const p=[{fixed:-Vh,stretch:0}];for(const[g,y]of s){const v=p[p.length-1];p.push({fixed:g-v.stretch,stretch:v.stretch}),p.push({fixed:g-v.stretch,stretch:v.stretch+(y-g)})}return p.push({fixed:r+Vh,stretch:a}),p}function bd(s,r,a,p){return s/r*a+p}function wd(s,r,a,p){return s-r*a/p}class Ed{constructor(r,a,p,g,y,v,E,T,L,N){if(this.boxStartIndex=r.length,L){let F=v.top,U=v.bottom;const q=v.collisionPadding;q&&(F-=q[1],U+=q[3]);let Y=U-F;Y>0&&(Y=Math.max(10,Y),this.circleDiameter=Y)}else{let F=v.top*E-T[0],U=v.bottom*E+T[2],q=v.left*E-T[3],Y=v.right*E+T[1];const nt=v.collisionPadding;if(nt&&(q-=nt[0]*E,F-=nt[1]*E,Y+=nt[2]*E,U+=nt[3]*E),N){const tt=new k(q,F),ft=new k(Y,F),bt=new k(q,U),ct=new k(Y,U),Ct=N*Math.PI/180;tt._rotate(Ct),ft._rotate(Ct),bt._rotate(Ct),ct._rotate(Ct),q=Math.min(tt.x,ft.x,bt.x,ct.x),Y=Math.max(tt.x,ft.x,bt.x,ct.x),F=Math.min(tt.y,ft.y,bt.y,ct.y),U=Math.max(tt.y,ft.y,bt.y,ct.y)}r.emplaceBack(a.x,a.y,q,F,Y,U,p,g,y)}this.boxEndIndex=r.length}}class z1{constructor(r=[],a=F1){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let p=(this.length>>1)-1;p>=0;p--)this._down(p)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(this.length===0)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:p}=this,g=a[r];for(;r>0;){const y=r-1>>1,v=a[y];if(p(g,v)>=0)break;a[r]=v,r=y}a[r]=g}_down(r){const{data:a,compare:p}=this,g=this.length>>1,y=a[r];for(;r<g;){let v=1+(r<<1),E=a[v];const T=v+1;if(T<this.length&&p(a[T],E)<0&&(v=T,E=a[T]),p(E,y)>=0)break;a[r]=E,r=v}a[r]=y}}function F1(s,r){return s<r?-1:s>r?1:0}function B1(s,r=1,a=!1){let p=1/0,g=1/0,y=-1/0,v=-1/0;const E=s[0];for(let q=0;q<E.length;q++){const Y=E[q];(!q||Y.x<p)&&(p=Y.x),(!q||Y.y<g)&&(g=Y.y),(!q||Y.x>y)&&(y=Y.x),(!q||Y.y>v)&&(v=Y.y)}const T=Math.min(y-p,v-g);let L=T/2;const N=new z1([],U1);if(T===0)return new k(p,g);for(let q=p;q<y;q+=T)for(let Y=g;Y<v;Y+=T)N.push(new Gh(q+L,Y+L,L,s));let F=function(q){let Y=0,nt=0,tt=0;const ft=q[0];for(let bt=0,ct=ft.length,Ct=ct-1;bt<ct;Ct=bt++){const At=ft[bt],Ft=ft[Ct],Ie=At.x*Ft.y-Ft.x*At.y;nt+=(At.x+Ft.x)*Ie,tt+=(At.y+Ft.y)*Ie,Y+=3*Ie}return new Gh(nt/Y,tt/Y,0,q)}(s),U=N.length;for(;N.length;){const q=N.pop();(q.d>F.d||!F.d)&&(F=q,a&&console.log("found best %d after %d probes",Math.round(1e4*q.d)/1e4,U)),q.max-F.d<=r||(L=q.h/2,N.push(new Gh(q.p.x-L,q.p.y-L,L,s)),N.push(new Gh(q.p.x+L,q.p.y-L,L,s)),N.push(new Gh(q.p.x-L,q.p.y+L,L,s)),N.push(new Gh(q.p.x+L,q.p.y+L,L,s)),U+=4)}return a&&(console.log(`num probes: ${U}`),console.log(`best distance: ${F.d}`)),F.p}function U1(s,r){return r.max-s.max}function Gh(s,r,a,p){this.p=new k(s,r),this.h=a,this.d=function(g,y){let v=!1,E=1/0;for(let T=0;T<y.length;T++){const L=y[T];for(let N=0,F=L.length,U=F-1;N<F;U=N++){const q=L[N],Y=L[U];q.y>g.y!=Y.y>g.y&&g.x<(Y.x-q.x)*(g.y-q.y)/(Y.y-q.y)+q.x&&(v=!v),E=Math.min(E,v_(g,q,Y))}}return(v?1:-1)*Math.sqrt(E)}(this.p,p),this.max=this.d+this.h*Math.SQRT2}const nm=Number.POSITIVE_INFINITY;function zy(s,r){return r[1]!==nm?function(a,p,g){let y=0,v=0;switch(p=Math.abs(p),g=Math.abs(g),a){case"top-right":case"top-left":case"top":v=g-7;break;case"bottom-right":case"bottom-left":case"bottom":v=7-g}switch(a){case"top-right":case"bottom-right":case"right":y=-p;break;case"top-left":case"bottom-left":case"left":y=p}return[y,v]}(s,r[0],r[1]):function(a,p){let g=0,y=0;p<0&&(p=0);const v=p/Math.sqrt(2);switch(a){case"top-right":case"top-left":y=v-7;break;case"bottom-right":case"bottom-left":y=7-v;break;case"bottom":y=7-p;break;case"top":y=p-7}switch(a){case"top-right":case"bottom-right":g=-v;break;case"top-left":case"bottom-left":g=v;break;case"left":g=p;break;case"right":g=-p}return[g,y]}(s,r[0])}function rm(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function V1(s,r,a,p,g,y,v,E,T,L,N){let F=y.textMaxSize.evaluate(r,{});F===void 0&&(F=v);const U=s.layers[0].layout,q=U.get("icon-offset").evaluate(r,{},N),Y=By(a.horizontal),nt=v/24,tt=s.tilePixelRatio*nt,ft=s.tilePixelRatio*F/24,bt=s.tilePixelRatio*E,ct=s.tilePixelRatio*U.get("symbol-spacing"),Ct=U.get("text-padding")*s.tilePixelRatio,At=function($t,ze,Ae,vn=1){const br=$t.get("icon-padding").evaluate(ze,{},Ae),Ar=br&&br.values;return[Ar[0]*vn,Ar[1]*vn,Ar[2]*vn,Ar[3]*vn]}(U,r,N,s.tilePixelRatio),Ft=U.get("text-max-angle")/180*Math.PI,Ie=U.get("text-rotation-alignment")!=="viewport"&&U.get("symbol-placement")!=="point",Me=U.get("icon-rotation-alignment")==="map"&&U.get("symbol-placement")!=="point",_e=U.get("symbol-placement"),he=ct/2,oe=U.get("icon-text-fit");let ye;p&&oe!=="none"&&(s.allowVerticalPlacement&&a.vertical&&(ye=uy(p,a.vertical,oe,U.get("icon-text-fit-padding"),q,nt)),Y&&(p=uy(p,Y,oe,U.get("icon-text-fit-padding"),q,nt)));const pe=($t,ze)=>{ze.x<0||ze.x>=xr||ze.y<0||ze.y>=xr||function(Ae,vn,br,Ar,Mi,$s,ho,wi,Gi,po,Do,fs,Ei,fo,ko,Ko,ds,gs,ni,go,xn,ks,mo,No,Ca){const ll=Ae.addToLineVertexArray(vn,br);let ul,mu,Pa,Ks,ms=0,_u=0,lf=0,jy=0,hm=-1,pm=-1;const yu={};let qy=li(""),fm=0,dm=0;if(wi._unevaluatedLayout.getValue("text-radial-offset")===void 0?[fm,dm]=wi.layout.get("text-offset").evaluate(xn,{},No).map(_s=>_s*Vi):(fm=wi.layout.get("text-radial-offset").evaluate(xn,{},No)*Vi,dm=nm),Ae.allowVerticalPlacement&&Ar.vertical){const _s=wi.layout.get("text-rotate").evaluate(xn,{},No)+90;Pa=new Ed(Gi,vn,po,Do,fs,Ar.vertical,Ei,fo,ko,_s),ho&&(Ks=new Ed(Gi,vn,po,Do,fs,ho,ds,gs,ko,_s))}if(Mi){const _s=wi.layout.get("icon-rotate").evaluate(xn,{}),zl=wi.layout.get("icon-text-fit")!=="none",uf=Ry(Mi,_s,mo,zl),cf=ho?Ry(ho,_s,mo,zl):void 0;mu=new Ed(Gi,vn,po,Do,fs,Mi,ds,gs,!1,_s),ms=4*uf.length;const Yy=Ae.iconSizeData;let Zc=null;Yy.kind==="source"?(Zc=[Ol*wi.layout.get("icon-size").evaluate(xn,{})],Zc[0]>Ku&&Qt(`${Ae.layerIds[0]}: Value for "icon-size" is >= ${rf}. Reduce your "icon-size".`)):Yy.kind==="composite"&&(Zc=[Ol*ks.compositeIconSizes[0].evaluate(xn,{},No),Ol*ks.compositeIconSizes[1].evaluate(xn,{},No)],(Zc[0]>Ku||Zc[1]>Ku)&&Qt(`${Ae.layerIds[0]}: Value for "icon-size" is >= ${rf}. Reduce your "icon-size".`)),Ae.addSymbols(Ae.icon,uf,Zc,go,ni,xn,u.WritingMode.none,vn,ll.lineStartIndex,ll.lineLength,-1,No),hm=Ae.icon.placedSymbolArray.length-1,cf&&(_u=4*cf.length,Ae.addSymbols(Ae.icon,cf,Zc,go,ni,xn,u.WritingMode.vertical,vn,ll.lineStartIndex,ll.lineLength,-1,No),pm=Ae.icon.placedSymbolArray.length-1)}const Zy=Object.keys(Ar.horizontal);for(const _s of Zy){const zl=Ar.horizontal[_s];if(!ul){qy=li(zl.text);const cf=wi.layout.get("text-rotate").evaluate(xn,{},No);ul=new Ed(Gi,vn,po,Do,fs,zl,Ei,fo,ko,cf)}const uf=zl.positionedLines.length===1;if(lf+=Fy(Ae,vn,zl,$s,wi,ko,xn,Ko,ll,Ar.vertical?u.WritingMode.horizontal:u.WritingMode.horizontalOnly,uf?Zy:[_s],yu,hm,ks,No),uf)break}Ar.vertical&&(jy+=Fy(Ae,vn,Ar.vertical,$s,wi,ko,xn,Ko,ll,u.WritingMode.vertical,["vertical"],yu,pm,ks,No));const q1=ul?ul.boxStartIndex:Ae.collisionBoxArray.length,Z1=ul?ul.boxEndIndex:Ae.collisionBoxArray.length,X1=Pa?Pa.boxStartIndex:Ae.collisionBoxArray.length,Y1=Pa?Pa.boxEndIndex:Ae.collisionBoxArray.length,W1=mu?mu.boxStartIndex:Ae.collisionBoxArray.length,H1=mu?mu.boxEndIndex:Ae.collisionBoxArray.length,$1=Ks?Ks.boxStartIndex:Ae.collisionBoxArray.length,K1=Ks?Ks.boxEndIndex:Ae.collisionBoxArray.length;let cl=-1;const Sd=(_s,zl)=>_s&&_s.circleDiameter?Math.max(_s.circleDiameter,zl):zl;cl=Sd(ul,cl),cl=Sd(Pa,cl),cl=Sd(mu,cl),cl=Sd(Ks,cl);const Xy=cl>-1?1:0;Xy&&(cl*=Ca/Vi),Ae.glyphOffsetArray.length>=Uh.MAX_GLYPHS&&Qt("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),xn.sortKey!==void 0&&Ae.addToSortKeyRanges(Ae.symbolInstances.length,xn.sortKey),Ae.symbolInstances.emplaceBack(vn.x,vn.y,yu.right>=0?yu.right:-1,yu.center>=0?yu.center:-1,yu.left>=0?yu.left:-1,yu.vertical||-1,hm,pm,qy,q1,Z1,X1,Y1,W1,H1,$1,K1,po,lf,jy,ms,_u,Xy,0,Ei,fm,dm,cl)}(s,ze,$t,a,p,g,ye,s.layers[0],s.collisionBoxArray,r.index,r.sourceLayerIndex,s.index,tt,[Ct,Ct,Ct,Ct],Ie,T,bt,At,Me,q,r,y,L,N,v)};if(_e==="line")for(const $t of My(r.geometry,0,0,xr,xr)){const ze=O1($t,ct,Ft,a.vertical||Y,p,24,ft,s.overscaling,xr);for(const Ae of ze)Y&&G1(s,Y.text,he,Ae)||pe($t,Ae)}else if(_e==="line-center"){for(const $t of r.geometry)if($t.length>1){const ze=R1($t,Ft,a.vertical||Y,p,24,ft);ze&&pe($t,ze)}}else if(r.type==="Polygon")for(const $t of Rg(r.geometry,0)){const ze=B1($t,16);pe($t[0],new Qu(ze.x,ze.y,0))}else if(r.type==="LineString")for(const $t of r.geometry)pe($t,new Qu($t[0].x,$t[0].y,0));else if(r.type==="Point")for(const $t of r.geometry)for(const ze of $t)pe([ze],new Qu(ze.x,ze.y,0))}function Fy(s,r,a,p,g,y,v,E,T,L,N,F,U,q,Y){const nt=function(bt,ct,Ct,At,Ft,Ie,Me,_e){const he=At.layout.get("text-rotate").evaluate(Ie,{})*Math.PI/180,oe=[];for(const ye of ct.positionedLines)for(const pe of ye.positionedGlyphs){if(!pe.rect)continue;const $t=pe.rect||{};let ze=ny+1,Ae=!0,vn=1,br=0;const Ar=(Ft||_e)&&pe.vertical,Mi=pe.metrics.advance*pe.scale/2;if(_e&&ct.verticalizable&&(br=ye.lineOffset/2-(pe.imageName?-(Vi-pe.metrics.width*pe.scale)/2:(pe.scale-1)*Vi)),pe.imageName){const ni=Me[pe.imageName];Ae=ni.sdf,vn=ni.pixelRatio,ze=ps/vn}const $s=Ft?[pe.x+Mi,pe.y]:[0,0];let ho=Ft?[0,0]:[pe.x+Mi+Ct[0],pe.y+Ct[1]-br],wi=[0,0];Ar&&(wi=ho,ho=[0,0]);const Gi=(pe.metrics.left-ze)*pe.scale-Mi+ho[0],po=(-pe.metrics.top-ze)*pe.scale+ho[1],Do=Gi+$t.w*pe.scale/vn,fs=po+$t.h*pe.scale/vn,Ei=new k(Gi,po),fo=new k(Do,po),ko=new k(Gi,fs),Ko=new k(Do,fs);if(Ar){const ni=new k(-Mi,Mi-ef),go=-Math.PI/2,xn=Vi/2-Mi,ks=new k(5-ef-xn,-(pe.imageName?xn:0)),mo=new k(...wi);Ei._rotateAround(go,ni)._add(ks)._add(mo),fo._rotateAround(go,ni)._add(ks)._add(mo),ko._rotateAround(go,ni)._add(ks)._add(mo),Ko._rotateAround(go,ni)._add(ks)._add(mo)}if(he){const ni=Math.sin(he),go=Math.cos(he),xn=[go,-ni,ni,go];Ei._matMult(xn),fo._matMult(xn),ko._matMult(xn),Ko._matMult(xn)}const ds=new k(0,0),gs=new k(0,0);oe.push({tl:Ei,tr:fo,bl:ko,br:Ko,tex:$t,writingMode:ct.writingMode,glyphOffset:$s,sectionIndex:pe.sectionIndex,isSDF:Ae,pixelOffsetTL:ds,pixelOffsetBR:gs,minFontScaleX:0,minFontScaleY:0})}return oe}(0,a,E,g,y,v,p,s.allowVerticalPlacement),tt=s.textSizeData;let ft=null;tt.kind==="source"?(ft=[Ol*g.layout.get("text-size").evaluate(v,{})],ft[0]>Ku&&Qt(`${s.layerIds[0]}: Value for "text-size" is >= ${rf}. Reduce your "text-size".`)):tt.kind==="composite"&&(ft=[Ol*q.compositeTextSizes[0].evaluate(v,{},Y),Ol*q.compositeTextSizes[1].evaluate(v,{},Y)],(ft[0]>Ku||ft[1]>Ku)&&Qt(`${s.layerIds[0]}: Value for "text-size" is >= ${rf}. Reduce your "text-size".`)),s.addSymbols(s.text,nt,ft,E,y,v,L,r,T.lineStartIndex,T.lineLength,U,Y);for(const bt of N)F[bt]=s.text.placedSymbolArray.length-1;return 4*nt.length}function By(s){for(const r in s)return s[r];return null}function G1(s,r,a,p){const g=s.compareText;if(r in g){const y=g[r];for(let v=y.length-1;v>=0;v--)if(p.dist(y[v])<a)return!0}else g[r]=[];return g[r].push(p),!1}const Uy=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class im{static from(r){if(!(r instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,p]=new Uint8Array(r,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const g=p>>4;if(g!==1)throw new Error(`Got v${g} data when expected v1.`);const y=Uy[15&p];if(!y)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(r,2,1),[E]=new Uint32Array(r,4,1);return new im(E,v,y,r)}constructor(r,a=64,p=Float64Array,g){if(isNaN(r)||r<0)throw new Error(`Unpexpected numItems value: ${r}.`);this.numItems=+r,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=p,this.IndexArrayType=r<65536?Uint16Array:Uint32Array;const y=Uy.indexOf(this.ArrayType),v=2*r*this.ArrayType.BYTES_PER_ELEMENT,E=r*this.IndexArrayType.BYTES_PER_ELEMENT,T=(8-E%8)%8;if(y<0)throw new Error(`Unexpected typed array class: ${p}.`);g&&g instanceof ArrayBuffer?(this.data=g,this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+E+T,2*r),this._pos=2*r,this._finished=!0):(this.data=new ArrayBuffer(8+v+E+T),this.ids=new this.IndexArrayType(this.data,8,r),this.coords=new this.ArrayType(this.data,8+E+T,2*r),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+y]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=r)}add(r,a){const p=this._pos>>1;return this.ids[p]=p,this.coords[this._pos++]=r,this.coords[this._pos++]=a,p}finish(){const r=this._pos>>1;if(r!==this.numItems)throw new Error(`Added ${r} items when expected ${this.numItems}.`);return om(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(r,a,p,g){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:y,coords:v,nodeSize:E}=this,T=[0,y.length-1,0],L=[];for(;T.length;){const N=T.pop()||0,F=T.pop()||0,U=T.pop()||0;if(F-U<=E){for(let tt=U;tt<=F;tt++){const ft=v[2*tt],bt=v[2*tt+1];ft>=r&&ft<=p&&bt>=a&&bt<=g&&L.push(y[tt])}continue}const q=U+F>>1,Y=v[2*q],nt=v[2*q+1];Y>=r&&Y<=p&&nt>=a&&nt<=g&&L.push(y[q]),(N===0?r<=Y:a<=nt)&&(T.push(U),T.push(q-1),T.push(1-N)),(N===0?p>=Y:g>=nt)&&(T.push(q+1),T.push(F),T.push(1-N))}return L}within(r,a,p){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:y,nodeSize:v}=this,E=[0,g.length-1,0],T=[],L=p*p;for(;E.length;){const N=E.pop()||0,F=E.pop()||0,U=E.pop()||0;if(F-U<=v){for(let tt=U;tt<=F;tt++)Gy(y[2*tt],y[2*tt+1],r,a)<=L&&T.push(g[tt]);continue}const q=U+F>>1,Y=y[2*q],nt=y[2*q+1];Gy(Y,nt,r,a)<=L&&T.push(g[q]),(N===0?r-p<=Y:a-p<=nt)&&(E.push(U),E.push(q-1),E.push(1-N)),(N===0?r+p>=Y:a+p>=nt)&&(E.push(q+1),E.push(F),E.push(1-N))}return T}}function om(s,r,a,p,g,y){if(g-p<=a)return;const v=p+g>>1;Vy(s,r,v,p,g,y),om(s,r,a,p,v-1,1-y),om(s,r,a,v+1,g,1-y)}function Vy(s,r,a,p,g,y){for(;g>p;){if(g-p>600){const L=g-p+1,N=a-p+1,F=Math.log(L),U=.5*Math.exp(2*F/3),q=.5*Math.sqrt(F*U*(L-U)/L)*(N-L/2<0?-1:1);Vy(s,r,a,Math.max(p,Math.floor(a-N*U/L+q)),Math.min(g,Math.floor(a+(L-N)*U/L+q)),y)}const v=r[2*a+y];let E=p,T=g;for(sf(s,r,p,a),r[2*g+y]>v&&sf(s,r,p,g);E<T;){for(sf(s,r,E,T),E++,T--;r[2*E+y]<v;)E++;for(;r[2*T+y]>v;)T--}r[2*p+y]===v?sf(s,r,p,T):(T++,sf(s,r,T,g)),T<=a&&(p=T+1),a<=T&&(g=T-1)}}function sf(s,r,a,p){sm(s,a,p),sm(r,2*a,2*p),sm(r,2*a+1,2*p+1)}function sm(s,r,a){const p=s[r];s[r]=s[a],s[a]=p}function Gy(s,r,a,p){const g=s-a,y=r-p;return g*g+y*y}var am;u.PerformanceMarkers=void 0,(am=u.PerformanceMarkers||(u.PerformanceMarkers={})).create="create",am.load="load",am.fullLoad="fullLoad";let Id=null,af=[];const lm=1e3/60,um="loadTime",cm="fullLoadTime",j1={mark(s){performance.mark(s)},frame(s){const r=s;Id!=null&&af.push(r-Id),Id=r},clearMetrics(){Id=null,af=[],performance.clearMeasures(um),performance.clearMeasures(cm);for(const s in u.PerformanceMarkers)performance.clearMarks(u.PerformanceMarkers[s])},getPerformanceMetrics(){performance.measure(um,u.PerformanceMarkers.create,u.PerformanceMarkers.load),performance.measure(cm,u.PerformanceMarkers.create,u.PerformanceMarkers.fullLoad);const s=performance.getEntriesByName(um)[0].duration,r=performance.getEntriesByName(cm)[0].duration,a=af.length,p=1/(af.reduce((y,v)=>y+v,0)/a/1e3),g=af.filter(y=>y>lm).reduce((y,v)=>y+(v-lm)/lm,0);return{loadTime:s,fullLoadTime:r,fps:p,percentDroppedFrames:g/(a+g)*100,totalFrames:a}}};u.AJAXError=pr,u.ARRAY_TYPE=Nh,u.Actor=class{constructor(s,r,a){this.target=s,this.parent=r,this.mapId=a,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},Nt(["receive","process"],this),this.invoker=new k1(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=Ue()?s:window}send(s,r,a,p,g=!1){const y=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(this.callbacks[y]=a);const v=Se(this.globalScope)?void 0:[];return this.target.postMessage({id:y,type:s,hasCallback:!!a,targetMapId:p,mustQueue:g,sourceMapId:this.mapId,data:zi(r,v)},v),{cancel:()=>{a&&delete this.callbacks[y],this.target.postMessage({id:y,type:"<cancel>",targetMapId:p,sourceMapId:this.mapId})}}}receive(s){const r=s.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if(r.type==="<cancel>"){delete this.tasks[a];const p=this.cancelCallbacks[a];delete this.cancelCallbacks[a],p&&p()}else Ue()||r.mustQueue?(this.tasks[a]=r,this.taskQueue.push(a),this.invoker.trigger()):this.processTask(a,r)}process(){if(!this.taskQueue.length)return;const s=this.taskQueue.shift(),r=this.tasks[s];delete this.tasks[s],this.taskQueue.length&&this.invoker.trigger(),r&&this.processTask(s,r)}processTask(s,r){if(r.type==="<response>"){const a=this.callbacks[s];delete this.callbacks[s],a&&(r.error?a(Ti(r.error)):a(null,Ti(r.data)))}else{let a=!1;const p=Se(this.globalScope)?void 0:[],g=r.hasCallback?(E,T)=>{a=!0,delete this.cancelCallbacks[s],this.target.postMessage({id:s,type:"<response>",sourceMapId:this.mapId,error:E?zi(E):null,data:zi(T,p)},p)}:E=>{a=!0};let y=null;const v=Ti(r.data);if(this.parent[r.type])y=this.parent[r.type](r.sourceMapId,v,g);else if(this.parent.getWorkerSource){const E=r.type.split(".");y=this.parent.getWorkerSource(r.sourceMapId,E[0],v.source)[E[1]](v,g)}else g(new Error(`Could not find function ${r.type}`));!a&&y&&y.cancel&&(this.cancelCallbacks[s]=y.cancel)}}remove(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)}},u.AlphaImage=Yp,u.CanonicalTileID=em,u.CollisionBoxArray=m,u.CollisionCircleLayoutArray=class extends Ch{},u.Color=Te,u.DEMData=Ey,u.DataConstantProperty=Le,u.DictionaryCoder=Iy,u.EXTENT=xr,u.ErrorEvent=We,u.EvaluationParameters=Mr,u.Event=cr,u.Evented=js,u.FeatureIndex=Ty,u.FillBucket=Fg,u.FillExtrusionBucket=Ug,u.GeoJSONFeature=Sy,u.ImageAtlas=iy,u.ImagePosition=Zg,u.KDBush=im,u.LineBucket=Vg,u.LineStripIndexArray=class extends i{},u.LngLat=Ju,u.MercatorCoordinate=vd,u.ONE_EM=Vi,u.OverscaledTileID=Hs,u.PerformanceUtils=j1,u.Point=k,u.Pos3dArray=class extends Ih{},u.PosArray=et,u.Properties=Ho,u.Protobuf=jg,u.QuadTriangleArray=class extends Ph{},u.RGBAImage=Ws,u.RasterBoundsArray=class extends Up{},u.RequestPerformance=class{constructor(s){this._marks={start:[s.url,"start"].join("#"),end:[s.url,"end"].join("#"),measure:s.url.toString()},performance.mark(this._marks.start)}finish(){performance.mark(this._marks.end);let s=performance.getEntriesByName(this._marks.measure);return s.length===0&&(performance.measure(this._marks.measure,this._marks.start,this._marks.end),s=performance.getEntriesByName(this._marks.measure),performance.clearMarks(this._marks.start),performance.clearMarks(this._marks.end),performance.clearMeasures(this._marks.measure)),s}},u.SegmentVector=ue,u.SymbolBucket=Uh,u.Transitionable=td,u.TriangleIndexArray=Yt,u.Uniform1f=Ta,u.Uniform1i=class extends Lo{constructor(s,r){super(s,r),this.current=0}set(s){this.current!==s&&(this.current=s,this.gl.uniform1i(this.location,s))}},u.Uniform2f=class extends Lo{constructor(s,r){super(s,r),this.current=[0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]||(this.current=s,this.gl.uniform2f(this.location,s[0],s[1]))}},u.Uniform3f=class extends Lo{constructor(s,r){super(s,r),this.current=[0,0,0]}set(s){s[0]===this.current[0]&&s[1]===this.current[1]&&s[2]===this.current[2]||(this.current=s,this.gl.uniform3f(this.location,s[0],s[1],s[2]))}},u.Uniform4f=Vc,u.UniformColor=co,u.UniformMatrix4f=class extends Lo{constructor(s,r){super(s,r),this.current=Bi}set(s){if(s[12]!==this.current[12]||s[0]!==this.current[0])return this.current=s,void this.gl.uniformMatrix4fv(this.location,!1,s);for(let r=1;r<16;r++)if(s[r]!==this.current[r]){this.current=s,this.gl.uniformMatrix4fv(this.location,!1,s);break}}},u.UnwrappedTileID=wy,u.ValidationError=te,u.ZoomHistory=Zs,u.addDynamicAttributes=Hg,u.arrayBufferToImage=function(s,r){const a=new Image;a.onload=()=>{r(null,a),URL.revokeObjectURL(a.src),a.onload=null,window.requestAnimationFrame(()=>{a.src=yn})},a.onerror=()=>r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const p=new Blob([new Uint8Array(s)],{type:"image/png"});a.src=s.byteLength?URL.createObjectURL(p):yn},u.arrayBufferToImageBitmap=function(s,r){const a=new Blob([new Uint8Array(s)],{type:"image/png"});createImageBitmap(a).then(p=>{r(null,p)}).catch(p=>{r(new Error(`Could not load image because of ${p.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})},u.asyncAll=function(s,r,a){if(!s.length)return a(null,[]);let p=s.length;const g=new Array(s.length);let y=null;s.forEach((v,E)=>{r(v,(T,L)=>{T&&(y=T),g[E]=L,--p==0&&a(y,g)})})},u.bezier=K,u.bindAll=Nt,u.clamp=dt,u.clipLine=My,u.clone=function(s){var r=new Nh(16);return r[0]=s[0],r[1]=s[1],r[2]=s[2],r[3]=s[3],r[4]=s[4],r[5]=s[5],r[6]=s[6],r[7]=s[7],r[8]=s[8],r[9]=s[9],r[10]=s[10],r[11]=s[11],r[12]=s[12],r[13]=s[13],r[14]=s[14],r[15]=s[15],r},u.clone$1=Zt,u.collisionCircleLayout=l1,u.config=An,u.copy=function(s,r){return s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[4]=r[4],s[5]=r[5],s[6]=r[6],s[7]=r[7],s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s},u.create=function(){var s=new Nh(16);return Nh!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s},u.createExpression=Hn,u.createFilter=Lc,u.createLayout=bi,u.createStyleLayer=function(s){return s.type==="custom"?new L1(s):new D1[s.type](s)},u.deepEqual=function s(r,a){if(Array.isArray(r)){if(!Array.isArray(a)||r.length!==a.length)return!1;for(let p=0;p<r.length;p++)if(!s(r[p],a[p]))return!1;return!0}if(typeof r=="object"&&r!==null&&a!==null){if(typeof a!="object"||Object.keys(r).length!==Object.keys(a).length)return!1;for(const p in r)if(!s(r[p],a[p]))return!1;return!0}return r===a},u.derefLayers=function(s){s=s.slice();const r=Object.create(null);for(let a=0;a<s.length;a++)r[s[a].id]=s[a];for(let a=0;a<s.length;a++)"ref"in s[a]&&(s[a]=Sr(s[a],r[s[a].ref]));return s},u.diffStyles=function(s,r){if(!s)return[{command:pn.setStyle,args:[r]}];let a=[];try{if(!Ln(s.version,r.version))return[{command:pn.setStyle,args:[r]}];Ln(s.center,r.center)||a.push({command:pn.setCenter,args:[r.center]}),Ln(s.zoom,r.zoom)||a.push({command:pn.setZoom,args:[r.zoom]}),Ln(s.bearing,r.bearing)||a.push({command:pn.setBearing,args:[r.bearing]}),Ln(s.pitch,r.pitch)||a.push({command:pn.setPitch,args:[r.pitch]}),Ln(s.sprite,r.sprite)||a.push({command:pn.setSprite,args:[r.sprite]}),Ln(s.glyphs,r.glyphs)||a.push({command:pn.setGlyphs,args:[r.glyphs]}),Ln(s.transition,r.transition)||a.push({command:pn.setTransition,args:[r.transition]}),Ln(s.light,r.light)||a.push({command:pn.setLight,args:[r.light]});const p={},g=[];(function(v,E,T,L){let N;for(N in E=E||{},v=v||{})Object.prototype.hasOwnProperty.call(v,N)&&(Object.prototype.hasOwnProperty.call(E,N)||rs(N,T,L));for(N in E)Object.prototype.hasOwnProperty.call(E,N)&&(Object.prototype.hasOwnProperty.call(v,N)?Ln(v[N],E[N])||(v[N].type==="geojson"&&E[N].type==="geojson"&&Tr(v,E,N)?T.push({command:pn.setGeoJSONSourceData,args:[N,E[N].data]}):is(N,E,T,L)):io(N,E,T))})(s.sources,r.sources,g,p);const y=[];s.layers&&s.layers.forEach(v=>{p[v.source]?a.push({command:pn.removeLayer,args:[v.id]}):y.push(v)}),a=a.concat(g),function(v,E,T){E=E||[];const L=(v=v||[]).map(os),N=E.map(os),F=v.reduce(Co,{}),U=E.reduce(Co,{}),q=L.slice(),Y=Object.create(null);let nt,tt,ft,bt,ct,Ct,At;for(nt=0,tt=0;nt<L.length;nt++)ft=L[nt],Object.prototype.hasOwnProperty.call(U,ft)?tt++:(T.push({command:pn.removeLayer,args:[ft]}),q.splice(q.indexOf(ft,tt),1));for(nt=0,tt=0;nt<N.length;nt++)ft=N[N.length-1-nt],q[q.length-1-nt]!==ft&&(Object.prototype.hasOwnProperty.call(F,ft)?(T.push({command:pn.removeLayer,args:[ft]}),q.splice(q.lastIndexOf(ft,q.length-tt),1)):tt++,Ct=q[q.length-nt],T.push({command:pn.addLayer,args:[U[ft],Ct]}),q.splice(q.length-nt,0,ft),Y[ft]=!0);for(nt=0;nt<N.length;nt++)if(ft=N[nt],bt=F[ft],ct=U[ft],!Y[ft]&&!Ln(bt,ct))if(Ln(bt.source,ct.source)&&Ln(bt["source-layer"],ct["source-layer"])&&Ln(bt.type,ct.type)){for(At in Nr(bt.layout,ct.layout,T,ft,null,pn.setLayoutProperty),Nr(bt.paint,ct.paint,T,ft,null,pn.setPaintProperty),Ln(bt.filter,ct.filter)||T.push({command:pn.setFilter,args:[ft,ct.filter]}),Ln(bt.minzoom,ct.minzoom)&&Ln(bt.maxzoom,ct.maxzoom)||T.push({command:pn.setLayerZoomRange,args:[ft,ct.minzoom,ct.maxzoom]}),bt)Object.prototype.hasOwnProperty.call(bt,At)&&At!=="layout"&&At!=="paint"&&At!=="filter"&&At!=="metadata"&&At!=="minzoom"&&At!=="maxzoom"&&(At.indexOf("paint.")===0?Nr(bt[At],ct[At],T,ft,At.slice(6),pn.setPaintProperty):Ln(bt[At],ct[At])||T.push({command:pn.setLayerProperty,args:[ft,At,ct[At]]}));for(At in ct)Object.prototype.hasOwnProperty.call(ct,At)&&!Object.prototype.hasOwnProperty.call(bt,At)&&At!=="layout"&&At!=="paint"&&At!=="filter"&&At!=="metadata"&&At!=="minzoom"&&At!=="maxzoom"&&(At.indexOf("paint.")===0?Nr(bt[At],ct[At],T,ft,At.slice(6),pn.setPaintProperty):Ln(bt[At],ct[At])||T.push({command:pn.setLayerProperty,args:[ft,At,ct[At]]}))}else T.push({command:pn.removeLayer,args:[ft]}),Ct=q[q.lastIndexOf(ft)+1],T.push({command:pn.addLayer,args:[ct,Ct]})}(y,r.layers,a)}catch(p){console.warn("Unable to compute style diff:",p),a=[{command:pn.setStyle,args:[r]}]}return a},u.dot=function(s,r){return s[0]*r[0]+s[1]*r[1]+s[2]*r[2]+s[3]*r[3]},u.earthRadius=Qg,u.ease=lt,u.emitValidationErrors=Bn,u.emptyStyle=function(){const s={},r=St.$version;for(const a in St.$root){const p=St.$root[a];if(p.required){let g=null;g=a==="version"?r:p.type==="array"?[]:{},g!=null&&(s[a]=g)}}return s},u.equals=function(s,r){var a=s[0],p=s[1],g=s[2],y=s[3],v=s[4],E=s[5],T=s[6],L=s[7],N=s[8],F=s[9],U=s[10],q=s[11],Y=s[12],nt=s[13],tt=s[14],ft=s[15],bt=r[0],ct=r[1],Ct=r[2],At=r[3],Ft=r[4],Ie=r[5],Me=r[6],_e=r[7],he=r[8],oe=r[9],ye=r[10],pe=r[11],$t=r[12],ze=r[13],Ae=r[14],vn=r[15];return Math.abs(a-bt)<=$o*Math.max(1,Math.abs(a),Math.abs(bt))&&Math.abs(p-ct)<=$o*Math.max(1,Math.abs(p),Math.abs(ct))&&Math.abs(g-Ct)<=$o*Math.max(1,Math.abs(g),Math.abs(Ct))&&Math.abs(y-At)<=$o*Math.max(1,Math.abs(y),Math.abs(At))&&Math.abs(v-Ft)<=$o*Math.max(1,Math.abs(v),Math.abs(Ft))&&Math.abs(E-Ie)<=$o*Math.max(1,Math.abs(E),Math.abs(Ie))&&Math.abs(T-Me)<=$o*Math.max(1,Math.abs(T),Math.abs(Me))&&Math.abs(L-_e)<=$o*Math.max(1,Math.abs(L),Math.abs(_e))&&Math.abs(N-he)<=$o*Math.max(1,Math.abs(N),Math.abs(he))&&Math.abs(F-oe)<=$o*Math.max(1,Math.abs(F),Math.abs(oe))&&Math.abs(U-ye)<=$o*Math.max(1,Math.abs(U),Math.abs(ye))&&Math.abs(q-pe)<=$o*Math.max(1,Math.abs(q),Math.abs(pe))&&Math.abs(Y-$t)<=$o*Math.max(1,Math.abs(Y),Math.abs($t))&&Math.abs(nt-ze)<=$o*Math.max(1,Math.abs(nt),Math.abs(ze))&&Math.abs(tt-Ae)<=$o*Math.max(1,Math.abs(tt),Math.abs(Ae))&&Math.abs(ft-vn)<=$o*Math.max(1,Math.abs(ft),Math.abs(vn))},u.evaluateSizeForFeature=function(s,{uSize:r,uSizeT:a},{lowerSize:p,upperSize:g}){return s.kind==="source"?p/Ol:s.kind==="composite"?ao.number(p/Ol,g/Ol,a):r},u.evaluateSizeForZoom=function(s,r){let a=0,p=0;if(s.kind==="constant")p=s.layoutSize;else if(s.kind!=="source"){const{interpolationType:g,minZoom:y,maxZoom:v}=s,E=g?dt(lo.interpolationFactor(g,r,y,v),0,1):0;s.kind==="camera"?p=ao.number(s.minSize,s.maxSize,E):a=E}return{uSizeT:a,uSize:p}},u.evaluateVariableOffset=zy,u.evented=bh,u.exported=_i,u.extend=gt,u.filterObject=Ut,u.findLineIntersection=function(s,r,a,p){const g=r.y-s.y,y=r.x-s.x,v=p.y-a.y,E=p.x-a.x,T=v*y-E*g;if(T===0)return null;const L=(E*(s.y-a.y)-v*(s.x-a.x))/T;return new k(s.x+L*y,s.y+L*g)},u.fromScaling=function(s,r){return s[0]=r[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=r[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=r[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s},u.getAnchorAlignment=Yg,u.getAnchorJustification=rm,u.getArrayBuffer=Ur,u.getDefaultExportFromCjs=I,u.getJSON=function(s,r){return Uo(gt(s,{type:"json"}),r)},u.getOverlapMode=Wg,u.getProtocolAction=Yn,u.getRTLTextPluginStatus=Rp,u.getReferrer=wn,u.getVideo=function(s,r){const a=window.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let p=0;p<s.length;p++){const g=window.document.createElement("source");Qe(s[p])||(a.crossOrigin="Anonymous"),g.src=s[p],a.appendChild(g)}return{cancel:()=>{}}},u.groupByLayout=function(s,r){const a={};for(let g=0;g<s.length;g++){const y=r&&r[s[g].id]||el(s[g]);r&&(r[s[g].id]=y);let v=a[y];v||(v=a[y]=[]),v.push(s[g])}const p=[];for(const g in a)p.push(a[g]);return p},u.identity=Pg,u.interpolate=ao,u.invert=function(s,r){var a=r[0],p=r[1],g=r[2],y=r[3],v=r[4],E=r[5],T=r[6],L=r[7],N=r[8],F=r[9],U=r[10],q=r[11],Y=r[12],nt=r[13],tt=r[14],ft=r[15],bt=a*E-p*v,ct=a*T-g*v,Ct=a*L-y*v,At=p*T-g*E,Ft=p*L-y*E,Ie=g*L-y*T,Me=N*nt-F*Y,_e=N*tt-U*Y,he=N*ft-q*Y,oe=F*tt-U*nt,ye=F*ft-q*nt,pe=U*ft-q*tt,$t=bt*pe-ct*ye+Ct*oe+At*he-Ft*_e+Ie*Me;return $t?(s[0]=(E*pe-T*ye+L*oe)*($t=1/$t),s[1]=(g*ye-p*pe-y*oe)*$t,s[2]=(nt*Ie-tt*Ft+ft*At)*$t,s[3]=(U*Ft-F*Ie-q*At)*$t,s[4]=(T*he-v*pe-L*_e)*$t,s[5]=(a*pe-g*he+y*_e)*$t,s[6]=(tt*Ct-Y*Ie-ft*ct)*$t,s[7]=(N*Ie-U*Ct+q*ct)*$t,s[8]=(v*ye-E*he+L*Me)*$t,s[9]=(p*he-a*ye-y*Me)*$t,s[10]=(Y*Ft-nt*Ct+ft*bt)*$t,s[11]=(F*Ct-N*Ft-q*bt)*$t,s[12]=(E*_e-v*oe-T*Me)*$t,s[13]=(a*oe-p*_e+g*Me)*$t,s[14]=(nt*ct-Y*At-tt*bt)*$t,s[15]=(N*At-F*ct+U*bt)*$t,s):null},u.isImageBitmap=Ye,u.isSafari=Se,u.isWorker=Ue,u.keysDifference=function(s,r){const a=[];for(const p in s)p in r||a.push(p);return a},u.lazyLoadRTLTextPlugin=function(){Ds.isLoading()||Ds.isLoaded()||Rp()!=="deferred"||Qf()},u.makeRequest=Uo,u.mapObject=Gt,u.mercatorXfromLng=yy,u.mercatorYfromLat=vy,u.mercatorZfromAltitude=xy,u.mul=xx,u.mul$1=function(s,r,a){return s[0]=r[0]*a[0],s[1]=r[1]*a[1],s[2]=r[2]*a[2],s[3]=r[3]*a[3],s},u.multiply=E_,u.nextPowerOfTwo=function(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log(s)/Math.LN2))},u.operations=pn,u.ortho=function(s,r,a,p,g,y,v){var E=1/(r-a),T=1/(p-g),L=1/(y-v);return s[0]=-2*E,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*T,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*L,s[11]=0,s[12]=(r+a)*E,s[13]=(g+p)*T,s[14]=(v+y)*L,s[15]=1,s},u.parseCacheControl=function(s){const r={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,p,g,y)=>{const v=g||y;return r[p]=!v||v.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r},u.parseGlyphPbf=function(s){return new jg(s).readFields(v1,[])},u.pbf=H_,u.performSymbolLayout=function(s){s.bucket.createArrays(),s.bucket.tilePixelRatio=xr/(512*s.bucket.overscaling),s.bucket.compareText={},s.bucket.iconsNeedLinear=!1;const r=s.bucket.layers[0].layout,a=s.bucket.layers[0]._unevaluatedLayout._values,p={layoutIconSize:a["icon-size"].possiblyEvaluate(new Mr(s.bucket.zoom+1),s.canonical),layoutTextSize:a["text-size"].possiblyEvaluate(new Mr(s.bucket.zoom+1),s.canonical),textMaxSize:a["text-size"].possiblyEvaluate(new Mr(18))};if(s.bucket.textSizeData.kind==="composite"){const{minZoom:T,maxZoom:L}=s.bucket.textSizeData;p.compositeTextSizes=[a["text-size"].possiblyEvaluate(new Mr(T),s.canonical),a["text-size"].possiblyEvaluate(new Mr(L),s.canonical)]}if(s.bucket.iconSizeData.kind==="composite"){const{minZoom:T,maxZoom:L}=s.bucket.iconSizeData;p.compositeIconSizes=[a["icon-size"].possiblyEvaluate(new Mr(T),s.canonical),a["icon-size"].possiblyEvaluate(new Mr(L),s.canonical)]}const g=r.get("text-line-height")*Vi,y=r.get("text-rotation-alignment")!=="viewport"&&r.get("symbol-placement")!=="point",v=r.get("text-keep-upright"),E=r.get("text-size");for(const T of s.bucket.features){const L=r.get("text-font").evaluate(T,{},s.canonical).join(","),N=E.evaluate(T,{},s.canonical),F=p.layoutTextSize.evaluate(T,{},s.canonical),U=p.layoutIconSize.evaluate(T,{},s.canonical),q={horizontal:{},vertical:void 0},Y=T.text;let nt,tt=[0,0];if(Y){const ct=Y.toString(),Ct=r.get("text-letter-spacing").evaluate(T,{},s.canonical)*Vi,At=ba(ct)?Ct:0,Ft=r.get("text-anchor").evaluate(T,{},s.canonical),Ie=r.get("text-variable-anchor");if(!Ie){const ye=r.get("text-radial-offset").evaluate(T,{},s.canonical);tt=ye?zy(Ft,[ye*Vi,nm]):r.get("text-offset").evaluate(T,{},s.canonical).map(pe=>pe*Vi)}let Me=y?"center":r.get("text-justify").evaluate(T,{},s.canonical);const _e=r.get("symbol-placement"),he=_e==="point"?r.get("text-max-width").evaluate(T,{},s.canonical)*Vi:0,oe=()=>{s.bucket.allowVerticalPlacement&&nl(ct)&&(q.vertical=gd(Y,s.glyphMap,s.glyphPositions,s.imagePositions,L,he,g,Ft,"left",At,tt,u.WritingMode.vertical,!0,_e,F,N))};if(!y&&Ie){const ye=Me==="auto"?Ie.map($t=>rm($t)):[Me];let pe=!1;for(let $t=0;$t<ye.length;$t++){const ze=ye[$t];if(!q.horizontal[ze])if(pe)q.horizontal[ze]=q.horizontal[0];else{const Ae=gd(Y,s.glyphMap,s.glyphPositions,s.imagePositions,L,he,g,"center",ze,At,tt,u.WritingMode.horizontal,!1,_e,F,N);Ae&&(q.horizontal[ze]=Ae,pe=Ae.positionedLines.length===1)}}oe()}else{Me==="auto"&&(Me=rm(Ft));const ye=gd(Y,s.glyphMap,s.glyphPositions,s.imagePositions,L,he,g,Ft,Me,At,tt,u.WritingMode.horizontal,!1,_e,F,N);ye&&(q.horizontal[Me]=ye),oe(),nl(ct)&&y&&v&&(q.vertical=gd(Y,s.glyphMap,s.glyphPositions,s.imagePositions,L,he,g,Ft,Me,At,tt,u.WritingMode.vertical,!1,_e,F,N))}}let ft=!1;if(T.icon&&T.icon.name){const ct=s.imageMap[T.icon.name];ct&&(nt=S1(s.imagePositions[T.icon.name],r.get("icon-offset").evaluate(T,{},s.canonical),r.get("icon-anchor").evaluate(T,{},s.canonical)),ft=!!ct.sdf,s.bucket.sdfIcons===void 0?s.bucket.sdfIcons=ft:s.bucket.sdfIcons!==ft&&Qt("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(ct.pixelRatio!==s.bucket.pixelRatio||r.get("icon-rotate").constantOr(1)!==0)&&(s.bucket.iconsNeedLinear=!0))}const bt=By(q.horizontal)||q.vertical;s.bucket.iconsInText=!!bt&&bt.iconsInText,(bt||nt)&&V1(s.bucket,T,q,nt,s.imageMap,p,F,U,tt,ft,s.canonical)}s.showCollisionBoxes&&s.bucket.generateCollisionDebugBuffers()},u.perspective=function(s,r,a,p,g){var y,v=1/Math.tan(r/2);return s[0]=v/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=v,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,g!=null&&g!==1/0?(s[10]=(g+p)*(y=1/(p-g)),s[14]=2*g*p*y):(s[10]=-1,s[14]=-2*p),s},u.pick=function(s,r){const a={};for(let p=0;p<r.length;p++){const g=r[p];g in s&&(a[g]=s[g])}return a},u.plugin=Ds,u.pointGeometry=w,u.polygonIntersectsPolygon=__,u.potpack=ry,u.register=de,u.registerForPluginStateChange=function(s){return s({pluginStatus:Wo,pluginURL:Rl}),bh.on("pluginStateChange",s),s},u.renderColorRamp=P_,u.rotateX=function(s,r,a){var p=Math.sin(a),g=Math.cos(a),y=r[4],v=r[5],E=r[6],T=r[7],L=r[8],N=r[9],F=r[10],U=r[11];return r!==s&&(s[0]=r[0],s[1]=r[1],s[2]=r[2],s[3]=r[3],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[4]=y*g+L*p,s[5]=v*g+N*p,s[6]=E*g+F*p,s[7]=T*g+U*p,s[8]=L*g-y*p,s[9]=N*g-v*p,s[10]=F*g-E*p,s[11]=U*g-T*p,s},u.rotateZ=function(s,r,a){var p=Math.sin(a),g=Math.cos(a),y=r[0],v=r[1],E=r[2],T=r[3],L=r[4],N=r[5],F=r[6],U=r[7];return r!==s&&(s[8]=r[8],s[9]=r[9],s[10]=r[10],s[11]=r[11],s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15]),s[0]=y*g+L*p,s[1]=v*g+N*p,s[2]=E*g+F*p,s[3]=T*g+U*p,s[4]=L*g-y*p,s[5]=N*g-v*p,s[6]=F*g-E*p,s[7]=U*g-T*p,s},u.sameOrigin=Qe,u.scale=function(s,r,a){var p=a[0],g=a[1],y=a[2];return s[0]=r[0]*p,s[1]=r[1]*p,s[2]=r[2]*p,s[3]=r[3]*p,s[4]=r[4]*g,s[5]=r[5]*g,s[6]=r[6]*g,s[7]=r[7]*g,s[8]=r[8]*y,s[9]=r[9]*y,s[10]=r[10]*y,s[11]=r[11]*y,s[12]=r[12],s[13]=r[13],s[14]=r[14],s[15]=r[15],s},u.setRTLTextPlugin=function(s,r,a=!1){if(Wo===Xu||Wo===il||Wo===Nl)throw new Error("setRTLTextPlugin cannot be called multiple times.");Rl=_i.resolveURL(s),Wo=Xu,zc=r,Np(),a||Qf()},u.sphericalToCartesian=function([s,r,a]){return r+=90,r*=Math.PI/180,a*=Math.PI/180,{x:s*Math.cos(r)*Math.sin(a),y:s*Math.sin(r)*Math.sin(a),z:s*Math.cos(a)}},u.toEvaluationFeature=jc,u.transformMat4=ld,u.translate=function(s,r,a){var p,g,y,v,E,T,L,N,F,U,q,Y,nt=a[0],tt=a[1],ft=a[2];return r===s?(s[12]=r[0]*nt+r[4]*tt+r[8]*ft+r[12],s[13]=r[1]*nt+r[5]*tt+r[9]*ft+r[13],s[14]=r[2]*nt+r[6]*tt+r[10]*ft+r[14],s[15]=r[3]*nt+r[7]*tt+r[11]*ft+r[15]):(g=r[1],y=r[2],v=r[3],E=r[4],T=r[5],L=r[6],N=r[7],F=r[8],U=r[9],q=r[10],Y=r[11],s[0]=p=r[0],s[1]=g,s[2]=y,s[3]=v,s[4]=E,s[5]=T,s[6]=L,s[7]=N,s[8]=F,s[9]=U,s[10]=q,s[11]=Y,s[12]=p*nt+E*tt+F*ft+r[12],s[13]=g*nt+T*tt+U*ft+r[13],s[14]=y*nt+L*tt+q*ft+r[14],s[15]=v*nt+N*tt+Y*ft+r[15]),s},u.triggerPluginCompletionEvent=Jf,u.unicodeBlockLookup=le,u.uniqueId=function(){return yt++},u.v8Spec=St,u.validateCustomStyleLayer=function(s){const r=[],a=s.id;return a===void 0&&r.push({message:`layers.${a}: missing required property "id"`}),s.render===void 0&&r.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},u.validateLight=xh,u.validateStyle=Yo,u.vectorTile=Hu,u.warnOnce=Qt,u.wrap=xt}),h(["./shared"],function(u){class I{constructor(z){this.keyCache={},z&&this.replace(z)}replace(z){this._layerConfigs={},this._layers={},this.update(z,[])}update(z,B){for(const J of z){this._layerConfigs[J.id]=J;const st=this._layers[J.id]=u.createStyleLayer(J);st._featureFilter=u.createFilter(st.filter),this.keyCache[J.id]&&delete this.keyCache[J.id]}for(const J of B)delete this.keyCache[J],delete this._layerConfigs[J],delete this._layers[J];this.familiesBySource={};const W=u.groupByLayout(Object.values(this._layerConfigs),this.keyCache);for(const J of W){const st=J.map(Bt=>this._layers[Bt.id]),mt=st[0];if(mt.visibility==="none")continue;const ut=mt.source||"";let at=this.familiesBySource[ut];at||(at=this.familiesBySource[ut]={});const vt=mt.sourceLayer||"_geojsonTileLayer";let zt=at[vt];zt||(zt=at[vt]=[]),zt.push(st)}}}class w{constructor(z){const B={},W=[];for(const ut in z){const at=z[ut],vt=B[ut]={};for(const zt in at){const Bt=at[+zt];if(!Bt||Bt.bitmap.width===0||Bt.bitmap.height===0)continue;const Vt={x:0,y:0,w:Bt.bitmap.width+2,h:Bt.bitmap.height+2};W.push(Vt),vt[zt]={rect:Vt,metrics:Bt.metrics}}}const{w:J,h:st}=u.potpack(W),mt=new u.AlphaImage({width:J||1,height:st||1});for(const ut in z){const at=z[ut];for(const vt in at){const zt=at[+vt];if(!zt||zt.bitmap.width===0||zt.bitmap.height===0)continue;const Bt=B[ut][vt].rect;u.AlphaImage.copy(zt.bitmap,mt,{x:0,y:0},{x:Bt.x+1,y:Bt.y+1},zt.bitmap)}}this.image=mt,this.positions=B}}u.register("GlyphAtlas",w);class D{constructor(z){this.tileID=new u.OverscaledTileID(z.tileID.overscaledZ,z.tileID.wrap,z.tileID.canonical.z,z.tileID.canonical.x,z.tileID.canonical.y),this.uid=z.uid,this.zoom=z.zoom,this.pixelRatio=z.pixelRatio,this.tileSize=z.tileSize,this.source=z.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=z.showCollisionBoxes,this.collectResourceTiming=!!z.collectResourceTiming,this.returnDependencies=!!z.returnDependencies,this.promoteId=z.promoteId}parse(z,B,W,J,st){this.status="parsing",this.data=z,this.collisionBoxArray=new u.CollisionBoxArray;const mt=new u.DictionaryCoder(Object.keys(z.layers).sort()),ut=new u.FeatureIndex(this.tileID,this.promoteId);ut.bucketLayerIDs=[];const at={},vt={featureIndex:ut,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:W},zt=B.familiesBySource[this.source];for(const hn in zt){const In=z.layers[hn];if(!In)continue;In.version===1&&u.warnOnce(`Vector tile source "${this.source}" layer "${hn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Wn=mt.encode(hn),Rr=[];for(let Te=0;Te<In.length;Te++){const _r=In.feature(Te),pa=ut.getId(_r,hn);Rr.push({feature:_r,id:pa,index:Te,sourceLayerIndex:Wn})}for(const Te of zt[hn]){const _r=Te[0];_r.source!==this.source&&u.warnOnce(`layer.source = ${_r.source} does not equal this.source = ${this.source}`),_r.minzoom&&this.zoom<Math.floor(_r.minzoom)||_r.maxzoom&&this.zoom>=_r.maxzoom||_r.visibility!=="none"&&(k(Te,this.zoom,W),(at[_r.id]=_r.createBucket({index:ut.bucketLayerIDs.length,layers:Te,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Wn,sourceID:this.source})).populate(Rr,vt,this.tileID.canonical),ut.bucketLayerIDs.push(Te.map(pa=>pa.id)))}}let Bt,Vt,Ee,$e;const Ce=u.mapObject(vt.glyphDependencies,hn=>Object.keys(hn).map(Number));Object.keys(Ce).length?J.send("getGlyphs",{uid:this.uid,stacks:Ce,source:this.source,tileID:this.tileID,type:"glyphs"},(hn,In)=>{Bt||(Bt=hn,Vt=In,En.call(this))}):Vt={};const ke=Object.keys(vt.iconDependencies);ke.length?J.send("getImages",{icons:ke,source:this.source,tileID:this.tileID,type:"icons"},(hn,In)=>{Bt||(Bt=hn,Ee=In,En.call(this))}):Ee={};const Ze=Object.keys(vt.patternDependencies);function En(){if(Bt)return st(Bt);if(Vt&&Ee&&$e){const hn=new w(Vt),In=new u.ImageAtlas(Ee,$e);for(const Wn in at){const Rr=at[Wn];Rr instanceof u.SymbolBucket?(k(Rr.layers,this.zoom,W),u.performSymbolLayout({bucket:Rr,glyphMap:Vt,glyphPositions:hn.positions,imageMap:Ee,imagePositions:In.iconPositions,showCollisionBoxes:this.showCollisionBoxes,canonical:this.tileID.canonical})):Rr.hasPattern&&(Rr instanceof u.LineBucket||Rr instanceof u.FillBucket||Rr instanceof u.FillExtrusionBucket)&&(k(Rr.layers,this.zoom,W),Rr.addFeatures(vt,this.tileID.canonical,In.patternPositions))}this.status="done",st(null,{buckets:Object.values(at).filter(Wn=>!Wn.isEmpty()),featureIndex:ut,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:hn.image,imageAtlas:In,glyphMap:this.returnDependencies?Vt:null,iconMap:this.returnDependencies?Ee:null,glyphPositions:this.returnDependencies?hn.positions:null})}}Ze.length?J.send("getImages",{icons:Ze,source:this.source,tileID:this.tileID,type:"patterns"},(hn,In)=>{Bt||(Bt=hn,$e=In,En.call(this))}):$e={},En.call(this)}}function k(V,z,B){const W=new u.EvaluationParameters(z);for(const J of V)J.recalculate(W,B)}function G(V,z){const B=u.getArrayBuffer(V.request,(W,J,st,mt)=>{W?z(W):J&&z(null,{vectorTile:new u.vectorTile.VectorTile(new u.Protobuf(J)),rawData:J,cacheControl:st,expires:mt})});return()=>{B.cancel(),z()}}class H{constructor(z,B,W,J){this.actor=z,this.layerIndex=B,this.availableImages=W,this.loadVectorData=J||G,this.loading={},this.loaded={}}loadTile(z,B){const W=z.uid;this.loading||(this.loading={});const J=!!(z&&z.request&&z.request.collectResourceTiming)&&new u.RequestPerformance(z.request),st=this.loading[W]=new D(z);st.abort=this.loadVectorData(z,(mt,ut)=>{if(delete this.loading[W],mt||!ut)return st.status="done",this.loaded[W]=st,B(mt);const at=ut.rawData,vt={};ut.expires&&(vt.expires=ut.expires),ut.cacheControl&&(vt.cacheControl=ut.cacheControl);const zt={};if(J){const Bt=J.finish();Bt&&(zt.resourceTiming=JSON.parse(JSON.stringify(Bt)))}st.vectorTile=ut.vectorTile,st.parse(ut.vectorTile,this.layerIndex,this.availableImages,this.actor,(Bt,Vt)=>{if(Bt||!Vt)return B(Bt);B(null,u.extend({rawTileData:at.slice(0)},Vt,vt,zt))}),this.loaded=this.loaded||{},this.loaded[W]=st})}reloadTile(z,B){const W=this.loaded,J=z.uid,st=this;if(W&&W[J]){const mt=W[J];mt.showCollisionBoxes=z.showCollisionBoxes;const ut=(at,vt)=>{const zt=mt.reloadCallback;zt&&(delete mt.reloadCallback,mt.parse(mt.vectorTile,st.layerIndex,this.availableImages,st.actor,zt)),B(at,vt)};mt.status==="parsing"?mt.reloadCallback=ut:mt.status==="done"&&(mt.vectorTile?mt.parse(mt.vectorTile,this.layerIndex,this.availableImages,this.actor,ut):ut())}}abortTile(z,B){const W=this.loading,J=z.uid;W&&W[J]&&W[J].abort&&(W[J].abort(),delete W[J]),B()}removeTile(z,B){const W=this.loaded,J=z.uid;W&&W[J]&&delete W[J],B()}}class j{constructor(){this.loaded={}}loadTile(z,B){const{uid:W,encoding:J,rawImageData:st}=z,mt=u.isImageBitmap(st)?this.getImageData(st):st,ut=new u.DEMData(W,mt,J);this.loaded=this.loaded||{},this.loaded[W]=ut,B(null,ut)}getImageData(z){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(z.width,z.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=z.width,this.offscreenCanvas.height=z.height,this.offscreenCanvasContext.drawImage(z,0,0,z.width,z.height);const B=this.offscreenCanvasContext.getImageData(-1,-1,z.width+2,z.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new u.RGBAImage({width:B.width,height:B.height},B.data)}removeTile(z){const B=this.loaded,W=z.uid;B&&B[W]&&delete B[W]}}function K(V,z){if(V.length!==0){lt(V[0],z);for(var B=1;B<V.length;B++)lt(V[B],!z)}}function lt(V,z){for(var B=0,W=0,J=0,st=V.length,mt=st-1;J<st;mt=J++){var ut=(V[J][0]-V[mt][0])*(V[mt][1]+V[J][1]),at=B+ut;W+=Math.abs(B)>=Math.abs(ut)?B-at+ut:ut-at+B,B=at}B+W>=0!=!!z&&V.reverse()}var dt=u.getDefaultExportFromCjs(function V(z,B){var W,J=z&&z.type;if(J==="FeatureCollection")for(W=0;W<z.features.length;W++)V(z.features[W],B);else if(J==="GeometryCollection")for(W=0;W<z.geometries.length;W++)V(z.geometries[W],B);else if(J==="Feature")V(z.geometry,B);else if(J==="Polygon")K(z.coordinates,B);else if(J==="MultiPolygon")for(W=0;W<z.coordinates.length;W++)K(z.coordinates[W],B);return z});const xt=u.vectorTile.VectorTileFeature.prototype.toGeoJSON;var gt={exports:{}},yt=u.pointGeometry,Nt=u.vectorTile.VectorTileFeature,Gt=Ut;function Ut(V,z){this.options=z||{},this.features=V,this.length=V.length}function Zt(V,z){this.id=typeof V.id=="number"?V.id:void 0,this.type=V.type,this.rawGeometry=V.type===1?[V.geometry]:V.geometry,this.properties=V.tags,this.extent=z||4096}Ut.prototype.feature=function(V){return new Zt(this.features[V],this.options.extent)},Zt.prototype.loadGeometry=function(){var V=this.rawGeometry;this.geometry=[];for(var z=0;z<V.length;z++){for(var B=V[z],W=[],J=0;J<B.length;J++)W.push(new yt(B[J][0],B[J][1]));this.geometry.push(W)}return this.geometry},Zt.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var V=this.geometry,z=1/0,B=-1/0,W=1/0,J=-1/0,st=0;st<V.length;st++)for(var mt=V[st],ut=0;ut<mt.length;ut++){var at=mt[ut];z=Math.min(z,at.x),B=Math.max(B,at.x),W=Math.min(W,at.y),J=Math.max(J,at.y)}return[z,W,B,J]},Zt.prototype.toGeoJSON=Nt.prototype.toGeoJSON;var qt=u.pbf,Qt=Gt;function ie(V){var z=new qt;return function(B,W){for(var J in B.layers)W.writeMessage(3,ve,B.layers[J])}(V,z),z.finish()}function ve(V,z){var B;z.writeVarintField(15,V.version||1),z.writeStringField(1,V.name||""),z.writeVarintField(5,V.extent||4096);var W={keys:[],values:[],keycache:{},valuecache:{}};for(B=0;B<V.length;B++)W.feature=V.feature(B),z.writeMessage(2,Ue,W);var J=W.keys;for(B=0;B<J.length;B++)z.writeStringField(3,J[B]);var st=W.values;for(B=0;B<st.length;B++)z.writeMessage(4,tr,st[B])}function Ue(V,z){var B=V.feature;B.id!==void 0&&z.writeVarintField(1,B.id),z.writeMessage(2,Rt,V),z.writeVarintField(3,B.type),z.writeMessage(4,yn,B)}function Rt(V,z){var B=V.feature,W=V.keys,J=V.values,st=V.keycache,mt=V.valuecache;for(var ut in B.properties){var at=B.properties[ut],vt=st[ut];if(at!==null){vt===void 0&&(W.push(ut),st[ut]=vt=W.length-1),z.writeVarint(vt);var zt=typeof at;zt!=="string"&&zt!=="boolean"&&zt!=="number"&&(at=JSON.stringify(at));var Bt=zt+":"+at,Vt=mt[Bt];Vt===void 0&&(J.push(at),mt[Bt]=Vt=J.length-1),z.writeVarint(Vt)}}}function Se(V,z){return(z<<3)+(7&V)}function Ye(V){return V<<1^V>>31}function yn(V,z){for(var B=V.loadGeometry(),W=V.type,J=0,st=0,mt=B.length,ut=0;ut<mt;ut++){var at=B[ut],vt=1;W===1&&(vt=at.length),z.writeVarint(Se(1,vt));for(var zt=W===3?at.length-1:at.length,Bt=0;Bt<zt;Bt++){Bt===1&&W!==1&&z.writeVarint(Se(2,zt-1));var Vt=at[Bt].x-J,Ee=at[Bt].y-st;z.writeVarint(Ye(Vt)),z.writeVarint(Ye(Ee)),J+=Vt,st+=Ee}W===3&&z.writeVarint(Se(7,1))}}function tr(V,z){var B=typeof V;B==="string"?z.writeStringField(1,V):B==="boolean"?z.writeBooleanField(7,V):B==="number"&&(V%1!=0?z.writeDoubleField(3,V):V<0?z.writeSVarintField(6,V):z.writeVarintField(5,V))}gt.exports=ie,gt.exports.fromVectorTileJs=ie,gt.exports.fromGeojsonVt=function(V,z){z=z||{};var B={};for(var W in V)B[W]=new Qt(V[W].features,z),B[W].name=W,B[W].version=z.version,B[W].extent=z.extent;return ie({layers:B})},gt.exports.GeoJSONWrapper=Qt;var Xn=u.getDefaultExportFromCjs(gt.exports);const _i={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:V=>V},An=Math.fround||(pr=new Float32Array(1),V=>(pr[0]=+V,pr[0]));var pr;const wn=3,Yn=5,ur=6;class Uo{constructor(z){this.options=Object.assign(Object.create(_i),z),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(z){const{log:B,minZoom:W,maxZoom:J}=this.options;B&&console.time("total time");const st=`prepare ${z.length} points`;B&&console.time(st),this.points=z;const mt=[];for(let at=0;at<z.length;at++){const vt=z[at];if(!vt.geometry)continue;const[zt,Bt]=vt.geometry.coordinates,Vt=An(Ni(zt)),Ee=An(_n(Bt));mt.push(Vt,Ee,1/0,at,-1,1),this.options.reduce&&mt.push(0)}let ut=this.trees[J+1]=this._createTree(mt);B&&console.timeEnd(st);for(let at=J;at>=W;at--){const vt=+Date.now();ut=this.trees[at]=this._createTree(this._cluster(ut,at)),B&&console.log("z%d: %d clusters in %dms",at,ut.numItems,+Date.now()-vt)}return B&&console.timeEnd("total time"),this}getClusters(z,B){let W=((z[0]+180)%360+360)%360-180;const J=Math.max(-90,Math.min(90,z[1]));let st=z[2]===180?180:((z[2]+180)%360+360)%360-180;const mt=Math.max(-90,Math.min(90,z[3]));if(z[2]-z[0]>=360)W=-180,st=180;else if(W>st){const Bt=this.getClusters([W,J,180,mt],B),Vt=this.getClusters([-180,J,st,mt],B);return Bt.concat(Vt)}const ut=this.trees[this._limitZoom(B)],at=ut.range(Ni(W),_n(mt),Ni(st),_n(J)),vt=ut.data,zt=[];for(const Bt of at){const Vt=this.stride*Bt;zt.push(vt[Vt+Yn]>1?Ur(vt,Vt,this.clusterProps):this.points[vt[Vt+wn]])}return zt}getChildren(z){const B=this._getOriginId(z),W=this._getOriginZoom(z),J="No cluster with the specified id.",st=this.trees[W];if(!st)throw new Error(J);const mt=st.data;if(B*this.stride>=mt.length)throw new Error(J);const ut=this.options.radius/(this.options.extent*Math.pow(2,W-1)),at=st.within(mt[B*this.stride],mt[B*this.stride+1],ut),vt=[];for(const zt of at){const Bt=zt*this.stride;mt[Bt+4]===z&&vt.push(mt[Bt+Yn]>1?Ur(mt,Bt,this.clusterProps):this.points[mt[Bt+wn]])}if(vt.length===0)throw new Error(J);return vt}getLeaves(z,B,W){const J=[];return this._appendLeaves(J,z,B=B||10,W=W||0,0),J}getTile(z,B,W){const J=this.trees[this._limitZoom(z)],st=Math.pow(2,z),{extent:mt,radius:ut}=this.options,at=ut/mt,vt=(W-at)/st,zt=(W+1+at)/st,Bt={features:[]};return this._addTileFeatures(J.range((B-at)/st,vt,(B+1+at)/st,zt),J.data,B,W,st,Bt),B===0&&this._addTileFeatures(J.range(1-at/st,vt,1,zt),J.data,st,W,st,Bt),B===st-1&&this._addTileFeatures(J.range(0,vt,at/st,zt),J.data,-1,W,st,Bt),Bt.features.length?Bt:null}getClusterExpansionZoom(z){let B=this._getOriginZoom(z)-1;for(;B<=this.options.maxZoom;){const W=this.getChildren(z);if(B++,W.length!==1)break;z=W[0].properties.cluster_id}return B}_appendLeaves(z,B,W,J,st){const mt=this.getChildren(B);for(const ut of mt){const at=ut.properties;if(at&&at.cluster?st+at.point_count<=J?st+=at.point_count:st=this._appendLeaves(z,at.cluster_id,W,J,st):st<J?st++:z.push(ut),z.length===W)break}return st}_createTree(z){const B=new u.KDBush(z.length/this.stride|0,this.options.nodeSize,Float32Array);for(let W=0;W<z.length;W+=this.stride)B.add(z[W],z[W+1]);return B.finish(),B.data=z,B}_addTileFeatures(z,B,W,J,st,mt){for(const ut of z){const at=ut*this.stride,vt=B[at+Yn]>1;let zt,Bt,Vt;if(vt)zt=Qe(B,at,this.clusterProps),Bt=B[at],Vt=B[at+1];else{const Ce=this.points[B[at+wn]];zt=Ce.properties;const[ke,Ze]=Ce.geometry.coordinates;Bt=Ni(ke),Vt=_n(Ze)}const Ee={type:1,geometry:[[Math.round(this.options.extent*(Bt*st-W)),Math.round(this.options.extent*(Vt*st-J))]],tags:zt};let $e;$e=vt||this.options.generateId?B[at+wn]:this.points[B[at+wn]].id,$e!==void 0&&(Ee.id=$e),mt.features.push(Ee)}}_limitZoom(z){return Math.max(this.options.minZoom,Math.min(Math.floor(+z),this.options.maxZoom+1))}_cluster(z,B){const{radius:W,extent:J,reduce:st,minPoints:mt}=this.options,ut=W/(J*Math.pow(2,B)),at=z.data,vt=[],zt=this.stride;for(let Bt=0;Bt<at.length;Bt+=zt){if(at[Bt+2]<=B)continue;at[Bt+2]=B;const Vt=at[Bt],Ee=at[Bt+1],$e=z.within(at[Bt],at[Bt+1],ut),Ce=at[Bt+Yn];let ke=Ce;for(const Ze of $e){const En=Ze*zt;at[En+2]>B&&(ke+=at[En+Yn])}if(ke>Ce&&ke>=mt){let Ze,En=Vt*Ce,hn=Ee*Ce,In=-1;const Wn=((Bt/zt|0)<<5)+(B+1)+this.points.length;for(const Rr of $e){const Te=Rr*zt;if(at[Te+2]<=B)continue;at[Te+2]=B;const _r=at[Te+Yn];En+=at[Te]*_r,hn+=at[Te+1]*_r,at[Te+4]=Wn,st&&(Ze||(Ze=this._map(at,Bt,!0),In=this.clusterProps.length,this.clusterProps.push(Ze)),st(Ze,this._map(at,Te)))}at[Bt+4]=Wn,vt.push(En/ke,hn/ke,1/0,Wn,-1,ke),st&&vt.push(In)}else{for(let Ze=0;Ze<zt;Ze++)vt.push(at[Bt+Ze]);if(ke>1)for(const Ze of $e){const En=Ze*zt;if(!(at[En+2]<=B)){at[En+2]=B;for(let hn=0;hn<zt;hn++)vt.push(at[En+hn])}}}}return vt}_getOriginId(z){return z-this.points.length>>5}_getOriginZoom(z){return(z-this.points.length)%32}_map(z,B,W){if(z[B+Yn]>1){const mt=this.clusterProps[z[B+ur]];return W?Object.assign({},mt):mt}const J=this.points[z[B+wn]].properties,st=this.options.map(J);return W&&st===J?Object.assign({},st):st}}function Ur(V,z,B){return{type:"Feature",id:V[z+wn],properties:Qe(V,z,B),geometry:{type:"Point",coordinates:[(W=V[z],360*(W-.5)),cr(V[z+1])]}};var W}function Qe(V,z,B){const W=V[z+Yn],J=W>=1e4?`${Math.round(W/1e3)}k`:W>=1e3?Math.round(W/100)/10+"k":W,st=V[z+ur],mt=st===-1?{}:Object.assign({},B[st]);return Object.assign(mt,{cluster:!0,cluster_id:V[z+wn],point_count:W,point_count_abbreviated:J})}function Ni(V){return V/360+.5}function _n(V){const z=Math.sin(V*Math.PI/180),B=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return B<0?0:B>1?1:B}function cr(V){const z=(180-360*V)*Math.PI/180;return 360*Math.atan(Math.exp(z))/Math.PI-90}function We(V,z,B,W){for(var J,st=W,mt=B-z>>1,ut=B-z,at=V[z],vt=V[z+1],zt=V[B],Bt=V[B+1],Vt=z+3;Vt<B;Vt+=3){var Ee=js(V[Vt],V[Vt+1],at,vt,zt,Bt);if(Ee>st)J=Vt,st=Ee;else if(Ee===st){var $e=Math.abs(Vt-mt);$e<ut&&(J=Vt,ut=$e)}}st>W&&(J-z>3&&We(V,z,J,W),V[J+2]=st,B-J>3&&We(V,J,B,W))}function js(V,z,B,W,J,st){var mt=J-B,ut=st-W;if(mt!==0||ut!==0){var at=((V-B)*mt+(z-W)*ut)/(mt*mt+ut*ut);at>1?(B=J,W=st):at>0&&(B+=mt*at,W+=ut*at)}return(mt=V-B)*mt+(ut=z-W)*ut}function St(V,z,B,W){var J={id:V===void 0?null:V,type:z,geometry:B,tags:W,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(st){var mt=st.geometry,ut=st.type;if(ut==="Point"||ut==="MultiPoint"||ut==="LineString")Gn(st,mt);else if(ut==="Polygon"||ut==="MultiLineString")for(var at=0;at<mt.length;at++)Gn(st,mt[at]);else if(ut==="MultiPolygon")for(at=0;at<mt.length;at++)for(var vt=0;vt<mt[at].length;vt++)Gn(st,mt[at][vt])}(J),J}function Gn(V,z){for(var B=0;B<z.length;B+=3)V.minX=Math.min(V.minX,z[B]),V.minY=Math.min(V.minY,z[B+1]),V.maxX=Math.max(V.maxX,z[B]),V.maxY=Math.max(V.maxY,z[B+1])}function Sr(V,z,B,W){if(z.geometry){var J=z.geometry.coordinates,st=z.geometry.type,mt=Math.pow(B.tolerance/((1<<B.maxZoom)*B.extent),2),ut=[],at=z.id;if(B.promoteId?at=z.properties[B.promoteId]:B.generateId&&(at=W||0),st==="Point")Ln(J,ut);else if(st==="MultiPoint")for(var vt=0;vt<J.length;vt++)Ln(J[vt],ut);else if(st==="LineString")pn(J,ut,mt,!1);else if(st==="MultiLineString"){if(B.lineMetrics){for(vt=0;vt<J.length;vt++)pn(J[vt],ut=[],mt,!1),V.push(St(at,"LineString",ut,z.properties));return}io(J,ut,mt,!1)}else if(st==="Polygon")io(J,ut,mt,!0);else{if(st!=="MultiPolygon"){if(st==="GeometryCollection"){for(vt=0;vt<z.geometry.geometries.length;vt++)Sr(V,{id:at,geometry:z.geometry.geometries[vt],properties:z.properties},B,W);return}throw new Error("Input data is not a valid GeoJSON object.")}for(vt=0;vt<J.length;vt++){var zt=[];io(J[vt],zt,mt,!0),ut.push(zt)}}V.push(St(at,st,ut,z.properties))}}function Ln(V,z){z.push(rs(V[0])),z.push(is(V[1])),z.push(0)}function pn(V,z,B,W){for(var J,st,mt=0,ut=0;ut<V.length;ut++){var at=rs(V[ut][0]),vt=is(V[ut][1]);z.push(at),z.push(vt),z.push(0),ut>0&&(mt+=W?(J*vt-at*st)/2:Math.sqrt(Math.pow(at-J,2)+Math.pow(vt-st,2))),J=at,st=vt}var zt=z.length-3;z[2]=1,We(z,0,zt,B),z[zt+2]=1,z.size=Math.abs(mt),z.start=0,z.end=z.size}function io(V,z,B,W){for(var J=0;J<V.length;J++){var st=[];pn(V[J],st,B,W),z.push(st)}}function rs(V){return V/360+.5}function is(V){var z=Math.sin(V*Math.PI/180),B=.5-.25*Math.log((1+z)/(1-z))/Math.PI;return B<0?0:B>1?1:B}function Tr(V,z,B,W,J,st,mt,ut){if(W/=z,st>=(B/=z)&&mt<W)return V;if(mt<B||st>=W)return null;for(var at=[],vt=0;vt<V.length;vt++){var zt=V[vt],Bt=zt.geometry,Vt=zt.type,Ee=J===0?zt.minX:zt.minY,$e=J===0?zt.maxX:zt.maxY;if(Ee>=B&&$e<W)at.push(zt);else if(!($e<B||Ee>=W)){var Ce=[];if(Vt==="Point"||Vt==="MultiPoint")Nr(Bt,Ce,B,W,J);else if(Vt==="LineString")os(Bt,Ce,B,W,J,!1,ut.lineMetrics);else if(Vt==="MultiLineString")te(Bt,Ce,B,W,J,!1);else if(Vt==="Polygon")te(Bt,Ce,B,W,J,!0);else if(Vt==="MultiPolygon")for(var ke=0;ke<Bt.length;ke++){var Ze=[];te(Bt[ke],Ze,B,W,J,!0),Ze.length&&Ce.push(Ze)}if(Ce.length){if(ut.lineMetrics&&Vt==="LineString"){for(ke=0;ke<Ce.length;ke++)at.push(St(zt.id,Vt,Ce[ke],zt.tags));continue}Vt!=="LineString"&&Vt!=="MultiLineString"||(Ce.length===1?(Vt="LineString",Ce=Ce[0]):Vt="MultiLineString"),Vt!=="Point"&&Vt!=="MultiPoint"||(Vt=Ce.length===3?"Point":"MultiPoint"),at.push(St(zt.id,Vt,Ce,zt.tags))}}}return at.length?at:null}function Nr(V,z,B,W,J){for(var st=0;st<V.length;st+=3){var mt=V[st+J];mt>=B&&mt<=W&&(z.push(V[st]),z.push(V[st+1]),z.push(V[st+2]))}}function os(V,z,B,W,J,st,mt){for(var ut,at,vt=Co(V),zt=J===0?Vr:ss,Bt=V.start,Vt=0;Vt<V.length-3;Vt+=3){var Ee=V[Vt],$e=V[Vt+1],Ce=V[Vt+2],ke=V[Vt+3],Ze=V[Vt+4],En=J===0?Ee:$e,hn=J===0?ke:Ze,In=!1;mt&&(ut=Math.sqrt(Math.pow(Ee-ke,2)+Math.pow($e-Ze,2))),En<B?hn>B&&(at=zt(vt,Ee,$e,ke,Ze,B),mt&&(vt.start=Bt+ut*at)):En>W?hn<W&&(at=zt(vt,Ee,$e,ke,Ze,W),mt&&(vt.start=Bt+ut*at)):Ri(vt,Ee,$e,Ce),hn<B&&En>=B&&(at=zt(vt,Ee,$e,ke,Ze,B),In=!0),hn>W&&En<=W&&(at=zt(vt,Ee,$e,ke,Ze,W),In=!0),!st&&In&&(mt&&(vt.end=Bt+ut*at),z.push(vt),vt=Co(V)),mt&&(Bt+=ut)}var Wn=V.length-3;Ee=V[Wn],$e=V[Wn+1],Ce=V[Wn+2],(En=J===0?Ee:$e)>=B&&En<=W&&Ri(vt,Ee,$e,Ce),Wn=vt.length-3,st&&Wn>=3&&(vt[Wn]!==vt[0]||vt[Wn+1]!==vt[1])&&Ri(vt,vt[0],vt[1],vt[2]),vt.length&&z.push(vt)}function Co(V){var z=[];return z.size=V.size,z.start=V.start,z.end=V.end,z}function te(V,z,B,W,J,st){for(var mt=0;mt<V.length;mt++)os(V[mt],z,B,W,J,st,!1)}function Ri(V,z,B,W){V.push(z),V.push(B),V.push(W)}function Vr(V,z,B,W,J,st){var mt=(st-z)/(W-z);return V.push(st),V.push(B+(J-B)*mt),V.push(1),mt}function ss(V,z,B,W,J,st){var mt=(st-B)/(J-B);return V.push(z+(W-z)*mt),V.push(st),V.push(1),mt}function Ki(V,z){for(var B=[],W=0;W<V.length;W++){var J,st=V[W],mt=st.type;if(mt==="Point"||mt==="MultiPoint"||mt==="LineString")J=ee(st.geometry,z);else if(mt==="MultiLineString"||mt==="Polygon"){J=[];for(var ut=0;ut<st.geometry.length;ut++)J.push(ee(st.geometry[ut],z))}else if(mt==="MultiPolygon")for(J=[],ut=0;ut<st.geometry.length;ut++){for(var at=[],vt=0;vt<st.geometry[ut].length;vt++)at.push(ee(st.geometry[ut][vt],z));J.push(at)}B.push(St(st.id,mt,J,st.tags))}return B}function ee(V,z){var B=[];B.size=V.size,V.start!==void 0&&(B.start=V.start,B.end=V.end);for(var W=0;W<V.length;W+=3)B.push(V[W]+z,V[W+1],V[W+2]);return B}function on(V,z){if(V.transformed)return V;var B,W,J,st=1<<V.z,mt=V.x,ut=V.y;for(B=0;B<V.features.length;B++){var at=V.features[B],vt=at.geometry,zt=at.type;if(at.geometry=[],zt===1)for(W=0;W<vt.length;W+=2)at.geometry.push(Ve(vt[W],vt[W+1],z,st,mt,ut));else for(W=0;W<vt.length;W++){var Bt=[];for(J=0;J<vt[W].length;J+=2)Bt.push(Ve(vt[W][J],vt[W][J+1],z,st,mt,ut));at.geometry.push(Bt)}}return V.transformed=!0,V}function Ve(V,z,B,W,J,st){return[Math.round(B*(V*W-J)),Math.round(B*(z*W-st))]}function yi(V,z,B,W,J){for(var st=z===J.maxZoom?0:J.tolerance/((1<<z)*J.extent),mt={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:B,y:W,z,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ut=0;ut<V.length;ut++){mt.numFeatures++,hr(mt,V[ut],st,J);var at=V[ut].minX,vt=V[ut].minY,zt=V[ut].maxX,Bt=V[ut].maxY;at<mt.minX&&(mt.minX=at),vt<mt.minY&&(mt.minY=vt),zt>mt.maxX&&(mt.maxX=zt),Bt>mt.maxY&&(mt.maxY=Bt)}return mt}function hr(V,z,B,W){var J=z.geometry,st=z.type,mt=[];if(st==="Point"||st==="MultiPoint")for(var ut=0;ut<J.length;ut+=3)mt.push(J[ut]),mt.push(J[ut+1]),V.numPoints++,V.numSimplified++;else if(st==="LineString")Xe(mt,J,V,B,!1,!1);else if(st==="MultiLineString"||st==="Polygon")for(ut=0;ut<J.length;ut++)Xe(mt,J[ut],V,B,st==="Polygon",ut===0);else if(st==="MultiPolygon")for(var at=0;at<J.length;at++){var vt=J[at];for(ut=0;ut<vt.length;ut++)Xe(mt,vt[ut],V,B,!0,ut===0)}if(mt.length){var zt=z.tags||null;if(st==="LineString"&&W.lineMetrics){for(var Bt in zt={},z.tags)zt[Bt]=z.tags[Bt];zt.mapbox_clip_start=J.start/J.size,zt.mapbox_clip_end=J.end/J.size}var Vt={geometry:mt,type:st==="Polygon"||st==="MultiPolygon"?3:st==="LineString"||st==="MultiLineString"?2:1,tags:zt};z.id!==null&&(Vt.id=z.id),V.features.push(Vt)}}function Xe(V,z,B,W,J,st){var mt=W*W;if(W>0&&z.size<(J?mt:W))B.numPoints+=z.length/3;else{for(var ut=[],at=0;at<z.length;at+=3)(W===0||z[at+2]>mt)&&(B.numSimplified++,ut.push(z[at]),ut.push(z[at+1])),B.numPoints++;J&&function(vt,zt){for(var Bt=0,Vt=0,Ee=vt.length,$e=Ee-2;Vt<Ee;$e=Vt,Vt+=2)Bt+=(vt[Vt]-vt[$e])*(vt[Vt+1]+vt[$e+1]);if(Bt>0===zt)for(Vt=0,Ee=vt.length;Vt<Ee/2;Vt+=2){var Ce=vt[Vt],ke=vt[Vt+1];vt[Vt]=vt[Ee-2-Vt],vt[Vt+1]=vt[Ee-1-Vt],vt[Ee-2-Vt]=Ce,vt[Ee-1-Vt]=ke}}(ut,st),V.push(ut)}}function oo(V,z){var B=(z=this.options=function(J,st){for(var mt in st)J[mt]=st[mt];return J}(Object.create(this.options),z)).debug;if(B&&console.time("preprocess data"),z.maxZoom<0||z.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(z.promoteId&&z.generateId)throw new Error("promoteId and generateId cannot be used together.");var W=function(J,st){var mt=[];if(J.type==="FeatureCollection")for(var ut=0;ut<J.features.length;ut++)Sr(mt,J.features[ut],st,ut);else Sr(mt,J.type==="Feature"?J:{geometry:J},st);return mt}(V,z);this.tiles={},this.tileCoords=[],B&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",z.indexMaxZoom,z.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),W=function(J,st){var mt=st.buffer/st.extent,ut=J,at=Tr(J,1,-1-mt,mt,0,-1,2,st),vt=Tr(J,1,1-mt,2+mt,0,-1,2,st);return(at||vt)&&(ut=Tr(J,1,-mt,1+mt,0,-1,2,st)||[],at&&(ut=Ki(at,1).concat(ut)),vt&&(ut=ut.concat(Ki(vt,-1)))),ut}(W,z),W.length&&this.splitTile(W,0,0,0),B&&(W.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Gr(V,z,B){return 32*((1<<V)*B+z)+V}function Ii(V,z){return z?V.properties[z]:V.id}function as(V,z){if(V==null)return!0;if(V.type==="Feature")return Ii(V,z)!=null;if(V.type==="FeatureCollection"){const B=new Set;for(const W of V.features){const J=Ii(W,z);if(J==null||B.has(J))return!1;B.add(J)}return!0}return!1}function Jr(V,z){const B=new Map;if(V!=null)if(V.type==="Feature")B.set(Ii(V,z),V);else for(const W of V.features)B.set(Ii(W,z),W);return B}function Jn(V,z){const B=V.tileID.canonical;if(!this._geoJSONIndex)return z(null,null);const W=this._geoJSONIndex.getTile(B.z,B.x,B.y);if(!W)return z(null,null);const J=new class{constructor(mt){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=u.EXTENT,this.length=mt.length,this._features=mt}feature(mt){return new class{constructor(ut){this._feature=ut,this.extent=u.EXTENT,this.type=ut.type,this.properties=ut.tags,"id"in ut&&!isNaN(ut.id)&&(this.id=parseInt(ut.id,10))}loadGeometry(){if(this._feature.type===1){const ut=[];for(const at of this._feature.geometry)ut.push([new u.Point(at[0],at[1])]);return ut}{const ut=[];for(const at of this._feature.geometry){const vt=[];for(const zt of at)vt.push(new u.Point(zt[0],zt[1]));ut.push(vt)}return ut}}toGeoJSON(ut,at,vt){return xt.call(this,ut,at,vt)}}(this._features[mt])}}(W.features);let st=Xn(J);st.byteOffset===0&&st.byteLength===st.buffer.byteLength||(st=new Uint8Array(st)),z(null,{vectorTile:J,rawData:st.buffer})}oo.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},oo.prototype.splitTile=function(V,z,B,W,J,st,mt){for(var ut=[V,z,B,W],at=this.options,vt=at.debug;ut.length;){W=ut.pop(),B=ut.pop(),z=ut.pop(),V=ut.pop();var zt=1<<z,Bt=Gr(z,B,W),Vt=this.tiles[Bt];if(!Vt&&(vt>1&&console.time("creation"),Vt=this.tiles[Bt]=yi(V,z,B,W,at),this.tileCoords.push({z,x:B,y:W}),vt)){vt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",z,B,W,Vt.numFeatures,Vt.numPoints,Vt.numSimplified),console.timeEnd("creation"));var Ee="z"+z;this.stats[Ee]=(this.stats[Ee]||0)+1,this.total++}if(Vt.source=V,J){if(z===at.maxZoom||z===J)continue;var $e=1<<J-z;if(B!==Math.floor(st/$e)||W!==Math.floor(mt/$e))continue}else if(z===at.indexMaxZoom||Vt.numPoints<=at.indexMaxPoints)continue;if(Vt.source=null,V.length!==0){vt>1&&console.time("clipping");var Ce,ke,Ze,En,hn,In,Wn=.5*at.buffer/at.extent,Rr=.5-Wn,Te=.5+Wn,_r=1+Wn;Ce=ke=Ze=En=null,hn=Tr(V,zt,B-Wn,B+Te,0,Vt.minX,Vt.maxX,at),In=Tr(V,zt,B+Rr,B+_r,0,Vt.minX,Vt.maxX,at),V=null,hn&&(Ce=Tr(hn,zt,W-Wn,W+Te,1,Vt.minY,Vt.maxY,at),ke=Tr(hn,zt,W+Rr,W+_r,1,Vt.minY,Vt.maxY,at),hn=null),In&&(Ze=Tr(In,zt,W-Wn,W+Te,1,Vt.minY,Vt.maxY,at),En=Tr(In,zt,W+Rr,W+_r,1,Vt.minY,Vt.maxY,at),In=null),vt>1&&console.timeEnd("clipping"),ut.push(Ce||[],z+1,2*B,2*W),ut.push(ke||[],z+1,2*B,2*W+1),ut.push(Ze||[],z+1,2*B+1,2*W),ut.push(En||[],z+1,2*B+1,2*W+1)}}},oo.prototype.getTile=function(V,z,B){var W=this.options,J=W.extent,st=W.debug;if(V<0||V>24)return null;var mt=1<<V,ut=Gr(V,z=(z%mt+mt)%mt,B);if(this.tiles[ut])return on(this.tiles[ut],J);st>1&&console.log("drilling down to z%d-%d-%d",V,z,B);for(var at,vt=V,zt=z,Bt=B;!at&&vt>0;)vt--,zt=Math.floor(zt/2),Bt=Math.floor(Bt/2),at=this.tiles[Gr(vt,zt,Bt)];return at&&at.source?(st>1&&console.log("found parent tile z%d-%d-%d",vt,zt,Bt),st>1&&console.time("drilling down"),this.splitTile(at.source,vt,zt,Bt,V,z,B),st>1&&console.timeEnd("drilling down"),this.tiles[ut]?on(this.tiles[ut],J):null):null};class Wa extends H{constructor(z,B,W,J){super(z,B,W,Jn),this._dataUpdateable=new Map,this.loadGeoJSON=(st,mt)=>{const{promoteId:ut}=st;if(st.request)return u.getJSON(st.request,(at,vt,zt,Bt)=>{this._dataUpdateable=as(vt,ut)?Jr(vt,ut):void 0,mt(at,vt,zt,Bt)});if(typeof st.data=="string")try{const at=JSON.parse(st.data);this._dataUpdateable=as(at,ut)?Jr(at,ut):void 0,mt(null,at)}catch{mt(new Error(`Input data given to '${st.source}' is not a valid GeoJSON object.`))}else st.dataDiff?this._dataUpdateable?(function(at,vt,zt){var Bt,Vt,Ee,$e;if(vt.removeAll&&at.clear(),vt.remove)for(const Ce of vt.remove)at.delete(Ce);if(vt.add)for(const Ce of vt.add){const ke=Ii(Ce,zt);ke!=null&&at.set(ke,Ce)}if(vt.update)for(const Ce of vt.update){let ke=at.get(Ce.id);if(ke==null)continue;const Ze=!Ce.removeAllProperties&&(((Bt=Ce.removeProperties)===null||Bt===void 0?void 0:Bt.length)>0||((Vt=Ce.addOrUpdateProperties)===null||Vt===void 0?void 0:Vt.length)>0);if((Ce.newGeometry||Ce.removeAllProperties||Ze)&&(ke={...ke},at.set(Ce.id,ke),Ze&&(ke.properties={...ke.properties})),Ce.newGeometry&&(ke.geometry=Ce.newGeometry),Ce.removeAllProperties)ke.properties={};else if(((Ee=Ce.removeProperties)===null||Ee===void 0?void 0:Ee.length)>0)for(const En of Ce.removeProperties)Object.prototype.hasOwnProperty.call(ke.properties,En)&&delete ke.properties[En];if((($e=Ce.addOrUpdateProperties)===null||$e===void 0?void 0:$e.length)>0)for(const{key:En,value:hn}of Ce.addOrUpdateProperties)ke.properties[En]=hn}}(this._dataUpdateable,st.dataDiff,ut),mt(null,{type:"FeatureCollection",features:Array.from(this._dataUpdateable.values())})):mt(new Error(`Cannot update existing geojson data in ${st.source}`)):mt(new Error(`Input data given to '${st.source}' is not a valid GeoJSON object.`));return{cancel:()=>{}}},J&&(this.loadGeoJSON=J)}loadData(z,B){var W;(W=this._pendingRequest)===null||W===void 0||W.cancel(),this._pendingCallback&&this._pendingCallback(null,{abandoned:!0});const J=!!(z&&z.request&&z.request.collectResourceTiming)&&new u.RequestPerformance(z.request);this._pendingCallback=B,this._pendingRequest=this.loadGeoJSON(z,(st,mt)=>{if(delete this._pendingCallback,delete this._pendingRequest,st||!mt)return B(st);if(typeof mt!="object")return B(new Error(`Input data given to '${z.source}' is not a valid GeoJSON object.`));{dt(mt,!0);try{if(z.filter){const at=u.createExpression(z.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(at.result==="error")throw new Error(at.value.map(zt=>`${zt.key}: ${zt.message}`).join(", "));mt={type:"FeatureCollection",features:mt.features.filter(zt=>at.value.evaluate({zoom:0},zt))}}this._geoJSONIndex=z.cluster?new Uo(function({superclusterOptions:at,clusterProperties:vt}){if(!vt||!at)return at;const zt={},Bt={},Vt={accumulated:null,zoom:0},Ee={properties:null},$e=Object.keys(vt);for(const Ce of $e){const[ke,Ze]=vt[Ce],En=u.createExpression(Ze),hn=u.createExpression(typeof ke=="string"?[ke,["accumulated"],["get",Ce]]:ke);zt[Ce]=En.value,Bt[Ce]=hn.value}return at.map=Ce=>{Ee.properties=Ce;const ke={};for(const Ze of $e)ke[Ze]=zt[Ze].evaluate(Vt,Ee);return ke},at.reduce=(Ce,ke)=>{Ee.properties=ke;for(const Ze of $e)Vt.accumulated=Ce[Ze],Ce[Ze]=Bt[Ze].evaluate(Vt,Ee)},at}(z)).load(mt.features):function(at,vt){return new oo(at,vt)}(mt,z.geojsonVtOptions)}catch(at){return B(at)}this.loaded={};const ut={};if(J){const at=J.finish();at&&(ut.resourceTiming={},ut.resourceTiming[z.source]=JSON.parse(JSON.stringify(at)))}B(null,ut)}})}reloadTile(z,B){const W=this.loaded;return W&&W[z.uid]?super.reloadTile(z,B):this.loadTile(z,B)}removeSource(z,B){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),B()}getClusterExpansionZoom(z,B){try{B(null,this._geoJSONIndex.getClusterExpansionZoom(z.clusterId))}catch(W){B(W)}}getClusterChildren(z,B){try{B(null,this._geoJSONIndex.getChildren(z.clusterId))}catch(W){B(W)}}getClusterLeaves(z,B){try{B(null,this._geoJSONIndex.getLeaves(z.clusterId,z.limit,z.offset))}catch(W){B(W)}}}class Vo{constructor(z){this.self=z,this.actor=new u.Actor(z,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:H,geojson:Wa},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(B,W)=>{if(this.workerSourceTypes[B])throw new Error(`Worker source with name "${B}" already registered.`);this.workerSourceTypes[B]=W},this.self.registerRTLTextPlugin=B=>{if(u.plugin.isParsed())throw new Error("RTL text plugin already registered.");u.plugin.applyArabicShaping=B.applyArabicShaping,u.plugin.processBidirectionalText=B.processBidirectionalText,u.plugin.processStyledBidirectionalText=B.processStyledBidirectionalText}}setReferrer(z,B){this.referrer=B}setImages(z,B,W){this.availableImages[z]=B;for(const J in this.workerSources[z]){const st=this.workerSources[z][J];for(const mt in st)st[mt].availableImages=B}W()}setLayers(z,B,W){this.getLayerIndex(z).replace(B),W()}updateLayers(z,B,W){this.getLayerIndex(z).update(B.layers,B.removedIds),W()}loadTile(z,B,W){this.getWorkerSource(z,B.type,B.source).loadTile(B,W)}loadDEMTile(z,B,W){this.getDEMWorkerSource(z,B.source).loadTile(B,W)}reloadTile(z,B,W){this.getWorkerSource(z,B.type,B.source).reloadTile(B,W)}abortTile(z,B,W){this.getWorkerSource(z,B.type,B.source).abortTile(B,W)}removeTile(z,B,W){this.getWorkerSource(z,B.type,B.source).removeTile(B,W)}removeDEMTile(z,B){this.getDEMWorkerSource(z,B.source).removeTile(B)}removeSource(z,B,W){if(!this.workerSources[z]||!this.workerSources[z][B.type]||!this.workerSources[z][B.type][B.source])return;const J=this.workerSources[z][B.type][B.source];delete this.workerSources[z][B.type][B.source],J.removeSource!==void 0?J.removeSource(B,W):W()}loadWorkerSource(z,B,W){try{this.self.importScripts(B.url),W()}catch(J){W(J.toString())}}syncRTLPluginState(z,B,W){try{u.plugin.setState(B);const J=u.plugin.getPluginURL();if(u.plugin.isLoaded()&&!u.plugin.isParsed()&&J!=null){this.self.importScripts(J);const st=u.plugin.isParsed();W(st?void 0:new Error(`RTL Text Plugin failed to import scripts from ${J}`),st)}}catch(J){W(J.toString())}}getAvailableImages(z){let B=this.availableImages[z];return B||(B=[]),B}getLayerIndex(z){let B=this.layerIndexes[z];return B||(B=this.layerIndexes[z]=new I),B}getWorkerSource(z,B,W){if(this.workerSources[z]||(this.workerSources[z]={}),this.workerSources[z][B]||(this.workerSources[z][B]={}),!this.workerSources[z][B][W]){const J={send:(st,mt,ut)=>{this.actor.send(st,mt,ut,z)}};this.workerSources[z][B][W]=new this.workerSourceTypes[B](J,this.getLayerIndex(z),this.getAvailableImages(z))}return this.workerSources[z][B][W]}getDEMWorkerSource(z,B){return this.demWorkerSources[z]||(this.demWorkerSources[z]={}),this.demWorkerSources[z][B]||(this.demWorkerSources[z][B]=new j),this.demWorkerSources[z][B]}}return u.isWorker()&&(self.worker=new Vo(self)),Vo}),h(["./shared"],function(u){var I="3.1.0";class w{static testProp(i){if(!w.docStyle)return i[0];for(let c=0;c<i.length;c++)if(i[c]in w.docStyle)return i[c];return i[0]}static create(i,c,f){const m=window.document.createElement(i);return c!==void 0&&(m.className=c),f&&f.appendChild(m),m}static createNS(i,c){return window.document.createElementNS(i,c)}static disableDrag(){w.docStyle&&w.selectProp&&(w.userSelect=w.docStyle[w.selectProp],w.docStyle[w.selectProp]="none")}static enableDrag(){w.docStyle&&w.selectProp&&(w.docStyle[w.selectProp]=w.userSelect)}static setTransform(i,c){i.style[w.transformProp]=c}static addEventListener(i,c,f,m={}){i.addEventListener(c,f,"passive"in m?m:m.capture)}static removeEventListener(i,c,f,m={}){i.removeEventListener(c,f,"passive"in m?m:m.capture)}static suppressClickInternal(i){i.preventDefault(),i.stopPropagation(),window.removeEventListener("click",w.suppressClickInternal,!0)}static suppressClick(){window.addEventListener("click",w.suppressClickInternal,!0),window.setTimeout(()=>{window.removeEventListener("click",w.suppressClickInternal,!0)},0)}static mousePos(i,c){const f=i.getBoundingClientRect();return new u.Point(c.clientX-f.left-i.clientLeft,c.clientY-f.top-i.clientTop)}static touchPos(i,c){const f=i.getBoundingClientRect(),m=[];for(let x=0;x<c.length;x++)m.push(new u.Point(c[x].clientX-f.left-i.clientLeft,c[x].clientY-f.top-i.clientTop));return m}static mouseButton(i){return i.button}static remove(i){i.parentNode&&i.parentNode.removeChild(i)}}w.docStyle=typeof window<"u"&&window.document&&window.document.documentElement.style,w.selectProp=w.testProp(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]),w.transformProp=w.testProp(["transform","WebkitTransform"]);const D={supported:!1,testSupport:function(d){!H&&G&&(j?K(d):k=d)}};let k,G,H=!1,j=!1;function K(d){const i=d.createTexture();d.bindTexture(d.TEXTURE_2D,i);try{if(d.texImage2D(d.TEXTURE_2D,0,d.RGBA,d.RGBA,d.UNSIGNED_BYTE,G),d.isContextLost())return;D.supported=!0}catch{}d.deleteTexture(i),H=!0}var lt;typeof document<"u"&&(G=document.createElement("img"),G.onload=function(){k&&K(k),k=null,j=!0},G.onerror=function(){H=!0,k=null},G.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA="),function(d){let i,c,f,m;d.resetRequestQueue=()=>{i=[],c=0,f=0,m={}},d.addThrottleControl=A=>{const O=f++;return m[O]=A,O},d.removeThrottleControl=A=>{delete m[A],P()},d.getImage=(A,O,R=!0)=>{D.supported&&(A.headers||(A.headers={}),A.headers.accept="image/webp,*/*");const X={requestParameters:A,supportImageRefresh:R,callback:O,cancelled:!1,completed:!1,cancel:()=>{X.completed||X.cancelled||(X.cancelled=!0,X.innerRequest&&(X.innerRequest.cancel(),c--),P())}};return i.push(X),P(),X};const x=A=>{const{requestParameters:O,supportImageRefresh:R,callback:X}=A;return u.extend(O,{type:"image"}),(R!==!1||u.isWorker()||u.getProtocolAction(O.url)||O.headers&&!Object.keys(O.headers).reduce((et,$)=>et&&$==="accept",!0)?u.makeRequest:C)(O,(et,$,Q,ot)=>{S(A,X,et,$,Q,ot)})},S=(A,O,R,X,et,$)=>{R?O(R):X instanceof HTMLImageElement||X instanceof ImageBitmap?O(null,X):X&&((Q,ot)=>{typeof createImageBitmap=="function"?u.arrayBufferToImageBitmap(Q,ot):u.arrayBufferToImage(Q,ot)})(X,(Q,ot)=>{Q!=null?O(Q):ot!=null&&O(null,ot,{cacheControl:et,expires:$})}),A.cancelled||(A.completed=!0,c--,P())},P=()=>{const A=(()=>{const O=Object.keys(m);let R=!1;if(O.length>0){for(const X of O)if(R=m[X](),R)break}return R})()?u.config.MAX_PARALLEL_IMAGE_REQUESTS_PER_FRAME:u.config.MAX_PARALLEL_IMAGE_REQUESTS;for(let O=c;O<A&&i.length>0;O++){const R=i.shift();if(R.cancelled){O--;continue}const X=x(R);c++,R.innerRequest=X}},C=(A,O)=>{const R=new Image,X=A.url;let et=!1;const $=A.credentials;return $&&$==="include"?R.crossOrigin="use-credentials":($&&$==="same-origin"||!u.sameOrigin(X))&&(R.crossOrigin="anonymous"),R.fetchPriority="high",R.onload=()=>{O(null,R),R.onerror=R.onload=null},R.onerror=()=>{et||O(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")),R.onerror=R.onload=null},R.src=X,{cancel:()=>{et=!0,R.src=""}}}}(lt||(lt={})),lt.resetRequestQueue();var dt,xt=lt;(function(d){d.Glyphs="Glyphs",d.Image="Image",d.Source="Source",d.SpriteImage="SpriteImage",d.SpriteJSON="SpriteJSON",d.Style="Style",d.Tile="Tile",d.Unknown="Unknown"})(dt||(dt={}));class gt{constructor(i){this._transformRequestFn=i}transformRequest(i,c){return this._transformRequestFn&&this._transformRequestFn(i,c)||{url:i}}normalizeSpriteURL(i,c,f){const m=function(x){const S=x.match(yt);if(!S)throw new Error(`Unable to parse URL "${x}"`);return{protocol:S[1],authority:S[2],path:S[3]||"/",params:S[4]?S[4].split("&"):[]}}(i);return m.path+=`${c}${f}`,function(x){const S=x.params.length?`?${x.params.join("&")}`:"";return`${x.protocol}://${x.authority}${x.path}${S}`}(m)}setTransformRequest(i){this._transformRequestFn=i}}const yt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Nt(d){var i=new u.ARRAY_TYPE(3);return i[0]=d[0],i[1]=d[1],i[2]=d[2],i}var Gt,Ut=function(d,i,c){return d[0]=i[0]-c[0],d[1]=i[1]-c[1],d[2]=i[2]-c[2],d};Gt=new u.ARRAY_TYPE(3),u.ARRAY_TYPE!=Float32Array&&(Gt[0]=0,Gt[1]=0,Gt[2]=0);var Zt=function(d){var i=d[0],c=d[1];return i*i+c*c};function qt(d){const i=[];if(typeof d=="string")i.push({id:"default",url:d});else if(d&&d.length>0){const c=[];for(const{id:f,url:m}of d){const x=`${f}${m}`;c.indexOf(x)===-1&&(c.push(x),i.push({id:f,url:m}))}}return i}function Qt(d,i,c,f,m){if(f)return void d(f);if(m!==Object.values(i).length||m!==Object.values(c).length)return;const x={};for(const S in i){x[S]={};const P=u.exported.getImageCanvasContext(c[S]),C=i[S];for(const A in C){const{width:O,height:R,x:X,y:et,sdf:$,pixelRatio:Q,stretchX:ot,stretchY:pt,content:Pt}=C[A];x[S][A]={data:null,pixelRatio:Q,sdf:$,stretchX:ot,stretchY:pt,content:Pt,spriteData:{width:O,height:R,x:X,y:et,context:P}}}}d(null,x)}(function(){var d=new u.ARRAY_TYPE(2);u.ARRAY_TYPE!=Float32Array&&(d[0]=0,d[1]=0)})();class ie{constructor(i,c,f,m){this.context=i,this.format=f,this.texture=i.gl.createTexture(),this.update(c,m)}update(i,c,f){const{width:m,height:x}=i,S=!(this.size&&this.size[0]===m&&this.size[1]===x||f),{context:P}=this,{gl:C}=P;if(this.useMipmap=!!(c&&c.useMipmap),C.bindTexture(C.TEXTURE_2D,this.texture),P.pixelStoreUnpackFlipY.set(!1),P.pixelStoreUnpack.set(1),P.pixelStoreUnpackPremultiplyAlpha.set(this.format===C.RGBA&&(!c||c.premultiply!==!1)),S)this.size=[m,x],i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||u.isImageBitmap(i)?C.texImage2D(C.TEXTURE_2D,0,this.format,this.format,C.UNSIGNED_BYTE,i):C.texImage2D(C.TEXTURE_2D,0,this.format,m,x,0,this.format,C.UNSIGNED_BYTE,i.data);else{const{x:A,y:O}=f||{x:0,y:0};i instanceof HTMLImageElement||i instanceof HTMLCanvasElement||i instanceof HTMLVideoElement||i instanceof ImageData||u.isImageBitmap(i)?C.texSubImage2D(C.TEXTURE_2D,0,A,O,C.RGBA,C.UNSIGNED_BYTE,i):C.texSubImage2D(C.TEXTURE_2D,0,A,O,m,x,C.RGBA,C.UNSIGNED_BYTE,i.data)}this.useMipmap&&this.isSizePowerOfTwo()&&C.generateMipmap(C.TEXTURE_2D)}bind(i,c,f){const{context:m}=this,{gl:x}=m;x.bindTexture(x.TEXTURE_2D,this.texture),f!==x.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(f=x.LINEAR),i!==this.filter&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MAG_FILTER,i),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_MIN_FILTER,f||i),this.filter=i),c!==this.wrap&&(x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_S,c),x.texParameteri(x.TEXTURE_2D,x.TEXTURE_WRAP_T,c),this.wrap=c)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:i}=this.context;i.deleteTexture(this.texture),this.texture=null}}function ve(d){const{userImage:i}=d;return!!(i&&i.render&&i.render())&&(d.data.replace(new Uint8Array(i.data.buffer)),!0)}class Ue extends u.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new u.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:c,callback:f}of this.requestors)this._notify(c,f);this.requestors=[]}}getImage(i){const c=this.images[i];if(c&&!c.data&&c.spriteData){const f=c.spriteData;c.data=new u.RGBAImage({width:f.width,height:f.height},f.context.getImageData(f.x,f.y,f.width,f.height).data),c.spriteData=null}return c}addImage(i,c){if(this.images[i])throw new Error(`Image id ${i} already exist, use updateImage instead`);this._validate(i,c)&&(this.images[i]=c)}_validate(i,c){let f=!0;const m=c.data||c.spriteData;return this._validateStretch(c.stretchX,m&&m.width)||(this.fire(new u.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,m&&m.height)||(this.fire(new u.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new u.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),f=!1),f}_validateStretch(i,c){if(!i)return!0;let f=0;for(const m of i){if(m[0]<f||m[1]<m[0]||c<m[1])return!1;f=m[1]}return!0}_validateContent(i,c){if(!i)return!0;if(i.length!==4)return!1;const f=c.spriteData,m=f&&f.width||c.data.width,x=f&&f.height||c.data.height;return!(i[0]<0||m<i[0]||i[1]<0||x<i[1]||i[2]<0||m<i[2]||i[3]<0||x<i[3]||i[2]<i[0]||i[3]<i[1])}updateImage(i,c,f=!0){const m=this.getImage(i);if(f&&(m.data.width!==c.data.width||m.data.height!==c.data.height))throw new Error(`size mismatch between old image (${m.data.width}x${m.data.height}) and new image (${c.data.width}x${c.data.height}).`);c.version=m.version+1,this.images[i]=c,this.updatedImages[i]=!0}removeImage(i){const c=this.images[i];delete this.images[i],delete this.patterns[i],c.userImage&&c.userImage.onRemove&&c.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,c){let f=!0;if(!this.isLoaded())for(const m of i)this.images[m]||(f=!1);this.isLoaded()||f?this._notify(i,c):this.requestors.push({ids:i,callback:c})}_notify(i,c){const f={};for(const m of i){let x=this.getImage(m);x||(this.fire(new u.Event("styleimagemissing",{id:m})),x=this.getImage(m)),x?f[m]={data:x.data.clone(),pixelRatio:x.pixelRatio,sdf:x.sdf,version:x.version,stretchX:x.stretchX,stretchY:x.stretchY,content:x.content,hasRenderCallback:!!(x.userImage&&x.userImage.render)}:u.warnOnce(`Image "${m}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}c(null,f)}getPixelSize(){const{width:i,height:c}=this.atlasImage;return{width:i,height:c}}getPattern(i){const c=this.patterns[i],f=this.getImage(i);if(!f)return null;if(c&&c.position.version===f.version)return c.position;if(c)c.position.version=f.version;else{const m={w:f.data.width+2,h:f.data.height+2,x:0,y:0},x=new u.ImagePosition(m,f);this.patterns[i]={bin:m,position:x}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const c=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new ie(i,this.atlasImage,c.RGBA),this.atlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const x in this.patterns)i.push(this.patterns[x].bin);const{w:c,h:f}=u.potpack(i),m=this.atlasImage;m.resize({width:c||1,height:f||1});for(const x in this.patterns){const{bin:S}=this.patterns[x],P=S.x+1,C=S.y+1,A=this.getImage(x).data,O=A.width,R=A.height;u.RGBAImage.copy(A,m,{x:0,y:0},{x:P,y:C},{width:O,height:R}),u.RGBAImage.copy(A,m,{x:0,y:R-1},{x:P,y:C-1},{width:O,height:1}),u.RGBAImage.copy(A,m,{x:0,y:0},{x:P,y:C+R},{width:O,height:1}),u.RGBAImage.copy(A,m,{x:O-1,y:0},{x:P-1,y:C},{width:1,height:R}),u.RGBAImage.copy(A,m,{x:0,y:0},{x:P+O,y:C},{width:1,height:R})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const c of i){if(this.callbackDispatchedThisFrame[c])continue;this.callbackDispatchedThisFrame[c]=!0;const f=this.getImage(c);f||u.warnOnce(`Image with ID: "${c}" was not found`),ve(f)&&this.updateImage(c,f)}}}const Rt=1e20;function Se(d,i,c,f,m,x,S,P,C){for(let A=i;A<i+f;A++)Ye(d,c*x+A,x,m,S,P,C);for(let A=c;A<c+m;A++)Ye(d,A*x+i,1,f,S,P,C)}function Ye(d,i,c,f,m,x,S){x[0]=0,S[0]=-Rt,S[1]=Rt,m[0]=d[i];for(let P=1,C=0,A=0;P<f;P++){m[P]=d[i+P*c];const O=P*P;do{const R=x[C];A=(m[P]-m[R]+O-R*R)/(P-R)/2}while(A<=S[C]&&--C>-1);C++,x[C]=P,S[C]=A,S[C+1]=Rt}for(let P=0,C=0;P<f;P++){for(;S[C+1]<P;)C++;const A=x[C],O=P-A;d[i+P*c]=m[A]+O*O}}class yn{constructor(i,c){this.requestManager=i,this.localIdeographFontFamily=c,this.entries={}}setURL(i){this.url=i}getGlyphs(i,c){const f=[];for(const m in i)for(const x of i[m])f.push({stack:m,id:x});u.asyncAll(f,({stack:m,id:x},S)=>{let P=this.entries[m];P||(P=this.entries[m]={glyphs:{},requests:{},ranges:{}});let C=P.glyphs[x];if(C!==void 0)return void S(null,{stack:m,id:x,glyph:C});if(C=this._tinySDF(P,m,x),C)return P.glyphs[x]=C,void S(null,{stack:m,id:x,glyph:C});const A=Math.floor(x/256);if(256*A>65535)return void S(new Error("glyphs > 65535 not supported"));if(P.ranges[A])return void S(null,{stack:m,id:x,glyph:C});if(!this.url)return void S(new Error("glyphsUrl is not set"));let O=P.requests[A];O||(O=P.requests[A]=[],yn.loadGlyphRange(m,A,this.url,this.requestManager,(R,X)=>{if(X){for(const et in X)this._doesCharSupportLocalGlyph(+et)||(P.glyphs[+et]=X[+et]);P.ranges[A]=!0}for(const et of O)et(R,X);delete P.requests[A]})),O.push((R,X)=>{R?S(R):X&&S(null,{stack:m,id:x,glyph:X[x]||null})})},(m,x)=>{if(m)c(m);else if(x){const S={};for(const{stack:P,id:C,glyph:A}of x)(S[P]||(S[P]={}))[C]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics};c(null,S)}})}_doesCharSupportLocalGlyph(i){return!!this.localIdeographFontFamily&&(u.unicodeBlockLookup["CJK Unified Ideographs"](i)||u.unicodeBlockLookup["Hangul Syllables"](i)||u.unicodeBlockLookup.Hiragana(i)||u.unicodeBlockLookup.Katakana(i))}_tinySDF(i,c,f){const m=this.localIdeographFontFamily;if(!m||!this._doesCharSupportLocalGlyph(f))return;let x=i.tinySDF;if(!x){let P="400";/bold/i.test(c)?P="900":/medium/i.test(c)?P="500":/light/i.test(c)&&(P="200"),x=i.tinySDF=new yn.TinySDF({fontSize:24,buffer:3,radius:8,cutoff:.25,fontFamily:m,fontWeight:P})}const S=x.draw(String.fromCharCode(f));return{id:f,bitmap:new u.AlphaImage({width:S.width||30,height:S.height||30},S.data),metrics:{width:S.glyphWidth||24,height:S.glyphHeight||24,left:S.glyphLeft||0,top:S.glyphTop-27||-8,advance:S.glyphAdvance||24}}}}yn.loadGlyphRange=function(d,i,c,f,m){const x=256*i,S=x+255,P=f.transformRequest(c.replace("{fontstack}",d).replace("{range}",`${x}-${S}`),dt.Glyphs);u.getArrayBuffer(P,(C,A)=>{if(C)m(C);else if(A){const O={};for(const R of u.parseGlyphPbf(A))O[R.id]=R;m(null,O)}})},yn.TinySDF=class{constructor({fontSize:d=24,buffer:i=3,radius:c=8,cutoff:f=.25,fontFamily:m="sans-serif",fontWeight:x="normal",fontStyle:S="normal"}={}){this.buffer=i,this.cutoff=f,this.radius=c;const P=this.size=d+4*i,C=this._createCanvas(P),A=this.ctx=C.getContext("2d",{willReadFrequently:!0});A.font=`${S} ${x} ${d}px ${m}`,A.textBaseline="alphabetic",A.textAlign="left",A.fillStyle="black",this.gridOuter=new Float64Array(P*P),this.gridInner=new Float64Array(P*P),this.f=new Float64Array(P),this.z=new Float64Array(P+1),this.v=new Uint16Array(P)}_createCanvas(d){const i=document.createElement("canvas");return i.width=i.height=d,i}draw(d){const{width:i,actualBoundingBoxAscent:c,actualBoundingBoxDescent:f,actualBoundingBoxLeft:m,actualBoundingBoxRight:x}=this.ctx.measureText(d),S=Math.ceil(c),P=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(x-m))),C=Math.min(this.size-this.buffer,S+Math.ceil(f)),A=P+2*this.buffer,O=C+2*this.buffer,R=Math.max(A*O,0),X=new Uint8ClampedArray(R),et={data:X,width:A,height:O,glyphWidth:P,glyphHeight:C,glyphTop:S,glyphLeft:0,glyphAdvance:i};if(P===0||C===0)return et;const{ctx:$,buffer:Q,gridInner:ot,gridOuter:pt}=this;$.clearRect(Q,Q,P,C),$.fillText(d,Q,Q+S);const Pt=$.getImageData(Q,Q,P,C);pt.fill(Rt,0,R),ot.fill(0,0,R);for(let rt=0;rt<C;rt++)for(let Tt=0;Tt<P;Tt++){const Lt=Pt.data[4*(rt*P+Tt)+3]/255;if(Lt===0)continue;const jt=(rt+Q)*A+Tt+Q;if(Lt===1)pt[jt]=0,ot[jt]=Rt;else{const Ht=.5-Lt;pt[jt]=Ht>0?Ht*Ht:0,ot[jt]=Ht<0?Ht*Ht:0}}Se(pt,0,0,A,O,A,this.f,this.v,this.z),Se(ot,Q,Q,P,C,A,this.f,this.v,this.z);for(let rt=0;rt<R;rt++){const Tt=Math.sqrt(pt[rt])-Math.sqrt(ot[rt]);X[rt]=Math.round(255-255*(Tt/this.radius+this.cutoff))}return et}};class tr{constructor(){this.specification=u.v8Spec.light.position}possiblyEvaluate(i,c){return u.sphericalToCartesian(i.expression.evaluate(c))}interpolate(i,c,f){return{x:u.interpolate.number(i.x,c.x,f),y:u.interpolate.number(i.y,c.y,f),z:u.interpolate.number(i.z,c.z,f)}}}let Xn,_i;class An extends u.Evented{constructor(i){super(),Xn=Xn||new u.Properties({anchor:new u.DataConstantProperty(u.v8Spec.light.anchor),position:new tr,color:new u.DataConstantProperty(u.v8Spec.light.color),intensity:new u.DataConstantProperty(u.v8Spec.light.intensity)}),this._transitionable=new u.Transitionable(Xn),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,c={}){if(!this._validate(u.validateLight,i,c))for(const f in i){const m=i[f];f.endsWith("-transition")?this._transitionable.setTransition(f.slice(0,-11),m):this._transitionable.setValue(f,m)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,f){return(!f||f.validate!==!1)&&u.emitValidationErrors(this,i.call(u.validateStyle,u.extend({value:c,style:{glyphs:!0,sprite:!0},styleSpec:u.v8Spec})))}}class pr{constructor(i,c){this.width=i,this.height=c,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}}getDash(i,c){const f=i.join(",")+String(c);return this.dashEntry[f]||(this.dashEntry[f]=this.addDash(i,c)),this.dashEntry[f]}getDashRanges(i,c,f){const m=[];let x=i.length%2==1?-i[i.length-1]*f:0,S=i[0]*f,P=!0;m.push({left:x,right:S,isDash:P,zeroLength:i[0]===0});let C=i[0];for(let A=1;A<i.length;A++){P=!P;const O=i[A];x=C*f,C+=O,S=C*f,m.push({left:x,right:S,isDash:P,zeroLength:O===0})}return m}addRoundDash(i,c,f){const m=c/2;for(let x=-f;x<=f;x++){const S=this.width*(this.nextRow+f+x);let P=0,C=i[P];for(let A=0;A<this.width;A++){A/C.right>1&&(C=i[++P]);const O=Math.abs(A-C.left),R=Math.abs(A-C.right),X=Math.min(O,R);let et;const $=x/f*(m+1);if(C.isDash){const Q=m-Math.abs($);et=Math.sqrt(X*X+Q*Q)}else et=m-Math.sqrt(X*X+$*$);this.data[S+A]=Math.max(0,Math.min(255,et+128))}}}addRegularDash(i){for(let P=i.length-1;P>=0;--P){const C=i[P],A=i[P+1];C.zeroLength?i.splice(P,1):A&&A.isDash===C.isDash&&(A.left=C.left,i.splice(P,1))}const c=i[0],f=i[i.length-1];c.isDash===f.isDash&&(c.left=f.left-this.width,f.right=c.right+this.width);const m=this.width*this.nextRow;let x=0,S=i[x];for(let P=0;P<this.width;P++){P/S.right>1&&(S=i[++x]);const C=Math.abs(P-S.left),A=Math.abs(P-S.right),O=Math.min(C,A);this.data[m+P]=Math.max(0,Math.min(255,(S.isDash?O:-O)+128))}}addDash(i,c){const f=c?7:0,m=2*f+1;if(this.nextRow+m>this.height)return u.warnOnce("LineAtlas out of space"),null;let x=0;for(let P=0;P<i.length;P++)x+=i[P];if(x!==0){const P=this.width/x,C=this.getDashRanges(i,this.width,P);c?this.addRoundDash(C,P,f):this.addRegularDash(C)}const S={y:(this.nextRow+f+.5)/this.height,height:2*f/this.height,width:x};return this.nextRow+=m,this.dirty=!0,S}bind(i){const c=i.gl;this.texture?(c.bindTexture(c.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,c.texSubImage2D(c.TEXTURE_2D,0,0,0,this.width,this.height,c.ALPHA,c.UNSIGNED_BYTE,this.data))):(this.texture=c.createTexture(),c.bindTexture(c.TEXTURE_2D,this.texture),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_S,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_WRAP_T,c.REPEAT),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MIN_FILTER,c.LINEAR),c.texParameteri(c.TEXTURE_2D,c.TEXTURE_MAG_FILTER,c.LINEAR),c.texImage2D(c.TEXTURE_2D,0,c.ALPHA,this.width,this.height,0,c.ALPHA,c.UNSIGNED_BYTE,this.data))}}class wn{constructor(i,c,f){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=f;const m=this.workerPool.acquire(f);for(let x=0;x<m.length;x++){const S=new wn.Actor(m[x],c,f);S.name=`Worker ${x}`,this.actors.push(S)}if(!this.actors.length)throw new Error("No actors found")}broadcast(i,c,f){u.asyncAll(this.actors,(m,x)=>{m.send(i,c,x)},f=f||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(i=!0){this.actors.forEach(c=>{c.remove()}),this.actors=[],i&&this.workerPool.release(this.id)}}function Yn(d,i,c){const f=function(m,x){if(m)return c(m);if(x){const S=u.pick(u.extend(x,d),["tiles","minzoom","maxzoom","attribution","bounds","scheme","tileSize","encoding"]);x.vector_layers&&(S.vectorLayers=x.vector_layers,S.vectorLayerIds=S.vectorLayers.map(P=>P.id)),c(null,S)}};return d.url?u.getJSON(i.transformRequest(d.url,dt.Source),f):u.exported.frame(()=>f(null,d))}wn.Actor=u.Actor;class ur{constructor(i,c){i&&(c?this.setSouthWest(i).setNorthEast(c):Array.isArray(i)&&(i.length===4?this.setSouthWest([i[0],i[1]]).setNorthEast([i[2],i[3]]):this.setSouthWest(i[0]).setNorthEast(i[1])))}setNorthEast(i){return this._ne=i instanceof u.LngLat?new u.LngLat(i.lng,i.lat):u.LngLat.convert(i),this}setSouthWest(i){return this._sw=i instanceof u.LngLat?new u.LngLat(i.lng,i.lat):u.LngLat.convert(i),this}extend(i){const c=this._sw,f=this._ne;let m,x;if(i instanceof u.LngLat)m=i,x=i;else{if(!(i instanceof ur))return Array.isArray(i)?i.length===4||i.every(Array.isArray)?this.extend(ur.convert(i)):this.extend(u.LngLat.convert(i)):i&&("lng"in i||"lon"in i)&&"lat"in i?this.extend(u.LngLat.convert(i)):this;if(m=i._sw,x=i._ne,!m||!x)return this}return c||f?(c.lng=Math.min(m.lng,c.lng),c.lat=Math.min(m.lat,c.lat),f.lng=Math.max(x.lng,f.lng),f.lat=Math.max(x.lat,f.lat)):(this._sw=new u.LngLat(m.lng,m.lat),this._ne=new u.LngLat(x.lng,x.lat)),this}getCenter(){return new u.LngLat((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new u.LngLat(this.getWest(),this.getNorth())}getSouthEast(){return new u.LngLat(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(i){const{lng:c,lat:f}=u.LngLat.convert(i);let m=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(m=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=f&&f<=this._ne.lat&&m}static convert(i){return i instanceof ur?i:i&&new ur(i)}static fromLngLat(i,c=0){const f=360*c/40075017,m=f/Math.cos(Math.PI/180*i.lat);return new ur(new u.LngLat(i.lng-m,i.lat-f),new u.LngLat(i.lng+m,i.lat+f))}}class Uo{constructor(i,c,f){this.bounds=ur.convert(this.validateBounds(i)),this.minzoom=c||0,this.maxzoom=f||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const c=Math.pow(2,i.z),f=Math.floor(u.mercatorXfromLng(this.bounds.getWest())*c),m=Math.floor(u.mercatorYfromLat(this.bounds.getNorth())*c),x=Math.ceil(u.mercatorXfromLng(this.bounds.getEast())*c),S=Math.ceil(u.mercatorYfromLat(this.bounds.getSouth())*c);return i.x>=f&&i.x<x&&i.y>=m&&i.y<S}}class Ur extends u.Evented{constructor(i,c,f,m){if(super(),this.id=i,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,u.extend(this,u.pick(c,["url","scheme","tileSize","promoteId"])),this._options=u.extend({type:"vector"},c),this._collectResourceTiming=c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(m)}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yn(this._options,this.map._requestManager,(i,c)=>{this._tileJSONRequest=null,this._loaded=!0,this.map.style.sourceCaches[this.id].clearTiles(),i?this.fire(new u.ErrorEvent(i)):c&&(u.extend(this,c),c.bounds&&(this.tileBounds=new Uo(c.bounds,this.minzoom,this.maxzoom)),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}setSourceProperty(i){this._tileJSONRequest&&this._tileJSONRequest.cancel(),i(),this.load()}setTiles(i){return this.setSourceProperty(()=>{this._options.tiles=i}),this}setUrl(i){return this.setSourceProperty(()=>{this.url=i,this._options.url=i}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}loadTile(i,c){const f=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme),m={request:this.map._requestManager.transformRequest(f,dt.Tile),uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function x(S,P){return delete i.request,i.aborted?c(null):S&&S.status!==404?c(S):(P&&P.resourceTiming&&(i.resourceTiming=P.resourceTiming),this.map._refreshExpiredTiles&&P&&i.setExpiryData(P),i.loadVectorData(P,this.map.painter),c(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}m.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired"?i.state==="loading"?i.reloadCallback=c:i.request=i.actor.send("reloadTile",m,x.bind(this)):(i.actor=this.dispatcher.getActor(),i.request=i.actor.send("loadTile",m,x.bind(this)))}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id},void 0)}unloadTile(i){i.unloadVectorData(),i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id},void 0)}hasTransition(){return!1}}class Qe extends u.Evented{constructor(i,c,f,m){super(),this.id=i,this.dispatcher=f,this.setEventedParent(m),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=u.extend({type:"raster"},c),u.extend(this,u.pick(c,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Yn(this._options,this.map._requestManager,(i,c)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new u.ErrorEvent(i)):c&&(u.extend(this,c),c.bounds&&(this.tileBounds=new Uo(c.bounds,this.minzoom,this.maxzoom)),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return u.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,c){const f=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);i.request=xt.getImage(this.map._requestManager.transformRequest(f,dt.Tile),(m,x,S)=>{if(delete i.request,i.aborted)i.state="unloaded",c(null);else if(m)i.state="errored",c(m);else if(x){this.map._refreshExpiredTiles&&S&&i.setExpiryData(S);const P=this.map.painter.context,C=P.gl;i.texture=this.map.painter.getTileTexture(x.width),i.texture?i.texture.update(x,{useMipmap:!0}):(i.texture=new ie(P,x,C.RGBA,{useMipmap:!0}),i.texture.bind(C.LINEAR,C.CLAMP_TO_EDGE,C.LINEAR_MIPMAP_NEAREST),P.extTextureFilterAnisotropic&&C.texParameterf(C.TEXTURE_2D,P.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,P.extTextureFilterAnisotropicMax)),i.state="loaded",c(null)}},this.map._refreshExpiredTiles)}abortTile(i,c){i.request&&(i.request.cancel(),delete i.request),c()}unloadTile(i,c){i.texture&&this.map.painter.saveTileTexture(i.texture),c()}hasTransition(){return!1}}class Ni extends Qe{constructor(i,c,f,m){super(i,c,f,m),this.type="raster-dem",this.maxzoom=22,this._options=u.extend({type:"raster-dem"},c),this.encoding=c.encoding||"mapbox"}serialize(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}}loadTile(i,c){const f=i.tileID.canonical.url(this.tiles,this.map.getPixelRatio(),this.scheme);function m(x,S){x&&(i.state="errored",c(x)),S&&(i.dem=S,i.needsHillshadePrepare=!0,i.needsTerrainPrepare=!0,i.state="loaded",c(null))}i.request=xt.getImage(this.map._requestManager.transformRequest(f,dt.Tile),function(x,S){if(delete i.request,i.aborted)i.state="unloaded",c(null);else if(x)i.state="errored",c(x);else if(S){this.map._refreshExpiredTiles&&i.setExpiryData(S),delete S.cacheControl,delete S.expires;const P=u.isImageBitmap(S)&&(_i==null&&(_i=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")&&typeof createImageBitmap=="function"),_i)?S:u.exported.getImageData(S,1),C={uid:i.uid,coord:i.tileID,source:this.id,rawImageData:P,encoding:this.encoding};i.actor&&i.state!=="expired"||(i.actor=this.dispatcher.getActor(),i.actor.send("loadDEMTile",C,m.bind(this)))}}.bind(this),this.map._refreshExpiredTiles),i.neighboringTiles=this._getNeighboringTiles(i.tileID)}_getNeighboringTiles(i){const c=i.canonical,f=Math.pow(2,c.z),m=(c.x-1+f)%f,x=c.x===0?i.wrap-1:i.wrap,S=(c.x+1+f)%f,P=c.x+1===f?i.wrap+1:i.wrap,C={};return C[new u.OverscaledTileID(i.overscaledZ,x,c.z,m,c.y).key]={backfilled:!1},C[new u.OverscaledTileID(i.overscaledZ,P,c.z,S,c.y).key]={backfilled:!1},c.y>0&&(C[new u.OverscaledTileID(i.overscaledZ,x,c.z,m,c.y-1).key]={backfilled:!1},C[new u.OverscaledTileID(i.overscaledZ,i.wrap,c.z,c.x,c.y-1).key]={backfilled:!1},C[new u.OverscaledTileID(i.overscaledZ,P,c.z,S,c.y-1).key]={backfilled:!1}),c.y+1<f&&(C[new u.OverscaledTileID(i.overscaledZ,x,c.z,m,c.y+1).key]={backfilled:!1},C[new u.OverscaledTileID(i.overscaledZ,i.wrap,c.z,c.x,c.y+1).key]={backfilled:!1},C[new u.OverscaledTileID(i.overscaledZ,P,c.z,S,c.y+1).key]={backfilled:!1}),C}unloadTile(i){i.demTexture&&this.map.painter.saveTileTexture(i.demTexture),i.fbo&&(i.fbo.destroy(),delete i.fbo),i.dem&&delete i.dem,delete i.neighboringTiles,i.state="unloaded",i.actor&&i.actor.send("removeDEMTile",{uid:i.uid,source:this.id})}}class _n extends u.Evented{constructor(i,c,f,m){super(),this.id=i,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._pendingLoads=0,this.actor=f.getActor(),this.setEventedParent(m),this._data=c.data,this._options=u.extend({},c),this._collectResourceTiming=c.collectResourceTiming,c.maxzoom!==void 0&&(this.maxzoom=c.maxzoom),c.type&&(this.type=c.type),c.attribution&&(this.attribution=c.attribution),this.promoteId=c.promoteId;const x=u.EXTENT/this.tileSize;this.workerOptions=u.extend({source:this.id,cluster:c.cluster||!1,geojsonVtOptions:{buffer:(c.buffer!==void 0?c.buffer:128)*x,tolerance:(c.tolerance!==void 0?c.tolerance:.375)*x,extent:u.EXTENT,maxZoom:this.maxzoom,lineMetrics:c.lineMetrics||!1,generateId:c.generateId||!1},superclusterOptions:{maxZoom:c.clusterMaxZoom!==void 0?c.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,c.clusterMinPoints||2),extent:u.EXTENT,radius:(c.clusterRadius||50)*x,log:!1,generateId:c.generateId||!1},clusterProperties:c.clusterProperties,filter:c.filter},c.workerOptions),typeof this.promoteId=="string"&&(this.workerOptions.promoteId=this.promoteId)}load(){this._updateWorkerData()}onAdd(i){this.map=i,this.load()}setData(i){return this._data=i,this._updateWorkerData(),this}updateData(i){return this._updateWorkerData(i),this}setClusterOptions(i){return this.workerOptions.cluster=i.cluster,i&&(i.clusterRadius!==void 0&&(this.workerOptions.superclusterOptions.radius=i.clusterRadius),i.clusterMaxZoom!==void 0&&(this.workerOptions.superclusterOptions.maxZoom=i.clusterMaxZoom)),this._updateWorkerData(),this}getClusterExpansionZoom(i,c){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:i,source:this.id},c),this}getClusterChildren(i,c){return this.actor.send("geojson.getClusterChildren",{clusterId:i,source:this.id},c),this}getClusterLeaves(i,c,f,m){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:i,limit:c,offset:f},m),this}_updateWorkerData(i){const c=u.extend({},this.workerOptions);i?c.dataDiff=i:typeof this._data=="string"?(c.request=this.map._requestManager.transformRequest(u.exported.resolveURL(this._data),dt.Source),c.request.collectResourceTiming=this._collectResourceTiming):c.data=JSON.stringify(this._data),this._pendingLoads++,this.fire(new u.Event("dataloading",{dataType:"source"})),this.actor.send(`${this.type}.loadData`,c,(f,m)=>{if(this._pendingLoads--,this._removed||m&&m.abandoned)return void this.fire(new u.Event("dataabort",{dataType:"source"}));let x=null;if(m&&m.resourceTiming&&m.resourceTiming[this.id]&&(x=m.resourceTiming[this.id].slice(0)),f)return void this.fire(new u.ErrorEvent(f));const S={dataType:"source"};this._collectResourceTiming&&x&&x.length>0&&u.extend(S,{resourceTiming:x}),this.fire(new u.Event("data",{...S,sourceDataType:"metadata"})),this.fire(new u.Event("data",{...S,sourceDataType:"content"}))})}loaded(){return this._pendingLoads===0}loadTile(i,c){const f=i.actor?"reloadTile":"loadTile";i.actor=this.actor;const m={type:this.type,uid:i.uid,tileID:i.tileID,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:this.map.getPixelRatio(),showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};i.request=this.actor.send(f,m,(x,S)=>(delete i.request,i.unloadVectorData(),i.aborted?c(null):x?c(x):(i.loadVectorData(S,this.map.painter,f==="reloadTile"),c(null))))}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.aborted=!0}unloadTile(i){i.unloadVectorData(),this.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id})}onRemove(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})}serialize(){return u.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}}var cr=u.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);class We extends u.Evented{constructor(i,c,f,m){super(),this.id=i,this.dispatcher=f,this.coordinates=c.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(m),this.options=c}load(i,c){this._loaded=!1,this.fire(new u.Event("dataloading",{dataType:"source"})),this.url=this.options.url,this._request=xt.getImage(this.map._requestManager.transformRequest(this.url,dt.Image),(f,m)=>{this._request=null,this._loaded=!0,f?this.fire(new u.ErrorEvent(f)):m&&(this.image=m,i&&(this.coordinates=i),c&&c(),this._finishLoading())})}loaded(){return this._loaded}updateImage(i){return i.url?(this._request&&(this._request.cancel(),this._request=null),this.options.url=i.url,this.load(i.coordinates,()=>{this.texture=null}),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this._request&&(this._request.cancel(),this._request=null)}setCoordinates(i){this.coordinates=i;const c=i.map(u.MercatorCoordinate.fromLngLat);this.tileID=function(m){let x=1/0,S=1/0,P=-1/0,C=-1/0;for(const X of m)x=Math.min(x,X.x),S=Math.min(S,X.y),P=Math.max(P,X.x),C=Math.max(C,X.y);const A=Math.max(P-x,C-S),O=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),R=Math.pow(2,O);return new u.CanonicalTileID(O,Math.floor((x+P)/2*R),Math.floor((S+C)/2*R))}(c),this.minzoom=this.maxzoom=this.tileID.z;const f=c.map(m=>this.tileID.getTilePoint(m)._round());return this._boundsArray=new u.RasterBoundsArray,this._boundsArray.emplaceBack(f[0].x,f[0].y,0,0),this._boundsArray.emplaceBack(f[1].x,f[1].y,u.EXTENT,0),this._boundsArray.emplaceBack(f[3].x,f[3].y,0,u.EXTENT),this._boundsArray.emplaceBack(f[2].x,f[2].y,u.EXTENT,u.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new u.Event("data",{dataType:"source",sourceDataType:"content"})),this}prepare(){if(Object.keys(this.tiles).length===0||!this.image)return;const i=this.map.painter.context,c=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,cr.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new ie(i,this.image,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let f=!1;for(const m in this.tiles){const x=this.tiles[m];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,f=!0)}f&&this.fire(new u.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}loadTile(i,c){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},c(null)):(i.state="errored",c(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}class js extends We{constructor(i,c,f,m){super(i,c,f,m),this.roundZoom=!0,this.type="video",this.options=c}load(){this._loaded=!1;const i=this.options;this.urls=[];for(const c of i.urls)this.urls.push(this.map._requestManager.transformRequest(c,dt.Source).url);u.getVideo(this.urls,(c,f)=>{this._loaded=!0,c?this.fire(new u.ErrorEvent(c)):f&&(this.video=f,this.video.loop=!0,this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(i){if(this.video){const c=this.video.seekable;i<c.start(0)||i>c.end(0)?this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${c.start(0)} and ${c.end(0)}-second mark.`))):this.video.currentTime=i}}getVideo(){return this.video}onAdd(i){this.map||(this.map=i,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const i=this.map.painter.context,c=i.gl;this.boundsBuffer||(this.boundsBuffer=i.createVertexBuffer(this._boundsArray,cr.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE),c.texSubImage2D(c.TEXTURE_2D,0,0,0,c.RGBA,c.UNSIGNED_BYTE,this.video)):(this.texture=new ie(i,this.video,c.RGBA),this.texture.bind(c.LINEAR,c.CLAMP_TO_EDGE));let f=!1;for(const m in this.tiles){const x=this.tiles[m];x.state!=="loaded"&&(x.state="loaded",x.texture=this.texture,f=!0)}f&&this.fire(new u.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}}class St extends We{constructor(i,c,f,m){super(i,c,f,m),c.coordinates?Array.isArray(c.coordinates)&&c.coordinates.length===4&&!c.coordinates.some(x=>!Array.isArray(x)||x.length!==2||x.some(S=>typeof S!="number"))||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${i}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${i}`,null,'missing required property "coordinates"'))),c.animate&&typeof c.animate!="boolean"&&this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${i}`,null,'optional "animate" property must be a boolean value'))),c.canvas?typeof c.canvas=="string"||c.canvas instanceof HTMLCanvasElement||this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${i}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new u.ErrorEvent(new u.ValidationError(`sources.${i}`,null,'missing required property "canvas"'))),this.options=c,this.animate=c.animate===void 0||c.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new u.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(i){this.map=i,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let i=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,i=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,i=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const c=this.map.painter.context,f=c.gl;this.boundsBuffer||(this.boundsBuffer=c.createVertexBuffer(this._boundsArray,cr.members)),this.boundsSegments||(this.boundsSegments=u.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(i||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new ie(c,this.canvas,f.RGBA,{premultiply:!0});let m=!1;for(const x in this.tiles){const S=this.tiles[x];S.state!=="loaded"&&(S.state="loaded",S.texture=this.texture,m=!0)}m&&this.fire(new u.Event("data",{dataType:"source",sourceDataType:"idle",sourceId:this.id}))}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const i of[this.canvas.width,this.canvas.height])if(isNaN(i)||i<=0)return!0;return!1}}const Gn={vector:Ur,raster:Qe,"raster-dem":Ni,geojson:_n,video:js,image:We,canvas:St};function Sr(d,i){const c=u.create();return u.translate(c,c,[1,1,0]),u.scale(c,c,[.5*d.width,.5*d.height,1]),u.multiply(c,c,d.calculatePosMatrix(i.toUnwrapped()))}function Ln(d,i,c,f,m,x){const S=function(R,X,et){if(R)for(const $ of R){const Q=X[$];if(Q&&Q.source===et&&Q.type==="fill-extrusion")return!0}else for(const $ in X){const Q=X[$];if(Q.source===et&&Q.type==="fill-extrusion")return!0}return!1}(m&&m.layers,i,d.id),P=x.maxPitchScaleFactor(),C=d.tilesIn(f,P,S);C.sort(pn);const A=[];for(const R of C)A.push({wrappedTileID:R.tileID.wrapped().key,queryResults:R.tile.queryRenderedFeatures(i,c,d._state,R.queryGeometry,R.cameraQueryGeometry,R.scale,m,x,P,Sr(d.transform,R.tileID))});const O=function(R){const X={},et={};for(const $ of R){const Q=$.queryResults,ot=$.wrappedTileID,pt=et[ot]=et[ot]||{};for(const Pt in Q){const rt=Q[Pt],Tt=pt[Pt]=pt[Pt]||{},Lt=X[Pt]=X[Pt]||[];for(const jt of rt)Tt[jt.featureIndex]||(Tt[jt.featureIndex]=!0,Lt.push(jt))}}return X}(A);for(const R in O)O[R].forEach(X=>{const et=X.feature,$=d.getFeatureState(et.layer["source-layer"],et.id);et.source=et.layer.source,et.layer["source-layer"]&&(et.sourceLayer=et.layer["source-layer"]),et.state=$});return O}function pn(d,i){const c=d.tileID,f=i.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}class io{constructor(i,c){this.timeAdded=0,this.fadeEndTime=0,this.tileID=i,this.uid=u.uniqueId(),this.uses=0,this.tileSize=c,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.rtt=[],this.rttCoords={},this.expiredRequestCount=0,this.state="loading"}registerFadeDuration(i){const c=i+this.timeAdded;c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}clearTextures(i){this.demTexture&&i.saveTileTexture(this.demTexture),this.demTexture=null}loadVectorData(i,c,f){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=function(m,x){const S={};if(!x)return S;for(const P of m){const C=P.layerIds.map(A=>x.getLayer(A)).filter(Boolean);if(C.length!==0){P.layers=C,P.stateDependentLayerIds&&(P.stateDependentLayers=P.stateDependentLayerIds.map(A=>C.filter(O=>O.id===A)[0]));for(const A of C)S[A.id]=P}}return S}(i.buckets,c.style),this.hasSymbolBuckets=!1;for(const m in this.buckets){const x=this.buckets[m];if(x instanceof u.SymbolBucket){if(this.hasSymbolBuckets=!0,!f)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const m in this.buckets){const x=this.buckets[m];if(x instanceof u.SymbolBucket&&x.hasRTLText){this.hasRTLText=!0,u.lazyLoadRTLTextPlugin();break}}this.queryPadding=0;for(const m in this.buckets){const x=this.buckets[m];this.queryPadding=Math.max(this.queryPadding,c.style.getLayer(m).queryRadius(x))}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage)}else this.collisionBoxArray=new u.CollisionBoxArray}unloadVectorData(){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"}getBucket(i){return this.buckets[i.id]}upload(i){for(const f in this.buckets){const m=this.buckets[f];m.uploadPending()&&m.upload(i)}const c=i.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new ie(i,this.imageAtlas.image,c.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new ie(i,this.glyphAtlasImage,c.ALPHA),this.glyphAtlasImage=null)}prepare(i){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture)}queryRenderedFeatures(i,c,f,m,x,S,P,C,A,O){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:x,scale:S,tileSize:this.tileSize,pixelPosMatrix:O,transform:C,params:P,queryPadding:this.queryPadding*A},i,c,f):{}}querySourceFeatures(i,c){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const m=f.loadVTLayers(),x=c&&c.sourceLayer?c.sourceLayer:"",S=m._geojsonTileLayer||m[x];if(!S)return;const P=u.createFilter(c&&c.filter),{z:C,x:A,y:O}=this.tileID.canonical,R={z:C,x:A,y:O};for(let X=0;X<S.length;X++){const et=S.feature(X);if(P.needGeometry){const ot=u.toEvaluationFeature(et,!0);if(!P.filter(new u.EvaluationParameters(this.tileID.overscaledZ),ot,this.tileID.canonical))continue}else if(!P.filter(new u.EvaluationParameters(this.tileID.overscaledZ),et))continue;const $=f.getId(et,x),Q=new u.GeoJSONFeature(et,C,A,O,$);Q.tile=R,i.push(Q)}}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(i){const c=this.expirationTime;if(i.cacheControl){const f=u.parseCacheControl(i.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const f=Date.now();let m=!1;if(this.expirationTime>f)m=!1;else if(c)if(this.expirationTime<c)m=!0;else{const x=this.expirationTime-c;x?this.expirationTime=f+Math.max(x,3e4):m=!0}else m=!0;m?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}setFeatureState(i,c){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||Object.keys(i).length===0)return;const f=this.latestFeatureIndex.loadVTLayers();for(const m in this.buckets){if(!c.style.hasLayer(m))continue;const x=this.buckets[m],S=x.layers[0].sourceLayer||"_geojsonTileLayer",P=f[S],C=i[S];if(!P||!C||Object.keys(C).length===0)continue;x.update(C,P,this.imageAtlas&&this.imageAtlas.patternPositions||{});const A=c&&c.style&&c.style.getLayer(m);A&&(this.queryPadding=Math.max(this.queryPadding,A.queryRadius(x)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<u.exported.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=u.exported.now()+i}setDependencies(i,c){const f={};for(const m of c)f[m]=!0;this.dependencies[i]=f}hasDependency(i,c){for(const f of i){const m=this.dependencies[f];if(m){for(const x of c)if(m[x])return!0}}return!1}}class rs{constructor(i,c){this.max=i,this.onRemove=c,this.reset()}reset(){for(const i in this.data)for(const c of this.data[i])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(i,c,f){const m=i.wrapped().key;this.data[m]===void 0&&(this.data[m]=[]);const x={value:c,timeout:void 0};if(f!==void 0&&(x.timeout=setTimeout(()=>{this.remove(i,x)},f)),this.data[m].push(x),this.order.push(m),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const c=this.data[i].shift();return c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),c.value}getByKey(i){const c=this.data[i];return c?c[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,c){if(!this.has(i))return this;const f=i.wrapped().key,m=c===void 0?0:this.data[f].indexOf(c),x=this.data[f][m];return this.data[f].splice(m,1),x.timeout&&clearTimeout(x.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(x.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(i){const c=[];for(const f in this.data)for(const m of this.data[f])i(m.value)||c.push(m);for(const f of c)this.remove(f.value.tileID,f)}}class is{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,c,f){const m=String(c);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][m]=this.stateChanges[i][m]||{},u.extend(this.stateChanges[i][m],f),this.deletedStates[i]===null){this.deletedStates[i]={};for(const x in this.state[i])x!==m&&(this.deletedStates[i][x]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][m]===null){this.deletedStates[i][m]={};for(const x in this.state[i][m])f[x]||(this.deletedStates[i][m][x]=null)}else for(const x in f)this.deletedStates[i]&&this.deletedStates[i][m]&&this.deletedStates[i][m][x]===null&&delete this.deletedStates[i][m][x]}removeFeatureState(i,c,f){if(this.deletedStates[i]===null)return;const m=String(c);if(this.deletedStates[i]=this.deletedStates[i]||{},f&&c!==void 0)this.deletedStates[i][m]!==null&&(this.deletedStates[i][m]=this.deletedStates[i][m]||{},this.deletedStates[i][m][f]=null);else if(c!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][m])for(f in this.deletedStates[i][m]={},this.stateChanges[i][m])this.deletedStates[i][m][f]=null;else this.deletedStates[i][m]=null;else this.deletedStates[i]=null}getState(i,c){const f=String(c),m=u.extend({},(this.state[i]||{})[f],(this.stateChanges[i]||{})[f]);if(this.deletedStates[i]===null)return{};if(this.deletedStates[i]){const x=this.deletedStates[i][c];if(x===null)return{};for(const S in x)delete m[S]}return m}initializeTileState(i,c){i.setFeatureState(this.state,c)}coalesceChanges(i,c){const f={};for(const m in this.stateChanges){this.state[m]=this.state[m]||{};const x={};for(const S in this.stateChanges[m])this.state[m][S]||(this.state[m][S]={}),u.extend(this.state[m][S],this.stateChanges[m][S]),x[S]=this.state[m][S];f[m]=x}for(const m in this.deletedStates){this.state[m]=this.state[m]||{};const x={};if(this.deletedStates[m]===null)for(const S in this.state[m])x[S]={},this.state[m][S]={};else for(const S in this.deletedStates[m]){if(this.deletedStates[m][S]===null)this.state[m][S]={};else for(const P of Object.keys(this.deletedStates[m][S]))delete this.state[m][S][P];x[S]=this.state[m][S]}f[m]=f[m]||{},u.extend(f[m],x)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const m in i)i[m].setFeatureState(f,c)}}class Tr extends u.Evented{constructor(i,c,f){super(),this.id=i,this.dispatcher=f,this.on("data",m=>{m.dataType==="source"&&m.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&m.dataType==="source"&&m.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform,this.terrain),this._didEmitContent=!0)}),this.on("dataloading",()=>{this._sourceErrored=!1}),this.on("error",()=>{this._sourceErrored=this._source.loaded()}),this._source=function(m,x,S,P){const C=new Gn[x.type](m,x,S,P);if(C.id!==m)throw new Error(`Expected Source id to be ${m} instead of ${C.id}`);return u.bindAll(["load","abort","unload","serialize","prepare"],C),C}(i,c,f,this),this._tiles={},this._cache=new rs(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._maxTileCacheZoomLevels=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new is,this._didEmitContent=!1,this._updated=!1}onAdd(i){this.map=i,this._maxTileCacheSize=i?i._maxTileCacheSize:null,this._maxTileCacheZoomLevels=i?i._maxTileCacheZoomLevels:null,this._source&&this._source.onAdd&&this._source.onAdd(i)}onRemove(i){this.clearTiles(),this._source&&this._source.onRemove&&this._source.onRemove(i)}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;if(!(this.used===void 0&&this.usedForTerrain===void 0||this.used||this.usedForTerrain))return!0;if(!this._updated)return!1;for(const i in this._tiles){const c=this._tiles[i];if(c.state!=="loaded"&&c.state!=="errored")return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform,this.terrain)}_loadTile(i,c){return this._source.loadTile(i,c)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i,()=>{})}_abortTile(i){this._source.abortTile&&this._source.abortTile(i,()=>{}),this._source.fire(new u.Event("dataabort",{tile:i,coord:i.tileID,dataType:"source"}))}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const f=this._tiles[c];f.upload(i),f.prepare(this.map.style.imageManager)}}getIds(){return Object.values(this._tiles).map(i=>i.tileID).sort(Nr).map(i=>i.key)}getRenderableIds(i){const c=[];for(const f in this._tiles)this._isIdRenderable(f,i)&&c.push(this._tiles[f]);return i?c.sort((f,m)=>{const x=f.tileID,S=m.tileID,P=new u.Point(x.canonical.x,x.canonical.y)._rotate(this.transform.angle),C=new u.Point(S.canonical.x,S.canonical.y)._rotate(this.transform.angle);return x.overscaledZ-S.overscaledZ||C.y-P.y||C.x-P.x}).map(f=>f.tileID.key):c.map(f=>f.tileID).sort(Nr).map(f=>f.key)}hasRenderableParent(i){const c=this.findLoadedParent(i,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(i,c){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(c||!this._tiles[i].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(i,"reloading")}}_reloadTile(i,c){const f=this._tiles[i];f&&(f.state!=="loading"&&(f.state=c),this._loadTile(f,this._tileLoaded.bind(this,f,i,c)))}_tileLoaded(i,c,f,m){if(m)return i.state="errored",void(m.status!==404?this._source.fire(new u.ErrorEvent(m,{tile:i})):this.update(this.transform,this.terrain));i.timeAdded=u.exported.now(),f==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(c,i),this.getSource().type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),i.aborted||this._source.fire(new u.Event("data",{dataType:"source",tile:i,coord:i.tileID}))}_backfillDEM(i){const c=this.getRenderableIds();for(let m=0;m<c.length;m++){const x=c[m];if(i.neighboringTiles&&i.neighboringTiles[x]){const S=this.getTileByID(x);f(i,S),f(S,i)}}function f(m,x){m.needsHillshadePrepare=!0,m.needsTerrainPrepare=!0;let S=x.tileID.canonical.x-m.tileID.canonical.x;const P=x.tileID.canonical.y-m.tileID.canonical.y,C=Math.pow(2,m.tileID.canonical.z),A=x.tileID.key;S===0&&P===0||Math.abs(P)>1||(Math.abs(S)>1&&(Math.abs(S+C)===1?S+=C:Math.abs(S-C)===1&&(S-=C)),x.dem&&m.dem&&(m.dem.backfillBorder(x.dem,S,P),m.neighboringTiles&&m.neighboringTiles[A]&&(m.neighboringTiles[A].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,c,f,m){for(const x in this._tiles){let S=this._tiles[x];if(m[x]||!S.hasData()||S.tileID.overscaledZ<=c||S.tileID.overscaledZ>f)continue;let P=S.tileID;for(;S&&S.tileID.overscaledZ>c+1;){const A=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[A.key],S&&S.hasData()&&(P=A)}let C=P;for(;C.overscaledZ>c;)if(C=C.scaledTo(C.overscaledZ-1),i[C.key]){m[P.key]=P;break}}}findLoadedParent(i,c){if(i.key in this._loadedParentTiles){const f=this._loadedParentTiles[i.key];return f&&f.tileID.overscaledZ>=c?f:null}for(let f=i.overscaledZ-1;f>=c;f--){const m=i.scaledTo(f),x=this._getLoadedTile(m);if(x)return x}}_getLoadedTile(i){const c=this._tiles[i.key];return c&&c.hasData()?c:this._cache.getByKey(i.wrapped().key)}updateCacheSize(i){const c=Math.ceil(i.width/this._source.tileSize)+1,f=Math.ceil(i.height/this._source.tileSize)+1,m=Math.floor(c*f*(this._maxTileCacheZoomLevels===null?u.config.MAX_TILE_CACHE_ZOOM_LEVELS:this._maxTileCacheZoomLevels)),x=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,m):m;this._cache.setMaxSize(x)}handleWrapJump(i){const c=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,c){const f={};for(const m in this._tiles){const x=this._tiles[m];x.tileID=x.tileID.unwrapTo(x.tileID.wrap+c),f[x.tileID.key]=x}this._tiles=f;for(const m in this._timers)clearTimeout(this._timers[m]),delete this._timers[m];for(const m in this._tiles)this._setTileReloadTimer(m,this._tiles[m])}}update(i,c){if(this.transform=i,this.terrain=c,!this._sourceLoaded||this._paused)return;let f;this.updateCacheSize(i),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?f=i.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new u.OverscaledTileID(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y)):(f=i.coveringTiles({tileSize:this.usedForTerrain?this.tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:!this.usedForTerrain&&this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled,terrain:c}),this._source.hasTile&&(f=f.filter(O=>this._source.hasTile(O)))):f=[];const m=i.coveringZoomLevel(this._source),x=Math.max(m-Tr.maxOverzooming,this._source.minzoom),S=Math.max(m+Tr.maxUnderzooming,this._source.minzoom);if(this.usedForTerrain){const O={};for(const R of f)if(R.canonical.z>this._source.minzoom){const X=R.scaledTo(R.canonical.z-1);O[X.key]=X;const et=R.scaledTo(Math.max(this._source.minzoom,Math.min(R.canonical.z,5)));O[et.key]=et}f=f.concat(Object.values(O))}const P=f.length===0&&!this._updated&&this._didEmitContent;this._updated=!0,P&&this.fire(new u.Event("data",{sourceDataType:"idle",dataType:"source",sourceId:this.id}));const C=this._updateRetainedTiles(f,m);if(os(this._source.type)){const O={},R={},X=Object.keys(C),et=u.exported.now();for(const $ of X){const Q=C[$],ot=this._tiles[$];if(!ot||ot.fadeEndTime!==0&&ot.fadeEndTime<=et)continue;const pt=this.findLoadedParent(Q,x);pt&&(this._addTile(pt.tileID),O[pt.tileID.key]=pt.tileID),R[$]=Q}this._retainLoadedChildren(R,m,S,C);for(const $ in O)C[$]||(this._coveredTiles[$]=!0,C[$]=O[$]);if(c){const $={},Q={};for(const ot of f)this._tiles[ot.key].hasData()?$[ot.key]=ot:Q[ot.key]=ot;for(const ot in Q){const pt=Q[ot].children(this._source.maxzoom);this._tiles[pt[0].key]&&this._tiles[pt[1].key]&&this._tiles[pt[2].key]&&this._tiles[pt[3].key]&&($[pt[0].key]=C[pt[0].key]=pt[0],$[pt[1].key]=C[pt[1].key]=pt[1],$[pt[2].key]=C[pt[2].key]=pt[2],$[pt[3].key]=C[pt[3].key]=pt[3],delete Q[ot])}for(const ot in Q){const pt=this.findLoadedParent(Q[ot],this._source.minzoom);if(pt){$[pt.tileID.key]=C[pt.tileID.key]=pt.tileID;for(const Pt in $)$[Pt].isChildOf(pt.tileID)&&delete $[Pt]}}for(const ot in this._tiles)$[ot]||(this._coveredTiles[ot]=!0)}}for(const O in C)this._tiles[O].clearFadeHold();const A=u.keysDifference(this._tiles,C);for(const O of A){const R=this._tiles[O];R.hasSymbolBuckets&&!R.holdingForFade()?R.setHoldDuration(this.map._fadeDuration):R.hasSymbolBuckets&&!R.symbolFadeFinished()||this._removeTile(O)}this._updateLoadedParentTileCache()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(i)}_updateRetainedTiles(i,c){const f={},m={},x=Math.max(c-Tr.maxOverzooming,this._source.minzoom),S=Math.max(c+Tr.maxUnderzooming,this._source.minzoom),P={};for(const C of i){const A=this._addTile(C);f[C.key]=C,A.hasData()||c<this._source.maxzoom&&(P[C.key]=C)}this._retainLoadedChildren(P,c,S,f);for(const C of i){let A=this._tiles[C.key];if(A.hasData())continue;if(c+1>this._source.maxzoom){const R=C.children(this._source.maxzoom)[0],X=this.getTile(R);if(X&&X.hasData()){f[R.key]=R;continue}}else{const R=C.children(this._source.maxzoom);if(f[R[0].key]&&f[R[1].key]&&f[R[2].key]&&f[R[3].key])continue}let O=A.wasRequested();for(let R=C.overscaledZ-1;R>=x;--R){const X=C.scaledTo(R);if(m[X.key])break;if(m[X.key]=!0,A=this.getTile(X),!A&&O&&(A=this._addTile(X)),A){const et=A.hasData();if((O||et)&&(f[X.key]=X),O=A.wasRequested(),et)break}}}return f}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const c=[];let f,m=this._tiles[i].tileID;for(;m.overscaledZ>0;){if(m.key in this._loadedParentTiles){f=this._loadedParentTiles[m.key];break}c.push(m.key);const x=m.scaledTo(m.overscaledZ-1);if(f=this._getLoadedTile(x),f)break;m=x}for(const x of c)this._loadedParentTiles[x]=f}}_addTile(i){let c=this._tiles[i.key];if(c)return c;c=this._cache.getAndRemove(i),c&&(this._setTileReloadTimer(i.key,c),c.tileID=i,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,c)));const f=c;return c||(c=new io(i,this._source.tileSize*i.overscaleFactor()),this._loadTile(c,this._tileLoaded.bind(this,c,i.key,c.state))),c.uses++,this._tiles[i.key]=c,f||this._source.fire(new u.Event("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(i,c){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const f=c.getExpiryTimeout();f&&(this._timers[i]=setTimeout(()=>{this._reloadTile(i,"expired"),delete this._timers[i]},f))}_removeTile(i){const c=this._tiles[i];c&&(c.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),c.uses>0||(c.hasData()&&c.state!=="reloading"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(i);this._cache.reset()}tilesIn(i,c,f){const m=[],x=this.transform;if(!x)return m;const S=f?x.getCameraQueryGeometry(i):i,P=i.map($=>x.pointCoordinate($,this.terrain)),C=S.map($=>x.pointCoordinate($,this.terrain)),A=this.getIds();let O=1/0,R=1/0,X=-1/0,et=-1/0;for(const $ of C)O=Math.min(O,$.x),R=Math.min(R,$.y),X=Math.max(X,$.x),et=Math.max(et,$.y);for(let $=0;$<A.length;$++){const Q=this._tiles[A[$]];if(Q.holdingForFade())continue;const ot=Q.tileID,pt=Math.pow(2,x.zoom-Q.tileID.overscaledZ),Pt=c*Q.queryPadding*u.EXTENT/Q.tileSize/pt,rt=[ot.getTilePoint(new u.MercatorCoordinate(O,R)),ot.getTilePoint(new u.MercatorCoordinate(X,et))];if(rt[0].x-Pt<u.EXTENT&&rt[0].y-Pt<u.EXTENT&&rt[1].x+Pt>=0&&rt[1].y+Pt>=0){const Tt=P.map(jt=>ot.getTilePoint(jt)),Lt=C.map(jt=>ot.getTilePoint(jt));m.push({tile:Q,tileID:ot,queryGeometry:Tt,cameraQueryGeometry:Lt,scale:pt})}}return m}getVisibleCoordinates(i){const c=this.getRenderableIds(i).map(f=>this._tiles[f].tileID);for(const f of c)f.posMatrix=this.transform.calculatePosMatrix(f.toUnwrapped());return c}hasTransition(){if(this._source.hasTransition())return!0;if(os(this._source.type)){const i=u.exported.now();for(const c in this._tiles)if(this._tiles[c].fadeEndTime>=i)return!0}return!1}setFeatureState(i,c,f){this._state.updateState(i=i||"_geojsonTileLayer",c,f)}removeFeatureState(i,c,f){this._state.removeFeatureState(i=i||"_geojsonTileLayer",c,f)}getFeatureState(i,c){return this._state.getState(i=i||"_geojsonTileLayer",c)}setDependencies(i,c,f){const m=this._tiles[i];m&&m.setDependencies(c,f)}reloadTilesForDependencies(i,c){for(const f in this._tiles)this._tiles[f].hasDependency(i,c)&&this._reloadTile(f,"reloading");this._cache.filter(f=>!f.hasDependency(i,c))}}function Nr(d,i){const c=Math.abs(2*d.wrap)-+(d.wrap<0),f=Math.abs(2*i.wrap)-+(i.wrap<0);return d.overscaledZ-i.overscaledZ||f-c||i.canonical.y-d.canonical.y||i.canonical.x-d.canonical.x}function os(d){return d==="raster"||d==="image"||d==="video"}Tr.maxOverzooming=10,Tr.maxUnderzooming=3;const Co="mapboxgl_preloaded_worker_pool";class te{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<te.workerCount;)this.workers.push(new Worker(u.config.WORKER_URL));return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],this.numActive()===0&&(this.workers.forEach(c=>{c.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Co]}numActive(){return Object.keys(this.active).length}}const Ri=Math.floor(u.exported.hardwareConcurrency/2);let Vr;function ss(){return Vr||(Vr=new te),Vr}te.workerCount=u.isSafari(globalThis)?Math.max(Math.min(Ri,3),1):1;class Ki{constructor(i,c){this.reset(i,c)}reset(i,c){this.points=i||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=u.clamp(i,0,1);let c=1,f=this._distances[c];const m=i*this.paddedLength+this.padding;for(;f<m&&c<this._distances.length;)f=this._distances[++c];const x=c-1,S=this._distances[x],P=f-S,C=P>0?(m-S)/P:0;return this.points[x].mult(1-C).add(this.points[c].mult(C))}}function ee(d,i){let c=!0;return d==="always"||d!=="never"&&i!=="never"||(c=!1),c}class on{constructor(i,c,f){const m=this.boxCells=[],x=this.circleCells=[];this.xCellCount=Math.ceil(i/f),this.yCellCount=Math.ceil(c/f);for(let S=0;S<this.xCellCount*this.yCellCount;S++)m.push([]),x.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=c,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,c,f,m,x){this._forEachCell(c,f,m,x,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(m),this.bboxes.push(x)}insertCircle(i,c,f,m){this._forEachCell(c-m,f-m,c+m,f+m,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(c),this.circles.push(f),this.circles.push(m)}_insertBoxCell(i,c,f,m,x,S){this.boxCells[x].push(S)}_insertCircleCell(i,c,f,m,x,S){this.circleCells[x].push(S)}_query(i,c,f,m,x,S,P){if(f<0||i>this.width||m<0||c>this.height)return[];const C=[];if(i<=0&&c<=0&&this.width<=f&&this.height<=m){if(x)return[{key:null,x1:i,y1:c,x2:f,y2:m}];for(let A=0;A<this.boxKeys.length;A++)C.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const O=this.circles[3*A],R=this.circles[3*A+1],X=this.circles[3*A+2];C.push({key:this.circleKeys[A],x1:O-X,y1:R-X,x2:O+X,y2:R+X})}}else this._forEachCell(i,c,f,m,this._queryCell,C,{hitTest:x,overlapMode:S,seenUids:{box:{},circle:{}}},P);return C}query(i,c,f,m){return this._query(i,c,f,m,!1,null)}hitTest(i,c,f,m,x,S){return this._query(i,c,f,m,!0,x,S).length>0}hitTestCircle(i,c,f,m,x){const S=i-f,P=i+f,C=c-f,A=c+f;if(P<0||S>this.width||A<0||C>this.height)return!1;const O=[];return this._forEachCell(S,C,P,A,this._queryCellCircle,O,{hitTest:!0,overlapMode:m,circle:{x:i,y:c,radius:f},seenUids:{box:{},circle:{}}},x),O.length>0}_queryCell(i,c,f,m,x,S,P,C){const{seenUids:A,hitTest:O,overlapMode:R}=P,X=this.boxCells[x];if(X!==null){const $=this.bboxes;for(const Q of X)if(!A.box[Q]){A.box[Q]=!0;const ot=4*Q,pt=this.boxKeys[Q];if(i<=$[ot+2]&&c<=$[ot+3]&&f>=$[ot+0]&&m>=$[ot+1]&&(!C||C(pt))&&(!O||!ee(R,pt.overlapMode))&&(S.push({key:pt,x1:$[ot],y1:$[ot+1],x2:$[ot+2],y2:$[ot+3]}),O))return!0}}const et=this.circleCells[x];if(et!==null){const $=this.circles;for(const Q of et)if(!A.circle[Q]){A.circle[Q]=!0;const ot=3*Q,pt=this.circleKeys[Q];if(this._circleAndRectCollide($[ot],$[ot+1],$[ot+2],i,c,f,m)&&(!C||C(pt))&&(!O||!ee(R,pt.overlapMode))){const Pt=$[ot],rt=$[ot+1],Tt=$[ot+2];if(S.push({key:pt,x1:Pt-Tt,y1:rt-Tt,x2:Pt+Tt,y2:rt+Tt}),O)return!0}}}return!1}_queryCellCircle(i,c,f,m,x,S,P,C){const{circle:A,seenUids:O,overlapMode:R}=P,X=this.boxCells[x];if(X!==null){const $=this.bboxes;for(const Q of X)if(!O.box[Q]){O.box[Q]=!0;const ot=4*Q,pt=this.boxKeys[Q];if(this._circleAndRectCollide(A.x,A.y,A.radius,$[ot+0],$[ot+1],$[ot+2],$[ot+3])&&(!C||C(pt))&&!ee(R,pt.overlapMode))return S.push(!0),!0}}const et=this.circleCells[x];if(et!==null){const $=this.circles;for(const Q of et)if(!O.circle[Q]){O.circle[Q]=!0;const ot=3*Q,pt=this.circleKeys[Q];if(this._circlesCollide($[ot],$[ot+1],$[ot+2],A.x,A.y,A.radius)&&(!C||C(pt))&&!ee(R,pt.overlapMode))return S.push(!0),!0}}}_forEachCell(i,c,f,m,x,S,P,C){const A=this._convertToXCellCoord(i),O=this._convertToYCellCoord(c),R=this._convertToXCellCoord(f),X=this._convertToYCellCoord(m);for(let et=A;et<=R;et++)for(let $=O;$<=X;$++)if(x.call(this,i,c,f,m,this.xCellCount*$+et,S,P,C))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,c,f,m,x,S){const P=m-i,C=x-c,A=f+S;return A*A>P*P+C*C}_circleAndRectCollide(i,c,f,m,x,S,P){const C=(S-m)/2,A=Math.abs(i-(m+C));if(A>C+f)return!1;const O=(P-x)/2,R=Math.abs(c-(x+O));if(R>O+f)return!1;if(A<=C||R<=O)return!0;const X=A-C,et=R-O;return X*X+et*et<=f*f}}function Ve(d,i,c,f,m){const x=u.create();return i?(u.scale(x,x,[1/m,1/m,1]),c||u.rotateZ(x,x,f.angle)):u.multiply(x,f.labelPlaneMatrix,d),x}function yi(d,i,c,f,m){if(i){const x=u.clone(d);return u.scale(x,x,[m,m,1]),c||u.rotateZ(x,x,-f.angle),x}return f.glCoordMatrix}function hr(d,i,c){let f;c?(f=[d.x,d.y,c(d.x,d.y),1],u.transformMat4(f,f,i)):(f=[d.x,d.y,0,1],J(f,f,i));const m=f[3];return{point:new u.Point(f[0]/m,f[1]/m),signedDistanceFromCamera:m}}function Xe(d,i){return .5+d/i*.5}function oo(d,i){const c=d[0]/d[3],f=d[1]/d[3];return c>=-i[0]&&c<=i[0]&&f>=-i[1]&&f<=i[1]}function Gr(d,i,c,f,m,x,S,P,C,A){const O=f?d.textSizeData:d.iconSizeData,R=u.evaluateSizeForZoom(O,c.transform.zoom),X=[256/c.width*2+1,256/c.height*2+1],et=f?d.text.dynamicLayoutVertexArray:d.icon.dynamicLayoutVertexArray;et.clear();const $=d.lineVertexArray,Q=f?d.text.placedSymbolArray:d.icon.placedSymbolArray,ot=c.transform.width/c.transform.height;let pt=!1;for(let Pt=0;Pt<Q.length;Pt++){const rt=Q.get(Pt);if(rt.hidden||rt.writingMode===u.WritingMode.vertical&&!pt){W(rt.numGlyphs,et);continue}let Tt;if(pt=!1,A?(Tt=[rt.anchorX,rt.anchorY,A(rt.anchorX,rt.anchorY),1],u.transformMat4(Tt,Tt,i)):(Tt=[rt.anchorX,rt.anchorY,0,1],J(Tt,Tt,i)),!oo(Tt,X)){W(rt.numGlyphs,et);continue}const Lt=Xe(c.transform.cameraToCenterDistance,Tt[3]),jt=u.evaluateSizeForFeature(O,R,rt),Ht=S?jt/Lt:jt*Lt,Jt=new u.Point(rt.anchorX,rt.anchorY),Yt=hr(Jt,m,A).point,xe={projections:{},offsets:{}},Oe=Jr(rt,Ht,!1,P,i,m,x,d.glyphOffsetArray,$,et,Yt,Jt,xe,ot,C,A);pt=Oe.useVertical,(Oe.notEnoughRoom||pt||Oe.needsFlipping&&Jr(rt,Ht,!0,P,i,m,x,d.glyphOffsetArray,$,et,Yt,Jt,xe,ot,C,A).notEnoughRoom)&&W(rt.numGlyphs,et)}f?d.text.dynamicLayoutVertexBuffer.updateData(et):d.icon.dynamicLayoutVertexBuffer.updateData(et)}function Ii(d,i,c,f,m,x,S,P,C,A,O,R,X){const et=P.glyphStartIndex+P.numGlyphs,$=P.lineStartIndex,Q=P.lineStartIndex+P.lineLength,ot=i.getoffsetX(P.glyphStartIndex),pt=i.getoffsetX(et-1),Pt=z(d*ot,c,f,m,x,S,P.segment,$,Q,C,A,O,R,X);if(!Pt)return null;const rt=z(d*pt,c,f,m,x,S,P.segment,$,Q,C,A,O,R,X);return rt?{first:Pt,last:rt}:null}function as(d,i,c,f){return d===u.WritingMode.horizontal&&Math.abs(c.y-i.y)>Math.abs(c.x-i.x)*f?{useVertical:!0}:(d===u.WritingMode.vertical?i.y<c.y:i.x>c.x)?{needsFlipping:!0}:null}function Jr(d,i,c,f,m,x,S,P,C,A,O,R,X,et,$,Q){const ot=i/24,pt=d.lineOffsetX*ot,Pt=d.lineOffsetY*ot;let rt;if(d.numGlyphs>1){const Tt=d.glyphStartIndex+d.numGlyphs,Lt=d.lineStartIndex,jt=d.lineStartIndex+d.lineLength,Ht=Ii(ot,P,pt,Pt,c,O,R,d,C,x,X,$,Q);if(!Ht)return{notEnoughRoom:!0};const Jt=hr(Ht.first.point,S,Q).point,Yt=hr(Ht.last.point,S,Q).point;if(f&&!c){const xe=as(d.writingMode,Jt,Yt,et);if(xe)return xe}rt=[Ht.first];for(let xe=d.glyphStartIndex+1;xe<Tt-1;xe++)rt.push(z(ot*P.getoffsetX(xe),pt,Pt,c,O,R,d.segment,Lt,jt,C,x,X,$,Q));rt.push(Ht.last)}else{if(f&&!c){const Lt=hr(R,m,Q).point,jt=d.lineStartIndex+d.segment+1,Ht=new u.Point(C.getx(jt),C.gety(jt)),Jt=hr(Ht,m,Q),Yt=Jt.signedDistanceFromCamera>0?Jt.point:Jn(R,Ht,Lt,1,m,Q),xe=as(d.writingMode,Lt,Yt,et);if(xe)return xe}const Tt=z(ot*P.getoffsetX(d.glyphStartIndex),pt,Pt,c,O,R,d.segment,d.lineStartIndex,d.lineStartIndex+d.lineLength,C,x,X,$,Q);if(!Tt)return{notEnoughRoom:!0};rt=[Tt]}for(const Tt of rt)u.addDynamicAttributes(A,Tt.point,Tt.angle);return{}}function Jn(d,i,c,f,m,x){const S=hr(d.add(d.sub(i)._unit()),m,x).point,P=c.sub(S);return c.add(P._mult(f/P.mag()))}function Wa(d,i){const{projectionCache:c,lineVertexArray:f,labelPlaneMatrix:m,tileAnchorPoint:x,distanceFromAnchor:S,getElevation:P,previousVertex:C,direction:A,absOffsetX:O}=i;if(c.projections[d])return c.projections[d];const R=new u.Point(f.getx(d),f.gety(d)),X=hr(R,m,P);if(X.signedDistanceFromCamera>0)return c.projections[d]=X.point,X.point;const et=d-A;return Jn(S===0?x:new u.Point(f.getx(et),f.gety(et)),R,C,O-S+1,m,P)}function Vo(d,i,c){return d._unit()._perp()._mult(i*c)}function V(d,i,c,f,m,x,S,P){const{projectionCache:C,direction:A}=P;if(C.offsets[d])return C.offsets[d];const O=c.add(i);if(d+A<f||d+A>=m)return C.offsets[d]=O,O;const R=Wa(d+A,P),X=Vo(R.sub(c),S,A),et=c.add(X),$=R.add(X);return C.offsets[d]=u.findLineIntersection(x,O,et,$)||O,C.offsets[d]}function z(d,i,c,f,m,x,S,P,C,A,O,R,X,et){const $=f?d-i:d+i;let Q=$>0?1:-1,ot=0;f&&(Q*=-1,ot=Math.PI),Q<0&&(ot+=Math.PI);let pt,Pt,rt=Q>0?P+S:P+S+1,Tt=m,Lt=m,jt=0,Ht=0;const Jt=Math.abs($),Yt=[];let xe;for(;jt+Ht<=Jt;){if(rt+=Q,rt<P||rt>=C)return null;jt+=Ht,Lt=Tt,Pt=pt;const ue={projectionCache:R,lineVertexArray:A,labelPlaneMatrix:O,tileAnchorPoint:x,distanceFromAnchor:jt,getElevation:et,previousVertex:Lt,direction:Q,absOffsetX:Jt};if(Tt=Wa(rt,ue),c===0)Yt.push(Lt),xe=Tt.sub(Lt);else{let je;const be=Tt.sub(Lt);je=be.mag()===0?Vo(Wa(rt+Q,ue).sub(Tt),c,Q):Vo(be,c,Q),Pt||(Pt=Lt.add(je)),pt=V(rt,je,Tt,P,C,Pt,c,ue),Yt.push(Pt),xe=pt.sub(Pt)}Ht=xe.mag()}const Oe=xe._mult((Jt-jt)/Ht)._add(Pt||Lt),nn=ot+Math.atan2(Tt.y-Lt.y,Tt.x-Lt.x);return Yt.push(Oe),{point:Oe,angle:X?nn:0,path:Yt}}const B=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function W(d,i){for(let c=0;c<d;c++){const f=i.length;i.resize(f+4),i.float32.set(B,3*f)}}function J(d,i,c){const f=i[0],m=i[1];return d[0]=c[0]*f+c[4]*m+c[12],d[1]=c[1]*f+c[5]*m+c[13],d[3]=c[3]*f+c[7]*m+c[15],d}const st=100;class mt{constructor(i,c=new on(i.width+200,i.height+200,25),f=new on(i.width+200,i.height+200,25)){this.transform=i,this.grid=c,this.ignoredGrid=f,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+st,this.screenBottomBoundary=i.height+st,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.perspectiveRatioCutoff=.6}placeCollisionBox(i,c,f,m,x,S){const P=this.projectAndGetPerspectiveRatio(m,i.anchorPointX,i.anchorPointY,S),C=f*P.perspectiveRatio,A=i.x1*C+P.point.x,O=i.y1*C+P.point.y,R=i.x2*C+P.point.x,X=i.y2*C+P.point.y;return!this.isInsideGrid(A,O,R,X)||c!=="always"&&this.grid.hitTest(A,O,R,X,c,x)||P.perspectiveRatio<this.perspectiveRatioCutoff?{box:[],offscreen:!1}:{box:[A,O,R,X],offscreen:this.isOffscreen(A,O,R,X)}}placeCollisionCircles(i,c,f,m,x,S,P,C,A,O,R,X,et,$){const Q=[],ot=new u.Point(c.anchorX,c.anchorY),pt=hr(ot,S,$),Pt=Xe(this.transform.cameraToCenterDistance,pt.signedDistanceFromCamera),rt=(O?x/Pt:x*Pt)/u.ONE_EM,Tt=hr(ot,P,$).point,Lt=Ii(rt,m,c.lineOffsetX*rt,c.lineOffsetY*rt,!1,Tt,ot,c,f,P,{projections:{},offsets:{}},!1,$);let jt=!1,Ht=!1,Jt=!0;if(Lt){const Yt=.5*X*Pt+et,xe=new u.Point(-100,-100),Oe=new u.Point(this.screenRightBoundary,this.screenBottomBoundary),nn=new Ki,ue=Lt.first,je=Lt.last;let be=[];for(let Vn=ue.path.length-1;Vn>=1;Vn--)be.push(ue.path[Vn]);for(let Vn=1;Vn<je.path.length;Vn++)be.push(je.path[Vn]);const Un=2.5*Yt;if(C){const Vn=be.map(ln=>hr(ln,C,$));be=Vn.some(ln=>ln.signedDistanceFromCamera<=0)?[]:Vn.map(ln=>ln.point)}let ai=[];if(be.length>0){const Vn=be[0].clone(),ln=be[0].clone();for(let ei=1;ei<be.length;ei++)Vn.x=Math.min(Vn.x,be[ei].x),Vn.y=Math.min(Vn.y,be[ei].y),ln.x=Math.max(ln.x,be[ei].x),ln.y=Math.max(ln.y,be[ei].y);ai=Vn.x>=xe.x&&ln.x<=Oe.x&&Vn.y>=xe.y&&ln.y<=Oe.y?[be]:ln.x<xe.x||Vn.x>Oe.x||ln.y<xe.y||Vn.y>Oe.y?[]:u.clipLine([be],xe.x,xe.y,Oe.x,Oe.y)}for(const Vn of ai){nn.reset(Vn,.25*Yt);let ln=0;ln=nn.length<=.5*Yt?1:Math.ceil(nn.paddedLength/Un)+1;for(let ei=0;ei<ln;ei++){const Ao=ei/Math.max(ln-1,1),li=nn.lerp(Ao),Fi=li.x+st,cs=li.y+st;Q.push(Fi,cs,Yt,0);const Xs=Fi-Yt,Ys=cs-Yt,Lo=Fi+Yt,Ta=cs+Yt;if(Jt=Jt&&this.isOffscreen(Xs,Ys,Lo,Ta),Ht=Ht||this.isInsideGrid(Xs,Ys,Lo,Ta),i!=="always"&&this.grid.hitTestCircle(Fi,cs,Yt,i,R)&&(jt=!0,!A))return{circles:[],offscreen:!1,collisionDetected:jt}}}}return{circles:!A&&jt||!Ht||Pt<this.perspectiveRatioCutoff?[]:Q,offscreen:Jt,collisionDetected:jt}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let f=1/0,m=1/0,x=-1/0,S=-1/0;for(const O of i){const R=new u.Point(O.x+st,O.y+st);f=Math.min(f,R.x),m=Math.min(m,R.y),x=Math.max(x,R.x),S=Math.max(S,R.y),c.push(R)}const P=this.grid.query(f,m,x,S).concat(this.ignoredGrid.query(f,m,x,S)),C={},A={};for(const O of P){const R=O.key;if(C[R.bucketInstanceId]===void 0&&(C[R.bucketInstanceId]={}),C[R.bucketInstanceId][R.featureIndex])continue;const X=[new u.Point(O.x1,O.y1),new u.Point(O.x2,O.y1),new u.Point(O.x2,O.y2),new u.Point(O.x1,O.y2)];u.polygonIntersectsPolygon(c,X)&&(C[R.bucketInstanceId][R.featureIndex]=!0,A[R.bucketInstanceId]===void 0&&(A[R.bucketInstanceId]=[]),A[R.bucketInstanceId].push(R.featureIndex))}return A}insertCollisionBox(i,c,f,m,x,S){(f?this.ignoredGrid:this.grid).insert({bucketInstanceId:m,featureIndex:x,collisionGroupID:S,overlapMode:c},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,c,f,m,x,S){const P=f?this.ignoredGrid:this.grid,C={bucketInstanceId:m,featureIndex:x,collisionGroupID:S,overlapMode:c};for(let A=0;A<i.length;A+=4)P.insertCircle(C,i[A],i[A+1],i[A+2])}projectAndGetPerspectiveRatio(i,c,f,m){let x;return m?(x=[c,f,m(c,f),1],u.transformMat4(x,x,i)):(x=[c,f,0,1],J(x,x,i)),{point:new u.Point((x[0]/x[3]+1)/2*this.transform.width+st,(-x[1]/x[3]+1)/2*this.transform.height+st),perspectiveRatio:.5+this.transform.cameraToCenterDistance/x[3]*.5}}isOffscreen(i,c,f,m){return f<st||i>=this.screenRightBoundary||m<st||c>this.screenBottomBoundary}isInsideGrid(i,c,f,m){return f>=0&&i<this.gridRightBoundary&&m>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const i=u.identity([]);return u.translate(i,i,[-100,-100,0]),i}}function ut(d,i,c){return i*(u.EXTENT/(d.tileSize*Math.pow(2,c-d.tileID.overscaledZ)))}class at{constructor(i,c,f,m){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?c:-c))):m&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class vt{constructor(i,c,f,m,x){this.text=new at(i?i.text:null,c,f,x),this.icon=new at(i?i.icon:null,c,m,x)}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class zt{constructor(i,c,f){this.text=i,this.icon=c,this.skipFade=f}}class Bt{constructor(){this.invProjMatrix=u.create(),this.viewportMatrix=u.create(),this.circles=[]}}class Vt{constructor(i,c,f,m,x){this.bucketInstanceId=i,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=m,this.tileID=x}}class Ee{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const c=++this.maxGroupID;this.collisionGroups[i]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[i]}}function $e(d,i,c,f,m){const{horizontalAlign:x,verticalAlign:S}=u.getAnchorAlignment(d),P=-(x-.5)*i,C=-(S-.5)*c,A=u.evaluateVariableOffset(d,f);return new u.Point(P+A[0]*m,C+A[1]*m)}function Ce(d,i,c,f,m,x){const{x1:S,x2:P,y1:C,y2:A,anchorPointX:O,anchorPointY:R}=d,X=new u.Point(i,c);return f&&X._rotate(m?x:-x),{x1:S+X.x,y1:C+X.y,x2:P+X.x,y2:A+X.y,anchorPointX:O,anchorPointY:R}}class ke{constructor(i,c,f,m,x){this.transform=i.clone(),this.terrain=c,this.collisionIndex=new mt(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=f,this.retainedQueryData={},this.collisionGroups=new Ee(m),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,c,f,m){const x=f.getBucket(c),S=f.latestFeatureIndex;if(!x||!S||c.id!==x.layerIds[0])return;const P=f.collisionBoxArray,C=x.layers[0].layout,A=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),O=f.tileSize/u.EXTENT,R=this.transform.calculatePosMatrix(f.tileID.toUnwrapped()),X=C.get("text-pitch-alignment")==="map",et=C.get("text-rotation-alignment")==="map",$=ut(f,1,this.transform.zoom),Q=Ve(R,X,et,this.transform,$);let ot=null;if(X){const Pt=yi(R,X,et,this.transform,$);ot=u.multiply([],this.transform.labelPlaneMatrix,Pt)}this.retainedQueryData[x.bucketInstanceId]=new Vt(x.bucketInstanceId,S,x.sourceLayerIndex,x.index,f.tileID);const pt={bucket:x,layout:C,posMatrix:R,textLabelPlaneMatrix:Q,labelToScreenMatrix:ot,scale:A,textPixelRatio:O,holdingForFade:f.holdingForFade(),collisionBoxArray:P,partiallyEvaluatedTextSize:u.evaluateSizeForZoom(x.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(x.sourceID)};if(m)for(const Pt of x.sortKeyRanges){const{sortKey:rt,symbolInstanceStart:Tt,symbolInstanceEnd:Lt}=Pt;i.push({sortKey:rt,symbolInstanceStart:Tt,symbolInstanceEnd:Lt,parameters:pt})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:x.symbolInstances.length,parameters:pt})}attemptAnchorPlacement(i,c,f,m,x,S,P,C,A,O,R,X,et,$,Q,ot){const pt=[X.textOffset0,X.textOffset1],Pt=$e(i,f,m,pt,x),rt=this.collisionIndex.placeCollisionBox(Ce(c,Pt.x,Pt.y,S,P,this.transform.angle),R,C,A,O.predicate,ot);if((!Q||this.collisionIndex.placeCollisionBox(Ce(Q,Pt.x,Pt.y,S,P,this.transform.angle),R,C,A,O.predicate,ot).box.length!==0)&&rt.box.length>0){let Tt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID]&&this.prevPlacement.placements[X.crossTileID].text&&(Tt=this.prevPlacement.variableOffsets[X.crossTileID].anchor),X.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");return this.variableOffsets[X.crossTileID]={textOffset:pt,width:f,height:m,anchor:i,textBoxScale:x,prevAnchor:Tt},this.markUsedJustification(et,i,X,$),et.allowVerticalPlacement&&(this.markUsedOrientation(et,$,X),this.placedOrientations[X.crossTileID]=$),{shift:Pt,placedGlyphBoxes:rt}}}placeLayerBucketPart(i,c,f){const{bucket:m,layout:x,posMatrix:S,textLabelPlaneMatrix:P,labelToScreenMatrix:C,textPixelRatio:A,holdingForFade:O,collisionBoxArray:R,partiallyEvaluatedTextSize:X,collisionGroup:et}=i.parameters,$=x.get("text-optional"),Q=x.get("icon-optional"),ot=u.getOverlapMode(x,"text-overlap","text-allow-overlap"),pt=ot==="always",Pt=u.getOverlapMode(x,"icon-overlap","icon-allow-overlap"),rt=Pt==="always",Tt=x.get("text-rotation-alignment")==="map",Lt=x.get("text-pitch-alignment")==="map",jt=x.get("icon-text-fit")!=="none",Ht=x.get("symbol-z-order")==="viewport-y",Jt=pt&&(rt||!m.hasIconData()||Q),Yt=rt&&(pt||!m.hasTextData()||$);!m.collisionArrays&&R&&m.deserializeCollisionBoxes(R);const xe=this.retainedQueryData[m.bucketInstanceId].tileID,Oe=this.terrain?(ue,je)=>this.terrain.getElevation(xe,ue,je):null,nn=(ue,je)=>{if(c[ue.crossTileID])return;if(O)return void(this.placements[ue.crossTileID]=new zt(!1,!1,!1));let be=!1,Un=!1,ai=!0,Vn=null,ln={box:null,offscreen:null},ei={box:null,offscreen:null},Ao=null,li=null,Fi=null,cs=0,Xs=0,Ys=0;je.textFeatureIndex?cs=je.textFeatureIndex:ue.useRuntimeCollisionCircles&&(cs=ue.featureIndex),je.verticalTextFeatureIndex&&(Xs=je.verticalTextFeatureIndex);const Lo=je.textBox;if(Lo){const co=jn=>{let Ci=u.WritingMode.horizontal;if(m.allowVerticalPlacement&&!jn&&this.prevPlacement){const Ui=this.prevPlacement.placedOrientations[ue.crossTileID];Ui&&(this.placedOrientations[ue.crossTileID]=Ui,Ci=Ui,this.markUsedOrientation(m,Ci,ue))}return Ci},Bi=(jn,Ci)=>{if(m.allowVerticalPlacement&&ue.numVerticalGlyphVertices>0&&je.verticalTextBox){for(const Ui of m.writingModes)if(Ui===u.WritingMode.vertical?(ln=Ci(),ei=ln):ln=jn(),ln&&ln.box&&ln.box.length)break}else ln=jn()};if(x.get("text-variable-anchor")){let jn=x.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ue.crossTileID]){const Kn=this.prevPlacement.variableOffsets[ue.crossTileID];jn.indexOf(Kn.anchor)>0&&(jn=jn.filter(Pi=>Pi!==Kn.anchor),jn.unshift(Kn.anchor))}const Ci=(Kn,Pi,hs)=>{const Dh=Kn.x2-Kn.x1,sl=Kn.y2-Kn.y1,Ig=ue.textBoxScale,id=jt&&Pt==="never"?Pi:null;let xr={box:[],offscreen:!1};const qp=ot!=="never"?2*jn.length:jn.length;for(let Gc=0;Gc<qp;++Gc){const al=this.attemptAnchorPlacement(jn[Gc%jn.length],Kn,Dh,sl,Ig,Tt,Lt,A,S,et,Gc>=jn.length?ot:"never",ue,m,hs,id,Oe);if(al&&(xr=al.placedGlyphBoxes,xr&&xr.box&&xr.box.length)){be=!0,Vn=al.shift;break}}return xr};Bi(()=>Ci(Lo,je.iconBox,u.WritingMode.horizontal),()=>{const Kn=je.verticalTextBox;return m.allowVerticalPlacement&&!(ln&&ln.box&&ln.box.length)&&ue.numVerticalGlyphVertices>0&&Kn?Ci(Kn,je.verticalIconBox,u.WritingMode.vertical):{box:null,offscreen:null}}),ln&&(be=ln.box,ai=ln.offscreen);const Ui=co(ln&&ln.box);if(!be&&this.prevPlacement){const Kn=this.prevPlacement.variableOffsets[ue.crossTileID];Kn&&(this.variableOffsets[ue.crossTileID]=Kn,this.markUsedJustification(m,Kn.anchor,ue,Ui))}}else{const jn=(Ci,Ui)=>{const Kn=this.collisionIndex.placeCollisionBox(Ci,ot,A,S,et.predicate,Oe);return Kn&&Kn.box&&Kn.box.length&&(this.markUsedOrientation(m,Ui,ue),this.placedOrientations[ue.crossTileID]=Ui),Kn};Bi(()=>jn(Lo,u.WritingMode.horizontal),()=>{const Ci=je.verticalTextBox;return m.allowVerticalPlacement&&ue.numVerticalGlyphVertices>0&&Ci?jn(Ci,u.WritingMode.vertical):{box:null,offscreen:null}}),co(ln&&ln.box&&ln.box.length)}}if(Ao=ln,be=Ao&&Ao.box&&Ao.box.length>0,ai=Ao&&Ao.offscreen,ue.useRuntimeCollisionCircles){const co=m.text.placedSymbolArray.get(ue.centerJustifiedTextSymbolIndex),Bi=u.evaluateSizeForFeature(m.textSizeData,X,co),jn=x.get("text-padding");li=this.collisionIndex.placeCollisionCircles(ot,co,m.lineVertexArray,m.glyphOffsetArray,Bi,S,P,C,f,Lt,et.predicate,ue.collisionCircleDiameter,jn,Oe),li.circles.length&&li.collisionDetected&&!f&&u.warnOnce("Collisions detected, but collision boxes are not shown"),be=pt||li.circles.length>0&&!li.collisionDetected,ai=ai&&li.offscreen}if(je.iconFeatureIndex&&(Ys=je.iconFeatureIndex),je.iconBox){const co=Bi=>{const jn=jt&&Vn?Ce(Bi,Vn.x,Vn.y,Tt,Lt,this.transform.angle):Bi;return this.collisionIndex.placeCollisionBox(jn,Pt,A,S,et.predicate,Oe)};ei&&ei.box&&ei.box.length&&je.verticalIconBox?(Fi=co(je.verticalIconBox),Un=Fi.box.length>0):(Fi=co(je.iconBox),Un=Fi.box.length>0),ai=ai&&Fi.offscreen}const Ta=$||ue.numHorizontalGlyphVertices===0&&ue.numVerticalGlyphVertices===0,Vc=Q||ue.numIconVertices===0;if(Ta||Vc?Vc?Ta||(Un=Un&&be):be=Un&&be:Un=be=Un&&be,be&&Ao&&Ao.box&&this.collisionIndex.insertCollisionBox(Ao.box,ot,x.get("text-ignore-placement"),m.bucketInstanceId,ei&&ei.box&&Xs?Xs:cs,et.ID),Un&&Fi&&this.collisionIndex.insertCollisionBox(Fi.box,Pt,x.get("icon-ignore-placement"),m.bucketInstanceId,Ys,et.ID),li&&(be&&this.collisionIndex.insertCollisionCircles(li.circles,ot,x.get("text-ignore-placement"),m.bucketInstanceId,cs,et.ID),f)){const co=m.bucketInstanceId;let Bi=this.collisionCircleArrays[co];Bi===void 0&&(Bi=this.collisionCircleArrays[co]=new Bt);for(let jn=0;jn<li.circles.length;jn+=4)Bi.circles.push(li.circles[jn+0]),Bi.circles.push(li.circles[jn+1]),Bi.circles.push(li.circles[jn+2]),Bi.circles.push(li.collisionDetected?1:0)}if(ue.crossTileID===0)throw new Error("symbolInstance.crossTileID can't be 0");if(m.bucketInstanceId===0)throw new Error("bucket.bucketInstanceId can't be 0");this.placements[ue.crossTileID]=new zt(be||Jt,Un||Yt,ai||m.justReloaded),c[ue.crossTileID]=!0};if(Ht){if(i.symbolInstanceStart!==0)throw new Error("bucket.bucketInstanceId should be 0");const ue=m.getSortedSymbolIndexes(this.transform.angle);for(let je=ue.length-1;je>=0;--je){const be=ue[je];nn(m.symbolInstances.get(be),m.collisionArrays[be])}}else for(let ue=i.symbolInstanceStart;ue<i.symbolInstanceEnd;ue++)nn(m.symbolInstances.get(ue),m.collisionArrays[ue]);if(f&&m.bucketInstanceId in this.collisionCircleArrays){const ue=this.collisionCircleArrays[m.bucketInstanceId];u.invert(ue.invProjMatrix,S),ue.viewportMatrix=this.collisionIndex.getViewportMatrix()}m.justReloaded=!1}markUsedJustification(i,c,f,m){let x;x=m===u.WritingMode.vertical?f.verticalPlacedTextSymbolIndex:{left:f.leftJustifiedTextSymbolIndex,center:f.centerJustifiedTextSymbolIndex,right:f.rightJustifiedTextSymbolIndex}[u.getAnchorJustification(c)];const S=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex,f.verticalPlacedTextSymbolIndex];for(const P of S)P>=0&&(i.text.placedSymbolArray.get(P).crossTileID=x>=0&&P!==x?0:f.crossTileID)}markUsedOrientation(i,c,f){const m=c===u.WritingMode.horizontal||c===u.WritingMode.horizontalOnly?c:0,x=c===u.WritingMode.vertical?c:0,S=[f.leftJustifiedTextSymbolIndex,f.centerJustifiedTextSymbolIndex,f.rightJustifiedTextSymbolIndex];for(const P of S)i.text.placedSymbolArray.get(P).placedOrientation=m;f.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(f.verticalPlacedTextSymbolIndex).placedOrientation=x)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const m=c?c.symbolFadeChange(i):1,x=c?c.opacities:{},S=c?c.variableOffsets:{},P=c?c.placedOrientations:{};for(const C in this.placements){const A=this.placements[C],O=x[C];O?(this.opacities[C]=new vt(O,m,A.text,A.icon),f=f||A.text!==O.text.placed||A.icon!==O.icon.placed):(this.opacities[C]=new vt(null,m,A.text,A.icon,A.skipFade),f=f||A.text||A.icon)}for(const C in x){const A=x[C];if(!this.opacities[C]){const O=new vt(A,m,!1,!1);O.isHidden()||(this.opacities[C]=O,f=f||A.text.placed||A.icon.placed)}}for(const C in S)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=S[C]);for(const C in P)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=P[C]);if(c&&c.lastPlacementChangeTime===void 0)throw new Error("Last placement time for previous placement is not defined");f?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:i)}updateLayerOpacities(i,c){const f={};for(const m of c){const x=m.getBucket(i);x&&m.latestFeatureIndex&&i.id===x.layerIds[0]&&this.updateBucketOpacities(x,f,m.collisionBoxArray)}}updateBucketOpacities(i,c,f){i.hasTextData()&&(i.text.opacityVertexArray.clear(),i.text.hasVisibleVertices=!1),i.hasIconData()&&(i.icon.opacityVertexArray.clear(),i.icon.hasVisibleVertices=!1),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const m=i.layers[0].layout,x=new vt(null,0,!1,!1,!0),S=m.get("text-allow-overlap"),P=m.get("icon-allow-overlap"),C=m.get("text-variable-anchor"),A=m.get("text-rotation-alignment")==="map",O=m.get("text-pitch-alignment")==="map",R=m.get("icon-text-fit")!=="none",X=new vt(null,0,S&&(P||!i.hasIconData()||m.get("icon-optional")),P&&(S||!i.hasTextData()||m.get("text-optional")),!0);!i.collisionArrays&&f&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(f);const et=($,Q,ot)=>{for(let pt=0;pt<Q/4;pt++)$.opacityVertexArray.emplaceBack(ot);$.hasVisibleVertices=$.hasVisibleVertices||ot!==yr};for(let $=0;$<i.symbolInstances.length;$++){const Q=i.symbolInstances.get($),{numHorizontalGlyphVertices:ot,numVerticalGlyphVertices:pt,crossTileID:Pt}=Q;let rt=this.opacities[Pt];c[Pt]?rt=x:rt||(rt=X,this.opacities[Pt]=rt),c[Pt]=!0;const Tt=Q.numIconVertices>0,Lt=this.placedOrientations[Q.crossTileID],jt=Lt===u.WritingMode.vertical,Ht=Lt===u.WritingMode.horizontal||Lt===u.WritingMode.horizontalOnly;if(ot>0||pt>0){const Jt=pa(rt.text);et(i.text,ot,jt?yr:Jt),et(i.text,pt,Ht?yr:Jt);const Yt=rt.text.isHidden();[Q.rightJustifiedTextSymbolIndex,Q.centerJustifiedTextSymbolIndex,Q.leftJustifiedTextSymbolIndex].forEach(nn=>{nn>=0&&(i.text.placedSymbolArray.get(nn).hidden=Yt||jt?1:0)}),Q.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(Q.verticalPlacedTextSymbolIndex).hidden=Yt||Ht?1:0);const xe=this.variableOffsets[Q.crossTileID];xe&&this.markUsedJustification(i,xe.anchor,Q,Lt);const Oe=this.placedOrientations[Q.crossTileID];Oe&&(this.markUsedJustification(i,"left",Q,Oe),this.markUsedOrientation(i,Oe,Q))}if(Tt){const Jt=pa(rt.icon),Yt=!(R&&Q.verticalPlacedIconSymbolIndex&&jt);Q.placedIconSymbolIndex>=0&&(et(i.icon,Q.numIconVertices,Yt?Jt:yr),i.icon.placedSymbolArray.get(Q.placedIconSymbolIndex).hidden=rt.icon.isHidden()),Q.verticalPlacedIconSymbolIndex>=0&&(et(i.icon,Q.numVerticalIconVertices,Yt?yr:Jt),i.icon.placedSymbolArray.get(Q.verticalPlacedIconSymbolIndex).hidden=rt.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Jt=i.collisionArrays[$];if(Jt){let Yt=new u.Point(0,0);if(Jt.textBox||Jt.verticalTextBox){let Oe=!0;if(C){const nn=this.variableOffsets[Pt];nn?(Yt=$e(nn.anchor,nn.width,nn.height,nn.textOffset,nn.textBoxScale),A&&Yt._rotate(O?this.transform.angle:-this.transform.angle)):Oe=!1}Jt.textBox&&Ze(i.textCollisionBox.collisionVertexArray,rt.text.placed,!Oe||jt,Yt.x,Yt.y),Jt.verticalTextBox&&Ze(i.textCollisionBox.collisionVertexArray,rt.text.placed,!Oe||Ht,Yt.x,Yt.y)}const xe=!!(!Ht&&Jt.verticalIconBox);Jt.iconBox&&Ze(i.iconCollisionBox.collisionVertexArray,rt.icon.placed,xe,R?Yt.x:0,R?Yt.y:0),Jt.verticalIconBox&&Ze(i.iconCollisionBox.collisionVertexArray,rt.icon.placed,!xe,R?Yt.x:0,R?Yt.y:0)}}}if(i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.text.opacityVertexArray.length!==i.text.layoutVertexArray.length/4)throw new Error(`bucket.text.opacityVertexArray.length (= ${i.text.opacityVertexArray.length}) !== bucket.text.layoutVertexArray.length (= ${i.text.layoutVertexArray.length}) / 4`);if(i.icon.opacityVertexArray.length!==i.icon.layoutVertexArray.length/4)throw new Error(`bucket.icon.opacityVertexArray.length (= ${i.icon.opacityVertexArray.length}) !== bucket.icon.layoutVertexArray.length (= ${i.icon.layoutVertexArray.length}) / 4`);if(i.bucketInstanceId in this.collisionCircleArrays){const $=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=$.invProjMatrix,i.placementViewportMatrix=$.viewportMatrix,i.collisionCircleArray=$.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,c){const f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>i}setStale(){this.stale=!0}}function Ze(d,i,c,f,m){d.emplaceBack(i?1:0,c?1:0,f||0,m||0),d.emplaceBack(i?1:0,c?1:0,f||0,m||0),d.emplaceBack(i?1:0,c?1:0,f||0,m||0),d.emplaceBack(i?1:0,c?1:0,f||0,m||0)}const En=Math.pow(2,25),hn=Math.pow(2,24),In=Math.pow(2,17),Wn=Math.pow(2,16),Rr=Math.pow(2,9),Te=Math.pow(2,8),_r=Math.pow(2,1);function pa(d){if(d.opacity===0&&!d.placed)return 0;if(d.opacity===1&&d.placed)return 4294967295;const i=d.placed?1:0,c=Math.floor(127*d.opacity);return c*En+i*hn+c*In+i*Wn+c*Rr+i*Te+c*_r+i}const yr=0;class Or{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&!i.layout.get("symbol-sort-key").isConstant(),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,c,f,m,x){const S=this._bucketParts;for(;this._currentTileIndex<i.length;)if(c.getBucketParts(S,m,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,x())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,S.sort((P,C)=>P.sortKey-C.sortKey));this._currentPartIndex<S.length;)if(c.placeLayerBucketPart(S[this._currentPartIndex],this._seenCrossTileIDs,f),this._currentPartIndex++,x())return!0;return!1}}class Ji{constructor(i,c,f,m,x,S,P,C){this.placement=new ke(i,c,S,P,C),this._currentPlacementIndex=f.length-1,this._forceFullPlacement=m,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,c,f){const m=u.exported.now(),x=()=>!this._forceFullPlacement&&u.exported.now()-m>2;for(;this._currentPlacementIndex>=0;){const S=c[i[this._currentPlacementIndex]],P=this.placement.collisionIndex.transform.zoom;if(S.type==="symbol"&&(!S.minzoom||S.minzoom<=P)&&(!S.maxzoom||S.maxzoom>P)){if(this._inProgressLayer||(this._inProgressLayer=new Or(S)),this._inProgressLayer.continuePlacement(f[S.source],this.placement,this._showCollisionBoxes,S,x))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Go=512/u.EXTENT/2;class Ps{constructor(i,c,f){this.tileID=i,this.bucketInstanceId=f,this._symbolsByKey={};const m=new Map;for(let x=0;x<c.length;x++){const S=c.get(x),P=S.key,C=m.get(P);C?C.push(S):m.set(P,[S])}for(const[x,S]of m){const P={positions:S.map(C=>({x:Math.floor(C.anchorX*Go),y:Math.floor(C.anchorY*Go)})),crossTileIDs:S.map(C=>C.crossTileID)};if(P.positions.length>128){const C=new u.KDBush(P.positions.length,16,Uint16Array);for(const{x:A,y:O}of P.positions)C.add(A,O);C.finish(),delete P.positions,P.index=C}this._symbolsByKey[x]=P}}getScaledCoordinates(i,c){const{x:f,y:m,z:x}=this.tileID.canonical,{x:S,y:P,z:C}=c.canonical,A=Go/Math.pow(2,C-x),O=(P*u.EXTENT+i.anchorY)*A,R=m*u.EXTENT*Go;return{x:Math.floor((S*u.EXTENT+i.anchorX)*A-f*u.EXTENT*Go),y:Math.floor(O-R)}}findMatches(i,c,f){const m=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z);for(let x=0;x<i.length;x++){const S=i.get(x);if(S.crossTileID)continue;const P=this._symbolsByKey[S.key];if(!P)continue;const C=this.getScaledCoordinates(S,c);if(P.index){const A=P.index.range(C.x-m,C.y-m,C.x+m,C.y+m).sort();for(const O of A){const R=P.crossTileIDs[O];if(!f[R]){f[R]=!0,S.crossTileID=R;break}}}else if(P.positions)for(let A=0;A<P.positions.length;A++){const O=P.positions[A],R=P.crossTileIDs[A];if(Math.abs(O.x-C.x)<=m&&Math.abs(O.y-C.y)<=m&&!f[R]){f[R]=!0,S.crossTileID=R;break}}}}getCrossTileIDsLists(){return Object.values(this._symbolsByKey).map(({crossTileIDs:i})=>i)}}class jr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ql{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const c=Math.round((i-this.lng)/360);if(c!==0)for(const f in this.indexes){const m=this.indexes[f],x={};for(const S in m){const P=m[S];P.tileID=P.tileID.unwrapTo(P.tileID.wrap+c),x[P.tileID.key]=P}this.indexes[f]=x}this.lng=i}addBucket(i,c,f){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let x=0;x<c.symbolInstances.length;x++)c.symbolInstances.get(x).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const m=this.usedCrossTileIDs[i.overscaledZ];for(const x in this.indexes){const S=this.indexes[x];if(Number(x)>i.overscaledZ)for(const P in S){const C=S[P];C.tileID.isChildOf(i)&&C.findMatches(c.symbolInstances,i,m)}else{const P=S[i.scaledTo(Number(x)).key];P&&P.findMatches(c.symbolInstances,i,m)}}for(let x=0;x<c.symbolInstances.length;x++){const S=c.symbolInstances.get(x);S.crossTileID||(S.crossTileID=f.generate(),m[S.crossTileID]=!0)}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Ps(i,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(i,c){for(const f of c.getCrossTileIDsLists())for(const m of f)delete this.usedCrossTileIDs[i][m]}removeStaleBuckets(i){let c=!1;for(const f in this.indexes){const m=this.indexes[f];for(const x in m)i[m[x].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,m[x]),delete m[x],c=!0)}return c}}class fa{constructor(){this.layerIndexes={},this.crossTileIDs=new jr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,c,f){let m=this.layerIndexes[i.id];m===void 0&&(m=this.layerIndexes[i.id]=new Ql);let x=!1;const S={};m.handleWrapJump(f);for(const P of c){const C=P.getBucket(i);C&&i.id===C.layerIds[0]&&(C.bucketInstanceId||(C.bucketInstanceId=++this.maxBucketInstanceId),m.addBucket(P.tileID,C,this.crossTileIDs)&&(x=!0),S[C.bucketInstanceId]=!0)}return m.removeStaleBuckets(S)&&(x=!0),x}pruneUnusedLayers(i){const c={};i.forEach(f=>{c[f]=!0});for(const f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}const qr=(d,i)=>u.emitValidationErrors(d,i&&i.filter(c=>c.identifier!=="source.canvas")),tu=u.pick(u.operations,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setGlyphs","setSprite"]),so=u.pick(u.operations,["setCenter","setZoom","setBearing","setPitch"]),ph=u.emptyStyle();class vi extends u.Evented{constructor(i,c={}){super(),this.map=i,this.dispatcher=new wn(ss(),this,i._getMapId()),this.imageManager=new Ue,this.imageManager.setEventedParent(this),this.glyphManager=new yn(i._requestManager,c.localIdeographFontFamily),this.lineAtlas=new pr(256,512),this.crossTileSymbolIndex=new fa,this._spritesImagesIds={},this._layers={},this._order=[],this.sourceCaches={},this.zoomHistory=new u.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",u.getReferrer());const f=this;this._rtlTextPluginCallback=vi.registerForPluginStateChange(m=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:m.pluginStatus,pluginURL:m.pluginURL},(x,S)=>{if(u.triggerPluginCompletionEvent(x),S&&S.every(P=>P))for(const P in f.sourceCaches){const C=f.sourceCaches[P].getSource().type;C!=="vector"&&C!=="geojson"||f.sourceCaches[P].reload()}})}),this.on("data",m=>{if(m.dataType!=="source"||m.sourceDataType!=="metadata")return;const x=this.sourceCaches[m.sourceId];if(!x)return;const S=x.getSource();if(S&&S.vectorLayerIds)for(const P in this._layers){const C=this._layers[P];C.source===S.id&&this._validateLayer(C)}})}loadURL(i,c={},f){this.fire(new u.Event("dataloading",{dataType:"style"})),c.validate=typeof c.validate!="boolean"||c.validate;const m=this.map._requestManager.transformRequest(i,dt.Style);this._request=u.getJSON(m,(x,S)=>{this._request=null,x?this.fire(new u.ErrorEvent(x)):S&&this._load(S,c,f)})}loadJSON(i,c={},f){this.fire(new u.Event("dataloading",{dataType:"style"})),this._request=u.exported.frame(()=>{this._request=null,c.validate=c.validate!==!1,this._load(i,c,f)})}loadEmpty(){this.fire(new u.Event("dataloading",{dataType:"style"})),this._load(ph,{validate:!1})}_load(i,c,f){const m=c.transformStyle?c.transformStyle(f,i):i;if(!c.validate||!qr(this,u.validateStyle(m))){this._loaded=!0,this.stylesheet=m;for(const x in m.sources)this.addSource(x,m.sources[x],{validate:!1});m.sprite?this._loadSprite(m.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(m.glyphs),this._createLayers(),this.light=new An(this.stylesheet.light),this.map.setTerrain(this.stylesheet.terrain),this.fire(new u.Event("data",{dataType:"style"})),this.fire(new u.Event("style.load"))}}_createLayers(){const i=u.derefLayers(this.stylesheet.layers);this.dispatcher.broadcast("setLayers",i),this._order=i.map(c=>c.id),this._layers={},this._serializedLayers=null;for(const c of i){const f=u.createStyleLayer(c);f.setEventedParent(this,{layer:{id:c.id}}),this._layers[c.id]=f}}_loadSprite(i,c=!1,f=void 0){this.imageManager.setLoaded(!1),this._spriteRequest=function(m,x,S,P){const C=qt(m),A=C.length,O=S>1?"@2x":"",R={},X={},et={};for(const{id:$,url:Q}of C){const ot=x.transformRequest(x.normalizeSpriteURL(Q,O,".json"),dt.SpriteJSON),pt=`${$}_${ot.url}`;R[pt]=u.getJSON(ot,(Tt,Lt)=>{delete R[pt],X[$]=Lt,Qt(P,X,et,Tt,A)});const Pt=x.transformRequest(x.normalizeSpriteURL(Q,O,".png"),dt.SpriteImage),rt=`${$}_${Pt.url}`;R[rt]=xt.getImage(Pt,(Tt,Lt)=>{delete R[rt],et[$]=Lt,Qt(P,X,et,Tt,A)})}return{cancel(){for(const $ of Object.values(R))$.cancel()}}}(i,this.map._requestManager,this.map.getPixelRatio(),(m,x)=>{if(this._spriteRequest=null,m)this.fire(new u.ErrorEvent(m));else if(x)for(const S in x){this._spritesImagesIds[S]=[];const P=this._spritesImagesIds[S]?this._spritesImagesIds[S].filter(C=>!(C in x)):[];for(const C of P)this.imageManager.removeImage(C),this._changedImages[C]=!0;for(const C in x[S]){const A=S==="default"?C:`${S}:${C}`;this._spritesImagesIds[S].push(A),A in this.imageManager.images?this.imageManager.updateImage(A,x[S][C],!1):this.imageManager.addImage(A,x[S][C]),c&&(this._changedImages[A]=!0)}}this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),c&&(this._changed=!0),this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"})),f&&f(m)})}_unloadSprite(){for(const i of Object.values(this._spritesImagesIds).flat())this.imageManager.removeImage(i),this._changedImages[i]=!0;this._spritesImagesIds={},this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}_validateLayer(i){const c=this.sourceCaches[i.source];if(!c)return;const f=i.sourceLayer;if(!f)return;const m=c.getSource();(m.type==="geojson"||m.vectorLayerIds&&m.vectorLayerIds.indexOf(f)===-1)&&this.fire(new u.ErrorEvent(new Error(`Source layer "${f}" does not exist on source "${m.id}" as specified by style layer "${i.id}".`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this.sourceCaches)if(!this.sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeByIds(i){const c=this._serializedAllLayers();if(!i||i.length===0)return Object.values(c);const f=[];for(const m of i)c[m]&&f.push(c[m]);return f}_serializedAllLayers(){let i=this._serializedLayers;if(i)return i;i=this._serializedLayers={};const c=Object.keys(this._layers);for(const f of c){const m=this._layers[f];m.type!=="custom"&&(i[f]=m.serialize())}return i}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;for(const i in this.sourceCaches)if(this.sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading.")}update(i){if(!this._loaded)return;const c=this._changed;if(this._changed){const m=Object.keys(this._updatedLayers),x=Object.keys(this._removedLayers);(m.length||x.length)&&this._updateWorkerLayers(m,x);for(const S in this._updatedSources){const P=this._updatedSources[S];if(P==="reload")this._reloadSource(S);else{if(P!=="clear")throw new Error(`Invalid action ${P}`);this._clearSource(S)}}this._updateTilesForChangedImages(),this._updateTilesForChangedGlyphs();for(const S in this._updatedPaintProps)this._layers[S].updateTransitions(i);this.light.updateTransitions(i),this._resetUpdates()}const f={};for(const m in this.sourceCaches){const x=this.sourceCaches[m];f[m]=x.used,x.used=!1}for(const m of this._order){const x=this._layers[m];x.recalculate(i,this._availableImages),!x.isHidden(i.zoom)&&x.source&&(this.sourceCaches[x.source].used=!0)}for(const m in f){const x=this.sourceCaches[m];f[m]!==x.used&&x.fire(new u.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:m}))}this.light.recalculate(i),this.z=i.zoom,c&&this.fire(new u.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const c in this.sourceCaches)this.sourceCaches[c].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateTilesForChangedGlyphs(){if(this._glyphsDidChange){for(const i in this.sourceCaches)this.sourceCaches[i].reloadTilesForDependencies(["glyphs"],[""]);this._glyphsDidChange=!1}}_updateWorkerLayers(i,c){this.dispatcher.broadcast("updateLayers",{layers:this._serializeByIds(i),removedIds:c})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={},this._glyphsDidChange=!1}setState(i,c={}){this._checkLoaded();const f=this.serialize();if(i=c.transformStyle?c.transformStyle(f,i):i,qr(this,u.validateStyle(i)))return!1;(i=u.clone$1(i)).layers=u.derefLayers(i.layers);const m=u.diffStyles(f,i).filter(S=>!(S.command in so));if(m.length===0)return!1;const x=m.filter(S=>!(S.command in tu));if(x.length>0)throw new Error(`Unimplemented: ${x.map(S=>S.command).join(", ")}.`);for(const S of m)S.command!=="setTransition"&&this[S.command].apply(this,S.args);return this.stylesheet=i,!0}addImage(i,c){if(this.getImage(i))return this.fire(new u.ErrorEvent(new Error(`An image named "${i}" already exists.`)));this.imageManager.addImage(i,c),this._afterImageUpdated(i)}updateImage(i,c){this.imageManager.updateImage(i,c)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){if(!this.getImage(i))return this.fire(new u.ErrorEvent(new Error(`An image named "${i}" does not exist.`)));this.imageManager.removeImage(i),this._afterImageUpdated(i)}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this.imageManager.listImages()}addSource(i,c,f={}){if(this._checkLoaded(),this.sourceCaches[i]!==void 0)throw new Error(`Source "${i}" already exists.`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(u.validateStyle.source,`sources.${i}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const m=this.sourceCaches[i]=new Tr(i,c,this.dispatcher);m.style=this,m.setEventedParent(this,()=>({isSourceLoaded:m.loaded(),source:m.serialize(),sourceId:i})),m.onAdd(this.map),this._changed=!0}removeSource(i){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error("There is no source with this ID");for(const f in this._layers)if(this._layers[f].source===i)return this.fire(new u.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${f}" is using it.`)));const c=this.sourceCaches[i];delete this.sourceCaches[i],delete this._updatedSources[i],c.fire(new u.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:i})),c.setEventedParent(null),c.onRemove(this.map),this._changed=!0}setGeoJSONSourceData(i,c){if(this._checkLoaded(),this.sourceCaches[i]===void 0)throw new Error(`There is no source with this ID=${i}`);const f=this.sourceCaches[i].getSource();if(f.type!=="geojson")throw new Error(`geojsonSource.type is ${f.type}, which is !== 'geojson`);f.setData(c),this._changed=!0}getSource(i){return this.sourceCaches[i]&&this.sourceCaches[i].getSource()}addLayer(i,c,f={}){this._checkLoaded();const m=i.id;if(this.getLayer(m))return void this.fire(new u.ErrorEvent(new Error(`Layer "${m}" already exists on this map.`)));let x;if(i.type==="custom"){if(qr(this,u.validateCustomStyleLayer(i)))return;x=u.createStyleLayer(i)}else{if(typeof i.source=="object"&&(this.addSource(m,i.source),i=u.clone$1(i),i=u.extend(i,{source:m})),this._validate(u.validateStyle.layer,`layers.${m}`,i,{arrayIndex:-1},f))return;x=u.createStyleLayer(i),this._validateLayer(x),x.setEventedParent(this,{layer:{id:m}})}const S=c?this._order.indexOf(c):this._order.length;if(c&&S===-1)this.fire(new u.ErrorEvent(new Error(`Cannot add layer "${m}" before non-existing layer "${c}".`)));else{if(this._order.splice(S,0,m),this._layerOrderChanged=!0,this._layers[m]=x,this._removedLayers[m]&&x.source&&x.type!=="custom"){const P=this._removedLayers[m];delete this._removedLayers[m],P.type!==x.type?this._updatedSources[x.source]="clear":(this._updatedSources[x.source]="reload",this.sourceCaches[x.source].pause())}this._updateLayer(x),x.onAdd&&x.onAdd(this.map)}}moveLayer(i,c){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new u.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===c)return;const f=this._order.indexOf(i);this._order.splice(f,1);const m=c?this._order.indexOf(c):this._order.length;c&&m===-1?this.fire(new u.ErrorEvent(new Error(`Cannot move layer "${i}" before non-existing layer "${c}".`))):(this._order.splice(m,0,i),this._layerOrderChanged=!0)}removeLayer(i){this._checkLoaded();const c=this._layers[i];if(!c)return void this.fire(new u.ErrorEvent(new Error(`Cannot remove non-existing layer "${i}".`)));c.setEventedParent(null);const f=this._order.indexOf(i);this._order.splice(f,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=c,delete this._layers[i],this._serializedLayers&&delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],c.onRemove&&c.onRemove(this.map)}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}setLayerZoomRange(i,c,f){this._checkLoaded();const m=this.getLayer(i);m?m.minzoom===c&&m.maxzoom===f||(c!=null&&(m.minzoom=c),f!=null&&(m.maxzoom=f),this._updateLayer(m)):this.fire(new u.ErrorEvent(new Error(`Cannot set the zoom range of non-existing layer "${i}".`)))}setFilter(i,c,f={}){this._checkLoaded();const m=this.getLayer(i);if(m){if(!u.deepEqual(m.filter,c))return c==null?(m.filter=void 0,void this._updateLayer(m)):void(this._validate(u.validateStyle.filter,`layers.${m.id}.filter`,c,null,f)||(m.filter=u.clone$1(c),this._updateLayer(m)))}else this.fire(new u.ErrorEvent(new Error(`Cannot filter non-existing layer "${i}".`)))}getFilter(i){return u.clone$1(this.getLayer(i).filter)}setLayoutProperty(i,c,f,m={}){this._checkLoaded();const x=this.getLayer(i);x?u.deepEqual(x.getLayoutProperty(c),f)||(x.setLayoutProperty(c,f,m),this._updateLayer(x)):this.fire(new u.ErrorEvent(new Error(`Cannot style non-existing layer "${i}".`)))}getLayoutProperty(i,c){const f=this.getLayer(i);if(f)return f.getLayoutProperty(c);this.fire(new u.ErrorEvent(new Error(`Cannot get style of non-existing layer "${i}".`)))}setPaintProperty(i,c,f,m={}){this._checkLoaded();const x=this.getLayer(i);x?u.deepEqual(x.getPaintProperty(c),f)||(x.setPaintProperty(c,f,m)&&this._updateLayer(x),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new u.ErrorEvent(new Error(`Cannot style non-existing layer "${i}".`)))}getPaintProperty(i,c){return this.getLayer(i).getPaintProperty(c)}setFeatureState(i,c){this._checkLoaded();const f=i.source,m=i.sourceLayer,x=this.sourceCaches[f];if(x===void 0)return void this.fire(new u.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const S=x.getSource().type;S==="geojson"&&m?this.fire(new u.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):S!=="vector"||m?(i.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),x.setFeatureState(m,i.id,c)):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}removeFeatureState(i,c){this._checkLoaded();const f=i.source,m=this.sourceCaches[f];if(m===void 0)return void this.fire(new u.ErrorEvent(new Error(`The source '${f}' does not exist in the map's style.`)));const x=m.getSource().type,S=x==="vector"?i.sourceLayer:void 0;x!=="vector"||S?c&&typeof i.id!="string"&&typeof i.id!="number"?this.fire(new u.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):m.removeFeatureState(S,i.id,c):this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}getFeatureState(i){this._checkLoaded();const c=i.source,f=i.sourceLayer,m=this.sourceCaches[c];if(m!==void 0)return m.getSource().type!=="vector"||f?(i.id===void 0&&this.fire(new u.ErrorEvent(new Error("The feature id parameter must be provided."))),m.getFeatureState(f,i.id)):void this.fire(new u.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));this.fire(new u.ErrorEvent(new Error(`The source '${c}' does not exist in the map's style.`)))}getTransition(){return u.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i=u.mapObject(this.sourceCaches,m=>m.serialize()),c=this._serializeByIds(this._order),f=this.stylesheet;return u.filterObject({version:f.version,name:f.name,metadata:f.metadata,light:f.light,center:f.center,zoom:f.zoom,bearing:f.bearing,pitch:f.pitch,sprite:f.sprite,glyphs:f.glyphs,transition:f.transition,sources:i,layers:c},m=>m!==void 0)}_updateLayer(i){this._updatedLayers[i.id]=!0,i.source&&!this._updatedSources[i.source]&&this.sourceCaches[i.source].getSource().type!=="raster"&&(this._updatedSources[i.source]="reload",this.sourceCaches[i.source].pause()),this._serializedLayers=null,this._changed=!0}_flattenAndSortRenderedFeatures(i){const c=S=>this._layers[S].type==="fill-extrusion",f={},m=[];for(let S=this._order.length-1;S>=0;S--){const P=this._order[S];if(c(P)){f[P]=S;for(const C of i){const A=C[P];if(A)for(const O of A)m.push(O)}}}m.sort((S,P)=>P.intersectionZ-S.intersectionZ);const x=[];for(let S=this._order.length-1;S>=0;S--){const P=this._order[S];if(c(P))for(let C=m.length-1;C>=0;C--){const A=m[C].feature;if(f[A.layer.id]<S)break;x.push(A),m.pop()}else for(const C of i){const A=C[P];if(A)for(const O of A)x.push(O.feature)}}return x}queryRenderedFeatures(i,c,f){c&&c.filter&&this._validate(u.validateStyle.filter,"queryRenderedFeatures.filter",c.filter,null,c);const m={};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new u.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const P of c.layers){const C=this._layers[P];if(!C)return this.fire(new u.ErrorEvent(new Error(`The layer '${P}' does not exist in the map's style and cannot be queried for features.`))),[];m[C.source]=!0}}const x=[];c.availableImages=this._availableImages;const S=this._serializedAllLayers();for(const P in this.sourceCaches)c.layers&&!m[P]||x.push(Ln(this.sourceCaches[P],this._layers,S,i,c,f));return this.placement&&x.push(function(P,C,A,O,R,X,et){const $={},Q=X.queryRenderedSymbols(O),ot=[];for(const pt of Object.keys(Q).map(Number))ot.push(et[pt]);ot.sort(pn);for(const pt of ot){const Pt=pt.featureIndex.lookupSymbolFeatures(Q[pt.bucketInstanceId],C,pt.bucketIndex,pt.sourceLayerIndex,R.filter,R.layers,R.availableImages,P);for(const rt in Pt){const Tt=$[rt]=$[rt]||[],Lt=Pt[rt];Lt.sort((jt,Ht)=>{const Jt=pt.featureSortOrder;if(Jt){const Yt=Jt.indexOf(jt.featureIndex);return Jt.indexOf(Ht.featureIndex)-Yt}return Ht.featureIndex-jt.featureIndex});for(const jt of Lt)Tt.push(jt)}}for(const pt in $)$[pt].forEach(Pt=>{const rt=Pt.feature,Tt=A[P[pt].source].getFeatureState(rt.layer["source-layer"],rt.id);rt.source=rt.layer.source,rt.layer["source-layer"]&&(rt.sourceLayer=rt.layer["source-layer"]),rt.state=Tt});return $}(this._layers,S,this.sourceCaches,i,c,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(x)}querySourceFeatures(i,c){c&&c.filter&&this._validate(u.validateStyle.filter,"querySourceFeatures.filter",c.filter,null,c);const f=this.sourceCaches[i];return f?function(m,x){const S=m.getRenderableIds().map(A=>m.getTileByID(A)),P=[],C={};for(let A=0;A<S.length;A++){const O=S[A],R=O.tileID.canonical.key;C[R]||(C[R]=!0,O.querySourceFeatures(P,x))}return P}(f,c):[]}addSourceType(i,c,f){return vi.getSourceType(i)?f(new Error(`A source type called "${i}" already exists.`)):(vi.setSourceType(i,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:c.workerSourceURL},f):f(null,null))}getLight(){return this.light.getLight()}setLight(i,c={}){this._checkLoaded();const f=this.light.getLight();let m=!1;for(const S in i)if(!u.deepEqual(i[S],f[S])){m=!0;break}if(!m)return;const x={now:u.exported.now(),transition:u.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(i,c),this.light.updateTransitions(x)}_validate(i,c,f,m,x={}){return(!x||x.validate!==!1)&&qr(this,i.call(u.validateStyle,u.extend({key:c,style:this.serialize(),value:f,styleSpec:u.v8Spec},m)))}_remove(i=!0){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),u.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const c in this._layers)this._layers[c].setEventedParent(null);for(const c in this.sourceCaches){const f=this.sourceCaches[c];f.setEventedParent(null),f.onRemove(this.map)}this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove(i)}_clearSource(i){this.sourceCaches[i].clearTiles()}_reloadSource(i){this.sourceCaches[i].resume(),this.sourceCaches[i].reload()}_updateSources(i){for(const c in this.sourceCaches)this.sourceCaches[c].update(i,this.map.terrain)}_generateCollisionBoxes(){for(const i in this.sourceCaches)this._reloadSource(i)}_updatePlacement(i,c,f,m,x=!1){let S=!1,P=!1;const C={};for(const A of this._order){const O=this._layers[A];if(O.type!=="symbol")continue;if(!C[O.source]){const X=this.sourceCaches[O.source];C[O.source]=X.getRenderableIds(!0).map(et=>X.getTileByID(et)).sort((et,$)=>$.tileID.overscaledZ-et.tileID.overscaledZ||(et.tileID.isLessThan($.tileID)?-1:1))}const R=this.crossTileSymbolIndex.addLayer(O,C[O.source],i.center.lng);S=S||R}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((x=x||this._layerOrderChanged||f===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(u.exported.now(),i.zoom))&&(this.pauseablePlacement=new Ji(i,this.map.terrain,this._order,x,c,f,m,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,C),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(u.exported.now()),P=!0),S&&this.pauseablePlacement.placement.setStale()),P||S)for(const A of this._order){const O=this._layers[A];O.type==="symbol"&&this.placement.updateLayerOpacities(O,C[O.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(u.exported.now())}_releaseSymbolFadeTiles(){for(const i in this.sourceCaches)this.sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,c,f){this.imageManager.getImages(c.icons,f),this._updateTilesForChangedImages();const m=this.sourceCaches[c.source];m&&m.setDependencies(c.tileID.key,c.type,c.icons)}getGlyphs(i,c,f){this.glyphManager.getGlyphs(c.stacks,f);const m=this.sourceCaches[c.source];m&&m.setDependencies(c.tileID.key,c.type,[""])}getResource(i,c,f){return u.makeRequest(c,f)}getGlyphsUrl(){return this.stylesheet.glyphs||null}setGlyphs(i,c={}){this._checkLoaded(),i&&this._validate(u.validateStyle.glyphs,"glyphs",i,null,c)||(this._glyphsDidChange=!0,this.stylesheet.glyphs=i,this.glyphManager.entries={},this.glyphManager.setURL(i))}addSprite(i,c,f={},m){this._checkLoaded();const x=[{id:i,url:c}],S=[...qt(this.stylesheet.sprite),...x];this._validate(u.validateStyle.sprite,"sprite",S,null,f)||(this.stylesheet.sprite=S,this._loadSprite(x,!0,m))}removeSprite(i){this._checkLoaded();const c=qt(this.stylesheet.sprite);if(c.find(f=>f.id===i)){if(this._spritesImagesIds[i])for(const f of this._spritesImagesIds[i])this.imageManager.removeImage(f),this._changedImages[f]=!0;c.splice(c.findIndex(f=>f.id===i),1),this.stylesheet.sprite=c.length>0?c:void 0,delete this._spritesImagesIds[i],this._availableImages=this.imageManager.listImages(),this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new u.Event("data",{dataType:"style"}))}else this.fire(new u.ErrorEvent(new Error(`Sprite "${i}" doesn't exists on this map.`)))}getSprite(){return qt(this.stylesheet.sprite)}setSprite(i,c={},f){this._checkLoaded(),i&&this._validate(u.validateStyle.sprite,"sprite",i,null,c)||(this.stylesheet.sprite=i,i?this._loadSprite(i,!0,f):(this._unloadSprite(),f&&f(null)))}}vi.getSourceType=function(d){return Gn[d]},vi.setSourceType=function(d,i){Gn[d]=i},vi.registerForPluginStateChange=u.registerForPluginStateChange;var Ec=u.createLayout([{name:"a_pos",type:"Int16",components:2}]),Ru="attribute vec3 a_pos3d;uniform mat4 u_matrix;uniform float u_ele_delta;varying vec2 v_texture_pos;varying float v_depth;void main() {float extent=8192.0;float ele_delta=a_pos3d.z==1.0 ? u_ele_delta : 0.0;v_texture_pos=a_pos3d.xy/extent;gl_Position=u_matrix*vec4(a_pos3d.xy,get_elevation(a_pos3d.xy)-ele_delta,1.0);v_depth=gl_Position.z/gl_Position.w;}";const da={prelude:Pn(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}
#ifdef TERRAIN3D
uniform sampler2D u_terrain;uniform float u_terrain_dim;uniform mat4 u_terrain_matrix;uniform vec4 u_terrain_unpack;uniform float u_terrain_exaggeration;uniform highp sampler2D u_depth;
#endif
const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitShifts=vec4(1.)/bitSh;highp float unpack(highp vec4 color) {return dot(color,bitShifts);}highp float depthOpacity(vec3 frag) {
#ifdef TERRAIN3D
highp float d=unpack(texture2D(u_depth,frag.xy*0.5+0.5))+0.0001-frag.z;return 1.0-max(0.0,min(1.0,-d*500.0));
#else
return 1.0;
#endif
}float calculate_visibility(vec4 pos) {
#ifdef TERRAIN3D
vec3 frag=pos.xyz/pos.w;highp float d=depthOpacity(frag);if (d > 0.95) return 1.0;return (d+depthOpacity(frag+vec3(0.0,0.01,0.0)))/2.0;
#else
return 1.0;
#endif
}float ele(vec2 pos) {
#ifdef TERRAIN3D
vec4 rgb=(texture2D(u_terrain,pos)*255.0)*u_terrain_unpack;return rgb.r+rgb.g+rgb.b-u_terrain_unpack.a;
#else
return 0.0;
#endif
}float get_elevation(vec2 pos) {
#ifdef TERRAIN3D
vec2 coord=(u_terrain_matrix*vec4(pos,0.0,1.0)).xy*u_terrain_dim+1.0;vec2 f=fract(coord);vec2 c=(floor(coord)+0.5)/(u_terrain_dim+2.0);float d=1.0/(u_terrain_dim+2.0);float tl=ele(c);float tr=ele(c+vec2(d,0.0));float bl=ele(c+vec2(0.0,d));float br=ele(c+vec2(d,d));float elevation=mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);return elevation*u_terrain_exaggeration;
#else
return 0.0;
#endif
}`),background:Pn(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),backgroundPattern:Pn(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),circle:Pn(`varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=v_visibility*opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;varying float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);float ele=get_elevation(circle_center);v_visibility=calculate_visibility(u_matrix*vec4(circle_center,ele,1.0));if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,ele,1);} else {gl_Position=u_matrix*vec4(circle_center,ele,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),clippingMask:Pn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pn(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),heatmapTexture:Pn(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),collisionBox:Pn("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,get_elevation(a_pos),1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,get_elevation(a_pos),1);}"),fill:Pn(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),fillOutline:Pn(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillOutlinePattern:Pn(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),fillPattern:Pn(`#ifdef GL_ES
precision highp float;
#endif
uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),fillExtrusion:Pn(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),fillExtrusionPattern:Pn(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;
#ifdef TERRAIN3D
attribute vec2 a_centroid;
#endif
varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;
#ifdef TERRAIN3D
float height_terrain3d_offset=get_elevation(a_centroid);float base_terrain3d_offset=height_terrain3d_offset-(base > 0.0 ? 0.0 : 10.0);
#else
float height_terrain3d_offset=0.0;float base_terrain3d_offset=0.0;
#endif
base=max(0.0,base)+base_terrain3d_offset;height=max(0.0,height)+height_terrain3d_offset;float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),hillshadePrepare:Pn(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pn(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),line:Pn(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),lineGradient:Pn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_width2=vec2(outset,inset);}`),linePattern:Pn(`#ifdef GL_ES
precision highp float;
#endif
uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),lineSDF:Pn(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;
#ifdef TERRAIN3D
v_gamma_scale=1.0;
#else
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;
#endif
v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),raster:Pn(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),symbolIcon:Pn(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),z,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float visibility=calculate_visibility(projectedPoint);v_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));}`),symbolSDF:Pn(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),symbolTextAndIcon:Pn(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;float ele=get_elevation(a_pos);highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,ele,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),ele,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,ele,1.0);float z=float(u_pitch_with_map)*projected_pos.z/projected_pos.w;gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),z,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float visibility=calculate_visibility(projectedPoint);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(visibility,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`),terrain:Pn("uniform sampler2D u_texture;varying vec2 v_texture_pos;void main() {gl_FragColor=texture2D(u_texture,v_texture_pos);}",Ru),terrainDepth:Pn("varying float v_depth;const highp vec4 bitSh=vec4(256.*256.*256.,256.*256.,256.,1.);const highp vec4 bitMsk=vec4(0.,vec3(1./256.0));highp vec4 pack(highp float value) {highp vec4 comp=fract(value*bitSh);comp-=comp.xxyz*bitMsk;return comp;}void main() {gl_FragColor=pack(v_depth);}",Ru),terrainCoords:Pn("precision mediump float;uniform sampler2D u_texture;uniform float u_terrain_coords_id;varying vec2 v_texture_pos;void main() {vec4 rgba=texture2D(u_texture,v_texture_pos);gl_FragColor=vec4(rgba.r,rgba.g,rgba.b,u_terrain_coords_id);}",Ru)};function Pn(d,i){const c=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,f=i.match(/attribute ([\w]+) ([\w]+)/g),m=d.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),x=i.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),S=x?x.concat(m):m,P={};return{fragmentSource:d=d.replace(c,(C,A,O,R,X)=>(P[X]=!0,A==="define"?`
#ifndef HAS_UNIFORM_u_${X}
varying ${O} ${R} ${X};
#else
uniform ${O} ${R} u_${X};
#endif
`:`
#ifdef HAS_UNIFORM_u_${X}
    ${O} ${R} ${X} = u_${X};
#endif
`)),vertexSource:i=i.replace(c,(C,A,O,R,X)=>{const et=R==="float"?"vec2":"vec4",$=X.match(/color/)?"color":et;return P[X]?A==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${O} ${et} a_${X};
varying ${O} ${R} ${X};
#else
uniform ${O} ${R} u_${X};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = a_${X};
#else
    ${O} ${R} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${X} = unpack_mix_${$}(a_${X}, u_${X}_t);
#else
    ${O} ${R} ${X} = u_${X};
#endif
`:A==="define"?`
#ifndef HAS_UNIFORM_u_${X}
uniform lowp float u_${X}_t;
attribute ${O} ${et} a_${X};
#else
uniform ${O} ${R} u_${X};
#endif
`:$==="vec4"?`
#ifndef HAS_UNIFORM_u_${X}
    ${O} ${R} ${X} = a_${X};
#else
    ${O} ${R} ${X} = u_${X};
#endif
`:`
#ifndef HAS_UNIFORM_u_${X}
    ${O} ${R} ${X} = unpack_mix_${$}(a_${X}, u_${X}_t);
#else
    ${O} ${R} ${X} = u_${X};
#endif
`}),staticAttributes:f,staticUniforms:S}}class b{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,c,f,m,x,S,P,C,A){this.context=i;let O=this.boundPaintVertexBuffers.length!==m.length;for(let R=0;!O&&R<m.length;R++)this.boundPaintVertexBuffers[R]!==m[R]&&(O=!0);!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==f||O||this.boundIndexBuffer!==x||this.boundVertexOffset!==S||this.boundDynamicVertexBuffer!==P||this.boundDynamicVertexBuffer2!==C||this.boundDynamicVertexBuffer3!==A?this.freshBind(c,f,m,x,S,P,C,A):(i.bindVertexArray.set(this.vao),P&&P.bind(),x&&x.dynamicDraw&&x.bind(),C&&C.bind(),A&&A.bind())}freshBind(i,c,f,m,x,S,P,C){const A=i.numAttributes,O=this.context,R=O.gl;this.vao&&this.destroy(),this.vao=O.createVertexArray(),O.bindVertexArray.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=m,this.boundVertexOffset=x,this.boundDynamicVertexBuffer=S,this.boundDynamicVertexBuffer2=P,this.boundDynamicVertexBuffer3=C,c.enableAttributes(R,i);for(const X of f)X.enableAttributes(R,i);S&&S.enableAttributes(R,i),P&&P.enableAttributes(R,i),C&&C.enableAttributes(R,i),c.bind(),c.setVertexAttribPointers(R,i,x);for(const X of f)X.bind(),X.setVertexAttribPointers(R,i,x);S&&(S.bind(),S.setVertexAttribPointers(R,i,x)),m&&m.bind(),P&&(P.bind(),P.setVertexAttribPointers(R,i,x)),C&&(C.bind(),C.setVertexAttribPointers(R,i,x)),O.currentNumAttributes=A}destroy(){this.vao&&(this.context.deleteVertexArray(this.vao),this.vao=null)}}function M(d){const i=[];for(let c=0;c<d.length;c++){if(d[c]===null)continue;const f=d[c].split(" ");i.push(f.pop())}return i}class Z{constructor(i,c,f,m,x,S,P){const C=i.gl;this.program=C.createProgram();const A=M(f.staticAttributes),O=m?m.getBinderAttributes():[],R=A.concat(O),X=da.prelude.staticUniforms?M(da.prelude.staticUniforms):[],et=f.staticUniforms?M(f.staticUniforms):[],$=m?m.getBinderUniforms():[],Q=X.concat(et).concat($),ot=[];for(const Ht of Q)ot.indexOf(Ht)<0&&ot.push(Ht);const pt=m?m.defines():[];S&&pt.push("#define OVERDRAW_INSPECTOR;"),P&&pt.push("#define TERRAIN3D;");const Pt=pt.concat(da.prelude.fragmentSource,f.fragmentSource).join(`
`),rt=pt.concat(da.prelude.vertexSource,f.vertexSource).join(`
`),Tt=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Tt,Pt),C.compileShader(Tt),C.attachShader(this.program,Tt);const Lt=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())return void(this.failedToCreate=!0);C.shaderSource(Lt,rt),C.compileShader(Lt),C.attachShader(this.program,Lt),this.attributes={};const jt={};this.numAttributes=R.length;for(let Ht=0;Ht<this.numAttributes;Ht++)R[Ht]&&(C.bindAttribLocation(this.program,Ht,R[Ht]),this.attributes[R[Ht]]=Ht);C.linkProgram(this.program),C.deleteShader(Lt),C.deleteShader(Tt);for(let Ht=0;Ht<ot.length;Ht++){const Jt=ot[Ht];if(Jt&&!jt[Jt]){const Yt=C.getUniformLocation(this.program,Jt);Yt&&(jt[Jt]=Yt)}}this.fixedUniforms=x(i,jt),this.terrainUniforms=((Ht,Jt)=>({u_depth:new u.Uniform1i(Ht,Jt.u_depth),u_terrain:new u.Uniform1i(Ht,Jt.u_terrain),u_terrain_dim:new u.Uniform1f(Ht,Jt.u_terrain_dim),u_terrain_matrix:new u.UniformMatrix4f(Ht,Jt.u_terrain_matrix),u_terrain_unpack:new u.Uniform4f(Ht,Jt.u_terrain_unpack),u_terrain_exaggeration:new u.Uniform1f(Ht,Jt.u_terrain_exaggeration)}))(i,jt),this.binderUniforms=m?m.getUniforms(i,jt):[]}draw(i,c,f,m,x,S,P,C,A,O,R,X,et,$,Q,ot,pt,Pt){const rt=i.gl;if(this.failedToCreate)return;if(i.program.set(this.program),i.setDepthMode(f),i.setStencilMode(m),i.setColorMode(x),i.setCullFace(S),C){i.activeTexture.set(rt.TEXTURE2),rt.bindTexture(rt.TEXTURE_2D,C.depthTexture),i.activeTexture.set(rt.TEXTURE3),rt.bindTexture(rt.TEXTURE_2D,C.texture);for(const Lt in this.terrainUniforms)this.terrainUniforms[Lt].set(C[Lt])}for(const Lt in this.fixedUniforms)this.fixedUniforms[Lt].set(P[Lt]);Q&&Q.setUniforms(i,this.binderUniforms,et,{zoom:$});let Tt=0;switch(c){case rt.LINES:Tt=2;break;case rt.TRIANGLES:Tt=3;break;case rt.LINE_STRIP:Tt=1}for(const Lt of X.get()){const jt=Lt.vaos||(Lt.vaos={});(jt[A]||(jt[A]=new b)).bind(i,this,O,Q?Q.getPaintVertexBuffers():[],R,Lt.vertexOffset,ot,pt,Pt),rt.drawElements(c,Lt.primitiveLength*Tt,rt.UNSIGNED_SHORT,Lt.primitiveOffset*Tt*2)}}}function it(d,i,c){const f=1/ut(c,1,i.transform.tileZoom),m=Math.pow(2,c.tileID.overscaledZ),x=c.tileSize*Math.pow(2,i.transform.tileZoom)/m,S=x*(c.tileID.canonical.x+c.tileID.wrap*m),P=x*c.tileID.canonical.y;return{u_image:0,u_texsize:c.imageAtlasTexture.size,u_scale:[f,d.fromScale,d.toScale],u_fade:d.t,u_pixel_coord_upper:[S>>16,P>>16],u_pixel_coord_lower:[65535&S,65535&P]}}const ht=(d,i,c,f)=>{const m=i.style.light,x=m.properties.get("position"),S=[x.x,x.y,x.z],P=function(){var A=new u.ARRAY_TYPE(9);return u.ARRAY_TYPE!=Float32Array&&(A[1]=0,A[2]=0,A[3]=0,A[5]=0,A[6]=0,A[7]=0),A[0]=1,A[4]=1,A[8]=1,A}();m.properties.get("anchor")==="viewport"&&function(A,O){var R=Math.sin(O),X=Math.cos(O);A[0]=X,A[1]=R,A[2]=0,A[3]=-R,A[4]=X,A[5]=0,A[6]=0,A[7]=0,A[8]=1}(P,-i.transform.angle),function(A,O,R){var X=O[0],et=O[1],$=O[2];A[0]=X*R[0]+et*R[3]+$*R[6],A[1]=X*R[1]+et*R[4]+$*R[7],A[2]=X*R[2]+et*R[5]+$*R[8]}(S,S,P);const C=m.properties.get("color");return{u_matrix:d,u_lightpos:S,u_lightintensity:m.properties.get("intensity"),u_lightcolor:[C.r,C.g,C.b],u_vertical_gradient:+c,u_opacity:f}},_t=(d,i,c,f,m,x,S)=>u.extend(ht(d,i,c,f),it(x,i,S),{u_height_factor:-Math.pow(2,m.overscaledZ)/S.tileSize/8}),wt=d=>({u_matrix:d}),Wt=(d,i,c,f)=>u.extend(wt(d),it(c,i,f)),ne=(d,i)=>({u_matrix:d,u_world:i}),me=(d,i,c,f,m)=>u.extend(Wt(d,i,c,f),{u_world:m}),fe=(d,i,c,f)=>{const m=d.transform;let x,S;if(f.paint.get("circle-pitch-alignment")==="map"){const P=ut(c,1,m.zoom);x=!0,S=[P,P]}else x=!1,S=m.pixelsToGLUnits;return{u_camera_to_center_distance:m.cameraToCenterDistance,u_scale_with_map:+(f.paint.get("circle-pitch-scale")==="map"),u_matrix:d.translatePosMatrix(i.posMatrix,c,f.paint.get("circle-translate"),f.paint.get("circle-translate-anchor")),u_pitch_with_map:+x,u_device_pixel_ratio:d.pixelRatio,u_extrude_scale:S}},ae=(d,i,c)=>{const f=ut(c,1,i.zoom),m=Math.pow(2,i.zoom-c.tileID.overscaledZ),x=c.tileID.overscaleFactor();return{u_matrix:d,u_camera_to_center_distance:i.cameraToCenterDistance,u_pixels_to_tile_units:f,u_extrude_scale:[i.pixelsToGLUnits[0]/(f*m),i.pixelsToGLUnits[1]/(f*m)],u_overscale_factor:x}},He=(d,i,c=1)=>({u_matrix:d,u_color:i,u_overlay:0,u_overlay_scale:c}),fr=d=>({u_matrix:d}),sn=(d,i,c,f)=>({u_matrix:d,u_extrude_scale:ut(i,1,c),u_intensity:f});function Zr(d,i){const c=Math.pow(2,i.canonical.z),f=i.canonical.y;return[new u.MercatorCoordinate(0,f/c).toLngLat().lat,new u.MercatorCoordinate(0,(f+1)/c).toLngLat().lat]}const Ot=(d,i,c,f)=>{const m=d.transform;return{u_matrix:ga(d,i,c,f),u_ratio:1/ut(i,1,m.zoom),u_device_pixel_ratio:d.pixelRatio,u_units_to_pixels:[1/m.pixelsToGLUnits[0],1/m.pixelsToGLUnits[1]]}},Pe=(d,i,c,f,m)=>u.extend(Ot(d,i,c,m),{u_image:0,u_image_height:f}),fn=(d,i,c,f,m)=>{const x=d.transform,S=vr(i,x);return{u_matrix:ga(d,i,c,m),u_texsize:i.imageAtlasTexture.size,u_ratio:1/ut(i,1,x.zoom),u_device_pixel_ratio:d.pixelRatio,u_image:0,u_scale:[S,f.fromScale,f.toScale],u_fade:f.t,u_units_to_pixels:[1/x.pixelsToGLUnits[0],1/x.pixelsToGLUnits[1]]}},Xr=(d,i,c,f,m,x)=>{const S=d.lineAtlas,P=vr(i,d.transform),C=c.layout.get("line-cap")==="round",A=S.getDash(f.from,C),O=S.getDash(f.to,C),R=A.width*m.fromScale,X=O.width*m.toScale;return u.extend(Ot(d,i,c,x),{u_patternscale_a:[P/R,-A.height/2],u_patternscale_b:[P/X,-O.height/2],u_sdfgamma:S.width/(256*Math.min(R,X)*d.pixelRatio)/2,u_image:0,u_tex_y_a:A.y,u_tex_y_b:O.y,u_mix:m.t})};function vr(d,i){return 1/ut(d,1,i.tileZoom)}function ga(d,i,c,f){return d.translatePosMatrix(f?f.posMatrix:i.tileID.posMatrix,i,c.paint.get("line-translate"),c.paint.get("line-translate-anchor"))}const Ou=(d,i,c,f,m)=>{return{u_matrix:d,u_tl_parent:i,u_scale_parent:c,u_buffer_scale:1,u_fade_t:f.mix,u_opacity:f.opacity*m.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:m.paint.get("raster-brightness-min"),u_brightness_high:m.paint.get("raster-brightness-max"),u_saturation_factor:(S=m.paint.get("raster-saturation"),S>0?1-1/(1.001-S):-S),u_contrast_factor:(x=m.paint.get("raster-contrast"),x>0?1/(1-x):1+x),u_spin_weights:er(m.paint.get("raster-hue-rotate"))};var x,S};function er(d){d*=Math.PI/180;const i=Math.sin(d),c=Math.cos(d);return[(2*c+1)/3,(-Math.sqrt(3)*i-c+1)/3,(Math.sqrt(3)*i-c+1)/3]}const Ha=(d,i,c,f,m,x,S,P,C,A)=>{const O=m.transform;return{u_is_size_zoom_constant:+(d==="constant"||d==="source"),u_is_size_feature_constant:+(d==="constant"||d==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:O.cameraToCenterDistance,u_pitch:O.pitch/360*2*Math.PI,u_rotate_symbol:+c,u_aspect_ratio:O.width/O.height,u_fade_change:m.options.fadeDuration?m.symbolFadeChange:1,u_matrix:x,u_label_plane_matrix:S,u_coord_matrix:P,u_is_text:+C,u_pitch_with_map:+f,u_texsize:A,u_texture:0}},Sl=(d,i,c,f,m,x,S,P,C,A,O)=>{const R=m.transform;return u.extend(Ha(d,i,c,f,m,x,S,P,C,A),{u_gamma_scale:f?Math.cos(R._pitch)*R.cameraToCenterDistance:1,u_device_pixel_ratio:m.pixelRatio,u_is_halo:+O})},jo=(d,i,c,f,m,x,S,P,C,A)=>u.extend(Sl(d,i,c,f,m,x,S,P,!0,C,!0),{u_texsize_icon:A,u_texture_icon:1}),ao=(d,i,c)=>({u_matrix:d,u_opacity:i,u_color:c}),lo=(d,i,c,f,m,x)=>u.extend(function(S,P,C,A){const O=C.imageManager.getPattern(S.from.toString()),R=C.imageManager.getPattern(S.to.toString()),{width:X,height:et}=C.imageManager.getPixelSize(),$=Math.pow(2,A.tileID.overscaledZ),Q=A.tileSize*Math.pow(2,C.transform.tileZoom)/$,ot=Q*(A.tileID.canonical.x+A.tileID.wrap*$),pt=Q*A.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:O.tl,u_pattern_br_a:O.br,u_pattern_tl_b:R.tl,u_pattern_br_b:R.br,u_texsize:[X,et],u_mix:P.t,u_pattern_size_a:O.displaySize,u_pattern_size_b:R.displaySize,u_scale_a:P.fromScale,u_scale_b:P.toScale,u_tile_units_to_pixels:1/ut(A,1,C.transform.tileZoom),u_pixel_coord_upper:[ot>>16,pt>>16],u_pixel_coord_lower:[65535&ot,65535&pt]}}(f,x,c,m),{u_matrix:d,u_opacity:i}),zu={fillExtrusion:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_lightpos:new u.Uniform3f(d,i.u_lightpos),u_lightintensity:new u.Uniform1f(d,i.u_lightintensity),u_lightcolor:new u.Uniform3f(d,i.u_lightcolor),u_vertical_gradient:new u.Uniform1f(d,i.u_vertical_gradient),u_opacity:new u.Uniform1f(d,i.u_opacity)}),fillExtrusionPattern:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_lightpos:new u.Uniform3f(d,i.u_lightpos),u_lightintensity:new u.Uniform1f(d,i.u_lightintensity),u_lightcolor:new u.Uniform3f(d,i.u_lightcolor),u_vertical_gradient:new u.Uniform1f(d,i.u_vertical_gradient),u_height_factor:new u.Uniform1f(d,i.u_height_factor),u_image:new u.Uniform1i(d,i.u_image),u_texsize:new u.Uniform2f(d,i.u_texsize),u_pixel_coord_upper:new u.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(d,i.u_pixel_coord_lower),u_scale:new u.Uniform3f(d,i.u_scale),u_fade:new u.Uniform1f(d,i.u_fade),u_opacity:new u.Uniform1f(d,i.u_opacity)}),fill:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix)}),fillPattern:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_image:new u.Uniform1i(d,i.u_image),u_texsize:new u.Uniform2f(d,i.u_texsize),u_pixel_coord_upper:new u.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(d,i.u_pixel_coord_lower),u_scale:new u.Uniform3f(d,i.u_scale),u_fade:new u.Uniform1f(d,i.u_fade)}),fillOutline:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_world:new u.Uniform2f(d,i.u_world)}),fillOutlinePattern:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_world:new u.Uniform2f(d,i.u_world),u_image:new u.Uniform1i(d,i.u_image),u_texsize:new u.Uniform2f(d,i.u_texsize),u_pixel_coord_upper:new u.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(d,i.u_pixel_coord_lower),u_scale:new u.Uniform3f(d,i.u_scale),u_fade:new u.Uniform1f(d,i.u_fade)}),circle:(d,i)=>({u_camera_to_center_distance:new u.Uniform1f(d,i.u_camera_to_center_distance),u_scale_with_map:new u.Uniform1i(d,i.u_scale_with_map),u_pitch_with_map:new u.Uniform1i(d,i.u_pitch_with_map),u_extrude_scale:new u.Uniform2f(d,i.u_extrude_scale),u_device_pixel_ratio:new u.Uniform1f(d,i.u_device_pixel_ratio),u_matrix:new u.UniformMatrix4f(d,i.u_matrix)}),collisionBox:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_camera_to_center_distance:new u.Uniform1f(d,i.u_camera_to_center_distance),u_pixels_to_tile_units:new u.Uniform1f(d,i.u_pixels_to_tile_units),u_extrude_scale:new u.Uniform2f(d,i.u_extrude_scale),u_overscale_factor:new u.Uniform1f(d,i.u_overscale_factor)}),collisionCircle:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_inv_matrix:new u.UniformMatrix4f(d,i.u_inv_matrix),u_camera_to_center_distance:new u.Uniform1f(d,i.u_camera_to_center_distance),u_viewport_size:new u.Uniform2f(d,i.u_viewport_size)}),debug:(d,i)=>({u_color:new u.UniformColor(d,i.u_color),u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_overlay:new u.Uniform1i(d,i.u_overlay),u_overlay_scale:new u.Uniform1f(d,i.u_overlay_scale)}),clippingMask:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix)}),heatmap:(d,i)=>({u_extrude_scale:new u.Uniform1f(d,i.u_extrude_scale),u_intensity:new u.Uniform1f(d,i.u_intensity),u_matrix:new u.UniformMatrix4f(d,i.u_matrix)}),heatmapTexture:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_world:new u.Uniform2f(d,i.u_world),u_image:new u.Uniform1i(d,i.u_image),u_color_ramp:new u.Uniform1i(d,i.u_color_ramp),u_opacity:new u.Uniform1f(d,i.u_opacity)}),hillshade:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_image:new u.Uniform1i(d,i.u_image),u_latrange:new u.Uniform2f(d,i.u_latrange),u_light:new u.Uniform2f(d,i.u_light),u_shadow:new u.UniformColor(d,i.u_shadow),u_highlight:new u.UniformColor(d,i.u_highlight),u_accent:new u.UniformColor(d,i.u_accent)}),hillshadePrepare:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_image:new u.Uniform1i(d,i.u_image),u_dimension:new u.Uniform2f(d,i.u_dimension),u_zoom:new u.Uniform1f(d,i.u_zoom),u_unpack:new u.Uniform4f(d,i.u_unpack)}),line:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_ratio:new u.Uniform1f(d,i.u_ratio),u_device_pixel_ratio:new u.Uniform1f(d,i.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(d,i.u_units_to_pixels)}),lineGradient:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_ratio:new u.Uniform1f(d,i.u_ratio),u_device_pixel_ratio:new u.Uniform1f(d,i.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(d,i.u_units_to_pixels),u_image:new u.Uniform1i(d,i.u_image),u_image_height:new u.Uniform1f(d,i.u_image_height)}),linePattern:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_texsize:new u.Uniform2f(d,i.u_texsize),u_ratio:new u.Uniform1f(d,i.u_ratio),u_device_pixel_ratio:new u.Uniform1f(d,i.u_device_pixel_ratio),u_image:new u.Uniform1i(d,i.u_image),u_units_to_pixels:new u.Uniform2f(d,i.u_units_to_pixels),u_scale:new u.Uniform3f(d,i.u_scale),u_fade:new u.Uniform1f(d,i.u_fade)}),lineSDF:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_ratio:new u.Uniform1f(d,i.u_ratio),u_device_pixel_ratio:new u.Uniform1f(d,i.u_device_pixel_ratio),u_units_to_pixels:new u.Uniform2f(d,i.u_units_to_pixels),u_patternscale_a:new u.Uniform2f(d,i.u_patternscale_a),u_patternscale_b:new u.Uniform2f(d,i.u_patternscale_b),u_sdfgamma:new u.Uniform1f(d,i.u_sdfgamma),u_image:new u.Uniform1i(d,i.u_image),u_tex_y_a:new u.Uniform1f(d,i.u_tex_y_a),u_tex_y_b:new u.Uniform1f(d,i.u_tex_y_b),u_mix:new u.Uniform1f(d,i.u_mix)}),raster:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_tl_parent:new u.Uniform2f(d,i.u_tl_parent),u_scale_parent:new u.Uniform1f(d,i.u_scale_parent),u_buffer_scale:new u.Uniform1f(d,i.u_buffer_scale),u_fade_t:new u.Uniform1f(d,i.u_fade_t),u_opacity:new u.Uniform1f(d,i.u_opacity),u_image0:new u.Uniform1i(d,i.u_image0),u_image1:new u.Uniform1i(d,i.u_image1),u_brightness_low:new u.Uniform1f(d,i.u_brightness_low),u_brightness_high:new u.Uniform1f(d,i.u_brightness_high),u_saturation_factor:new u.Uniform1f(d,i.u_saturation_factor),u_contrast_factor:new u.Uniform1f(d,i.u_contrast_factor),u_spin_weights:new u.Uniform3f(d,i.u_spin_weights)}),symbolIcon:(d,i)=>({u_is_size_zoom_constant:new u.Uniform1i(d,i.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(d,i.u_is_size_feature_constant),u_size_t:new u.Uniform1f(d,i.u_size_t),u_size:new u.Uniform1f(d,i.u_size),u_camera_to_center_distance:new u.Uniform1f(d,i.u_camera_to_center_distance),u_pitch:new u.Uniform1f(d,i.u_pitch),u_rotate_symbol:new u.Uniform1i(d,i.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(d,i.u_aspect_ratio),u_fade_change:new u.Uniform1f(d,i.u_fade_change),u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(d,i.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(d,i.u_coord_matrix),u_is_text:new u.Uniform1i(d,i.u_is_text),u_pitch_with_map:new u.Uniform1i(d,i.u_pitch_with_map),u_texsize:new u.Uniform2f(d,i.u_texsize),u_texture:new u.Uniform1i(d,i.u_texture)}),symbolSDF:(d,i)=>({u_is_size_zoom_constant:new u.Uniform1i(d,i.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(d,i.u_is_size_feature_constant),u_size_t:new u.Uniform1f(d,i.u_size_t),u_size:new u.Uniform1f(d,i.u_size),u_camera_to_center_distance:new u.Uniform1f(d,i.u_camera_to_center_distance),u_pitch:new u.Uniform1f(d,i.u_pitch),u_rotate_symbol:new u.Uniform1i(d,i.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(d,i.u_aspect_ratio),u_fade_change:new u.Uniform1f(d,i.u_fade_change),u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(d,i.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(d,i.u_coord_matrix),u_is_text:new u.Uniform1i(d,i.u_is_text),u_pitch_with_map:new u.Uniform1i(d,i.u_pitch_with_map),u_texsize:new u.Uniform2f(d,i.u_texsize),u_texture:new u.Uniform1i(d,i.u_texture),u_gamma_scale:new u.Uniform1f(d,i.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(d,i.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(d,i.u_is_halo)}),symbolTextAndIcon:(d,i)=>({u_is_size_zoom_constant:new u.Uniform1i(d,i.u_is_size_zoom_constant),u_is_size_feature_constant:new u.Uniform1i(d,i.u_is_size_feature_constant),u_size_t:new u.Uniform1f(d,i.u_size_t),u_size:new u.Uniform1f(d,i.u_size),u_camera_to_center_distance:new u.Uniform1f(d,i.u_camera_to_center_distance),u_pitch:new u.Uniform1f(d,i.u_pitch),u_rotate_symbol:new u.Uniform1i(d,i.u_rotate_symbol),u_aspect_ratio:new u.Uniform1f(d,i.u_aspect_ratio),u_fade_change:new u.Uniform1f(d,i.u_fade_change),u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_label_plane_matrix:new u.UniformMatrix4f(d,i.u_label_plane_matrix),u_coord_matrix:new u.UniformMatrix4f(d,i.u_coord_matrix),u_is_text:new u.Uniform1i(d,i.u_is_text),u_pitch_with_map:new u.Uniform1i(d,i.u_pitch_with_map),u_texsize:new u.Uniform2f(d,i.u_texsize),u_texsize_icon:new u.Uniform2f(d,i.u_texsize_icon),u_texture:new u.Uniform1i(d,i.u_texture),u_texture_icon:new u.Uniform1i(d,i.u_texture_icon),u_gamma_scale:new u.Uniform1f(d,i.u_gamma_scale),u_device_pixel_ratio:new u.Uniform1f(d,i.u_device_pixel_ratio),u_is_halo:new u.Uniform1i(d,i.u_is_halo)}),background:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_opacity:new u.Uniform1f(d,i.u_opacity),u_color:new u.UniformColor(d,i.u_color)}),backgroundPattern:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_opacity:new u.Uniform1f(d,i.u_opacity),u_image:new u.Uniform1i(d,i.u_image),u_pattern_tl_a:new u.Uniform2f(d,i.u_pattern_tl_a),u_pattern_br_a:new u.Uniform2f(d,i.u_pattern_br_a),u_pattern_tl_b:new u.Uniform2f(d,i.u_pattern_tl_b),u_pattern_br_b:new u.Uniform2f(d,i.u_pattern_br_b),u_texsize:new u.Uniform2f(d,i.u_texsize),u_mix:new u.Uniform1f(d,i.u_mix),u_pattern_size_a:new u.Uniform2f(d,i.u_pattern_size_a),u_pattern_size_b:new u.Uniform2f(d,i.u_pattern_size_b),u_scale_a:new u.Uniform1f(d,i.u_scale_a),u_scale_b:new u.Uniform1f(d,i.u_scale_b),u_pixel_coord_upper:new u.Uniform2f(d,i.u_pixel_coord_upper),u_pixel_coord_lower:new u.Uniform2f(d,i.u_pixel_coord_lower),u_tile_units_to_pixels:new u.Uniform1f(d,i.u_tile_units_to_pixels)}),terrain:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_texture:new u.Uniform1i(d,i.u_texture),u_ele_delta:new u.Uniform1f(d,i.u_ele_delta)}),terrainDepth:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_ele_delta:new u.Uniform1f(d,i.u_ele_delta)}),terrainCoords:(d,i)=>({u_matrix:new u.UniformMatrix4f(d,i.u_matrix),u_texture:new u.Uniform1i(d,i.u_texture),u_terrain_coords_id:new u.Uniform1f(d,i.u_terrain_coords_id),u_ele_delta:new u.Uniform1f(d,i.u_ele_delta)})};class Tl{constructor(i,c,f){this.context=i;const m=i.gl;this.buffer=m.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),m.bufferData(m.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?m.DYNAMIC_DRAW:m.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;if(!this.dynamicDraw)throw new Error("Attempted to update data while not in dynamic mode.");this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const eu={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Fu{constructor(i,c,f,m){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=m,this.context=i;const x=i.gl;this.buffer=x.createBuffer(),i.bindVertexBuffer.set(this.buffer),x.bufferData(x.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?x.DYNAMIC_DRAW:x.STATIC_DRAW),this.dynamicDraw||delete c.arrayBuffer}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){if(i.length!==this.length)throw new Error(`Length of new data is ${i.length}, which doesn't match current length of ${this.length}`);const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,c){for(let f=0;f<this.attributes.length;f++){const m=c.attributes[this.attributes[f].name];m!==void 0&&i.enableVertexAttribArray(m)}}setVertexAttribPointers(i,c,f){for(let m=0;m<this.attributes.length;m++){const x=this.attributes[m],S=c.attributes[x.name];S!==void 0&&i.vertexAttribPointer(S,x.components,i[eu[x.type]],!1,this.itemSize,x.offset+this.itemSize*(f||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const nu=new WeakMap;function $a(d){if(nu.has(d))return nu.get(d);{const i=d.getParameter(d.VERSION).startsWith("WebGL 2.0");return nu.set(d,i),i}}class Mn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Bu extends Mn{getDefault(){return u.Color.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ru extends Mn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Ic extends Mn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class fh extends Mn{getDefault(){return[!0,!0,!0,!0]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Cl extends Mn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Uu extends Mn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Sc extends Mn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const c=this.current;(i.func!==c.func||i.ref!==c.ref||i.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class dh extends Mn{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Ms extends Mn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=i,this.dirty=!1}}class gh extends Mn{getDefault(){return[0,1]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class mh extends Mn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=i,this.dirty=!1}}class Tc extends Mn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class iu extends Mn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.BLEND):c.disable(c.BLEND),this.current=i,this.dirty=!1}}class Pl extends Mn{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Vu extends Mn{getDefault(){return u.Color.transparent}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Ka extends Mn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class _h extends Mn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=i,this.dirty=!1}}class ma extends Mn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Gu extends Mn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Ja extends Mn{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class yh extends Mn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class _a extends Mn{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class As extends Mn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class ju extends Mn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class ou extends Mn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class Dn extends Mn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class ya extends Mn{getDefault(){return null}set(i){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Mp extends Mn{getDefault(){return null}set(i){var c;if(i===this.current&&!this.dirty)return;const f=this.gl;$a(f)?f.bindVertexArray(i):(c=f.getExtension("OES_vertex_array_object"))===null||c===void 0||c.bindVertexArrayOES(i),this.current=i,this.dirty=!1}}class vh extends Mn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class su extends Mn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class Ap extends Mn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class Cc extends Mn{constructor(i,c){super(i),this.context=i,this.parent=c}getDefault(){return null}}class Pc extends Cc{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Mc extends Cc{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_ATTACHMENT,c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class qs extends Cc{set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,c.DEPTH_STENCIL_ATTACHMENT,c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class qo{constructor(i,c,f,m,x){this.context=i,this.width=c,this.height=f;const S=i.gl,P=this.framebuffer=S.createFramebuffer();if(this.colorAttachment=new Pc(i,P),m)this.depthAttachment=x?new qs(i,P):new Mc(i,P);else if(x)throw new Error("Stencil cannot be setted without depth");if(S.checkFramebufferStatus(S.FRAMEBUFFER)!==S.FRAMEBUFFER_COMPLETE)throw new Error("Framebuffer is not complete")}destroy(){const i=this.context.gl,c=this.colorAttachment.get();if(c&&i.deleteTexture(c),this.depthAttachment){const f=this.depthAttachment.get();f&&i.deleteRenderbuffer(f)}i.deleteFramebuffer(this.framebuffer)}}class Hn{constructor(i,c,f){this.blendFunction=i,this.blendColor=c,this.mask=f}}Hn.Replace=[1,0],Hn.disabled=new Hn(Hn.Replace,u.Color.transparent,[!1,!1,!1,!1]),Hn.unblended=new Hn(Hn.Replace,u.Color.transparent,[!0,!0,!0,!0]),Hn.alphaBlended=new Hn([1,771],u.Color.transparent,[!0,!0,!0,!0]);class Ml{constructor(i){var c,f;if(this.gl=i,this.clearColor=new Bu(this),this.clearDepth=new ru(this),this.clearStencil=new Ic(this),this.colorMask=new fh(this),this.depthMask=new Cl(this),this.stencilMask=new Uu(this),this.stencilFunc=new Sc(this),this.stencilOp=new dh(this),this.stencilTest=new Ms(this),this.depthRange=new gh(this),this.depthTest=new mh(this),this.depthFunc=new Tc(this),this.blend=new iu(this),this.blendFunc=new Pl(this),this.blendColor=new Vu(this),this.blendEquation=new Ka(this),this.cullFace=new _h(this),this.cullFaceSide=new ma(this),this.frontFace=new Gu(this),this.program=new Ja(this),this.activeTexture=new yh(this),this.viewport=new _a(this),this.bindFramebuffer=new As(this),this.bindRenderbuffer=new ju(this),this.bindTexture=new ou(this),this.bindVertexBuffer=new Dn(this),this.bindElementBuffer=new ya(this),this.bindVertexArray=new Mp(this),this.pixelStoreUnpack=new vh(this),this.pixelStoreUnpackPremultiplyAlpha=new su(this),this.pixelStoreUnpackFlipY=new Ap(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),$a(i)){this.HALF_FLOAT=i.HALF_FLOAT;const m=i.getExtension("EXT_color_buffer_half_float");this.RGBA16F=(c=i.RGBA16F)!==null&&c!==void 0?c:m==null?void 0:m.RGBA16F_EXT,this.RGB16F=(f=i.RGB16F)!==null&&f!==void 0?f:m==null?void 0:m.RGB16F_EXT,i.getExtension("EXT_color_buffer_float")}else{i.getExtension("EXT_color_buffer_half_float"),i.getExtension("OES_texture_half_float_linear");const m=i.getExtension("OES_texture_half_float");this.HALF_FLOAT=m==null?void 0:m.HALF_FLOAT_OES}}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArray.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,c){return new Tl(this,i,c)}createVertexBuffer(i,c,f){return new Fu(this,i,c,f)}createRenderbuffer(i,c,f){const m=this.gl,x=m.createRenderbuffer();return this.bindRenderbuffer.set(x),m.renderbufferStorage(m.RENDERBUFFER,i,c,f),this.bindRenderbuffer.set(null),x}createFramebuffer(i,c,f,m){return new qo(this,i,c,f,m)}clear({color:i,depth:c,stencil:f}){const m=this.gl;let x=0;i&&(x|=m.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),c!==void 0&&(x|=m.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(x|=m.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),m.clear(x)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){u.deepEqual(i.blendFunction,Hn.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}createVertexArray(){var i;return $a(this.gl)?this.gl.createVertexArray():(i=this.gl.getExtension("OES_vertex_array_object"))===null||i===void 0?void 0:i.createVertexArrayOES()}deleteVertexArray(i){var c;return $a(this.gl)?this.gl.deleteVertexArray(i):(c=this.gl.getExtension("OES_vertex_array_object"))===null||c===void 0?void 0:c.deleteVertexArrayOES(i)}unbindVAO(){this.bindVertexArray.set(null)}}class en{constructor(i,c,f){this.func=i,this.mask=c,this.range=f}}en.ReadOnly=!1,en.ReadWrite=!0,en.disabled=new en(519,en.ReadOnly,[0,1]);const qu=7680;class $n{constructor(i,c,f,m,x,S){this.test=i,this.ref=c,this.mask=f,this.fail=m,this.depthFail=x,this.pass=S}}$n.disabled=new $n({func:519,mask:0},0,0,qu,qu,qu);class Fn{constructor(i,c,f){this.enable=i,this.mode=c,this.frontFace=f}}let Qa;function Ac(d,i,c,f,m,x,S){const P=d.context,C=P.gl,A=d.useProgram("collisionBox"),O=[];let R=0,X=0;for(let rt=0;rt<f.length;rt++){const Tt=f[rt],Lt=i.getTile(Tt),jt=Lt.getBucket(c);if(!jt)continue;let Ht=Tt.posMatrix;m[0]===0&&m[1]===0||(Ht=d.translatePosMatrix(Tt.posMatrix,Lt,m,x));const Jt=S?jt.textCollisionBox:jt.iconCollisionBox,Yt=jt.collisionCircleArray;if(Yt.length>0){const xe=u.create(),Oe=Ht;u.mul(xe,jt.placementInvProjMatrix,d.transform.glCoordMatrix),u.mul(xe,xe,jt.placementViewportMatrix),O.push({circleArray:Yt,circleOffset:X,transform:Oe,invTransform:xe,coord:Tt}),R+=Yt.length/4,X=R}Jt&&A.draw(P,C.LINES,en.disabled,$n.disabled,d.colorModeForRenderPass(),Fn.disabled,ae(Ht,d.transform,Lt),d.style.map.terrain&&d.style.map.terrain.getTerrainData(Tt),c.id,Jt.layoutVertexBuffer,Jt.indexBuffer,Jt.segments,null,d.transform.zoom,null,null,Jt.collisionVertexBuffer)}if(!S||!O.length)return;const et=d.useProgram("collisionCircle"),$=new u.CollisionCircleLayoutArray;$.resize(4*R),$._trim();let Q=0;for(const rt of O)for(let Tt=0;Tt<rt.circleArray.length/4;Tt++){const Lt=4*Tt,jt=rt.circleArray[Lt+0],Ht=rt.circleArray[Lt+1],Jt=rt.circleArray[Lt+2],Yt=rt.circleArray[Lt+3];$.emplace(Q++,jt,Ht,Jt,Yt,0),$.emplace(Q++,jt,Ht,Jt,Yt,1),$.emplace(Q++,jt,Ht,Jt,Yt,2),$.emplace(Q++,jt,Ht,Jt,Yt,3)}(!Qa||Qa.length<2*R)&&(Qa=function(rt){const Tt=2*rt,Lt=new u.QuadTriangleArray;Lt.resize(Tt),Lt._trim();for(let jt=0;jt<Tt;jt++){const Ht=6*jt;Lt.uint16[Ht+0]=4*jt+0,Lt.uint16[Ht+1]=4*jt+1,Lt.uint16[Ht+2]=4*jt+2,Lt.uint16[Ht+3]=4*jt+2,Lt.uint16[Ht+4]=4*jt+3,Lt.uint16[Ht+5]=4*jt+0}return Lt}(R));const ot=P.createIndexBuffer(Qa,!0),pt=P.createVertexBuffer($,u.collisionCircleLayout.members,!0);for(const rt of O){const Tt={u_matrix:rt.transform,u_inv_matrix:rt.invTransform,u_camera_to_center_distance:(Pt=d.transform).cameraToCenterDistance,u_viewport_size:[Pt.width,Pt.height]};et.draw(P,C.TRIANGLES,en.disabled,$n.disabled,d.colorModeForRenderPass(),Fn.disabled,Tt,d.style.map.terrain&&d.style.map.terrain.getTerrainData(rt.coord),c.id,pt,ot,u.SegmentVector.simpleSegment(0,2*rt.circleOffset,rt.circleArray.length,rt.circleArray.length/2),null,d.transform.zoom,null,null,null)}var Pt;pt.destroy(),ot.destroy()}Fn.disabled=new Fn(!1,1029,2305),Fn.backCCW=new Fn(!0,1029,2305);const Lc=u.identity(new Float32Array(16));function Lp(d,i,c,f,m,x){const{horizontalAlign:S,verticalAlign:P}=u.getAnchorAlignment(d),C=-(S-.5)*i,A=-(P-.5)*c,O=u.evaluateVariableOffset(d,f);return new u.Point((C/m+O[0])*x,(A/m+O[1])*x)}function Dc(d,i,c,f,m,x,S,P,C,A,O){const R=d.text.placedSymbolArray,X=d.text.dynamicLayoutVertexArray,et=d.icon.dynamicLayoutVertexArray,$={};X.clear();for(let Q=0;Q<R.length;Q++){const ot=R.get(Q),pt=ot.hidden||!ot.crossTileID||d.allowVerticalPlacement&&!ot.placedOrientation?null:f[ot.crossTileID];if(pt){const Pt=new u.Point(ot.anchorX,ot.anchorY),rt=hr(Pt,c?S:x,O),Tt=Xe(m.cameraToCenterDistance,rt.signedDistanceFromCamera);let Lt=u.evaluateSizeForFeature(d.textSizeData,C,ot)*Tt/u.ONE_EM;c&&(Lt*=d.tilePixelRatio/P);const{width:jt,height:Ht,anchor:Jt,textOffset:Yt,textBoxScale:xe}=pt,Oe=Lp(Jt,jt,Ht,Yt,xe,Lt),nn=c?hr(Pt.add(Oe),x,O).point:rt.point.add(i?Oe.rotate(-m.angle):Oe),ue=d.allowVerticalPlacement&&ot.placedOrientation===u.WritingMode.vertical?Math.PI/2:0;for(let je=0;je<ot.numGlyphs;je++)u.addDynamicAttributes(X,nn,ue);A&&ot.associatedIconIndex>=0&&($[ot.associatedIconIndex]={shiftedAnchor:nn,angle:ue})}else W(ot.numGlyphs,X)}if(A){et.clear();const Q=d.icon.placedSymbolArray;for(let ot=0;ot<Q.length;ot++){const pt=Q.get(ot);if(pt.hidden)W(pt.numGlyphs,et);else{const Pt=$[ot];if(Pt)for(let rt=0;rt<pt.numGlyphs;rt++)u.addDynamicAttributes(et,Pt.shiftedAnchor,Pt.angle);else W(pt.numGlyphs,et)}}d.icon.dynamicLayoutVertexBuffer.updateData(et)}d.text.dynamicLayoutVertexBuffer.updateData(X)}function au(d,i,c){return c.iconsInText&&i?"symbolTextAndIcon":d?"symbolSDF":"symbolIcon"}function tl(d,i,c,f,m,x,S,P,C,A,O,R){const X=d.context,et=X.gl,$=d.transform,Q=P==="map",ot=C==="map",pt=P!=="viewport"&&c.layout.get("symbol-placement")!=="point",Pt=Q&&!ot&&!pt,rt=!c.layout.get("symbol-sort-key").isConstant();let Tt=!1;const Lt=d.depthModeForSublayer(0,en.ReadOnly),jt=c.layout.get("text-variable-anchor"),Ht=[];for(const Jt of f){const Yt=i.getTile(Jt),xe=Yt.getBucket(c);if(!xe)continue;const Oe=m?xe.text:xe.icon;if(!Oe||!Oe.segments.get().length||!Oe.hasVisibleVertices)continue;const nn=Oe.programConfigurations.get(c.id),ue=m||xe.sdfIcons,je=m?xe.textSizeData:xe.iconSizeData,be=ot||$.pitch!==0,Un=d.useProgram(au(ue,m,xe),nn),ai=u.evaluateSizeForZoom(je,$.zoom),Vn=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Jt);let ln,ei,Ao,li,Fi=[0,0],cs=null;if(m)ei=Yt.glyphAtlasTexture,Ao=et.LINEAR,ln=Yt.glyphAtlasTexture.size,xe.iconsInText&&(Fi=Yt.imageAtlasTexture.size,cs=Yt.imageAtlasTexture,li=be||d.options.rotating||d.options.zooming||je.kind==="composite"||je.kind==="camera"?et.LINEAR:et.NEAREST);else{const Pi=c.layout.get("icon-size").constantOr(0)!==1||xe.iconsNeedLinear;ei=Yt.imageAtlasTexture,Ao=ue||d.options.rotating||d.options.zooming||Pi||be?et.LINEAR:et.NEAREST,ln=Yt.imageAtlasTexture.size}const Xs=ut(Yt,1,d.transform.zoom),Ys=Ve(Jt.posMatrix,ot,Q,d.transform,Xs),Lo=yi(Jt.posMatrix,ot,Q,d.transform,Xs),Ta=jt&&xe.hasTextData(),Vc=c.layout.get("icon-text-fit")!=="none"&&Ta&&xe.hasIconData();if(pt){const Pi=d.style.map.terrain?(Dh,sl)=>d.style.map.terrain.getElevation(Jt,Dh,sl):null,hs=c.layout.get("text-rotation-alignment")==="map";Gr(xe,Jt.posMatrix,d,m,Ys,Lo,ot,A,hs,Pi)}const co=d.translatePosMatrix(Jt.posMatrix,Yt,x,S),Bi=pt||m&&jt||Vc?Lc:Ys,jn=d.translatePosMatrix(Lo,Yt,x,S,!0),Ci=ue&&c.paint.get(m?"text-halo-width":"icon-halo-width").constantOr(1)!==0;let Ui;Ui=ue?xe.iconsInText?jo(je.kind,ai,Pt,ot,d,co,Bi,jn,ln,Fi):Sl(je.kind,ai,Pt,ot,d,co,Bi,jn,m,ln,!0):Ha(je.kind,ai,Pt,ot,d,co,Bi,jn,m,ln);const Kn={program:Un,buffers:Oe,uniformValues:Ui,atlasTexture:ei,atlasTextureIcon:cs,atlasInterpolation:Ao,atlasInterpolationIcon:li,isSDF:ue,hasHalo:Ci};if(rt&&xe.canOverlap){Tt=!0;const Pi=Oe.segments.get();for(const hs of Pi)Ht.push({segments:new u.SegmentVector([hs]),sortKey:hs.sortKey,state:Kn,terrainData:Vn})}else Ht.push({segments:Oe.segments,sortKey:0,state:Kn,terrainData:Vn})}Tt&&Ht.sort((Jt,Yt)=>Jt.sortKey-Yt.sortKey);for(const Jt of Ht){const Yt=Jt.state;if(X.activeTexture.set(et.TEXTURE0),Yt.atlasTexture.bind(Yt.atlasInterpolation,et.CLAMP_TO_EDGE),Yt.atlasTextureIcon&&(X.activeTexture.set(et.TEXTURE1),Yt.atlasTextureIcon&&Yt.atlasTextureIcon.bind(Yt.atlasInterpolationIcon,et.CLAMP_TO_EDGE)),Yt.isSDF){const xe=Yt.uniformValues;Yt.hasHalo&&(xe.u_is_halo=1,va(Yt.buffers,Jt.segments,c,d,Yt.program,Lt,O,R,xe,Jt.terrainData)),xe.u_is_halo=0}va(Yt.buffers,Jt.segments,c,d,Yt.program,Lt,O,R,Yt.uniformValues,Jt.terrainData)}}function va(d,i,c,f,m,x,S,P,C,A){const O=f.context;m.draw(O,O.gl.TRIANGLES,x,S,P,Fn.disabled,C,A,c.id,d.layoutVertexBuffer,d.indexBuffer,i,c.paint,f.transform.zoom,d.programConfigurations.get(c.id),d.dynamicLayoutVertexBuffer,d.opacityVertexBuffer)}function kc(d,i,c,f,m){if(!c||!f||!f.imageAtlas)return;const x=f.imageAtlas.patternPositions;let S=x[c.to.toString()],P=x[c.from.toString()];if(!S||!P){const C=m.getPaintProperty(i);S=x[C],P=x[C]}S&&P&&d.setConstantPatternPositions(S,P)}function Zo(d,i,c,f,m,x,S){const P=d.context.gl,C="fill-pattern",A=c.paint.get(C),O=A&&A.constantOr(1),R=c.getCrossfadeParameters();let X,et,$,Q,ot;S?(et=O&&!c.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",X=P.LINES):(et=O?"fillPattern":"fill",X=P.TRIANGLES);const pt=A.constantOr(null);for(const Pt of f){const rt=i.getTile(Pt);if(O&&!rt.patternsLoaded())continue;const Tt=rt.getBucket(c);if(!Tt)continue;const Lt=Tt.programConfigurations.get(c.id),jt=d.useProgram(et,Lt),Ht=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Pt);O&&(d.context.activeTexture.set(P.TEXTURE0),rt.imageAtlasTexture.bind(P.LINEAR,P.CLAMP_TO_EDGE),Lt.updatePaintBuffers(R)),kc(Lt,C,pt,rt,c);const Jt=Ht?Pt:null,Yt=d.translatePosMatrix(Jt?Jt.posMatrix:Pt.posMatrix,rt,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));if(S){Q=Tt.indexBuffer2,ot=Tt.segments2;const xe=[P.drawingBufferWidth,P.drawingBufferHeight];$=et==="fillOutlinePattern"&&O?me(Yt,d,R,rt,xe):ne(Yt,xe)}else Q=Tt.indexBuffer,ot=Tt.segments,$=O?Wt(Yt,d,R,rt):wt(Yt);jt.draw(d.context,X,m,d.stencilModeForClipping(Pt),x,Fn.disabled,$,Ht,c.id,Tt.layoutVertexBuffer,Q,ot,c.paint,d.transform.zoom,Lt)}}function lu(d,i,c,f,m,x,S){const P=d.context,C=P.gl,A="fill-extrusion-pattern",O=c.paint.get(A),R=O.constantOr(1),X=c.getCrossfadeParameters(),et=c.paint.get("fill-extrusion-opacity"),$=O.constantOr(null);for(const Q of f){const ot=i.getTile(Q),pt=ot.getBucket(c);if(!pt)continue;const Pt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Q),rt=pt.programConfigurations.get(c.id),Tt=d.useProgram(R?"fillExtrusionPattern":"fillExtrusion",rt);R&&(d.context.activeTexture.set(C.TEXTURE0),ot.imageAtlasTexture.bind(C.LINEAR,C.CLAMP_TO_EDGE),rt.updatePaintBuffers(X)),kc(rt,A,$,ot,c);const Lt=d.translatePosMatrix(Q.posMatrix,ot,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),jt=c.paint.get("fill-extrusion-vertical-gradient"),Ht=R?_t(Lt,d,jt,et,Q,X,ot):ht(Lt,d,jt,et);Tt.draw(P,P.gl.TRIANGLES,m,x,S,Fn.backCCW,Ht,Pt,c.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,c.paint,d.transform.zoom,rt,d.style.map.terrain&&pt.centroidVertexBuffer)}}function el(d,i,c,f,m,x,S){const P=d.context,C=P.gl,A=c.fbo;if(!A)return;const O=d.useProgram("hillshade"),R=d.style.map.terrain&&d.style.map.terrain.getTerrainData(i);P.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,A.colorAttachment.get()),O.draw(P,C.TRIANGLES,m,x,S,Fn.disabled,((X,et,$,Q)=>{const ot=$.paint.get("hillshade-shadow-color"),pt=$.paint.get("hillshade-highlight-color"),Pt=$.paint.get("hillshade-accent-color");let rt=$.paint.get("hillshade-illumination-direction")*(Math.PI/180);$.paint.get("hillshade-illumination-anchor")==="viewport"&&(rt-=X.transform.angle);const Tt=!X.options.moving;return{u_matrix:Q?Q.posMatrix:X.transform.calculatePosMatrix(et.tileID.toUnwrapped(),Tt),u_image:0,u_latrange:Zr(0,et.tileID),u_light:[$.paint.get("hillshade-exaggeration"),rt],u_shadow:ot,u_highlight:pt,u_accent:Pt}})(d,c,f,R?i:null),R,f.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}function Nc(d,i,c,f,m,x){const S=d.context,P=S.gl,C=i.dem;if(C&&C.data){const A=C.dim,O=C.stride,R=C.getPixels();if(S.activeTexture.set(P.TEXTURE1),S.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||d.getTileTexture(O),i.demTexture){const et=i.demTexture;et.update(R,{premultiply:!1}),et.bind(P.NEAREST,P.CLAMP_TO_EDGE)}else i.demTexture=new ie(S,R,P.RGBA,{premultiply:!1}),i.demTexture.bind(P.NEAREST,P.CLAMP_TO_EDGE);S.activeTexture.set(P.TEXTURE0);let X=i.fbo;if(!X){const et=new ie(S,{width:A,height:A,data:null},P.RGBA);et.bind(P.LINEAR,P.CLAMP_TO_EDGE),X=i.fbo=S.createFramebuffer(A,A,!0,!1),X.colorAttachment.set(et.texture)}S.bindFramebuffer.set(X.framebuffer),S.viewport.set([0,0,A,A]),d.useProgram("hillshadePrepare").draw(S,P.TRIANGLES,f,m,x,Fn.disabled,((et,$)=>{const Q=$.stride,ot=u.create();return u.ortho(ot,0,u.EXTENT,-u.EXTENT,0,0,1),u.translate(ot,ot,[0,-u.EXTENT,0]),{u_matrix:ot,u_image:1,u_dimension:[Q,Q],u_zoom:et.overscaledZ,u_unpack:$.getUnpackVector()}})(i.tileID,C),null,c.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments),i.needsHillshadePrepare=!1}}function Yr(d,i,c,f,m,x){const S=f.paint.get("raster-fade-duration");if(!x&&S>0){const P=u.exported.now(),C=(P-d.timeAdded)/S,A=i?(P-i.timeAdded)/S:-1,O=c.getSource(),R=m.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),X=!i||Math.abs(i.tileID.overscaledZ-R)>Math.abs(d.tileID.overscaledZ-R),et=X&&d.refreshedUponExpiration?1:u.clamp(X?C:1-A,0,1);return d.refreshedUponExpiration&&C>=1&&(d.refreshedUponExpiration=!1),i?{opacity:1,mix:1-et}:{opacity:et,mix:0}}return{opacity:1,mix:0}}const Ls=new u.Color(1,0,0,1),uo=new u.Color(0,1,0,1),Rc=new u.Color(0,0,1,1),Zu=new u.Color(1,0,1,1),Oc=new u.Color(0,1,1,1);function ls(d,i,c,f){Ll(d,0,i+c/2,d.transform.width,c,f)}function Al(d,i,c,f){Ll(d,i-c/2,0,c,d.transform.height,f)}function Ll(d,i,c,f,m,x){const S=d.context,P=S.gl;P.enable(P.SCISSOR_TEST),P.scissor(i*d.pixelRatio,c*d.pixelRatio,f*d.pixelRatio,m*d.pixelRatio),S.clear({color:x}),P.disable(P.SCISSOR_TEST)}function Et(d,i,c){const f=d.context,m=f.gl,x=c.posMatrix,S=d.useProgram("debug"),P=en.disabled,C=$n.disabled,A=d.colorModeForRenderPass(),O="$debug",R=d.style.map.terrain&&d.style.map.terrain.getTerrainData(c);f.activeTexture.set(m.TEXTURE0);const X=i.getTileByID(c.key).latestRawTileData,et=Math.floor((X&&X.byteLength||0)/1024),$=i.getTile(c).tileSize,Q=512/Math.min($,512)*(c.overscaledZ/d.transform.zoom)*.5;let ot=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(ot+=` => ${c.overscaledZ}`),function(pt,Pt){pt.initDebugOverlayCanvas();const rt=pt.debugOverlayCanvas,Tt=pt.context.gl,Lt=pt.debugOverlayCanvas.getContext("2d");Lt.clearRect(0,0,rt.width,rt.height),Lt.shadowColor="white",Lt.shadowBlur=2,Lt.lineWidth=1.5,Lt.strokeStyle="white",Lt.textBaseline="top",Lt.font="bold 36px Open Sans, sans-serif",Lt.fillText(Pt,5,5),Lt.strokeText(Pt,5,5),pt.debugOverlayTexture.update(rt),pt.debugOverlayTexture.bind(Tt.LINEAR,Tt.CLAMP_TO_EDGE)}(d,`${ot} ${et}kB`),S.draw(f,m.TRIANGLES,P,C,Hn.alphaBlended,Fn.disabled,He(x,u.Color.transparent,Q),null,O,d.debugBuffer,d.quadTriangleIndexBuffer,d.debugSegments),S.draw(f,m.LINE_STRIP,P,C,A,Fn.disabled,He(x,u.Color.red),R,O,d.debugBuffer,d.tileBorderIndexBuffer,d.debugSegments)}function kt(d,i,c){const f=d.context,m=f.gl,x=d.colorModeForRenderPass(),S=new en(m.LEQUAL,en.ReadWrite,d.depthRangeFor3D),P=d.useProgram("terrain"),C=i.getTerrainMesh();f.bindFramebuffer.set(null),f.viewport.set([0,0,d.width,d.height]);for(const A of c){const O=d.renderToTexture.getTexture(A),R=i.getTerrainData(A.tileID);f.activeTexture.set(m.TEXTURE0),m.bindTexture(m.TEXTURE_2D,O.texture);const X={u_matrix:d.transform.calculatePosMatrix(A.tileID.toUnwrapped()),u_texture:0,u_ele_delta:i.getMeshFrameDelta(d.transform.zoom)};P.draw(f,m.TRIANGLES,S,$n.disabled,x,Fn.backCCW,X,R,"terrain",C.vertexBuffer,C.indexBuffer,C.segments)}}const ce={symbol:function(d,i,c,f,m){if(d.renderPass!=="translucent")return;const x=$n.disabled,S=d.colorModeForRenderPass();c.layout.get("text-variable-anchor")&&function(P,C,A,O,R,X,et){const $=C.transform,Q=R==="map",ot=X==="map";for(const pt of P){const Pt=O.getTile(pt),rt=Pt.getBucket(A);if(!rt||!rt.text||!rt.text.segments.get().length)continue;const Tt=u.evaluateSizeForZoom(rt.textSizeData,$.zoom),Lt=ut(Pt,1,C.transform.zoom),jt=Ve(pt.posMatrix,ot,Q,C.transform,Lt),Ht=A.layout.get("icon-text-fit")!=="none"&&rt.hasIconData();if(Tt){const Jt=Math.pow(2,$.zoom-Pt.tileID.overscaledZ);Dc(rt,Q,ot,et,$,jt,pt.posMatrix,Jt,Tt,Ht,C.style.map.terrain?(Yt,xe)=>C.style.map.terrain.getElevation(pt,Yt,xe):null)}}}(f,d,c,i,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),m),c.paint.get("icon-opacity").constantOr(1)!==0&&tl(d,i,c,f,!1,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),c.layout.get("icon-rotation-alignment"),c.layout.get("icon-pitch-alignment"),c.layout.get("icon-keep-upright"),x,S),c.paint.get("text-opacity").constantOr(1)!==0&&tl(d,i,c,f,!0,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),c.layout.get("text-keep-upright"),x,S),i.map.showCollisionBoxes&&(Ac(d,i,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Ac(d,i,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(d,i,c,f){if(d.renderPass!=="translucent")return;const m=c.paint.get("circle-opacity"),x=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),P=!c.layout.get("circle-sort-key").isConstant();if(m.constantOr(1)===0&&(x.constantOr(1)===0||S.constantOr(1)===0))return;const C=d.context,A=C.gl,O=d.depthModeForSublayer(0,en.ReadOnly),R=$n.disabled,X=d.colorModeForRenderPass(),et=[];for(let $=0;$<f.length;$++){const Q=f[$],ot=i.getTile(Q),pt=ot.getBucket(c);if(!pt)continue;const Pt=pt.programConfigurations.get(c.id),rt=d.useProgram("circle",Pt),Tt=pt.layoutVertexBuffer,Lt=pt.indexBuffer,jt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Q),Ht={programConfiguration:Pt,program:rt,layoutVertexBuffer:Tt,indexBuffer:Lt,uniformValues:fe(d,Q,ot,c),terrainData:jt};if(P){const Jt=pt.segments.get();for(const Yt of Jt)et.push({segments:new u.SegmentVector([Yt]),sortKey:Yt.sortKey,state:Ht})}else et.push({segments:pt.segments,sortKey:0,state:Ht})}P&&et.sort(($,Q)=>$.sortKey-Q.sortKey);for(const $ of et){const{programConfiguration:Q,program:ot,layoutVertexBuffer:pt,indexBuffer:Pt,uniformValues:rt,terrainData:Tt}=$.state;ot.draw(C,A.TRIANGLES,O,R,X,Fn.disabled,rt,Tt,c.id,pt,Pt,$.segments,c.paint,d.transform.zoom,Q)}},heatmap:function(d,i,c,f){if(c.paint.get("heatmap-opacity")!==0)if(d.renderPass==="offscreen"){const m=d.context,x=m.gl,S=$n.disabled,P=new Hn([x.ONE,x.ONE],u.Color.transparent,[!0,!0,!0,!0]);(function(C,A,O){const R=C.gl;C.activeTexture.set(R.TEXTURE1),C.viewport.set([0,0,A.width/4,A.height/4]);let X=O.heatmapFbo;if(X)R.bindTexture(R.TEXTURE_2D,X.colorAttachment.get()),C.bindFramebuffer.set(X.framebuffer);else{const et=R.createTexture();R.bindTexture(R.TEXTURE_2D,et),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_S,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_WRAP_T,R.CLAMP_TO_EDGE),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MIN_FILTER,R.LINEAR),R.texParameteri(R.TEXTURE_2D,R.TEXTURE_MAG_FILTER,R.LINEAR),X=O.heatmapFbo=C.createFramebuffer(A.width/4,A.height/4,!1,!1),function($,Q,ot,pt){var Pt,rt;const Tt=$.gl,Lt=(Pt=$.HALF_FLOAT)!==null&&Pt!==void 0?Pt:Tt.UNSIGNED_BYTE,jt=(rt=$.RGBA16F)!==null&&rt!==void 0?rt:Tt.RGBA;Tt.texImage2D(Tt.TEXTURE_2D,0,jt,Q.width/4,Q.height/4,0,Tt.RGBA,Lt,null),pt.colorAttachment.set(ot)}(C,A,et,X)}})(m,d,c),m.clear({color:u.Color.transparent});for(let C=0;C<f.length;C++){const A=f[C];if(i.hasRenderableParent(A))continue;const O=i.getTile(A),R=O.getBucket(c);if(!R)continue;const X=R.programConfigurations.get(c.id),et=d.useProgram("heatmap",X),{zoom:$}=d.transform;et.draw(m,x.TRIANGLES,en.disabled,S,P,Fn.disabled,sn(A.posMatrix,O,$,c.paint.get("heatmap-intensity")),null,c.id,R.layoutVertexBuffer,R.indexBuffer,R.segments,c.paint,d.transform.zoom,X)}m.viewport.set([0,0,d.width,d.height])}else d.renderPass==="translucent"&&(d.context.setColorMode(d.colorModeForRenderPass()),function(m,x){const S=m.context,P=S.gl,C=x.heatmapFbo;if(!C)return;S.activeTexture.set(P.TEXTURE0),P.bindTexture(P.TEXTURE_2D,C.colorAttachment.get()),S.activeTexture.set(P.TEXTURE1);let A=x.colorRampTexture;A||(A=x.colorRampTexture=new ie(S,x.colorRamp,P.RGBA)),A.bind(P.LINEAR,P.CLAMP_TO_EDGE),m.useProgram("heatmapTexture").draw(S,P.TRIANGLES,en.disabled,$n.disabled,m.colorModeForRenderPass(),Fn.disabled,((O,R,X,et)=>{const $=u.create();u.ortho($,0,O.width,O.height,0,0,1);const Q=O.context.gl;return{u_matrix:$,u_world:[Q.drawingBufferWidth,Q.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:R.paint.get("heatmap-opacity")}})(m,x),null,x.id,m.viewportBuffer,m.quadTriangleIndexBuffer,m.viewportSegments,x.paint,m.transform.zoom)}(d,c))},line:function(d,i,c,f){if(d.renderPass!=="translucent")return;const m=c.paint.get("line-opacity"),x=c.paint.get("line-width");if(m.constantOr(1)===0||x.constantOr(1)===0)return;const S=d.depthModeForSublayer(0,en.ReadOnly),P=d.colorModeForRenderPass(),C=c.paint.get("line-dasharray"),A=c.paint.get("line-pattern"),O=A.constantOr(1),R=c.paint.get("line-gradient"),X=c.getCrossfadeParameters(),et=O?"linePattern":C?"lineSDF":R?"lineGradient":"line",$=d.context,Q=$.gl;let ot=!0;for(const pt of f){const Pt=i.getTile(pt);if(O&&!Pt.patternsLoaded())continue;const rt=Pt.getBucket(c);if(!rt)continue;const Tt=rt.programConfigurations.get(c.id),Lt=d.context.program.get(),jt=d.useProgram(et,Tt),Ht=ot||jt.program!==Lt,Jt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(pt),Yt=A.constantOr(null);if(Yt&&Pt.imageAtlas){const nn=Pt.imageAtlas,ue=nn.patternPositions[Yt.to.toString()],je=nn.patternPositions[Yt.from.toString()];ue&&je&&Tt.setConstantPatternPositions(ue,je)}const xe=Jt?pt:null,Oe=O?fn(d,Pt,c,X,xe):C?Xr(d,Pt,c,C,X,xe):R?Pe(d,Pt,c,rt.lineClipsArray.length,xe):Ot(d,Pt,c,xe);if(O)$.activeTexture.set(Q.TEXTURE0),Pt.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Tt.updatePaintBuffers(X);else if(C&&(Ht||d.lineAtlas.dirty))$.activeTexture.set(Q.TEXTURE0),d.lineAtlas.bind($);else if(R){const nn=rt.gradients[c.id];let ue=nn.texture;if(c.gradientVersion!==nn.version){let je=256;if(c.stepInterpolant){const be=i.getSource().maxzoom,Un=pt.canonical.z===be?Math.ceil(1<<d.transform.maxZoom-pt.canonical.z):1;je=u.clamp(u.nextPowerOfTwo(rt.maxLineLength/u.EXTENT*1024*Un),256,$.maxTextureSize)}nn.gradient=u.renderColorRamp({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:je,image:nn.gradient||void 0,clips:rt.lineClipsArray}),nn.texture?nn.texture.update(nn.gradient):nn.texture=new ie($,nn.gradient,Q.RGBA),nn.version=c.gradientVersion,ue=nn.texture}$.activeTexture.set(Q.TEXTURE0),ue.bind(c.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}jt.draw($,Q.TRIANGLES,S,d.stencilModeForClipping(pt),P,Fn.disabled,Oe,Jt,c.id,rt.layoutVertexBuffer,rt.indexBuffer,rt.segments,c.paint,d.transform.zoom,Tt,rt.layoutVertexBuffer2),ot=!1}},fill:function(d,i,c,f){const m=c.paint.get("fill-color"),x=c.paint.get("fill-opacity");if(x.constantOr(1)===0)return;const S=d.colorModeForRenderPass(),P=c.paint.get("fill-pattern"),C=d.opaquePassEnabledForLayer()&&!P.constantOr(1)&&m.constantOr(u.Color.transparent).a===1&&x.constantOr(0)===1?"opaque":"translucent";if(d.renderPass===C){const A=d.depthModeForSublayer(1,d.renderPass==="opaque"?en.ReadWrite:en.ReadOnly);Zo(d,i,c,f,A,S,!1)}if(d.renderPass==="translucent"&&c.paint.get("fill-antialias")){const A=d.depthModeForSublayer(c.getPaintProperty("fill-outline-color")?2:0,en.ReadOnly);Zo(d,i,c,f,A,S,!0)}},"fill-extrusion":function(d,i,c,f){const m=c.paint.get("fill-extrusion-opacity");if(m!==0&&d.renderPass==="translucent"){const x=new en(d.context.gl.LEQUAL,en.ReadWrite,d.depthRangeFor3D);if(m!==1||c.paint.get("fill-extrusion-pattern").constantOr(1))lu(d,i,c,f,x,$n.disabled,Hn.disabled),lu(d,i,c,f,x,d.stencilModeFor3D(),d.colorModeForRenderPass());else{const S=d.colorModeForRenderPass();lu(d,i,c,f,x,$n.disabled,S)}}},hillshade:function(d,i,c,f){if(d.renderPass!=="offscreen"&&d.renderPass!=="translucent")return;const m=d.context,x=d.depthModeForSublayer(0,en.ReadOnly),S=d.colorModeForRenderPass(),[P,C]=d.renderPass==="translucent"?d.stencilConfigForOverlap(f):[{},f];for(const A of C){const O=i.getTile(A);O.needsHillshadePrepare!==void 0&&O.needsHillshadePrepare&&d.renderPass==="offscreen"?Nc(d,O,c,x,$n.disabled,S):d.renderPass==="translucent"&&el(d,A,O,c,x,P[A.overscaledZ],S)}m.viewport.set([0,0,d.width,d.height])},raster:function(d,i,c,f){if(d.renderPass!=="translucent"||c.paint.get("raster-opacity")===0||!f.length)return;const m=d.context,x=m.gl,S=i.getSource(),P=d.useProgram("raster"),C=d.colorModeForRenderPass(),[A,O]=S instanceof We?[{},f]:d.stencilConfigForOverlap(f),R=O[O.length-1].overscaledZ,X=!d.options.moving;for(const et of O){const $=d.depthModeForSublayer(et.overscaledZ-R,c.paint.get("raster-opacity")===1?en.ReadWrite:en.ReadOnly,x.LESS),Q=i.getTile(et);Q.registerFadeDuration(c.paint.get("raster-fade-duration"));const ot=i.findLoadedParent(et,0),pt=Yr(Q,ot,i,c,d.transform,d.style.map.terrain);let Pt,rt;const Tt=c.paint.get("raster-resampling")==="nearest"?x.NEAREST:x.LINEAR;m.activeTexture.set(x.TEXTURE0),Q.texture.bind(Tt,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),m.activeTexture.set(x.TEXTURE1),ot?(ot.texture.bind(Tt,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST),Pt=Math.pow(2,ot.tileID.overscaledZ-Q.tileID.overscaledZ),rt=[Q.tileID.canonical.x*Pt%1,Q.tileID.canonical.y*Pt%1]):Q.texture.bind(Tt,x.CLAMP_TO_EDGE,x.LINEAR_MIPMAP_NEAREST);const Lt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(et),jt=Lt?et:null,Ht=jt?jt.posMatrix:d.transform.calculatePosMatrix(et.toUnwrapped(),X),Jt=Ou(Ht,rt||[0,0],Pt||1,pt,c);S instanceof We?P.draw(m,x.TRIANGLES,$,$n.disabled,C,Fn.disabled,Jt,Lt,c.id,S.boundsBuffer,d.quadTriangleIndexBuffer,S.boundsSegments):P.draw(m,x.TRIANGLES,$,A[et.overscaledZ],C,Fn.disabled,Jt,Lt,c.id,d.rasterBoundsBuffer,d.quadTriangleIndexBuffer,d.rasterBoundsSegments)}},background:function(d,i,c,f){const m=c.paint.get("background-color"),x=c.paint.get("background-opacity");if(x===0)return;const S=d.context,P=S.gl,C=d.transform,A=C.tileSize,O=c.paint.get("background-pattern");if(d.isPatternMissing(O))return;const R=!O&&m.a===1&&x===1&&d.opaquePassEnabledForLayer()?"opaque":"translucent";if(d.renderPass!==R)return;const X=$n.disabled,et=d.depthModeForSublayer(0,R==="opaque"?en.ReadWrite:en.ReadOnly),$=d.colorModeForRenderPass(),Q=d.useProgram(O?"backgroundPattern":"background"),ot=f||C.coveringTiles({tileSize:A,terrain:d.style.map.terrain});O&&(S.activeTexture.set(P.TEXTURE0),d.imageManager.bind(d.context));const pt=c.getCrossfadeParameters();for(const Pt of ot){const rt=f?Pt.posMatrix:d.transform.calculatePosMatrix(Pt.toUnwrapped()),Tt=O?lo(rt,x,d,O,{tileID:Pt,tileSize:A},pt):ao(rt,x,m),Lt=d.style.map.terrain&&d.style.map.terrain.getTerrainData(Pt);Q.draw(S,P.TRIANGLES,et,X,$,Fn.disabled,Tt,Lt,c.id,d.tileExtentBuffer,d.quadTriangleIndexBuffer,d.tileExtentSegments)}},debug:function(d,i,c){for(let f=0;f<c.length;f++)Et(d,i,c[f])},custom:function(d,i,c){const f=d.context,m=c.implementation;if(d.renderPass==="offscreen"){const x=m.prerender;x&&(d.setCustomLayerDefaults(),f.setColorMode(d.colorModeForRenderPass()),x.call(m,f.gl,d.transform.customLayerMatrix()),f.setDirty(),d.setBaseState())}else if(d.renderPass==="translucent"){d.setCustomLayerDefaults(),f.setColorMode(d.colorModeForRenderPass()),f.setStencilMode($n.disabled);const x=m.renderingMode==="3d"?new en(d.context.gl.LEQUAL,en.ReadWrite,d.depthRangeFor3D):d.depthModeForSublayer(0,en.ReadOnly);f.setDepthMode(x),m.render(f.gl,d.transform.customLayerMatrix()),f.setDirty(),d.setBaseState(),f.bindFramebuffer.set(null)}}};class Fe{constructor(i,c){this.context=new Ml(i),this.transform=c,this._tileTextures={},this.terrainFacilitator={dirty:!0,matrix:u.create(),renderTime:0},this.setup(),this.numSublayers=Tr.maxUnderzooming+Tr.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new fa}resize(i,c,f){if(this.width=i*f,this.height=c*f,this.pixelRatio=f,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const m of this.style._order)this.style._layers[m].resize()}setup(){const i=this.context,c=new u.PosArray;c.emplaceBack(0,0),c.emplaceBack(u.EXTENT,0),c.emplaceBack(0,u.EXTENT),c.emplaceBack(u.EXTENT,u.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(c,Ec.members),this.tileExtentSegments=u.SegmentVector.simpleSegment(0,0,4,2);const f=new u.PosArray;f.emplaceBack(0,0),f.emplaceBack(u.EXTENT,0),f.emplaceBack(0,u.EXTENT),f.emplaceBack(u.EXTENT,u.EXTENT),this.debugBuffer=i.createVertexBuffer(f,Ec.members),this.debugSegments=u.SegmentVector.simpleSegment(0,0,4,5);const m=new u.RasterBoundsArray;m.emplaceBack(0,0,0,0),m.emplaceBack(u.EXTENT,0,u.EXTENT,0),m.emplaceBack(0,u.EXTENT,0,u.EXTENT),m.emplaceBack(u.EXTENT,u.EXTENT,u.EXTENT,u.EXTENT),this.rasterBoundsBuffer=i.createVertexBuffer(m,cr.members),this.rasterBoundsSegments=u.SegmentVector.simpleSegment(0,0,4,2);const x=new u.PosArray;x.emplaceBack(0,0),x.emplaceBack(1,0),x.emplaceBack(0,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,Ec.members),this.viewportSegments=u.SegmentVector.simpleSegment(0,0,4,2);const S=new u.LineStripIndexArray;S.emplaceBack(0),S.emplaceBack(1),S.emplaceBack(3),S.emplaceBack(2),S.emplaceBack(0),this.tileBorderIndexBuffer=i.createIndexBuffer(S);const P=new u.TriangleIndexArray;P.emplaceBack(0,1,2),P.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(P);const C=this.context.gl;this.stencilClearMode=new $n({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO)}clearStencil(){const i=this.context,c=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0;const f=u.create();u.ortho(f,0,this.width,this.height,0,0,1),u.scale(f,f,[c.drawingBufferWidth,c.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(i,c.TRIANGLES,en.disabled,this.stencilClearMode,Hn.disabled,Fn.disabled,fr(f),null,"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}_renderTileClippingMasks(i,c){if(this.currentStencilSource===i.source||!i.isTileClipped()||!c||!c.length)return;this.currentStencilSource=i.source;const f=this.context,m=f.gl;this.nextStencilID+c.length>256&&this.clearStencil(),f.setColorMode(Hn.disabled),f.setDepthMode(en.disabled);const x=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const S of c){const P=this._tileClippingMaskIDs[S.key]=this.nextStencilID++,C=this.style.map.terrain&&this.style.map.terrain.getTerrainData(S);x.draw(f,m.TRIANGLES,en.disabled,new $n({func:m.ALWAYS,mask:0},P,255,m.KEEP,m.KEEP,m.REPLACE),Hn.disabled,Fn.disabled,fr(S.posMatrix),C,"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,c=this.context.gl;return new $n({func:c.NOTEQUAL,mask:255},i,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(i){const c=this.context.gl;return new $n({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(i){const c=this.context.gl,f=i.sort((S,P)=>P.overscaledZ-S.overscaledZ),m=f[f.length-1].overscaledZ,x=f[0].overscaledZ-m+1;if(x>1){this.currentStencilSource=void 0,this.nextStencilID+x>256&&this.clearStencil();const S={};for(let P=0;P<x;P++)S[P+m]=new $n({func:c.GEQUAL,mask:255},P+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=x,[S,f]}return[{[m]:$n.disabled},f]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new Hn([i.CONSTANT_COLOR,i.ONE],new u.Color(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Hn.unblended:Hn.alphaBlended}depthModeForSublayer(i,c,f){if(!this.opaquePassEnabledForLayer())return en.disabled;const m=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new en(f||this.context.gl.LEQUAL,c,[m,m])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,c){this.style=i,this.options=c,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(u.exported.now()),this.imageManager.beginFrame();const f=this.style._order,m=this.style.sourceCaches,x={},S={},P={};for(const C in m){const A=m[C];A.used&&A.prepare(this.context),x[C]=A.getVisibleCoordinates(),S[C]=x[C].slice().reverse(),P[C]=A.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let C=0;C<f.length;C++)if(this.style._layers[f[C]].is3D()){this.opaquePassCutoff=C;break}if(this.renderToTexture){this.renderToTexture.prepareForRender(this.style,this.transform.zoom),this.opaquePassCutoff=0;const C=this.style.map.terrain.sourceCache.tilesAfterTime(this.terrainFacilitator.renderTime);(this.terrainFacilitator.dirty||!u.equals(this.terrainFacilitator.matrix,this.transform.projMatrix)||C.length)&&(u.copy(this.terrainFacilitator.matrix,this.transform.projMatrix),this.terrainFacilitator.renderTime=Date.now(),this.terrainFacilitator.dirty=!1,function(A,O){const R=A.context,X=R.gl,et=Hn.unblended,$=new en(X.LEQUAL,en.ReadWrite,[0,1]),Q=O.getTerrainMesh(),ot=O.sourceCache.getRenderableTiles(),pt=A.useProgram("terrainDepth");R.bindFramebuffer.set(O.getFramebuffer("depth").framebuffer),R.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),R.clear({color:u.Color.transparent,depth:1});for(const Pt of ot){const rt=O.getTerrainData(Pt.tileID),Tt={u_matrix:A.transform.calculatePosMatrix(Pt.tileID.toUnwrapped()),u_ele_delta:O.getMeshFrameDelta(A.transform.zoom)};pt.draw(R,X.TRIANGLES,$,$n.disabled,et,Fn.backCCW,Tt,rt,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments)}R.bindFramebuffer.set(null),R.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain),function(A,O){const R=A.context,X=R.gl,et=Hn.unblended,$=new en(X.LEQUAL,en.ReadWrite,[0,1]),Q=O.getTerrainMesh(),ot=O.getCoordsTexture(),pt=O.sourceCache.getRenderableTiles(),Pt=A.useProgram("terrainCoords");R.bindFramebuffer.set(O.getFramebuffer("coords").framebuffer),R.viewport.set([0,0,A.width/devicePixelRatio,A.height/devicePixelRatio]),R.clear({color:u.Color.transparent,depth:1}),O.coordsIndex=[];for(const rt of pt){const Tt=O.getTerrainData(rt.tileID);R.activeTexture.set(X.TEXTURE0),X.bindTexture(X.TEXTURE_2D,ot.texture);const Lt={u_matrix:A.transform.calculatePosMatrix(rt.tileID.toUnwrapped()),u_terrain_coords_id:(255-O.coordsIndex.length)/255,u_texture:0,u_ele_delta:O.getMeshFrameDelta(A.transform.zoom)};Pt.draw(R,X.TRIANGLES,$,$n.disabled,et,Fn.backCCW,Lt,Tt,"terrain",Q.vertexBuffer,Q.indexBuffer,Q.segments),O.coordsIndex.push(rt.tileID.key)}R.bindFramebuffer.set(null),R.viewport.set([0,0,A.width,A.height])}(this,this.style.map.terrain))}this.renderPass="offscreen";for(const C of f){const A=this.style._layers[C];if(!A.hasOffscreenPass()||A.isHidden(this.transform.zoom))continue;const O=S[A.source];(A.type==="custom"||O.length)&&this.renderLayer(this,m[A.source],A,O)}if(this.context.bindFramebuffer.set(null),this.context.clear({color:c.showOverdrawInspector?u.Color.black:u.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.depthRangeFor3D=[0,1-(i._order.length+2)*this.numSublayers*this.depthEpsilon],!this.renderToTexture)for(this.renderPass="opaque",this.currentLayer=f.length-1;this.currentLayer>=0;this.currentLayer--){const C=this.style._layers[f[this.currentLayer]],A=m[C.source],O=x[C.source];this._renderTileClippingMasks(C,O),this.renderLayer(this,A,C,O)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<f.length;this.currentLayer++){const C=this.style._layers[f[this.currentLayer]],A=m[C.source];if(this.renderToTexture&&this.renderToTexture.renderLayer(C))continue;const O=(C.type==="symbol"?P:S)[C.source];this._renderTileClippingMasks(C,x[C.source]),this.renderLayer(this,A,C,O)}if(this.options.showTileBoundaries){const C=function(A,O){let R=null;const X=Object.values(A._layers).flatMap(ot=>ot.source&&!ot.isHidden(O)?[A.sourceCaches[ot.source]]:[]),et=X.filter(ot=>ot.getSource().type==="vector"),$=X.filter(ot=>ot.getSource().type!=="vector"),Q=ot=>{(!R||R.getSource().maxzoom<ot.getSource().maxzoom)&&(R=ot)};return et.forEach(ot=>Q(ot)),R||$.forEach(ot=>Q(ot)),R}(this.style,this.transform.zoom);C&&ce.debug(this,C,C.getVisibleCoordinates())}this.options.showPadding&&function(C){const A=C.transform.padding;ls(C,C.transform.height-(A.top||0),3,Ls),ls(C,A.bottom||0,3,uo),Al(C,A.left||0,3,Rc),Al(C,C.transform.width-(A.right||0),3,Zu);const O=C.transform.centerPoint;(function(R,X,et,$){Ll(R,X-1,et-10,2,20,$),Ll(R,X-10,et-1,20,2,$)})(C,O.x,C.transform.height-O.y,Oc)}(this),this.context.setDefault()}renderLayer(i,c,f,m){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="custom"||(m||[]).length)&&(this.id=f.id,ce[f.type](i,c,f,m,this.style.placement.variableOffsets))}translatePosMatrix(i,c,f,m,x){if(!f[0]&&!f[1])return i;const S=x?m==="map"?this.transform.angle:0:m==="viewport"?-this.transform.angle:0;if(S){const A=Math.sin(S),O=Math.cos(S);f=[f[0]*O-f[1]*A,f[0]*A+f[1]*O]}const P=[x?f[0]:ut(c,f[0],this.transform.zoom),x?f[1]:ut(c,f[1],this.transform.zoom),0],C=new Float32Array(16);return u.translate(C,i,P),C}saveTileTexture(i){const c=this._tileTextures[i.size[0]];c?c.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const c=this._tileTextures[i];return c&&c.length>0?c.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const c=this.imageManager.getPattern(i.from.toString()),f=this.imageManager.getPattern(i.to.toString());return!c||!f}useProgram(i,c){this.cache=this.cache||{};const f=i+(c?c.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"")+(this.style.map.terrain?"/terrain":"");return this.cache[f]||(this.cache[f]=new Z(this.context,i,da[i],c,zu[i],this._showOverdrawInspector,this.style.map.terrain)),this.cache[f]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new ie(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}}class nr{constructor(i,c){this.points=i,this.planes=c}static fromInvProjectionMatrix(i,c,f){const m=Math.pow(2,f),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(P=>{const C=1/(P=u.transformMat4([],P,i))[3]/c*m;return u.mul$1(P,P,[C,C,1/P[3],C])}),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(P=>{const C=function(X,et){var $=et[0],Q=et[1],ot=et[2],pt=$*$+Q*Q+ot*ot;return pt>0&&(pt=1/Math.sqrt(pt)),X[0]=et[0]*pt,X[1]=et[1]*pt,X[2]=et[2]*pt,X}([],function(X,et,$){var Q=et[0],ot=et[1],pt=et[2],Pt=$[0],rt=$[1],Tt=$[2];return X[0]=ot*Tt-pt*rt,X[1]=pt*Pt-Q*Tt,X[2]=Q*rt-ot*Pt,X}([],Ut([],x[P[0]],x[P[1]]),Ut([],x[P[2]],x[P[1]]))),A=-((O=C)[0]*(R=x[P[1]])[0]+O[1]*R[1]+O[2]*R[2]);var O,R;return C.concat(A)});return new nr(x,S)}}class an{constructor(i,c){this.min=i,this.max=c,this.center=function(f,m,x){return f[0]=.5*m[0],f[1]=.5*m[1],f[2]=.5*m[2],f}([],function(f,m,x){return f[0]=m[0]+x[0],f[1]=m[1]+x[1],f[2]=m[2]+x[2],f}([],this.min,this.max))}quadrant(i){const c=[i%2==0,i<2],f=Nt(this.min),m=Nt(this.max);for(let x=0;x<c.length;x++)f[x]=c[x]?this.min[x]:this.center[x],m[x]=c[x]?this.center[x]:this.max[x];return m[2]=this.max[2],new an(f,m)}distanceX(i){return Math.max(Math.min(this.max[0],i[0]),this.min[0])-i[0]}distanceY(i){return Math.max(Math.min(this.max[1],i[1]),this.min[1])-i[1]}intersects(i){const c=[[this.min[0],this.min[1],this.min[2],1],[this.max[0],this.min[1],this.min[2],1],[this.max[0],this.max[1],this.min[2],1],[this.min[0],this.max[1],this.min[2],1],[this.min[0],this.min[1],this.max[2],1],[this.max[0],this.min[1],this.max[2],1],[this.max[0],this.max[1],this.max[2],1],[this.min[0],this.max[1],this.max[2],1]];let f=!0;for(let m=0;m<i.planes.length;m++){const x=i.planes[m];let S=0;for(let P=0;P<c.length;P++)u.dot(x,c[P])>=0&&S++;if(S===0)return 0;S!==c.length&&(f=!1)}if(f)return 2;for(let m=0;m<3;m++){let x=Number.MAX_VALUE,S=-Number.MAX_VALUE;for(let P=0;P<i.points.length;P++){const C=i.points[P][m]-this.min[m];x=Math.min(x,C),S=Math.max(S,C)}if(S<0||x>this.max[m]-this.min[m])return 0}return 1}}class dr{constructor(i=0,c=0,f=0,m=0){if(isNaN(i)||i<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(m)||m<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=c,this.left=f,this.right=m}interpolate(i,c,f){return c.top!=null&&i.top!=null&&(this.top=u.interpolate.number(i.top,c.top,f)),c.bottom!=null&&i.bottom!=null&&(this.bottom=u.interpolate.number(i.bottom,c.bottom,f)),c.left!=null&&i.left!=null&&(this.left=u.interpolate.number(i.left,c.left,f)),c.right!=null&&i.right!=null&&(this.right=u.interpolate.number(i.right,c.right,f)),this}getCenter(i,c){const f=u.clamp((this.left+i-this.right)/2,0,i),m=u.clamp((this.top+c-this.bottom)/2,0,c);return new u.Point(f,m)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new dr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}class Cr{constructor(i,c,f,m,x){this.tileSize=512,this.maxValidLatitude=85.051129,this.freezeElevation=!1,this._renderWorldCopies=x===void 0||!!x,this._minZoom=i||0,this._maxZoom=c||22,this._minPitch=f??0,this._maxPitch=m??60,this.setMaxBounds(),this.width=0,this.height=0,this._center=new u.LngLat(0,0),this._elevation=0,this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new dr,this._posMatrixCache={},this._alignedPosMatrixCache={}}clone(){const i=new Cr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return i.apply(this),i}apply(i){this.tileSize=i.tileSize,this.latRange=i.latRange,this.width=i.width,this.height=i.height,this._center=i._center,this._elevation=i._elevation,this.zoom=i.zoom,this.angle=i.angle,this._fov=i._fov,this._pitch=i._pitch,this._unmodified=i._unmodified,this._edgeInsets=i._edgeInsets.clone(),this._calcMatrices()}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new u.Point(this.width,this.height)}get bearing(){return-this.angle/Math.PI*180}set bearing(i){const c=-u.wrap(i,-180,180)*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=function(){var f=new u.ARRAY_TYPE(4);return u.ARRAY_TYPE!=Float32Array&&(f[1]=0,f[2]=0),f[0]=1,f[3]=1,f}(),function(f,m,x){var S=m[0],P=m[1],C=m[2],A=m[3],O=Math.sin(x),R=Math.cos(x);f[0]=S*R+C*O,f[1]=P*R+A*O,f[2]=S*-O+C*R,f[3]=P*-O+A*R}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const c=u.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get zoom(){return this._zoom}set zoom(i){const c=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._zoom=c,this.tileZoom=Math.max(0,Math.floor(c)),this.scale=this.zoomScale(c),this._constrain(),this._calcMatrices())}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._constrain(),this._calcMatrices())}get elevation(){return this._elevation}set elevation(i){i!==this._elevation&&(this._elevation=i,this._constrain(),this._calcMatrices())}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,c,f){this._unmodified=!1,this._edgeInsets.interpolate(i,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const c=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(i){const c=[new u.UnwrappedTileID(0,i)];if(this._renderWorldCopies){const f=this.pointCoordinate(new u.Point(0,0)),m=this.pointCoordinate(new u.Point(this.width,0)),x=this.pointCoordinate(new u.Point(this.width,this.height)),S=this.pointCoordinate(new u.Point(0,this.height)),P=Math.floor(Math.min(f.x,m.x,x.x,S.x)),C=Math.floor(Math.max(f.x,m.x,x.x,S.x)),A=1;for(let O=P-A;O<=C+A;O++)O!==0&&c.push(new u.UnwrappedTileID(O,i))}return c}coveringTiles(i){var c,f;let m=this.coveringZoomLevel(i);const x=m;if(i.minzoom!==void 0&&m<i.minzoom)return[];i.maxzoom!==void 0&&m>i.maxzoom&&(m=i.maxzoom);const S=this.pointCoordinate(this.getCameraPoint()),P=u.MercatorCoordinate.fromLngLat(this.center),C=Math.pow(2,m),A=[C*S.x,C*S.y,0],O=[C*P.x,C*P.y,0],R=nr.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,m);let X=i.minzoom||0;!i.terrain&&this.pitch<=60&&this._edgeInsets.top<.1&&(X=m);const et=i.terrain?2/Math.min(this.tileSize,i.tileSize)*this.tileSize:3,$=rt=>({aabb:new an([rt*C,0,0],[(rt+1)*C,C,0]),zoom:0,x:0,y:0,wrap:rt,fullyVisible:!1}),Q=[],ot=[],pt=m,Pt=i.reparseOverscaled?x:m;if(this._renderWorldCopies)for(let rt=1;rt<=3;rt++)Q.push($(-rt)),Q.push($(rt));for(Q.push($(0));Q.length>0;){const rt=Q.pop(),Tt=rt.x,Lt=rt.y;let jt=rt.fullyVisible;if(!jt){const Oe=rt.aabb.intersects(R);if(Oe===0)continue;jt=Oe===2}const Ht=i.terrain?A:O,Jt=rt.aabb.distanceX(Ht),Yt=rt.aabb.distanceY(Ht),xe=Math.max(Math.abs(Jt),Math.abs(Yt));if(rt.zoom===pt||xe>et+(1<<pt-rt.zoom)-2&&rt.zoom>=X){const Oe=pt-rt.zoom,nn=A[0]-.5-(Tt<<Oe),ue=A[1]-.5-(Lt<<Oe);ot.push({tileID:new u.OverscaledTileID(rt.zoom===pt?Pt:rt.zoom,rt.wrap,rt.zoom,Tt,Lt),distanceSq:Zt([O[0]-.5-Tt,O[1]-.5-Lt]),tileDistanceToCamera:Math.sqrt(nn*nn+ue*ue)})}else for(let Oe=0;Oe<4;Oe++){const nn=(Tt<<1)+Oe%2,ue=(Lt<<1)+(Oe>>1),je=rt.zoom+1;let be=rt.aabb.quadrant(Oe);if(i.terrain){const Un=new u.OverscaledTileID(je,rt.wrap,je,nn,ue),ai=i.terrain.getMinMaxElevation(Un),Vn=(c=ai.minElevation)!==null&&c!==void 0?c:this.elevation,ln=(f=ai.maxElevation)!==null&&f!==void 0?f:this.elevation;be=new an([be.min[0],be.min[1],Vn],[be.max[0],be.max[1],ln])}Q.push({aabb:be,zoom:je,x:nn,y:ue,wrap:rt.wrap,fullyVisible:jt})}}return ot.sort((rt,Tt)=>rt.distanceSq-Tt.distanceSq).map(rt=>rt.tileID)}resize(i,c){this.width=i,this.height=c,this.pixelsToGLUnits=[2/i,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const c=u.clamp(i.lat,-this.maxValidLatitude,this.maxValidLatitude);return new u.Point(u.mercatorXfromLng(i.lng)*this.worldSize,u.mercatorYfromLat(c)*this.worldSize)}unproject(i){return new u.MercatorCoordinate(i.x/this.worldSize,i.y/this.worldSize).toLngLat()}get point(){return this.project(this.center)}updateElevation(i){this.freezeElevation||(this.elevation=i?this.getElevation(this._center,i):0)}getElevation(i,c){const f=u.MercatorCoordinate.fromLngLat(i.wrap()),m=(1<<this.tileZoom)*u.EXTENT,x=f.x*m,S=f.y*m,P=Math.floor(x/u.EXTENT),C=Math.floor(S/u.EXTENT),A=new u.OverscaledTileID(this.tileZoom,0,this.tileZoom,P,C);return c.getElevation(A,x%u.EXTENT,S%u.EXTENT,u.EXTENT)}getCameraPosition(){return{lngLat:this.pointLocation(this.getCameraPoint()),altitude:Math.cos(this._pitch)*this.cameraToCenterDistance/this._pixelPerMeter+this.elevation}}recalculateZoom(i){const c=this.pointLocation(this.centerPoint,i),f=this.getElevation(c,i);if(!(this.elevation-f))return;const m=this.getCameraPosition(),x=u.MercatorCoordinate.fromLngLat(m.lngLat,m.altitude),S=u.MercatorCoordinate.fromLngLat(c,f),P=x.x-S.x,C=x.y-S.y,A=x.z-S.z,O=Math.sqrt(P*P+C*C+A*A),R=this.scaleZoom(this.cameraToCenterDistance/O/this.tileSize);this._elevation=f,this._center=c,this.zoom=R}setLocationAtPoint(i,c){const f=this.pointCoordinate(c),m=this.pointCoordinate(this.centerPoint),x=this.locationCoordinate(i),S=new u.MercatorCoordinate(x.x-(f.x-m.x),x.y-(f.y-m.y));this.center=this.coordinateLocation(S),this._renderWorldCopies&&(this.center=this.center.wrap())}locationPoint(i,c){return c?this.coordinatePoint(this.locationCoordinate(i),this.getElevation(i,c),this.pixelMatrix3D):this.coordinatePoint(this.locationCoordinate(i))}pointLocation(i,c){return this.coordinateLocation(this.pointCoordinate(i,c))}locationCoordinate(i){return u.MercatorCoordinate.fromLngLat(i)}coordinateLocation(i){return i&&i.toLngLat()}pointCoordinate(i,c){if(c){const X=c.pointCoordinate(i);if(X!=null)return X}const f=[i.x,i.y,0,1],m=[i.x,i.y,1,1];u.transformMat4(f,f,this.pixelMatrixInverse),u.transformMat4(m,m,this.pixelMatrixInverse);const x=f[3],S=m[3],P=f[1]/x,C=m[1]/S,A=f[2]/x,O=m[2]/S,R=A===O?0:(0-A)/(O-A);return new u.MercatorCoordinate(u.interpolate.number(f[0]/x,m[0]/S,R)/this.worldSize,u.interpolate.number(P,C,R)/this.worldSize)}coordinatePoint(i,c=0,f=this.pixelMatrix){const m=[i.x*this.worldSize,i.y*this.worldSize,c,1];return u.transformMat4(m,m,f),new u.Point(m[0]/m[3],m[1]/m[3])}getBounds(){const i=Math.max(0,this.height/2-this.getHorizon());return new ur().extend(this.pointLocation(new u.Point(0,i))).extend(this.pointLocation(new u.Point(this.width,i))).extend(this.pointLocation(new u.Point(this.width,this.height))).extend(this.pointLocation(new u.Point(0,this.height)))}getMaxBounds(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new ur([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}getHorizon(){return Math.tan(Math.PI/2-this._pitch)*this.cameraToCenterDistance*.85}setMaxBounds(i){i?(this.lngRange=[i.getWest(),i.getEast()],this.latRange=[i.getSouth(),i.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}calculatePosMatrix(i,c=!1){const f=i.key,m=c?this._alignedPosMatrixCache:this._posMatrixCache;if(m[f])return m[f];const x=i.canonical,S=this.worldSize/this.zoomScale(x.z),P=x.x+Math.pow(2,x.z)*i.wrap,C=u.identity(new Float64Array(16));return u.translate(C,C,[P*S,x.y*S,0]),u.scale(C,C,[S/u.EXTENT,S/u.EXTENT,1]),u.multiply(C,c?this.alignedProjMatrix:this.projMatrix,C),m[f]=new Float32Array(C),m[f]}customLayerMatrix(){return this.mercatorMatrix.slice()}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;let i,c,f,m,x=-90,S=90,P=-180,C=180;const A=this.size,O=this._unmodified;if(this.latRange){const et=this.latRange;x=u.mercatorYfromLat(et[1])*this.worldSize,S=u.mercatorYfromLat(et[0])*this.worldSize,i=S-x<A.y?A.y/(S-x):0}if(this.lngRange){const et=this.lngRange;P=u.wrap(u.mercatorXfromLng(et[0])*this.worldSize,0,this.worldSize),C=u.wrap(u.mercatorXfromLng(et[1])*this.worldSize,0,this.worldSize),C<P&&(C+=this.worldSize),c=C-P<A.x?A.x/(C-P):0}const R=this.point,X=Math.max(c||0,i||0);if(X)return this.center=this.unproject(new u.Point(c?(C+P)/2:R.x,i?(S+x)/2:R.y)),this.zoom+=this.scaleZoom(X),this._unmodified=O,void(this._constraining=!1);if(this.latRange){const et=R.y,$=A.y/2;et-$<x&&(m=x+$),et+$>S&&(m=S-$)}if(this.lngRange){const et=(P+C)/2,$=u.wrap(R.x,et-this.worldSize/2,et+this.worldSize/2),Q=A.x/2;$-Q<P&&(f=P+Q),$+Q>C&&(f=C-Q)}f===void 0&&m===void 0||(this.center=this.unproject(new u.Point(f!==void 0?f:R.x,m!==void 0?m:R.y)).wrap()),this._unmodified=O,this._constraining=!1}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,c=this.point.x,f=this.point.y;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height,this._pixelPerMeter=u.mercatorZfromAltitude(1,this.center.lat)*this.worldSize;let m=u.identity(new Float64Array(16));u.scale(m,m,[this.width/2,-this.height/2,1]),u.translate(m,m,[1,-1,0]),this.labelPlaneMatrix=m,m=u.identity(new Float64Array(16)),u.scale(m,m,[1,-1,1]),u.translate(m,m,[-1,-1,0]),u.scale(m,m,[2/this.width,2/this.height,1]),this.glCoordMatrix=m,this.cameraToSeaLevelDistance=this.cameraToCenterDistance+this._elevation*this._pixelPerMeter/Math.cos(this._pitch);const x=this._elevation<0?this.cameraToCenterDistance:this.cameraToSeaLevelDistance,S=Math.PI/2+this._pitch,P=this._fov*(.5+i.y/this.height),C=Math.sin(P)*x/Math.sin(u.clamp(Math.PI-S-P,.01,Math.PI-.01)),A=this.getHorizon(),O=2*Math.atan(A/this.cameraToCenterDistance)*(.5+i.y/(2*A)),R=Math.sin(O)*x/Math.sin(u.clamp(Math.PI-S-O,.01,Math.PI-.01)),X=Math.min(C,R),et=1.01*(Math.cos(Math.PI/2-this._pitch)*X+x),$=this.height/50;m=new Float64Array(16),u.perspective(m,this._fov,this.width/this.height,$,et),m[8]=2*-i.x/this.width,m[9]=2*i.y/this.height,u.scale(m,m,[1,-1,1]),u.translate(m,m,[0,0,-this.cameraToCenterDistance]),u.rotateX(m,m,this._pitch),u.rotateZ(m,m,this.angle),u.translate(m,m,[-c,-f,0]),this.mercatorMatrix=u.scale([],m,[this.worldSize,this.worldSize,this.worldSize]),u.scale(m,m,[1,1,this._pixelPerMeter]),this.pixelMatrix=u.multiply(new Float64Array(16),this.labelPlaneMatrix,m),u.translate(m,m,[0,0,-this.elevation]),this.projMatrix=m,this.invProjMatrix=u.invert([],m),this.pixelMatrix3D=u.multiply(new Float64Array(16),this.labelPlaneMatrix,m);const Q=this.width%2/2,ot=this.height%2/2,pt=Math.cos(this.angle),Pt=Math.sin(this.angle),rt=c-Math.round(c)+pt*Q+Pt*ot,Tt=f-Math.round(f)+pt*ot+Pt*Q,Lt=new Float64Array(m);if(u.translate(Lt,Lt,[rt>.5?rt-1:rt,Tt>.5?Tt-1:Tt,0]),this.alignedProjMatrix=Lt,m=u.invert(new Float64Array(16),this.pixelMatrix),!m)throw new Error("failed to invert matrix");this.pixelMatrixInverse=m,this._posMatrixCache={},this._alignedPosMatrixCache={}}maxPitchScaleFactor(){if(!this.pixelMatrixInverse)return 1;const i=this.pointCoordinate(new u.Point(0,0)),c=[i.x*this.worldSize,i.y*this.worldSize,0,1];return u.transformMat4(c,c,this.pixelMatrix)[3]/this.cameraToCenterDistance}getCameraPoint(){const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new u.Point(0,i))}getCameraQueryGeometry(i){const c=this.getCameraPoint();if(i.length===1)return[i[0],c];{let f=c.x,m=c.y,x=c.x,S=c.y;for(const P of i)f=Math.min(f,P.x),m=Math.min(m,P.y),x=Math.max(x,P.x),S=Math.max(S,P.y);return[new u.Point(f,m),new u.Point(x,m),new u.Point(x,S),new u.Point(f,S),new u.Point(f,m)]}}}class Xo{constructor(i){this._hashName=i&&encodeURIComponent(i),u.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=function(c,f){let m=!1,x=null;const S=()=>{x=null,m&&(c(),x=setTimeout(S,300),m=!1)};return()=>(m=!0,x||S(),x)}(this._updateHashUnthrottled.bind(this))}addTo(i){return this._map=i,addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this}remove(){return removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this}getHashString(i){const c=this._map.getCenter(),f=Math.round(100*this._map.getZoom())/100,m=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),x=Math.pow(10,m),S=Math.round(c.lng*x)/x,P=Math.round(c.lat*x)/x,C=this._map.getBearing(),A=this._map.getPitch();let O="";if(O+=i?`/${S}/${P}/${f}`:`${f}/${P}/${S}`,(C||A)&&(O+="/"+Math.round(10*C)/10),A&&(O+=`/${Math.round(A)}`),this._hashName){const R=this._hashName;let X=!1;const et=window.location.hash.slice(1).split("&").map($=>{const Q=$.split("=")[0];return Q===R?(X=!0,`${Q}=${O}`):$}).filter($=>$);return X||et.push(`${R}=${O}`),`#${et.join("&")}`}return`#${O}`}_getCurrentHash(){const i=window.location.hash.replace("#","");if(this._hashName){let c;return i.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._getCurrentHash();if(i.length>=3&&!i.some(c=>isNaN(c))){const c=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(i[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+i[2],+i[1]],zoom:+i[0],bearing:c,pitch:+(i[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=window.location.href.replace(/(#.+)?$/,this.getHashString());try{window.history.replaceState(window.history.state,null,i)}catch{}}}const Pr={linearity:.3,easing:u.bezier(0,0,.3,1)},Qr=u.extend({deceleration:2500,maxSpeed:1400},Pr),us=u.extend({deceleration:20,maxSpeed:1400},Pr),Po=u.extend({deceleration:1e3,maxSpeed:360},Pr),Oi=u.extend({deceleration:1e3,maxSpeed:90},Pr);class xi{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:u.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,c=u.exported.now();for(;i.length>0&&c-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const c={zoom:0,bearing:0,pitch:0,pan:new u.Point(0,0),pinchAround:void 0,around:void 0};for(const{settings:x}of this._inertiaBuffer)c.zoom+=x.zoomDelta||0,c.bearing+=x.bearingDelta||0,c.pitch+=x.pitchDelta||0,x.panDelta&&c.pan._add(x.panDelta),x.around&&(c.around=x.around),x.pinchAround&&(c.pinchAround=x.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,m={};if(c.pan.mag()){const x=xa(c.pan.mag(),f,u.extend({},Qr,i||{}));m.offset=c.pan.mult(x.amount/c.pan.mag()),m.center=this._map.transform.center,Si(m,x)}if(c.zoom){const x=xa(c.zoom,f,us);m.zoom=this._map.transform.zoom+x.amount,Si(m,x)}if(c.bearing){const x=xa(c.bearing,f,Po);m.bearing=this._map.transform.bearing+u.clamp(x.amount,-179,179),Si(m,x)}if(c.pitch){const x=xa(c.pitch,f,Oi);m.pitch=this._map.transform.pitch+x.amount,Si(m,x)}if(m.zoom||m.bearing){const x=c.pinchAround===void 0?c.around:c.pinchAround;m.around=x?this._map.unproject(x):this._map.getCenter()}return this.clear(),u.extend(m,{noMoveStart:!0})}}function Si(d,i){(!d.duration||d.duration<i.duration)&&(d.duration=i.duration,d.easing=i.easing)}function xa(d,i,c){const{maxSpeed:f,linearity:m,deceleration:x}=c,S=u.clamp(d*m/(i/1e3),-f,f),P=Math.abs(S)/(x*m);return{easing:c.easing,duration:1e3*P,amount:S*(P/2)}}class gr extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,f,m={}){const x=w.mousePos(c.getCanvasContainer(),f),S=c.unproject(x);super(i,u.extend({point:x,lngLat:S,originalEvent:f},m)),this._defaultPrevented=!1,this.target=c}}class Yo extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,f){const m=i==="touchend"?f.changedTouches:f.touches,x=w.touchPos(c.getCanvasContainer(),m),S=x.map(C=>c.unproject(C)),P=x.reduce((C,A,O,R)=>C.add(A.div(R.length)),new u.Point(0,0));super(i,{points:x,point:P,lngLats:S,lngLat:c.unproject(P),originalEvent:f}),this._defaultPrevented=!1}}class xh extends u.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,f){super(i,{originalEvent:f}),this._defaultPrevented=!1}}class Dp{constructor(i,c){this._map=i,this._clickTolerance=c.clickTolerance}reset(){delete this._mousedownPos}wheel(i){return this._firePreventable(new xh(i.type,this._map,i))}mousedown(i,c){return this._mousedownPos=c,this._firePreventable(new gr(i.type,this._map,i))}mouseup(i){this._map.fire(new gr(i.type,this._map,i))}click(i,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||this._map.fire(new gr(i.type,this._map,i))}dblclick(i){return this._firePreventable(new gr(i.type,this._map,i))}mouseover(i){this._map.fire(new gr(i.type,this._map,i))}mouseout(i){this._map.fire(new gr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new Yo(i.type,this._map,i))}touchmove(i){this._map.fire(new Yo(i.type,this._map,i))}touchend(i){this._map.fire(new Yo(i.type,this._map,i))}touchcancel(i){this._map.fire(new Yo(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class kp{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._ignoreContextMenu=!0,delete this._contextMenuEvent}mousemove(i){this._map.fire(new gr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0,this._ignoreContextMenu=!1}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new gr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._ignoreContextMenu||this._map.fire(new gr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Bn{constructor(i){this._map=i}get transform(){return this._map._requestedCameraState||this._map.transform}get center(){return{lng:this.transform.center.lng,lat:this.transform.center.lat}}get zoom(){return this.transform.zoom}get pitch(){return this.transform.pitch}get bearing(){return this.transform.bearing}unproject(i){return this.transform.pointLocation(u.Point.convert(i),this._map.terrain)}}class kn{constructor(i,c){this._map=i,this._tr=new Bn(i),this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,c){this.isEnabled()&&i.shiftKey&&i.button===0&&(w.disableDrag(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(i,c){if(!this._active)return;const f=c;if(this._lastPos.equals(f)||!this._box&&f.dist(this._startPos)<this._clickTolerance)return;const m=this._startPos;this._lastPos=f,this._box||(this._box=w.create("div","maplibregl-boxzoom",this._container),this._container.classList.add("maplibregl-crosshair"),this._fireEvent("boxzoomstart",i));const x=Math.min(m.x,f.x),S=Math.max(m.x,f.x),P=Math.min(m.y,f.y),C=Math.max(m.y,f.y);w.setTransform(this._box,`translate(${x}px,${P}px)`),this._box.style.width=S-x+"px",this._box.style.height=C-P+"px"}mouseupWindow(i,c){if(!this._active||i.button!==0)return;const f=this._startPos,m=c;if(this.reset(),w.suppressClick(),f.x!==m.x||f.y!==m.y)return this._map.fire(new u.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:x=>x.fitScreenCoordinates(f,m,this._tr.bearing,{linear:!0})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}reset(){this._active=!1,this._container.classList.remove("maplibregl-crosshair"),this._box&&(w.remove(this._box),this._box=null),w.enableDrag(),delete this._startPos,delete this._lastPos}_fireEvent(i,c){return this._map.fire(new u.Event(i,{originalEvent:c}))}}function Mo(d,i){if(d.length!==i.length)throw new Error(`The number of touches and points are not equal - touches ${d.length}, points ${i.length}`);const c={};for(let f=0;f<d.length;f++)c[d[f].identifier]=i[f];return c}class de{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}touchstart(i,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=i.timeStamp),f.length===this.numTouches&&(this.centroid=function(m){const x=new u.Point(0,0);for(const S of m)x._add(S);return x.div(m.length)}(c),this.touches=Mo(f,c)))}touchmove(i,c,f){if(this.aborted||!this.centroid)return;const m=Mo(f,c);for(const x in this.touches){const S=m[x];(!S||S.dist(this.touches[x])>30)&&(this.aborted=!0)}}touchend(i,c,f){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const m=!this.aborted&&this.centroid;if(this.reset(),m)return m}}}class Dl{constructor(i){this.singleTap=new de(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}touchstart(i,c,f){this.singleTap.touchstart(i,c,f)}touchmove(i,c,f){this.singleTap.touchmove(i,c,f)}touchend(i,c,f){const m=this.singleTap.touchend(i,c,f);if(m){const x=i.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(m)<30;if(x&&S||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=m,this.count===this.numTaps)return this.reset(),m}}}class zi{constructor(i){this._tr=new Bn(i),this._zoomIn=new Dl({numTouches:1,numTaps:2}),this._zoomOut=new Dl({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,c,f){this._zoomIn.touchstart(i,c,f),this._zoomOut.touchstart(i,c,f)}touchmove(i,c,f){this._zoomIn.touchmove(i,c,f),this._zoomOut.touchmove(i,c,f)}touchend(i,c,f){const m=this._zoomIn.touchend(i,c,f),x=this._zoomOut.touchend(i,c,f),S=this._tr;return m?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:S.zoom+1,around:S.unproject(m)},{originalEvent:i})}):x?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:P=>P.easeTo({duration:300,zoom:S.zoom-1,around:S.unproject(x)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ti{constructor(i){this._enabled=!!i.enable,this._moveStateManager=i.moveStateManager,this._clickTolerance=i.clickTolerance||1,this._moveFunction=i.move,this._activateOnStart=!!i.activateOnStart,i.assignEvents(this),this.reset()}reset(i){this._active=!1,this._moved=!1,delete this._lastPoint,this._moveStateManager.endMove(i)}_move(...i){const c=this._moveFunction(...i);if(c.bearingDelta||c.pitchDelta||c.around||c.panDelta)return this._active=!0,c}dragStart(i,c){this.isEnabled()&&!this._lastPoint&&this._moveStateManager.isValidStartEvent(i)&&(this._moveStateManager.startMove(i),this._lastPoint=c.length?c[0]:c,this._activateOnStart&&this._lastPoint&&(this._active=!0))}dragMove(i,c){if(!this.isEnabled())return;const f=this._lastPoint;if(!f)return;if(i.preventDefault(),!this._moveStateManager.isValidMoveEvent(i))return void this.reset(i);const m=c.length?c[0]:c;return!this._moved&&m.dist(f)<this._clickTolerance?void 0:(this._moved=!0,this._lastPoint=m,this._move(f,m))}dragEnd(i){this.isEnabled()&&this._lastPoint&&this._moveStateManager.isValidEndEvent(i)&&(this._moved&&w.suppressClick(),this.reset(i))}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}getClickTolerance(){return this._clickTolerance}}const Zs={0:1,2:2};class le{constructor(i){this._correctEvent=i.checkCorrectEvent}startMove(i){const c=w.mouseButton(i);this._eventButton=c}endMove(i){delete this._eventButton}isValidStartEvent(i){return this._correctEvent(i)}isValidMoveEvent(i){return!function(c,f){const m=Zs[f];return c.buttons===void 0||(c.buttons&m)!==m}(i,this._eventButton)}isValidEndEvent(i){return w.mouseButton(i)===this._eventButton}}class nl{constructor(){this._firstTouch=void 0}_isOneFingerTouch(i){return i.targetTouches.length===1}_isSameTouchEvent(i){return i.targetTouches[0].identifier===this._firstTouch}startMove(i){this._firstTouch=i.targetTouches[0].identifier}endMove(i){delete this._firstTouch}isValidStartEvent(i){return this._isOneFingerTouch(i)}isValidMoveEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}isValidEndEvent(i){return this._isOneFingerTouch(i)&&this._isSameTouchEvent(i)}}const ba=d=>{d.mousedown=d.dragStart,d.mousemoveWindow=d.dragMove,d.mouseup=d.dragEnd,d.contextmenu=function(i){i.preventDefault()}},wa=({enable:d,clickTolerance:i,bearingDegreesPerPixelMoved:c=.8})=>{const f=new le({checkCorrectEvent:m=>w.mouseButton(m)===0&&m.ctrlKey||w.mouseButton(m)===2});return new Ti({clickTolerance:i,move:(m,x)=>({bearingDelta:(x.x-m.x)*c}),moveStateManager:f,enable:d,assignEvents:ba})},uu=({enable:d,clickTolerance:i,pitchDegreesPerPixelMoved:c=-.5})=>{const f=new le({checkCorrectEvent:m=>w.mouseButton(m)===0&&m.ctrlKey||w.mouseButton(m)===2});return new Ti({clickTolerance:i,move:(m,x)=>({pitchDelta:(x.y-m.y)*c}),moveStateManager:f,enable:d,assignEvents:ba})};class cu{constructor(i,c){this._minTouches=i.cooperativeGestures?2:1,this._clickTolerance=i.clickTolerance||1,this._map=c,this.reset()}reset(){this._active=!1,this._touches={},this._sum=new u.Point(0,0),setTimeout(()=>{this._cancelCooperativeMessage=!1},200)}touchstart(i,c,f){return this._calculateTransform(i,c,f)}touchmove(i,c,f){if(this._map._cooperativeGestures&&(this._minTouches===2&&f.length<2&&!this._cancelCooperativeMessage?this._map._onCooperativeGesture(i,!1,f.length):this._cancelCooperativeMessage||(this._cancelCooperativeMessage=!0)),this._active&&!(f.length<this._minTouches))return i.preventDefault(),this._calculateTransform(i,c,f)}touchend(i,c,f){this._calculateTransform(i,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,c,f){f.length>0&&(this._active=!0);const m=Mo(f,c),x=new u.Point(0,0),S=new u.Point(0,0);let P=0;for(const A in m){const O=m[A],R=this._touches[A];R&&(x._add(O),S._add(O.sub(R)),P++,m[A]=O)}if(this._touches=m,P<this._minTouches||!S.mag())return;const C=S.div(P);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:x.div(P),panDelta:C}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kl{constructor(){this.reset()}reset(){this._active=!1,delete this._firstTwoTouches}_start(i){}_move(i,c,f){return{}}touchstart(i,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(i,c,f){if(!this._firstTwoTouches)return;i.preventDefault();const[m,x]=this._firstTwoTouches,S=rl(f,c,m),P=rl(f,c,x);if(!S||!P)return;const C=this._aroundCenter?null:S.add(P).div(2);return this._move([S,P],C,i)}touchend(i,c,f){if(!this._firstTwoTouches)return;const[m,x]=this._firstTwoTouches,S=rl(f,c,m),P=rl(f,c,x);S&&P||(this._active&&w.suppressClick(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function rl(d,i,c){for(let f=0;f<d.length;f++)if(d[f].identifier===c)return i[f]}function hu(d,i){return Math.log(d/i)/Math.LN2}class Xu extends kl{reset(){super.reset(),delete this._distance,delete this._startDistance}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,c){const f=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(hu(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:hu(this._distance,f),pinchAround:c}}}function il(d,i){return 180*d.angleWith(i)/Math.PI}class Nl extends kl{reset(){super.reset(),delete this._minDiameter,delete this._startVector,delete this._vector}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,c){const f=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:il(this._vector,f),pinchAround:c}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const c=25/(Math.PI*this._minDiameter)*360,f=il(i,this._startVector);return Math.abs(f)<c}}function zc(d){return Math.abs(d.y)>Math.abs(d.x)}class Wo extends kl{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,delete this._firstMove,delete this._lastPoints}touchstart(i,c,f){super.touchstart(i,c,f),this._currentTouchCount=f.length}_start(i){this._lastPoints=i,zc(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,c,f){if(this._map._cooperativeGestures&&this._currentTouchCount<3)return;const m=i[0].sub(this._lastPoints[0]),x=i[1].sub(this._lastPoints[1]);return this._valid=this.gestureBeginsVertically(m,x,f.timeStamp),this._valid?(this._lastPoints=i,this._active=!0,{pitchDelta:(m.y+x.y)/2*-.5}):void 0}gestureBeginsVertically(i,c,f){if(this._valid!==void 0)return this._valid;const m=i.mag()>=2,x=c.mag()>=2;if(!m&&!x)return;if(!m||!x)return this._firstMove===void 0&&(this._firstMove=f),f-this._firstMove<100&&void 0;const S=i.y>0==c.y>0;return zc(i)&&zc(c)&&S}}const Rl={panStep:100,bearingStep:15,pitchStep:10};class Jf{constructor(i){this._tr=new Bn(i);const c=Rl;this._panStep=c.panStep,this._bearingStep=c.bearingStep,this._pitchStep=c.pitchStep,this._rotationDisabled=!1}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let c=0,f=0,m=0,x=0,S=0;switch(i.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:i.shiftKey?f=-1:(i.preventDefault(),x=-1);break;case 39:i.shiftKey?f=1:(i.preventDefault(),x=1);break;case 38:i.shiftKey?m=1:(i.preventDefault(),S=-1);break;case 40:i.shiftKey?m=-1:(i.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(f=0,m=0),{cameraAnimation:P=>{const C=this._tr;P.easeTo({duration:300,easeId:"keyboardHandler",easing:Np,zoom:c?Math.round(C.zoom)+c*(i.shiftKey?2:1):C.zoom,bearing:C.bearing+f*this._bearingStep,pitch:C.pitch+m*this._pitchStep,offset:[-x*this._panStep,-S*this._panStep],center:C.center},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Np(d){return d*(2-d)}const bh=4.000244140625;class Rp{constructor(i,c){this._map=i,this._tr=new Bn(i),this._el=i.getCanvasContainer(),this._handler=c,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,u.bindAll(["_onTimeout"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=i&&i.around==="center")}disable(){this.isEnabled()&&(this._enabled=!1)}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!i[this._map._metaKey])return;i.preventDefault()}let c=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const f=u.exported.now(),m=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%bh==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":m>400?(this._type=null,this._lastValue=c,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(m*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),i.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=i,this._delta-=c,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=w.mousePos(this._el,i),f=this._tr;this._around=u.LngLat.convert(this._aroundCenter?f.center:f.unproject(c)),this._aroundPoint=f.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._tr.transform;if(this._delta!==0){const P=this._type==="wheel"&&Math.abs(this._delta)>bh?this._wheelZoomRate:this._defaultZoomRate;let C=2/(1+Math.exp(-Math.abs(this._delta*P)));this._delta<0&&C!==0&&(C=1/C);const A=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):i.scale;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(A*C))),this._type==="wheel"&&(this._startZoom=i.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}const c=typeof this._targetZoom=="number"?this._targetZoom:i.zoom,f=this._startZoom,m=this._easing;let x,S=!1;if(this._type==="wheel"&&f&&m){const P=Math.min((u.exported.now()-this._lastWheelEventTime)/200,1),C=m(P);x=u.interpolate.number(f,c,C),P<1?this._frameId||(this._frameId=!0):S=!0}else x=c,S=!0;return this._active=!0,S&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!S,zoomDelta:x-i.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let c=u.ease;if(this._prevEase){const f=this._prevEase,m=(u.exported.now()-f.start)/f.duration,x=f.easing(m+.01)-f.easing(m),S=.27/Math.sqrt(x*x+1e-4)*.01,P=Math.sqrt(.0729-S*S);c=u.bezier(S,P,.25,1)}return this._prevEase={start:u.exported.now(),duration:i,easing:c},c}reset(){this._active=!1}}class Qf{constructor(i,c){this._clickZoom=i,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ds{constructor(i){this._tr=new Bn(i),this.reset()}reset(){this._active=!1}dblclick(i,c){return i.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:this._tr.zoom+(i.shiftKey?-1:1),around:this._tr.unproject(c)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Mr{constructor(){this._tap=new Dl({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()}touchstart(i,c,f){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(i,c,f))}touchmove(i,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const m=c[0],x=m.y-this._swipePoint.y;return this._swipePoint=m,i.preventDefault(),this._active=!0,{zoomDelta:x/128}}}else this._tap.touchmove(i,c,f)}touchend(i,c,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(i,c,f)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class wh{constructor(i,c,f){this._el=i,this._mousePan=c,this._touchPan=f}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("maplibregl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("maplibregl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Op{constructor(i,c,f){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class td{constructor(i,c,f,m){this._el=i,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=m,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("maplibregl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("maplibregl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Fc=d=>d.zoom||d.drag||d.pitch||d.rotate;class ed extends u.Event{}function zp(d){return d.panDelta&&d.panDelta.mag()||d.zoomDelta||d.bearingDelta||d.pitchDelta}class Ea{constructor(i,c){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new xi(i),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(c),u.bindAll(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[m,x,S]of this._listeners)w.addEventListener(m,x,m===document?this.handleWindowEvent:this.handleEvent,S)}destroy(){for(const[i,c,f]of this._listeners)w.removeEventListener(i,c,i===document?this.handleWindowEvent:this.handleEvent,f)}_addDefaultHandlers(i){const c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new Dp(c,i));const m=c.boxZoom=new kn(c,i);this._add("boxZoom",m);const x=new zi(c),S=new Ds(c);c.doubleClickZoom=new Qf(S,x),this._add("tapZoom",x),this._add("clickZoom",S);const P=new Mr;this._add("tapDragZoom",P);const C=c.touchPitch=new Wo(c);this._add("touchPitch",C);const A=wa(i),O=uu(i);c.dragRotate=new Op(i,A,O),this._add("mouseRotate",A,["mousePitch"]),this._add("mousePitch",O,["mouseRotate"]);const R=(({enable:pt,clickTolerance:Pt})=>{const rt=new le({checkCorrectEvent:Tt=>w.mouseButton(Tt)===0&&!Tt.ctrlKey});return new Ti({clickTolerance:Pt,move:(Tt,Lt)=>({around:Lt,panDelta:Lt.sub(Tt)}),activateOnStart:!0,moveStateManager:rt,enable:pt,assignEvents:ba})})(i),X=new cu(i,c);c.dragPan=new wh(f,R,X),this._add("mousePan",R),this._add("touchPan",X,["touchZoom","touchRotate"]);const et=new Nl,$=new Xu;c.touchZoomRotate=new td(f,$,et,P),this._add("touchRotate",et,["touchPan","touchZoom"]),this._add("touchZoom",$,["touchPan","touchRotate"]);const Q=c.scrollZoom=new Rp(c,this);this._add("scrollZoom",Q,["mousePan"]);const ot=c.keyboard=new Jf(c);this._add("keyboard",ot),this._add("blockableMapEvent",new kp(c));for(const pt of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[pt]&&c[pt].enable(i[pt])}_add(i,c,f){this._handlers.push({handlerName:i,handler:c,allowed:f}),this._handlersById[i]=c}stop(i){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Fc(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,c,f){for(const m in i)if(m!==f&&(!c||c.indexOf(m)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const c=[];for(const f of i)this._el.contains(f.target)&&c.push(f);return c}handleEvent(i,c){if(i.type==="blur")return void this.stop(!0);this._updatingCamera=!0;const f=i.type==="renderFrame"?void 0:i,m={needsRenderFrame:!1},x={},S={},P=i.touches,C=P?this._getMapTouches(P):void 0,A=C?w.touchPos(this._el,C):w.mousePos(this._el,i);for(const{handlerName:X,handler:et,allowed:$}of this._handlers){if(!et.isEnabled())continue;let Q;this._blockedByActive(S,$,X)?et.reset():et[c||i.type]&&(Q=et[c||i.type](i,A,C),this.mergeHandlerResult(m,x,Q,X,f),Q&&Q.needsRenderFrame&&this._triggerRenderFrame()),(Q||et.isActive())&&(S[X]=et)}const O={};for(const X in this._previousActiveHandlers)S[X]||(O[X]=f);this._previousActiveHandlers=S,(Object.keys(O).length||zp(m))&&(this._changes.push([m,x,O]),this._triggerRenderFrame()),(Object.keys(S).length||zp(m))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:R}=m;R&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],R(this._map))}mergeHandlerResult(i,c,f,m,x){if(!f)return;u.extend(i,f);const S={handlerName:m,originalEvent:f.originalEvent||x};f.zoomDelta!==void 0&&(c.zoom=S),f.panDelta!==void 0&&(c.drag=S),f.pitchDelta!==void 0&&(c.pitch=S),f.bearingDelta!==void 0&&(c.rotate=S)}_applyChanges(){const i={},c={},f={};for(const[m,x,S]of this._changes)m.panDelta&&(i.panDelta=(i.panDelta||new u.Point(0,0))._add(m.panDelta)),m.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+m.zoomDelta),m.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+m.bearingDelta),m.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+m.pitchDelta),m.around!==void 0&&(i.around=m.around),m.pinchAround!==void 0&&(i.pinchAround=m.pinchAround),m.noInertia&&(i.noInertia=m.noInertia),u.extend(c,x),u.extend(f,S);this._updateMapTransform(i,c,f),this._changes=[]}_updateMapTransform(i,c,f){const m=this._map,x=m._getTransformForUpdate(),S=m.terrain;if(!(zp(i)||S&&this._terrainMovement))return this._fireEvents(c,f,!0);let{panDelta:P,zoomDelta:C,bearingDelta:A,pitchDelta:O,around:R,pinchAround:X}=i;X!==void 0&&(R=X),m._stop(!0),R=R||m.transform.centerPoint;const et=x.pointLocation(P?R.sub(P):R);A&&(x.bearing+=A),O&&(x.pitch+=O),C&&(x.zoom+=C),S?this._terrainMovement||!c.drag&&!c.zoom?c.drag&&this._terrainMovement?x.center=x.pointLocation(x.centerPoint.sub(P)):x.setLocationAtPoint(et,R):(this._terrainMovement=!0,x.freezeElevation=!0,x.setLocationAtPoint(et,R),this._map.once("moveend",()=>{x.freezeElevation=!1,this._terrainMovement=!1,x.recalculateZoom(m.terrain)})):x.setLocationAtPoint(et,R),m._applyUpdatedTransform(x),this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(c,f,!0)}_fireEvents(i,c,f){const m=Fc(this._eventsInProgress),x=Fc(i),S={};for(const O in i){const{originalEvent:R}=i[O];this._eventsInProgress[O]||(S[`${O}start`]=R),this._eventsInProgress[O]=i[O]}!m&&x&&this._fireEvent("movestart",x.originalEvent);for(const O in S)this._fireEvent(O,S[O]);x&&this._fireEvent("move",x.originalEvent);for(const O in i){const{originalEvent:R}=i[O];this._fireEvent(O,R)}const P={};let C;for(const O in this._eventsInProgress){const{handlerName:R,originalEvent:X}=this._eventsInProgress[O];this._handlersById[R].isActive()||(delete this._eventsInProgress[O],C=c[R]||X,P[`${O}end`]=C)}for(const O in P)this._fireEvent(O,P[O]);const A=Fc(this._eventsInProgress);if(f&&(m||x)&&!A){this._updatingCamera=!0;const O=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),R=X=>X!==0&&-this._bearingSnap<X&&X<this._bearingSnap;O?(R(O.bearing||this._map.getBearing())&&(O.bearing=0),O.freezeElevation=!0,this._map.easeTo(O,{originalEvent:C})):(this._map.fire(new u.Event("moveend",{originalEvent:C})),R(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,c){this._map.fire(new u.Event(i,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{delete this._frameId,this.handleEvent(new ed("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Eh={extend:(d,...i)=>u.extend(d,...i),run(d){d()},logToElement(d,i=!1,c="log"){const f=window.document.getElementById(c);f&&(i&&(f.innerHTML=""),f.innerHTML+=`<br>${d}`)}};class Le extends u.Evented{constructor(i,c){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=c.bearingSnap,u.bindAll(["_renderFrameCallback"],this),this.on("moveend",()=>{delete this._requestedCameraState})}getCenter(){return new u.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,c){return this.jumpTo({center:i},c)}panBy(i,c,f){return i=u.Point.convert(i).mult(-1),this.panTo(this.transform.center,u.extend({offset:i},c),f)}panTo(i,c,f){return this.easeTo(u.extend({center:i},c),f)}getZoom(){return this.transform.zoom}setZoom(i,c){return this.jumpTo({zoom:i},c),this}zoomTo(i,c,f){return this.easeTo(u.extend({zoom:i},c),f)}zoomIn(i,c){return this.zoomTo(this.getZoom()+1,i,c),this}zoomOut(i,c){return this.zoomTo(this.getZoom()-1,i,c),this}getBearing(){return this.transform.bearing}setBearing(i,c){return this.jumpTo({bearing:i},c),this}getPadding(){return this.transform.padding}setPadding(i,c){return this.jumpTo({padding:i},c),this}rotateTo(i,c,f){return this.easeTo(u.extend({bearing:i},c),f)}resetNorth(i,c){return this.rotateTo(0,u.extend({duration:1e3},i),c),this}resetNorthPitch(i,c){return this.easeTo(u.extend({bearing:0,pitch:0,duration:1e3},i),c),this}snapToNorth(i,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,c):this}getPitch(){return this.transform.pitch}setPitch(i,c){return this.jumpTo({pitch:i},c),this}cameraForBounds(i,c){i=ur.convert(i);const f=c&&c.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),f,c)}_cameraForBoxAndBearing(i,c,f,m){const x={top:0,bottom:0,right:0,left:0};if(typeof(m=u.extend({padding:x,offset:[0,0],maxZoom:this.transform.maxZoom},m)).padding=="number"){const Lt=m.padding;m.padding={top:Lt,bottom:Lt,right:Lt,left:Lt}}m.padding=u.extend(x,m.padding);const S=this.transform,P=S.padding,C=S.project(u.LngLat.convert(i)),A=S.project(u.LngLat.convert(c)),O=C.rotate(-f*Math.PI/180),R=A.rotate(-f*Math.PI/180),X=new u.Point(Math.max(O.x,R.x),Math.max(O.y,R.y)),et=new u.Point(Math.min(O.x,R.x),Math.min(O.y,R.y)),$=X.sub(et),Q=(S.width-(P.left+P.right+m.padding.left+m.padding.right))/$.x,ot=(S.height-(P.top+P.bottom+m.padding.top+m.padding.bottom))/$.y;if(ot<0||Q<0)return void u.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const pt=Math.min(S.scaleZoom(S.scale*Math.min(Q,ot)),m.maxZoom),Pt=u.Point.convert(m.offset),rt=new u.Point((m.padding.left-m.padding.right)/2,(m.padding.top-m.padding.bottom)/2).rotate(f*Math.PI/180),Tt=Pt.add(rt).mult(S.scale/S.zoomScale(pt));return{center:S.unproject(C.add(A).div(2).sub(Tt)),zoom:pt,bearing:f}}fitBounds(i,c,f){return this._fitInternal(this.cameraForBounds(i,c),c,f)}fitScreenCoordinates(i,c,f,m,x){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(u.Point.convert(i)),this.transform.pointLocation(u.Point.convert(c)),f,m),m,x)}_fitInternal(i,c,f){return i?(delete(c=u.extend(i,c)).padding,c.linear?this.easeTo(c,f):this.flyTo(c,f)):this}jumpTo(i,c){this.stop();const f=this._getTransformForUpdate();let m=!1,x=!1,S=!1;return"zoom"in i&&f.zoom!==+i.zoom&&(m=!0,f.zoom=+i.zoom),i.center!==void 0&&(f.center=u.LngLat.convert(i.center)),"bearing"in i&&f.bearing!==+i.bearing&&(x=!0,f.bearing=+i.bearing),"pitch"in i&&f.pitch!==+i.pitch&&(S=!0,f.pitch=+i.pitch),i.padding==null||f.isPaddingEqual(i.padding)||(f.padding=i.padding),this._applyUpdatedTransform(f),this.fire(new u.Event("movestart",c)).fire(new u.Event("move",c)),m&&this.fire(new u.Event("zoomstart",c)).fire(new u.Event("zoom",c)).fire(new u.Event("zoomend",c)),x&&this.fire(new u.Event("rotatestart",c)).fire(new u.Event("rotate",c)).fire(new u.Event("rotateend",c)),S&&this.fire(new u.Event("pitchstart",c)).fire(new u.Event("pitch",c)).fire(new u.Event("pitchend",c)),this.fire(new u.Event("moveend",c))}calculateCameraOptionsFromTo(i,c,f,m=0){const x=u.MercatorCoordinate.fromLngLat(i,c),S=u.MercatorCoordinate.fromLngLat(f,m),P=S.x-x.x,C=S.y-x.y,A=S.z-x.z,O=Math.hypot(P,C,A);if(O===0)throw new Error("Can't calculate camera options with same From and To");const R=Math.hypot(P,C),X=this.transform.scaleZoom(this.transform.cameraToCenterDistance/O/this.transform.tileSize),et=180*Math.atan2(P,-C)/Math.PI;let $=180*Math.acos(R/O)/Math.PI;return $=A<0?90-$:90+$,{center:S.toLngLat(),zoom:X,pitch:$,bearing:et}}easeTo(i,c){this._stop(!1,i.easeId),((i=u.extend({offset:[0,0],duration:500,easing:u.ease},i)).animate===!1||!i.essential&&u.exported.prefersReducedMotion)&&(i.duration=0);const f=this._getTransformForUpdate(),m=this.getZoom(),x=this.getBearing(),S=this.getPitch(),P=this.getPadding(),C="zoom"in i?+i.zoom:m,A="bearing"in i?this._normalizeBearing(i.bearing,x):x,O="pitch"in i?+i.pitch:S,R="padding"in i?i.padding:f.padding,X=u.Point.convert(i.offset);let et=f.centerPoint.add(X);const $=f.pointLocation(et),Q=u.LngLat.convert(i.center||$);this._normalizeCenter(Q);const ot=f.project($),pt=f.project(Q).sub(ot),Pt=f.zoomScale(C-m);let rt,Tt;i.around&&(rt=u.LngLat.convert(i.around),Tt=f.locationPoint(rt));const Lt={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||C!==m,this._rotating=this._rotating||x!==A,this._pitching=this._pitching||O!==S,this._padding=!f.isPaddingEqual(R),this._easeId=i.easeId,this._prepareEase(c,i.noMoveStart,Lt),this.terrain&&this._prepareElevation(Q),this._ease(jt=>{if(this._zooming&&(f.zoom=u.interpolate.number(m,C,jt)),this._rotating&&(f.bearing=u.interpolate.number(x,A,jt)),this._pitching&&(f.pitch=u.interpolate.number(S,O,jt)),this._padding&&(f.interpolatePadding(P,R,jt),et=f.centerPoint.add(X)),this.terrain&&!i.freezeElevation&&this._updateElevation(jt),rt)f.setLocationAtPoint(rt,Tt);else{const Ht=f.zoomScale(f.zoom-m),Jt=C>m?Math.min(2,Pt):Math.max(.5,Pt),Yt=Math.pow(Jt,1-jt),xe=f.unproject(ot.add(pt.mult(jt*Yt)).mult(Ht));f.setLocationAtPoint(f.renderWorldCopies?xe.wrap():xe,et)}this._applyUpdatedTransform(f),this._fireMoveEvents(c)},jt=>{this.terrain&&this._finalizeElevation(),this._afterEase(c,jt)},i),this}_prepareEase(i,c,f={}){this._moving=!0,c||f.moving||this.fire(new u.Event("movestart",i)),this._zooming&&!f.zooming&&this.fire(new u.Event("zoomstart",i)),this._rotating&&!f.rotating&&this.fire(new u.Event("rotatestart",i)),this._pitching&&!f.pitching&&this.fire(new u.Event("pitchstart",i))}_prepareElevation(i){this._elevationCenter=i,this._elevationStart=this.transform.elevation,this._elevationTarget=this.transform.getElevation(i,this.terrain),this.transform.freezeElevation=!0}_updateElevation(i){const c=this.transform.getElevation(this._elevationCenter,this.terrain);if(i<1&&c!==this._elevationTarget){const f=this._elevationTarget-this._elevationStart;this._elevationStart+=i*(f-(c-(f*i+this._elevationStart))/(1-i)),this._elevationTarget=c}this.transform.elevation=u.interpolate.number(this._elevationStart,this._elevationTarget,i)}_finalizeElevation(){this.transform.freezeElevation=!1,this.transform.recalculateZoom(this.terrain)}_getTransformForUpdate(){return this.transformCameraUpdate?(this._requestedCameraState||(this._requestedCameraState=this.transform.clone()),this._requestedCameraState):this.transform}_applyUpdatedTransform(i){if(!this.transformCameraUpdate)return;const c=i.clone(),{center:f,zoom:m,pitch:x,bearing:S,elevation:P}=this.transformCameraUpdate(c);f&&(c.center=f),m!==void 0&&(c.zoom=m),x!==void 0&&(c.pitch=x),S!==void 0&&(c.bearing=S),P!==void 0&&(c.elevation=P),this.transform.apply(c)}_fireMoveEvents(i){this.fire(new u.Event("move",i)),this._zooming&&this.fire(new u.Event("zoom",i)),this._rotating&&this.fire(new u.Event("rotate",i)),this._pitching&&this.fire(new u.Event("pitch",i))}_afterEase(i,c){if(this._easeId&&c&&this._easeId===c)return;delete this._easeId;const f=this._zooming,m=this._rotating,x=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new u.Event("zoomend",i)),m&&this.fire(new u.Event("rotateend",i)),x&&this.fire(new u.Event("pitchend",i)),this.fire(new u.Event("moveend",i))}flyTo(i,c){if(!i.essential&&u.exported.prefersReducedMotion){const be=u.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(be,c)}this.stop(),i=u.extend({offset:[0,0],speed:1.2,curve:1.42,easing:u.ease},i);const f=this._getTransformForUpdate(),m=this.getZoom(),x=this.getBearing(),S=this.getPitch(),P=this.getPadding(),C="zoom"in i?u.clamp(+i.zoom,f.minZoom,f.maxZoom):m,A="bearing"in i?this._normalizeBearing(i.bearing,x):x,O="pitch"in i?+i.pitch:S,R="padding"in i?i.padding:f.padding,X=f.zoomScale(C-m),et=u.Point.convert(i.offset);let $=f.centerPoint.add(et);const Q=f.pointLocation($),ot=u.LngLat.convert(i.center||Q);this._normalizeCenter(ot);const pt=f.project(Q),Pt=f.project(ot).sub(pt);let rt=i.curve;const Tt=Math.max(f.width,f.height),Lt=Tt/X,jt=Pt.mag();if("minZoom"in i){const be=u.clamp(Math.min(i.minZoom,m,C),f.minZoom,f.maxZoom),Un=Tt/f.zoomScale(be-m);rt=Math.sqrt(Un/jt*2)}const Ht=rt*rt;function Jt(be){const Un=(Lt*Lt-Tt*Tt+(be?-1:1)*Ht*Ht*jt*jt)/(2*(be?Lt:Tt)*Ht*jt);return Math.log(Math.sqrt(Un*Un+1)-Un)}function Yt(be){return(Math.exp(be)-Math.exp(-be))/2}function xe(be){return(Math.exp(be)+Math.exp(-be))/2}const Oe=Jt(0);let nn=function(be){return xe(Oe)/xe(Oe+rt*be)},ue=function(be){return Tt*((xe(Oe)*(Yt(Un=Oe+rt*be)/xe(Un))-Yt(Oe))/Ht)/jt;var Un},je=(Jt(1)-Oe)/rt;if(Math.abs(jt)<1e-6||!isFinite(je)){if(Math.abs(Tt-Lt)<1e-6)return this.easeTo(i,c);const be=Lt<Tt?-1:1;je=Math.abs(Math.log(Lt/Tt))/rt,ue=function(){return 0},nn=function(Un){return Math.exp(be*rt*Un)}}return i.duration="duration"in i?+i.duration:1e3*je/("screenSpeed"in i?+i.screenSpeed/rt:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0),this._zooming=!0,this._rotating=x!==A,this._pitching=O!==S,this._padding=!f.isPaddingEqual(R),this._prepareEase(c,!1),this.terrain&&this._prepareElevation(ot),this._ease(be=>{const Un=be*je,ai=1/nn(Un);f.zoom=be===1?C:m+f.scaleZoom(ai),this._rotating&&(f.bearing=u.interpolate.number(x,A,be)),this._pitching&&(f.pitch=u.interpolate.number(S,O,be)),this._padding&&(f.interpolatePadding(P,R,be),$=f.centerPoint.add(et)),this.terrain&&!i.freezeElevation&&this._updateElevation(be);const Vn=be===1?ot:f.unproject(pt.add(Pt.mult(ue(Un))).mult(ai));f.setLocationAtPoint(f.renderWorldCopies?Vn.wrap():Vn,$),this._applyUpdatedTransform(f),this._fireMoveEvents(c)},()=>{this.terrain&&this._finalizeElevation(),this._afterEase(c)},i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){const f=this._onEaseEnd;delete this._onEaseEnd,f.call(this,c)}if(!i){const f=this.handlers;f&&f.stop(!1)}return this}_ease(i,c,f){f.animate===!1||f.duration===0?(i(1),c()):(this._easeStart=u.exported.now(),this._easeOptions=f,this._onEaseFrame=i,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((u.exported.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,c){i=u.wrap(i,-180,180);const f=Math.abs(i-c);return Math.abs(i-360-c)<f&&(i-=360),Math.abs(i+360-c)<f&&(i+=360),i}_normalizeCenter(i){const c=this.transform;if(!c.renderWorldCopies||c.lngRange)return;const f=i.lng-c.center.lng;i.lng+=f>180?-360:f<-180?360:0}queryTerrainElevation(i){return this.terrain?this.transform.getElevation(u.LngLat.convert(i),this.terrain)-this.transform.elevation:null}}class Be{constructor(i={}){this.options=i,u.bindAll(["_toggleAttribution","_updateData","_updateCompact","_updateCompactMinimize"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){return this._map=i,this._compact=this.options&&this.options.compact,this._container=w.create("details","maplibregl-ctrl maplibregl-ctrl-attrib"),this._compactButton=w.create("summary","maplibregl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=w.create("div","maplibregl-ctrl-attrib-inner",this._container),this._updateAttributions(),this._updateCompact(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("terrain",this._updateData),this._map.on("resize",this._updateCompact),this._map.on("drag",this._updateCompactMinimize),this._container}onRemove(){w.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("terrain",this._updateData),this._map.off("resize",this._updateCompact),this._map.off("drag",this._updateCompactMinimize),this._map=void 0,this._compact=void 0,this._attribHTML=void 0}_setElementTitle(i,c){const f=this._map._getUIString(`AttributionControl.${c}`);i.title=f,i.setAttribute("aria-label",f)}_toggleAttribution(){this._container.classList.contains("maplibregl-compact")&&(this._container.classList.contains("maplibregl-compact-show")?(this._container.setAttribute("open",""),this._container.classList.remove("maplibregl-compact-show")):(this._container.classList.add("maplibregl-compact-show"),this._container.removeAttribute("open")))}_updateData(i){!i||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility"&&i.dataType!=="style"&&i.type!=="terrain"||this._updateAttributions()}_updateAttributions(){if(!this._map.style)return;let i=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=i.concat(this.options.customAttribution.map(m=>typeof m!="string"?"":m)):typeof this.options.customAttribution=="string"&&i.push(this.options.customAttribution)),this._map.style.stylesheet){const m=this._map.style.stylesheet;this.styleOwner=m.owner,this.styleId=m.id}const c=this._map.style.sourceCaches;for(const m in c){const x=c[m];if(x.used||x.usedForTerrain){const S=x.getSource();S.attribution&&i.indexOf(S.attribution)<0&&i.push(S.attribution)}}i=i.filter(m=>String(m).trim()),i.sort((m,x)=>m.length-x.length),i=i.filter((m,x)=>{for(let S=x+1;S<i.length;S++)if(i[S].indexOf(m)>=0)return!1;return!0});const f=i.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,i.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("maplibregl-attrib-empty")):this._container.classList.add("maplibregl-attrib-empty"),this._updateCompact(),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact===!1?this._container.setAttribute("open",""):this._container.classList.contains("maplibregl-compact")||this._container.classList.contains("maplibregl-attrib-empty")||(this._container.setAttribute("open",""),this._container.classList.add("maplibregl-compact","maplibregl-compact-show")):(this._container.setAttribute("open",""),this._container.classList.contains("maplibregl-compact")&&this._container.classList.remove("maplibregl-compact","maplibregl-compact-show"))}_updateCompactMinimize(){this._container.classList.contains("maplibregl-compact")&&this._container.classList.contains("maplibregl-compact-show")&&this._container.classList.remove("maplibregl-compact-show")}}class Bc{constructor(i={}){this.options=i,u.bindAll(["_updateCompact"],this)}getDefaultPosition(){return"bottom-left"}onAdd(i){this._map=i,this._compact=this.options&&this.options.compact,this._container=w.create("div","maplibregl-ctrl");const c=w.create("a","maplibregl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://maplibre.org/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="block",this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){w.remove(this._container),this._map.off("resize",this._updateCompact),this._map=void 0,this._compact=void 0}_updateCompact(){const i=this._container.children;if(i.length){const c=i[0];this._map.getCanvasContainer().offsetWidth<=640||this._compact?this._compact!==!1&&c.classList.add("maplibregl-compact"):c.classList.remove("maplibregl-compact")}}}class Fp{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const c=++this._id;return this._queue.push({callback:i,id:c,cancelled:!1}),c}remove(i){const c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(const m of f)if(m.id===i)return void(m.cancelled=!0)}run(i=0){if(this._currentlyRunning)throw new Error("Attempting to run(), but is already running.");const c=this._currentlyRunning=this._queue;this._queue=[];for(const f of c)if(!f.cancelled&&(f.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}const Bp={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","TerrainControl.enableTerrain":"Enable terrain","TerrainControl.disableTerrain":"Disable terrain"};var Ho=u.createLayout([{name:"a_pos3d",type:"Int16",components:3}]);class nd extends u.Evented{constructor(i){super(),this.sourceCache=i,this._tiles={},this._renderableTilesKeys=[],this._sourceTileCache={},this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.deltaZoom=1,i.usedForTerrain=!0,i.tileSize=this.tileSize*2**this.deltaZoom}destruct(){this.sourceCache.usedForTerrain=!1,this.sourceCache.tileSize=null}update(i,c){this.sourceCache.update(i,c),this._renderableTilesKeys=[];const f={};for(const m of i.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,reparseOverscaled:!1,terrain:c}))f[m.key]=!0,this._renderableTilesKeys.push(m.key),this._tiles[m.key]||(m.posMatrix=new Float64Array(16),u.ortho(m.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),this._tiles[m.key]=new io(m,this.tileSize));for(const m in this._tiles)f[m]||delete this._tiles[m]}freeRtt(i){for(const c in this._tiles){const f=this._tiles[c];(!i||f.tileID.equals(i)||f.tileID.isChildOf(i)||i.isChildOf(f.tileID))&&(f.rtt=[])}}getRenderableTiles(){return this._renderableTilesKeys.map(i=>this.getTileByID(i))}getTileByID(i){return this._tiles[i]}getTerrainCoords(i){const c={};for(const f of this._renderableTilesKeys){const m=this._tiles[f].tileID;if(m.canonical.equals(i.canonical)){const x=i.clone();x.posMatrix=new Float64Array(16),u.ortho(x.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),c[f]=x}else if(m.canonical.isChildOf(i.canonical)){const x=i.clone();x.posMatrix=new Float64Array(16);const S=m.canonical.z-i.canonical.z,P=m.canonical.x-(m.canonical.x>>S<<S),C=m.canonical.y-(m.canonical.y>>S<<S),A=u.EXTENT>>S;u.ortho(x.posMatrix,0,A,0,A,0,1),u.translate(x.posMatrix,x.posMatrix,[-P*A,-C*A,0]),c[f]=x}else if(i.canonical.isChildOf(m.canonical)){const x=i.clone();x.posMatrix=new Float64Array(16);const S=i.canonical.z-m.canonical.z,P=i.canonical.x-(i.canonical.x>>S<<S),C=i.canonical.y-(i.canonical.y>>S<<S),A=u.EXTENT>>S;u.ortho(x.posMatrix,0,u.EXTENT,0,u.EXTENT,0,1),u.translate(x.posMatrix,x.posMatrix,[P*A,C*A,0]),u.scale(x.posMatrix,x.posMatrix,[1/2**S,1/2**S,0]),c[f]=x}}return c}getSourceTile(i,c){const f=this.sourceCache._source;let m=i.overscaledZ-this.deltaZoom;if(m>f.maxzoom&&(m=f.maxzoom),m<f.minzoom)return null;this._sourceTileCache[i.key]||(this._sourceTileCache[i.key]=i.scaledTo(m).key);let x=this.sourceCache.getTileByID(this._sourceTileCache[i.key]);if((!x||!x.dem)&&c)for(;m>=f.minzoom&&(!x||!x.dem);)x=this.sourceCache.getTileByID(i.scaledTo(m--).key);return x}tilesAfterTime(i=Date.now()){return Object.values(this._tiles).filter(c=>c.timeAdded>=i)}}class Ia{constructor(i,c,f){this.painter=i,this.sourceCache=new nd(c),this.options=f,this.exaggeration=typeof f.exaggeration=="number"?f.exaggeration:1,this.qualityFactor=2,this.meshSize=128,this._demMatrixCache={},this.coordsIndex=[],this._coordsTextureSize=1024}getDEMElevation(i,c,f,m=u.EXTENT){if(!(c>=0&&c<m&&f>=0&&f<m))return 0;let x=0;const S=this.getTerrainData(i);if(S.tile&&S.tile.dem){const P=function($,Q,ot){var pt=Q[0],Pt=Q[1];return $[0]=ot[0]*pt+ot[4]*Pt+ot[12],$[1]=ot[1]*pt+ot[5]*Pt+ot[13],$}([],[c/m*u.EXTENT,f/m*u.EXTENT],S.u_terrain_matrix),C=[P[0]*S.tile.dem.dim,P[1]*S.tile.dem.dim],A=[Math.floor(C[0]),Math.floor(C[1])],O=S.tile.dem.get(A[0],A[1]),R=S.tile.dem.get(A[0],A[1]+1),X=S.tile.dem.get(A[0]+1,A[1]),et=S.tile.dem.get(A[0]+1,A[1]+1);x=u.interpolate.number(u.interpolate.number(O,R,C[0]-A[0]),u.interpolate.number(X,et,C[0]-A[0]),C[1]-A[1])}return x}getElevation(i,c,f,m=u.EXTENT){return this.getDEMElevation(i,c,f,m)*this.exaggeration}getTerrainData(i){if(!this._emptyDemTexture){const m=this.painter.context,x=new u.RGBAImage({width:1,height:1},new Uint8Array(4));this._emptyDepthTexture=new ie(m,x,m.gl.RGBA,{premultiply:!1}),this._emptyDemUnpack=[0,0,0,0],this._emptyDemTexture=new ie(m,new u.RGBAImage({width:1,height:1}),m.gl.RGBA,{premultiply:!1}),this._emptyDemTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),this._emptyDemMatrix=u.identity([])}const c=this.sourceCache.getSourceTile(i,!0);if(c&&c.dem&&(!c.demTexture||c.needsTerrainPrepare)){const m=this.painter.context;c.demTexture=this.painter.getTileTexture(c.dem.stride),c.demTexture?c.demTexture.update(c.dem.getPixels(),{premultiply:!1}):c.demTexture=new ie(m,c.dem.getPixels(),m.gl.RGBA,{premultiply:!1}),c.demTexture.bind(m.gl.NEAREST,m.gl.CLAMP_TO_EDGE),c.needsTerrainPrepare=!1}const f=c&&c+c.tileID.key+i.key;if(f&&!this._demMatrixCache[f]){const m=this.sourceCache.sourceCache._source.maxzoom;let x=i.canonical.z-c.tileID.canonical.z;i.overscaledZ>i.canonical.z&&(i.canonical.z>=m?x=i.canonical.z-m:u.warnOnce("cannot calculate elevation if elevation maxzoom > source.maxzoom"));const S=i.canonical.x-(i.canonical.x>>x<<x),P=i.canonical.y-(i.canonical.y>>x<<x),C=u.fromScaling(new Float64Array(16),[1/(u.EXTENT<<x),1/(u.EXTENT<<x),0]);u.translate(C,C,[S*u.EXTENT,P*u.EXTENT,0]),this._demMatrixCache[i.key]={matrix:C,coord:i}}return{u_depth:2,u_terrain:3,u_terrain_dim:c&&c.dem&&c.dem.dim||1,u_terrain_matrix:f?this._demMatrixCache[i.key].matrix:this._emptyDemMatrix,u_terrain_unpack:c&&c.dem&&c.dem.getUnpackVector()||this._emptyDemUnpack,u_terrain_exaggeration:this.exaggeration,texture:(c&&c.demTexture||this._emptyDemTexture).texture,depthTexture:(this._fboDepthTexture||this._emptyDepthTexture).texture,tile:c}}getFramebuffer(i){const c=this.painter,f=c.width/devicePixelRatio,m=c.height/devicePixelRatio;return!this._fbo||this._fbo.width===f&&this._fbo.height===m||(this._fbo.destroy(),this._fboCoordsTexture.destroy(),this._fboDepthTexture.destroy(),delete this._fbo,delete this._fboDepthTexture,delete this._fboCoordsTexture),this._fboCoordsTexture||(this._fboCoordsTexture=new ie(c.context,{width:f,height:m,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboCoordsTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fboDepthTexture||(this._fboDepthTexture=new ie(c.context,{width:f,height:m,data:null},c.context.gl.RGBA,{premultiply:!1}),this._fboDepthTexture.bind(c.context.gl.NEAREST,c.context.gl.CLAMP_TO_EDGE)),this._fbo||(this._fbo=c.context.createFramebuffer(f,m,!0,!1),this._fbo.depthAttachment.set(c.context.createRenderbuffer(c.context.gl.DEPTH_COMPONENT16,f,m))),this._fbo.colorAttachment.set(i==="coords"?this._fboCoordsTexture.texture:this._fboDepthTexture.texture),this._fbo}getCoordsTexture(){const i=this.painter.context;if(this._coordsTexture)return this._coordsTexture;const c=new Uint8Array(this._coordsTextureSize*this._coordsTextureSize*4);for(let x=0,S=0;x<this._coordsTextureSize;x++)for(let P=0;P<this._coordsTextureSize;P++,S+=4)c[S+0]=255&P,c[S+1]=255&x,c[S+2]=P>>8<<4|x>>8,c[S+3]=0;const f=new u.RGBAImage({width:this._coordsTextureSize,height:this._coordsTextureSize},new Uint8Array(c.buffer)),m=new ie(i,f,i.gl.RGBA,{premultiply:!1});return m.bind(i.gl.NEAREST,i.gl.CLAMP_TO_EDGE),this._coordsTexture=m,m}pointCoordinate(i){const c=new Uint8Array(4),f=this.painter.context,m=f.gl;f.bindFramebuffer.set(this.getFramebuffer("coords").framebuffer),m.readPixels(i.x,this.painter.height/devicePixelRatio-i.y-1,1,1,m.RGBA,m.UNSIGNED_BYTE,c),f.bindFramebuffer.set(null);const x=c[0]+(c[2]>>4<<8),S=c[1]+((15&c[2])<<8),P=this.coordsIndex[255-c[3]],C=P&&this.sourceCache.getTileByID(P);if(!C)return null;const A=this._coordsTextureSize,O=(1<<C.tileID.canonical.z)*A;return new u.MercatorCoordinate((C.tileID.canonical.x*A+x)/O,(C.tileID.canonical.y*A+S)/O,this.getElevation(C.tileID,x,S,A))}getTerrainMesh(){if(this._mesh)return this._mesh;const i=this.painter.context,c=new u.Pos3dArray,f=new u.TriangleIndexArray,m=this.meshSize,x=u.EXTENT/m,S=m*m;for(let R=0;R<=m;R++)for(let X=0;X<=m;X++)c.emplaceBack(X*x,R*x,0);for(let R=0;R<S;R+=m+1)for(let X=0;X<m;X++)f.emplaceBack(X+R,m+X+R+1,m+X+R+2),f.emplaceBack(X+R,m+X+R+2,X+R+1);const P=c.length,C=P+2*(m+1);for(const R of[0,1])for(let X=0;X<=m;X++)for(const et of[0,1])c.emplaceBack(X*x,R*u.EXTENT,et);for(let R=0;R<2*m;R+=2)f.emplaceBack(C+R,C+R+1,C+R+3),f.emplaceBack(C+R,C+R+3,C+R+2),f.emplaceBack(P+R,P+R+3,P+R+1),f.emplaceBack(P+R,P+R+2,P+R+3);const A=c.length,O=A+2*(m+1);for(const R of[0,1])for(let X=0;X<=m;X++)for(const et of[0,1])c.emplaceBack(R*u.EXTENT,X*x,et);for(let R=0;R<2*m;R+=2)f.emplaceBack(A+R,A+R+1,A+R+3),f.emplaceBack(A+R,A+R+3,A+R+2),f.emplaceBack(O+R,O+R+3,O+R+1),f.emplaceBack(O+R,O+R+2,O+R+3);return this._mesh={indexBuffer:i.createIndexBuffer(f),vertexBuffer:i.createVertexBuffer(c,Ho.members),segments:u.SegmentVector.simpleSegment(0,0,c.length,f.length)},this._mesh}getMeshFrameDelta(i){return 2*Math.PI*u.earthRadius/Math.pow(2,i)/5}getMinMaxElevation(i){const c=this.getTerrainData(i).tile,f={minElevation:null,maxElevation:null};return c&&c.dem&&(f.minElevation=c.dem.min*this.exaggeration,f.maxElevation=c.dem.max*this.exaggeration),f}}class Eg{constructor(i,c,f){this._context=i,this._size=c,this._tileSize=f,this._objects=[],this._recentlyUsed=[],this._stamp=0}destruct(){for(const i of this._objects)i.texture.destroy(),i.fbo.destroy()}_createObject(i){const c=this._context.createFramebuffer(this._tileSize,this._tileSize,!0,!0),f=new ie(this._context,{width:this._tileSize,height:this._tileSize,data:null},this._context.gl.RGBA);return f.bind(this._context.gl.LINEAR,this._context.gl.CLAMP_TO_EDGE),c.depthAttachment.set(this._context.createRenderbuffer(this._context.gl.DEPTH_STENCIL,this._tileSize,this._tileSize)),c.colorAttachment.set(f.texture),{id:i,fbo:c,texture:f,stamp:-1,inUse:!1}}getObjectForId(i){return this._objects[i]}useObject(i){i.inUse=!0,this._recentlyUsed=this._recentlyUsed.filter(c=>i.id!==c),this._recentlyUsed.push(i.id)}stampObject(i){i.stamp=++this._stamp}getOrCreateFreeObject(){for(const c of this._recentlyUsed)if(!this._objects[c].inUse)return this._objects[c];if(this._objects.length>=this._size)throw new Error("No free RenderPool available, call freeAllObjects() required!");const i=this._createObject(this._objects.length);return this._objects.push(i),i}freeObject(i){i.inUse=!1}freeAllObjects(){for(const i of this._objects)this.freeObject(i)}isFull(){return!(this._objects.length<this._size)&&this._objects.some(i=>!i.inUse)===!1}}const ol={background:!0,fill:!0,line:!0,raster:!0,hillshade:!0};class ti{constructor(i,c){this.painter=i,this.terrain=c,this.pool=new Eg(i.context,30,c.sourceCache.tileSize*c.qualityFactor)}destruct(){this.pool.destruct()}getTexture(i){return this.pool.getObjectForId(i.rtt[this._stacks.length-1].id).texture}prepareForRender(i,c){this._stacks=[],this._prevType=null,this._rttTiles=[],this._renderableTiles=this.terrain.sourceCache.getRenderableTiles(),this._renderableLayerIds=i._order.filter(f=>!i._layers[f].isHidden(c)),this._coordsDescendingInv={};for(const f in i.sourceCaches){this._coordsDescendingInv[f]={};const m=i.sourceCaches[f].getVisibleCoordinates();for(const x of m){const S=this.terrain.sourceCache.getTerrainCoords(x);for(const P in S)this._coordsDescendingInv[f][P]||(this._coordsDescendingInv[f][P]=[]),this._coordsDescendingInv[f][P].push(S[P])}}this._coordsDescendingInvStr={};for(const f of i._order){const m=i._layers[f],x=m.source;if(ol[m.type]&&!this._coordsDescendingInvStr[x]){this._coordsDescendingInvStr[x]={};for(const S in this._coordsDescendingInv[x])this._coordsDescendingInvStr[x][S]=this._coordsDescendingInv[x][S].map(P=>P.key).sort().join()}}for(const f of this._renderableTiles)for(const m in this._coordsDescendingInvStr){const x=this._coordsDescendingInvStr[m][f.tileID.key];x&&x!==f.rttCoords[m]&&(f.rtt=[])}}renderLayer(i){if(i.isHidden(this.painter.transform.zoom))return!1;const c=i.type,f=this.painter,m=this._renderableLayerIds[this._renderableLayerIds.length-1]===i.id;if(ol[c]&&(this._prevType&&ol[this._prevType]||this._stacks.push([]),this._prevType=c,this._stacks[this._stacks.length-1].push(i.id),!m))return!0;if(ol[this._prevType]||ol[c]&&m){this._prevType=c;const x=this._stacks.length-1,S=this._stacks[x]||[];for(const P of this._renderableTiles){if(this.pool.isFull()&&(kt(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects()),this._rttTiles.push(P),P.rtt[x]){const A=this.pool.getObjectForId(P.rtt[x].id);if(A.stamp===P.rtt[x].stamp){this.pool.useObject(A);continue}}const C=this.pool.getOrCreateFreeObject();this.pool.useObject(C),this.pool.stampObject(C),P.rtt[x]={id:C.id,stamp:C.stamp},f.context.bindFramebuffer.set(C.fbo.framebuffer),f.context.clear({color:u.Color.transparent,stencil:0}),f.currentStencilSource=void 0;for(let A=0;A<S.length;A++){const O=f.style._layers[S[A]],R=O.source?this._coordsDescendingInv[O.source][P.tileID.key]:[P.tileID];f.context.viewport.set([0,0,C.fbo.width,C.fbo.height]),f._renderTileClippingMasks(O,R),f.renderLayer(f,f.style.sourceCaches[O.source],O,R),O.source&&(P.rttCoords[O.source]=this._coordsDescendingInvStr[O.source][P.tileID.key])}}return kt(this.painter,this.terrain,this._rttTiles),this._rttTiles=[],this.pool.freeAllObjects(),ol[c]}return!1}}const bi=I,rd={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:void 0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,maplibreLogo:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,maxTileCacheZoomLevels:u.config.MAX_TILE_CACHE_ZOOM_LEVELS,localIdeographFontFamily:"sans-serif",transformRequest:null,transformCameraUpdate:null,fadeDuration:300,crossSourceCollisions:!0,validateStyle:!0},Yu=d=>{d.touchstart=d.dragStart,d.touchmoveWindow=d.dragMove,d.touchend=d.dragEnd},Ih={showCompass:!0,showZoom:!0,visualizePitch:!1};class Up{constructor(i,c,f=!1){this._clickTolerance=10;const m=i.dragRotate._mouseRotate.getClickTolerance(),x=i.dragRotate._mousePitch.getClickTolerance();this.element=c,this.mouseRotate=wa({clickTolerance:m,enable:!0}),this.touchRotate=(({enable:S,clickTolerance:P,bearingDegreesPerPixelMoved:C=.8})=>{const A=new nl;return new Ti({clickTolerance:P,move:(O,R)=>({bearingDelta:(R.x-O.x)*C}),moveStateManager:A,enable:S,assignEvents:Yu})})({clickTolerance:m,enable:!0}),this.map=i,f&&(this.mousePitch=uu({clickTolerance:x,enable:!0}),this.touchPitch=(({enable:S,clickTolerance:P,pitchDegreesPerPixelMoved:C=-.5})=>{const A=new nl;return new Ti({clickTolerance:P,move:(O,R)=>({pitchDelta:(R.y-O.y)*C}),moveStateManager:A,enable:S,assignEvents:Yu})})({clickTolerance:x,enable:!0})),u.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),w.addEventListener(c,"mousedown",this.mousedown),w.addEventListener(c,"touchstart",this.touchstart,{passive:!1}),w.addEventListener(c,"touchcancel",this.reset)}startMouse(i,c){this.mouseRotate.dragStart(i,c),this.mousePitch&&this.mousePitch.dragStart(i,c),w.disableDrag()}startTouch(i,c){this.touchRotate.dragStart(i,c),this.touchPitch&&this.touchPitch.dragStart(i,c),w.disableDrag()}moveMouse(i,c){const f=this.map,{bearingDelta:m}=this.mouseRotate.dragMove(i,c)||{};if(m&&f.setBearing(f.getBearing()+m),this.mousePitch){const{pitchDelta:x}=this.mousePitch.dragMove(i,c)||{};x&&f.setPitch(f.getPitch()+x)}}moveTouch(i,c){const f=this.map,{bearingDelta:m}=this.touchRotate.dragMove(i,c)||{};if(m&&f.setBearing(f.getBearing()+m),this.touchPitch){const{pitchDelta:x}=this.touchPitch.dragMove(i,c)||{};x&&f.setPitch(f.getPitch()+x)}}off(){const i=this.element;w.removeEventListener(i,"mousedown",this.mousedown),w.removeEventListener(i,"touchstart",this.touchstart,{passive:!1}),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend),w.removeEventListener(i,"touchcancel",this.reset),this.offTemp()}offTemp(){w.enableDrag(),w.removeEventListener(window,"mousemove",this.mousemove),w.removeEventListener(window,"mouseup",this.mouseup),w.removeEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.removeEventListener(window,"touchend",this.touchend)}mousedown(i){this.startMouse(u.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),w.mousePos(this.element,i)),w.addEventListener(window,"mousemove",this.mousemove),w.addEventListener(window,"mouseup",this.mouseup)}mousemove(i){this.moveMouse(i,w.mousePos(this.element,i))}mouseup(i){this.mouseRotate.dragEnd(i),this.mousePitch&&this.mousePitch.dragEnd(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=w.touchPos(this.element,i.targetTouches)[0],this.startTouch(i,this._startPos),w.addEventListener(window,"touchmove",this.touchmove,{passive:!1}),w.addEventListener(window,"touchend",this.touchend))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=w.touchPos(this.element,i.targetTouches)[0],this.moveTouch(i,this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),delete this._startPos,delete this._lastPos,this.offTemp()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),this.touchRotate.reset(),this.touchPitch&&this.touchPitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}let Sa;function Sh(d,i,c){if(d=new u.LngLat(d.lng,d.lat),i){const f=new u.LngLat(d.lng-360,d.lat),m=new u.LngLat(d.lng+360,d.lat),x=c.locationPoint(d).distSqr(i);c.locationPoint(f).distSqr(i)<x?d=f:c.locationPoint(m).distSqr(i)<x&&(d=m)}for(;Math.abs(d.lng-c.center.lng)>180;){const f=c.locationPoint(d);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;d.lng>c.center.lng?d.lng-=360:d.lng+=360}return d}const pu={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Th(d,i,c){const f=d.classList;for(const m in pu)f.remove(`maplibregl-${c}-anchor-${m}`);f.add(`maplibregl-${c}-anchor-${i}`)}class Uc extends u.Evented{constructor(i,c){if(super(),(i instanceof HTMLElement||c)&&(i=u.extend({element:i},c)),u.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment!=="auto"?i.pitchAlignment:this._rotationAlignment,i&&i.element)this._element=i.element,this._offset=u.Point.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=w.create("div"),this._element.setAttribute("aria-label","Map marker");const f=w.createNS("http://www.w3.org/2000/svg","svg"),m=41,x=27;f.setAttributeNS(null,"display","block"),f.setAttributeNS(null,"height",`${m}px`),f.setAttributeNS(null,"width",`${x}px`),f.setAttributeNS(null,"viewBox",`0 0 ${x} ${m}`);const S=w.createNS("http://www.w3.org/2000/svg","g");S.setAttributeNS(null,"stroke","none"),S.setAttributeNS(null,"stroke-width","1"),S.setAttributeNS(null,"fill","none"),S.setAttributeNS(null,"fill-rule","evenodd");const P=w.createNS("http://www.w3.org/2000/svg","g");P.setAttributeNS(null,"fill-rule","nonzero");const C=w.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"transform","translate(3.0, 29.0)"),C.setAttributeNS(null,"fill","#000000");const A=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];for(const Pt of A){const rt=w.createNS("http://www.w3.org/2000/svg","ellipse");rt.setAttributeNS(null,"opacity","0.04"),rt.setAttributeNS(null,"cx","10.5"),rt.setAttributeNS(null,"cy","5.80029008"),rt.setAttributeNS(null,"rx",Pt.rx),rt.setAttributeNS(null,"ry",Pt.ry),C.appendChild(rt)}const O=w.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"fill",this._color);const R=w.createNS("http://www.w3.org/2000/svg","path");R.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),O.appendChild(R);const X=w.createNS("http://www.w3.org/2000/svg","g");X.setAttributeNS(null,"opacity","0.25"),X.setAttributeNS(null,"fill","#000000");const et=w.createNS("http://www.w3.org/2000/svg","path");et.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),X.appendChild(et);const $=w.createNS("http://www.w3.org/2000/svg","g");$.setAttributeNS(null,"transform","translate(6.0, 7.0)"),$.setAttributeNS(null,"fill","#FFFFFF");const Q=w.createNS("http://www.w3.org/2000/svg","g");Q.setAttributeNS(null,"transform","translate(8.0, 8.0)");const ot=w.createNS("http://www.w3.org/2000/svg","circle");ot.setAttributeNS(null,"fill","#000000"),ot.setAttributeNS(null,"opacity","0.25"),ot.setAttributeNS(null,"cx","5.5"),ot.setAttributeNS(null,"cy","5.5"),ot.setAttributeNS(null,"r","5.4999962");const pt=w.createNS("http://www.w3.org/2000/svg","circle");pt.setAttributeNS(null,"fill","#FFFFFF"),pt.setAttributeNS(null,"cx","5.5"),pt.setAttributeNS(null,"cy","5.5"),pt.setAttributeNS(null,"r","5.4999962"),Q.appendChild(ot),Q.appendChild(pt),P.appendChild(C),P.appendChild(O),P.appendChild(X),P.appendChild($),P.appendChild(Q),f.appendChild(P),f.setAttributeNS(null,"height",m*this._scale+"px"),f.setAttributeNS(null,"width",x*this._scale+"px"),this._element.appendChild(f),this._offset=u.Point.convert(i&&i.offset||[0,-14])}this._element.classList.add("maplibregl-marker"),this._element.addEventListener("dragstart",f=>{f.preventDefault()}),this._element.addEventListener("mousedown",f=>{f.preventDefault()}),Th(this._element,this._anchor,"marker"),this._popup=null}addTo(i){return this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._update),i.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this}remove(){return this._opacityTimeout&&(clearTimeout(this._opacityTimeout),delete this._opacityTimeout),this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),w.remove(this._element),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=u.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const m=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[m,-1*(38.1-13.5+m)],"bottom-right":[-m,-1*(38.1-13.5+m)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this}_onKeyPress(i){const c=i.code,f=i.charCode||i.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(i){const c=i.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?i.remove():i.addTo(this._map),this):this}_update(i){if(!this._map)return;this._map.transform.renderWorldCopies&&(this._lngLat=Sh(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);let c="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?c=`rotateZ(${this._rotation}deg)`:this._rotationAlignment==="map"&&(c=`rotateZ(${this._rotation-this._map.getBearing()}deg)`);let f="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?f="rotateX(0deg)":this._pitchAlignment==="map"&&(f=`rotateX(${this._map.getPitch()}deg)`),i&&i.type!=="moveend"||(this._pos=this._pos.round()),w.setTransform(this._element,`${pu[this._anchor]} translate(${this._pos.x}px, ${this._pos.y}px) ${f} ${c}`),this._map.terrain&&!this._opacityTimeout&&(this._opacityTimeout=setTimeout(()=>{const m=this._map.unproject(this._pos),x=40075016686e-3*Math.abs(Math.cos(this._lngLat.lat*Math.PI/180))/Math.pow(2,this._map.transform.tileZoom+8);this._element.style.opacity=m.distanceTo(this._lngLat)>20*x?"0.2":"1.0",this._opacityTimeout=null},100))}getOffset(){return this._offset}setOffset(i){return this._offset=u.Point.convert(i),this._update(),this}_onMove(i){if(!this._isDragging){const c=this._clickTolerance||this._map._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=c}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new u.Event("dragstart"))),this.fire(new u.Event("drag")))}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new u.Event("dragend")),this._state="inactive"}_addDragHandler(i){this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos).add(this._offset),this._pointerdownPos=i.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))}setDraggable(i){return this._draggable=!!i,this._map&&(i?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i&&i!=="auto"?i:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}const Vp={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0};let Wu=0,fu=!1;const Gp={maxWidth:100,unit:"metric"};function Ch(d,i,c){const f=c&&c.maxWidth||100,m=d._container.clientHeight/2,x=d.unproject([0,m]),S=d.unproject([f,m]),P=x.distanceTo(S);if(c&&c.unit==="imperial"){const C=3.2808*P;C>5280?du(i,f,C/5280,d._getUIString("ScaleControl.Miles")):du(i,f,C,d._getUIString("ScaleControl.Feet"))}else c&&c.unit==="nautical"?du(i,f,P/1852,d._getUIString("ScaleControl.NauticalMiles")):P>=1e3?du(i,f,P/1e3,d._getUIString("ScaleControl.Kilometers")):du(i,f,P,d._getUIString("ScaleControl.Meters"))}function du(d,i,c,f){const m=function(x){const S=Math.pow(10,`${Math.floor(x)}`.length-1);let P=x/S;return P=P>=10?10:P>=5?5:P>=3?3:P>=2?2:P>=1?1:function(C){const A=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*A)/A}(P),S*P}(c);d.style.width=i*(m/c)+"px",d.innerHTML=`${m}&nbsp;${f}`}const Ph={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},jp=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function Mh(d){if(d){if(typeof d=="number"){const i=Math.round(Math.sqrt(.5*Math.pow(d,2)));return{center:new u.Point(0,0),top:new u.Point(0,d),"top-left":new u.Point(i,i),"top-right":new u.Point(-i,i),bottom:new u.Point(0,-d),"bottom-left":new u.Point(i,-i),"bottom-right":new u.Point(-i,-i),left:new u.Point(d,0),right:new u.Point(-d,0)}}if(d instanceof u.Point||Array.isArray(d)){const i=u.Point.convert(d);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:u.Point.convert(d.center||[0,0]),top:u.Point.convert(d.top||[0,0]),"top-left":u.Point.convert(d["top-left"]||[0,0]),"top-right":u.Point.convert(d["top-right"]||[0,0]),bottom:u.Point.convert(d.bottom||[0,0]),"bottom-left":u.Point.convert(d["bottom-left"]||[0,0]),"bottom-right":u.Point.convert(d["bottom-right"]||[0,0]),left:u.Point.convert(d.left||[0,0]),right:u.Point.convert(d.right||[0,0])}}return Mh(new u.Point(0,0))}const Ah=I,Lh={setRTLTextPlugin:u.setRTLTextPlugin,getRTLTextPluginStatus:u.getRTLTextPluginStatus,Map:class extends Le{constructor(d){var i;if(u.PerformanceUtils.mark(u.PerformanceMarkers.create),(d=u.extend({},rd,d)).minZoom!=null&&d.maxZoom!=null&&d.minZoom>d.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(d.minPitch!=null&&d.maxPitch!=null&&d.minPitch>d.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(d.minPitch!=null&&d.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(d.maxPitch!=null&&d.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(super(new Cr(d.minZoom,d.maxZoom,d.minPitch,d.maxPitch,d.renderWorldCopies),{bearingSnap:d.bearingSnap}),this._interactive=d.interactive,this._cooperativeGestures=d.cooperativeGestures,this._metaKey=navigator.platform.indexOf("Mac")===0?"metaKey":"ctrlKey",this._maxTileCacheSize=d.maxTileCacheSize,this._maxTileCacheZoomLevels=d.maxTileCacheZoomLevels,this._failIfMajorPerformanceCaveat=d.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=d.preserveDrawingBuffer,this._antialias=d.antialias,this._trackResize=d.trackResize,this._bearingSnap=d.bearingSnap,this._refreshExpiredTiles=d.refreshExpiredTiles,this._fadeDuration=d.fadeDuration,this._crossSourceCollisions=d.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=d.collectResourceTiming,this._renderTaskQueue=new Fp,this._controls=[],this._mapId=u.uniqueId(),this._locale=u.extend({},Bp,d.locale),this._clickTolerance=d.clickTolerance,this._pixelRatio=(i=d.pixelRatio)!==null&&i!==void 0?i:devicePixelRatio,this.transformCameraUpdate=d.transformCameraUpdate,this._imageQueueHandle=xt.addThrottleControl(()=>this.isMoving()),this._requestManager=new gt(d.transformRequest),typeof d.container=="string"){if(this._container=document.getElementById(d.container),!this._container)throw new Error(`Container '${d.container}' not found.`)}else{if(!(d.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=d.container}if(d.maxBounds&&this.setMaxBounds(d.maxBounds),u.bindAll(["_onWindowOnline","_onMapScroll","_cooperativeGesturesOnWheel","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this.on("terrain",()=>{this.painter.terrainFacilitator.dirty=!0,this._update(!0)}),this.once("idle",()=>{this._idleTriggered=!0}),typeof window<"u"){addEventListener("online",this._onWindowOnline,!1);let c=!1;this._resizeObserver=new ResizeObserver(f=>{c?this._trackResize&&this.resize(f)._update():c=!0}),this._resizeObserver.observe(this._container)}this.handlers=new Ea(this,d),this._cooperativeGestures&&this._setupCooperativeGestures(),this._hash=d.hash&&new Xo(typeof d.hash=="string"&&d.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:d.center,zoom:d.zoom,bearing:d.bearing,pitch:d.pitch}),d.bounds&&(this.resize(),this.fitBounds(d.bounds,u.extend({},d.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=d.localIdeographFontFamily,this._validateStyle=d.validateStyle,d.style&&this.setStyle(d.style,{localIdeographFontFamily:d.localIdeographFontFamily}),d.attributionControl&&this.addControl(new Be({customAttribution:d.customAttribution})),d.maplibreLogo&&this.addControl(new Bc,d.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new u.Event(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new u.Event(`${c.dataType}dataloading`,c))}),this.on("dataabort",c=>{this.fire(new u.Event("sourcedataabort",c))})}_getMapId(){return this._mapId}addControl(d,i){if(i===void 0&&(i=d.getDefaultPosition?d.getDefaultPosition():"top-right"),!d||!d.onAdd)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=d.onAdd(this);this._controls.push(d);const f=this._controlPositions[i];return i.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(d){if(!d||!d.onRemove)return this.fire(new u.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(d);return i>-1&&this._controls.splice(i,1),d.onRemove(this),this}hasControl(d){return this._controls.indexOf(d)>-1}calculateCameraOptionsFromTo(d,i,c,f){return f==null&&this.terrain&&(f=this.transform.getElevation(c,this.terrain)),super.calculateCameraOptionsFromTo(d,i,c,f)}resize(d){var i;const c=this._containerDimensions(),f=c[0],m=c[1];this._resizeCanvas(f,m,this.getPixelRatio()),this.transform.resize(f,m),(i=this._requestedCameraState)===null||i===void 0||i.resize(f,m),this.painter.resize(f,m,this.getPixelRatio());const x=!this._moving;return x&&(this.stop(),this.fire(new u.Event("movestart",d)).fire(new u.Event("move",d))),this.fire(new u.Event("resize",d)),x&&this.fire(new u.Event("moveend",d)),this}getPixelRatio(){return this._pixelRatio}setPixelRatio(d){const[i,c]=this._containerDimensions();this._pixelRatio=d,this._resizeCanvas(i,c,d),this.painter.resize(i,c,d)}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()}setMaxBounds(d){return this.transform.setMaxBounds(ur.convert(d)),this._update()}setMinZoom(d){if((d=d??-2)>=-2&&d<=this.transform.maxZoom)return this.transform.minZoom=d,this._update(),this.getZoom()<d&&this.setZoom(d),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(d){if((d=d??22)>=this.transform.minZoom)return this.transform.maxZoom=d,this._update(),this.getZoom()>d&&this.setZoom(d),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(d){if((d=d??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(d>=0&&d<=this.transform.maxPitch)return this.transform.minPitch=d,this._update(),this.getPitch()<d&&this.setPitch(d),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(d){if((d=d??60)>85)throw new Error("maxPitch must be less than or equal to 85");if(d>=this.transform.minPitch)return this.transform.maxPitch=d,this._update(),this.getPitch()>d&&this.setPitch(d),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(d){return this.transform.renderWorldCopies=d,this._update()}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(d){return this._cooperativeGestures=d,this._cooperativeGestures?this._setupCooperativeGestures():this._destroyCooperativeGestures(),this}project(d){return this.transform.locationPoint(u.LngLat.convert(d),this.style&&this.terrain)}unproject(d){return this.transform.pointLocation(u.Point.convert(d),this.terrain)}isMoving(){var d;return this._moving||((d=this.handlers)===null||d===void 0?void 0:d.isMoving())}isZooming(){var d;return this._zooming||((d=this.handlers)===null||d===void 0?void 0:d.isZooming())}isRotating(){var d;return this._rotating||((d=this.handlers)===null||d===void 0?void 0:d.isRotating())}_createDelegatedListener(d,i,c){if(d==="mouseenter"||d==="mouseover"){let f=!1;return{layer:i,listener:c,delegates:{mousemove:x=>{const S=this.getLayer(i)?this.queryRenderedFeatures(x.point,{layers:[i]}):[];S.length?f||(f=!0,c.call(this,new gr(d,this,x.originalEvent,{features:S}))):f=!1},mouseout:()=>{f=!1}}}}if(d==="mouseleave"||d==="mouseout"){let f=!1;return{layer:i,listener:c,delegates:{mousemove:S=>{(this.getLayer(i)?this.queryRenderedFeatures(S.point,{layers:[i]}):[]).length?f=!0:f&&(f=!1,c.call(this,new gr(d,this,S.originalEvent)))},mouseout:S=>{f&&(f=!1,c.call(this,new gr(d,this,S.originalEvent)))}}}}{const f=m=>{const x=this.getLayer(i)?this.queryRenderedFeatures(m.point,{layers:[i]}):[];x.length&&(m.features=x,c.call(this,m),delete m.features)};return{layer:i,listener:c,delegates:{[d]:f}}}}on(d,i,c){if(c===void 0)return super.on(d,i);const f=this._createDelegatedListener(d,i,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[d]=this._delegatedListeners[d]||[],this._delegatedListeners[d].push(f);for(const m in f.delegates)this.on(m,f.delegates[m]);return this}once(d,i,c){if(c===void 0)return super.once(d,i);const f=this._createDelegatedListener(d,i,c);for(const m in f.delegates)this.once(m,f.delegates[m]);return this}off(d,i,c){return c===void 0?super.off(d,i):(this._delegatedListeners&&this._delegatedListeners[d]&&(f=>{const m=this._delegatedListeners[d];for(let x=0;x<m.length;x++){const S=m[x];if(S.layer===i&&S.listener===c){for(const P in S.delegates)this.off(P,S.delegates[P]);return m.splice(x,1),this}}})(),this)}queryRenderedFeatures(d,i){if(!this.style)return[];let c;const f=d instanceof u.Point||Array.isArray(d),m=f?d:[[0,0],[this.transform.width,this.transform.height]];if(i=i||(f?{}:d)||{},m instanceof u.Point||typeof m[0]=="number")c=[u.Point.convert(m)];else{const x=u.Point.convert(m[0]),S=u.Point.convert(m[1]);c=[x,new u.Point(S.x,x.y),S,new u.Point(x.x,S.y),x]}return this.style.queryRenderedFeatures(c,i,this.transform)}querySourceFeatures(d,i){return this.style.querySourceFeatures(d,i)}setStyle(d,i){return(i=u.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,validate:this._validateStyle},i)).diff!==!1&&i.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&d?(this._diffStyle(d,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._updateStyle(d,i))}setTransformRequest(d){return this._requestManager.setTransformRequest(d),this}_getUIString(d){const i=this._locale[d];if(i==null)throw new Error(`Missing UI string '${d}'`);return i}_updateStyle(d,i){if(i.transformStyle&&this.style&&!this.style._loaded)return void this.style.once("style.load",()=>this._updateStyle(d,i));const c=this.style&&i.transformStyle?this.style.serialize():void 0;return this.style&&(this.style.setEventedParent(null),this.style._remove(!d)),d?(this.style=new vi(this,i||{}),this.style.setEventedParent(this,{style:this.style}),typeof d=="string"?this.style.loadURL(d,i,c):this.style.loadJSON(d,i,c),this):(delete this.style,this)}_lazyInitEmptyStyle(){this.style||(this.style=new vi(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(d,i){if(typeof d=="string"){const c=this._requestManager.transformRequest(d,dt.Style);u.getJSON(c,(f,m)=>{f?this.fire(new u.ErrorEvent(f)):m&&this._updateDiff(m,i)})}else typeof d=="object"&&this._updateDiff(d,i)}_updateDiff(d,i){try{this.style.setState(d,i)&&this._update(!0)}catch(c){u.warnOnce(`Unable to perform style diff: ${c.message||c.error||c}.  Rebuilding the style from scratch.`),this._updateStyle(d,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():u.warnOnce("There is no style added to the map.")}addSource(d,i){return this._lazyInitEmptyStyle(),this.style.addSource(d,i),this._update(!0)}isSourceLoaded(d){const i=this.style&&this.style.sourceCaches[d];if(i!==void 0)return i.loaded();this.fire(new u.ErrorEvent(new Error(`There is no source with ID '${d}'`)))}setTerrain(d){if(this.style._checkLoaded(),this._terrainDataCallback&&this.style.off("data",this._terrainDataCallback),d){const i=this.style.sourceCaches[d.source];if(!i)throw new Error(`cannot load terrain, because there exists no source with ID: ${d.source}`);for(const c in this.style._layers){const f=this.style._layers[c];f.type==="hillshade"&&f.source===d.source&&u.warnOnce("You are using the same source for a hillshade layer and for 3D terrain. Please consider using two separate sources to improve rendering quality.")}this.terrain=new Ia(this.painter,i,d),this.painter.renderToTexture=new ti(this.painter,this.terrain),this.transform.updateElevation(this.terrain),this._terrainDataCallback=c=>{c.dataType==="style"?this.terrain.sourceCache.freeRtt():c.dataType==="source"&&c.tile&&(c.sourceId===d.source&&this.transform.updateElevation(this.terrain),this.terrain.sourceCache.freeRtt(c.tile.tileID))},this.style.on("data",this._terrainDataCallback)}else this.terrain&&this.terrain.sourceCache.destruct(),this.terrain=null,this.painter.renderToTexture&&this.painter.renderToTexture.destruct(),this.painter.renderToTexture=null,this.transform.updateElevation(this.terrain);return this.fire(new u.Event("terrain",{terrain:d})),this}getTerrain(){return this.terrain&&this.terrain.options}areTilesLoaded(){const d=this.style&&this.style.sourceCaches;for(const i in d){const c=d[i]._tiles;for(const f in c){const m=c[f];if(m.state!=="loaded"&&m.state!=="errored")return!1}}return!0}addSourceType(d,i,c){return this._lazyInitEmptyStyle(),this.style.addSourceType(d,i,c)}removeSource(d){return this.style.removeSource(d),this._update(!0)}getSource(d){return this.style.getSource(d)}addImage(d,i,{pixelRatio:c=1,sdf:f=!1,stretchX:m,stretchY:x,content:S}={}){if(this._lazyInitEmptyStyle(),i instanceof HTMLImageElement||u.isImageBitmap(i)){const{width:P,height:C,data:A}=u.exported.getImageData(i);this.style.addImage(d,{data:new u.RGBAImage({width:P,height:C},A),pixelRatio:c,stretchX:m,stretchY:x,content:S,sdf:f,version:0})}else{if(i.width===void 0||i.height===void 0)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));{const{width:P,height:C,data:A}=i,O=i;this.style.addImage(d,{data:new u.RGBAImage({width:P,height:C},new Uint8Array(A)),pixelRatio:c,stretchX:m,stretchY:x,content:S,sdf:f,version:0,userImage:O}),O.onAdd&&O.onAdd(this,d)}}}updateImage(d,i){const c=this.style.getImage(d);if(!c)return this.fire(new u.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const f=i instanceof HTMLImageElement||u.isImageBitmap(i)?u.exported.getImageData(i):i,{width:m,height:x,data:S}=f;if(m===void 0||x===void 0)return this.fire(new u.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(m!==c.data.width||x!==c.data.height)return this.fire(new u.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image")));const P=!(i instanceof HTMLImageElement||u.isImageBitmap(i));c.data.replace(S,P),this.style.updateImage(d,c)}getImage(d){return this.style.getImage(d)}hasImage(d){return d?!!this.style.getImage(d):(this.fire(new u.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(d){this.style.removeImage(d)}loadImage(d,i){xt.getImage(this._requestManager.transformRequest(d,dt.Image),i)}listImages(){return this.style.listImages()}addLayer(d,i){return this._lazyInitEmptyStyle(),this.style.addLayer(d,i),this._update(!0)}moveLayer(d,i){return this.style.moveLayer(d,i),this._update(!0)}removeLayer(d){return this.style.removeLayer(d),this._update(!0)}getLayer(d){return this.style.getLayer(d)}setLayerZoomRange(d,i,c){return this.style.setLayerZoomRange(d,i,c),this._update(!0)}setFilter(d,i,c={}){return this.style.setFilter(d,i,c),this._update(!0)}getFilter(d){return this.style.getFilter(d)}setPaintProperty(d,i,c,f={}){return this.style.setPaintProperty(d,i,c,f),this._update(!0)}getPaintProperty(d,i){return this.style.getPaintProperty(d,i)}setLayoutProperty(d,i,c,f={}){return this.style.setLayoutProperty(d,i,c,f),this._update(!0)}getLayoutProperty(d,i){return this.style.getLayoutProperty(d,i)}setGlyphs(d,i={}){return this._lazyInitEmptyStyle(),this.style.setGlyphs(d,i),this._update(!0)}getGlyphs(){return this.style.getGlyphsUrl()}addSprite(d,i,c={}){return this._lazyInitEmptyStyle(),this.style.addSprite(d,i,c,f=>{f||this._update(!0)}),this}removeSprite(d){return this._lazyInitEmptyStyle(),this.style.removeSprite(d),this._update(!0)}getSprite(){return this.style.getSprite()}setSprite(d,i={}){return this._lazyInitEmptyStyle(),this.style.setSprite(d,i,c=>{c||this._update(!0)}),this}setLight(d,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(d,i),this._update(!0)}getLight(){return this.style.getLight()}setFeatureState(d,i){return this.style.setFeatureState(d,i),this._update()}removeFeatureState(d,i){return this.style.removeFeatureState(d,i),this._update()}getFeatureState(d){return this.style.getFeatureState(d)}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}_containerDimensions(){let d=0,i=0;return this._container&&(d=this._container.clientWidth||400,i=this._container.clientHeight||300),[d,i]}_setupContainer(){const d=this._container;d.classList.add("maplibregl-map");const i=this._canvasContainer=w.create("div","maplibregl-canvas-container",d);this._interactive&&i.classList.add("maplibregl-interactive"),this._canvas=w.create("canvas","maplibregl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");const c=this._containerDimensions();this._resizeCanvas(c[0],c[1],this.getPixelRatio());const f=this._controlContainer=w.create("div","maplibregl-control-container",d),m=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(x=>{m[x]=w.create("div",`maplibregl-ctrl-${x} `,f)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_cooperativeGesturesOnWheel(d){this._onCooperativeGesture(d,d[this._metaKey],1)}_setupCooperativeGestures(){this._cooperativeGesturesScreen=w.create("div","maplibregl-cooperative-gesture-screen",this._container);let d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.windowsHelpText?this._cooperativeGestures.windowsHelpText:"Use Ctrl + scroll to zoom the map";navigator.platform.indexOf("Mac")===0&&(d=typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.macHelpText?this._cooperativeGestures.macHelpText:"Use ⌘ + scroll to zoom the map"),this._cooperativeGesturesScreen.innerHTML=`
            <div class="maplibregl-desktop-message">${d}</div>
            <div class="maplibregl-mobile-message">${typeof this._cooperativeGestures!="boolean"&&this._cooperativeGestures.mobileHelpText?this._cooperativeGestures.mobileHelpText:"Use two fingers to move the map"}</div>
        `,this._canvasContainer.addEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.add("maplibregl-cooperative-gestures")}_destroyCooperativeGestures(){w.remove(this._cooperativeGesturesScreen),this._canvasContainer.removeEventListener("wheel",this._cooperativeGesturesOnWheel,!1),this._canvasContainer.classList.remove("maplibregl-cooperative-gestures")}_resizeCanvas(d,i,c){this._canvas.width=c*d,this._canvas.height=c*i,this._canvas.style.width=`${d}px`,this._canvas.style.height=`${i}px`}_setupPainter(){const d={alpha:!0,stencil:!0,depth:!0,failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1};let i=null;this._canvas.addEventListener("webglcontextcreationerror",f=>{i={requestedAttributes:d},f&&(i.statusMessage=f.statusMessage,i.type=f.type)},{once:!0});const c=this._canvas.getContext("webgl2",d)||this._canvas.getContext("webgl",d);if(!c){const f="Failed to initialize WebGL";throw i?(i.message=f,new Error(JSON.stringify(i))):new Error(f)}this.painter=new Fe(c,this.transform),D.testSupport(c)}_contextLost(d){d.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new u.Event("webglcontextlost",{originalEvent:d}))}_contextRestored(d){this._setupPainter(),this.resize(),this._update(),this.fire(new u.Event("webglcontextrestored",{originalEvent:d}))}_onMapScroll(d){if(d.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}_onCooperativeGesture(d,i,c){return!i&&c<2&&(this._cooperativeGesturesScreen.classList.add("maplibregl-show"),setTimeout(()=>{this._cooperativeGesturesScreen.classList.remove("maplibregl-show")},100)),!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(d){return this.style&&this.style._loaded?(this._styleDirty=this._styleDirty||d,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(d){return this._update(),this._renderTaskQueue.add(d)}_cancelRenderFrame(d){this._renderTaskQueue.remove(d)}_render(d){const i=this._idleTriggered?this._fadeDuration:0;if(this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(d),this._removed)return;let c=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;const m=this.transform.zoom,x=u.exported.now();this.style.zoomHistory.update(m,x);const S=new u.EvaluationParameters(m,{now:x,fadeDuration:i,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),P=S.crossFadingFactor();P===1&&P===this._crossFadingFactor||(c=!0,this._crossFadingFactor=P),this.style.update(S)}this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this.terrain&&this.terrain.sourceCache.update(this.transform,this.terrain),this.transform.updateElevation(this.terrain),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,i,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:i,showPadding:this.showPadding}),this.fire(new u.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,u.PerformanceUtils.mark(u.PerformanceMarkers.load),this.fire(new u.Event("load"))),this.style&&(this.style.hasTransitions()||c)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles();const f=this._sourcesDirty||this._styleDirty||this._placementDirty;return f||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new u.Event("idle")),!this._loaded||this._fullyLoaded||f||(this._fullyLoaded=!0,u.PerformanceUtils.mark(u.PerformanceMarkers.fullLoad)),this}redraw(){return this.style&&(this._frame&&(this._frame.cancel(),this._frame=null),this._render(0)),this}remove(){var d;this._hash&&this._hash.remove();for(const c of this._controls)c.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),typeof window<"u"&&removeEventListener("online",this._onWindowOnline,!1),xt.removeThrottleControl(this._imageQueueHandle),(d=this._resizeObserver)===null||d===void 0||d.disconnect();const i=this.painter.context.gl.getExtension("WEBGL_lose_context");i&&i.loseContext(),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),w.remove(this._canvasContainer),w.remove(this._controlContainer),this._cooperativeGestures&&this._destroyCooperativeGestures(),this._container.classList.remove("maplibregl-map"),u.PerformanceUtils.clearMetrics(),this._removed=!0,this.fire(new u.Event("remove"))}triggerRepaint(){this.style&&!this._frame&&(this._frame=u.exported.frame(d=>{u.PerformanceUtils.frame(d),this._frame=null,this._render(d)}))}_onWindowOnline(){this._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(d){this._showTileBoundaries!==d&&(this._showTileBoundaries=d,this._update())}get showPadding(){return!!this._showPadding}set showPadding(d){this._showPadding!==d&&(this._showPadding=d,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(d){this._showCollisionBoxes!==d&&(this._showCollisionBoxes=d,d?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(d){this._showOverdrawInspector!==d&&(this._showOverdrawInspector=d,this._update())}get repaint(){return!!this._repaint}set repaint(d){this._repaint!==d&&(this._repaint=d,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(d){this._vertices=d,this._update()}get version(){return bi}getCameraTargetElevation(){return this.transform.elevation}},NavigationControl:class{constructor(d){this.options=u.extend({},Ih,d),this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(u.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("maplibregl-ctrl-zoom-in",i=>this._map.zoomIn({},{originalEvent:i})),w.create("span","maplibregl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("maplibregl-ctrl-zoom-out",i=>this._map.zoomOut({},{originalEvent:i})),w.create("span","maplibregl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(u.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("maplibregl-ctrl-compass",i=>{this.options.visualizePitch?this._map.resetNorthPitch({},{originalEvent:i}):this._map.resetNorth({},{originalEvent:i})}),this._compassIcon=w.create("span","maplibregl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const d=this._map.getZoom(),i=d===this._map.getMaxZoom(),c=d===this._map.getMinZoom();this._zoomInButton.disabled=i,this._zoomOutButton.disabled=c,this._zoomInButton.setAttribute("aria-disabled",i.toString()),this._zoomOutButton.setAttribute("aria-disabled",c.toString())}_rotateCompassArrow(){const d=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)}) rotateX(${this._map.transform.pitch}deg) rotateZ(${this._map.transform.angle*(180/Math.PI)}deg)`:`rotate(${this._map.transform.angle*(180/Math.PI)}deg)`;this._compassIcon.style.transform=d}onAdd(d){return this._map=d,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Up(this._map,this._compass,this.options.visualizePitch)),this._container}onRemove(){w.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map}_createButton(d,i){const c=w.create("button",d,this._container);return c.type="button",c.addEventListener("click",i),c}_setButtonTitle(d,i){const c=this._map._getUIString(`NavigationControl.${i}`);d.title=c,d.setAttribute("aria-label",c)}},GeolocateControl:class extends u.Evented{constructor(d){super(),this.options=u.extend({},Vp,d),u.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}onAdd(d){return this._map=d,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),function(i,c=!1){Sa===void 0||c?window.navigator.permissions!==void 0?window.navigator.permissions.query({name:"geolocation"}).then(f=>{Sa=f.state!=="denied",i(Sa)}).catch(()=>{Sa=!!window.navigator.geolocation,i(Sa)}):(Sa=!!window.navigator.geolocation,i(Sa)):i(Sa)}(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),w.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Wu=0,fu=!1}_isOutOfMapMaxBounds(d){const i=this._map.getMaxBounds(),c=d.coords;return i&&(c.longitude<i.getWest()||c.longitude>i.getEast()||c.latitude<i.getSouth()||c.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting");break;case"ACTIVE_ERROR":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}}_onSuccess(d){if(this._map){if(this._isOutOfMapMaxBounds(d))return this._setErrorState(),this.fire(new u.Event("outofmaxbounds",d)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=d,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background");break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(d),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(d),this.options.showUserLocation&&this._dotElement.classList.remove("maplibregl-user-location-dot-stale"),this.fire(new u.Event("geolocate",d)),this._finish()}}_updateCamera(d){const i=new u.LngLat(d.coords.longitude,d.coords.latitude),c=d.coords.accuracy,f=this._map.getBearing(),m=u.extend({bearing:f},this.options.fitBoundsOptions),x=ur.fromLngLat(i,c);this._map.fitBounds(x,m,{geolocateSource:!0})}_updateMarker(d){if(d){const i=new u.LngLat(d.coords.longitude,d.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=d.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const d=this._map.getBounds(),i=d.getSouthEast(),c=d.getNorthEast(),f=i.distanceTo(c),m=Math.ceil(this._accuracy/(f/this._map._container.clientHeight)*2);this._circleElement.style.width=`${m}px`,this._circleElement.style.height=`${m}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_onError(d){if(this._map){if(this.options.trackUserLocation)if(d.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(d.code===3&&fu)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("maplibregl-user-location-dot-stale"),this.fire(new u.Event("error",d)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(d){if(this._map){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=w.create("button","maplibregl-ctrl-geolocate",this._container),w.create("span","maplibregl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",d===!1){u.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=w.create("div","maplibregl-user-location-dot"),this._userLocationDotMarker=new Uc(this._dotElement),this._circleElement=w.create("div","maplibregl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Uc({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this.fire(new u.Event("trackuserlocationend")))})}}trigger(){if(!this._setup)return u.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new u.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Wu--,fu=!1,this._watchState="OFF",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background-error"),this.fire(new u.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new u.Event("trackuserlocationstart"));break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-active");break;case"OFF":break;default:throw new Error(`Unexpected watchState ${this._watchState}`)}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let d;this._geolocateButton.classList.add("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Wu++,Wu>1?(d={maximumAge:6e5,timeout:0},fu=!0):(d=this.options.positionOptions,fu=!1),this._geolocationWatchID=window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,d)}}else window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_clearWatch(){window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("maplibregl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Be,LogoControl:Bc,ScaleControl:class{constructor(d){this.options=u.extend({},Gp,d),u.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){Ch(this._map,this._container,this.options)}onAdd(d){return this._map=d,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-scale",d.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){w.remove(this._container),this._map.off("move",this._onMove),this._map=void 0}setUnit(d){this.options.unit=d,Ch(this._map,this._container,this.options)}},FullscreenControl:class extends u.Evented{constructor(d={}){super(),this._onFullscreenChange=()=>{(window.document.fullscreenElement||window.document.mozFullScreenElement||window.document.webkitFullscreenElement||window.document.msFullscreenElement)===this._container!==this._fullscreen&&this._handleFullscreenChange()},this._onClickFullscreen=()=>{this._isFullscreen()?this._exitFullscreen():this._requestFullscreen()},this._fullscreen=!1,d&&d.container&&(d.container instanceof HTMLElement?this._container=d.container:u.warnOnce("Full screen control 'container' must be a DOM element.")),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in document&&(this._fullscreenchange="MSFullscreenChange")}onAdd(d){return this._map=d,this._container||(this._container=this._map.getContainer()),this._controlContainer=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._setupUI(),this._controlContainer}onRemove(){w.remove(this._controlContainer),this._map=null,window.document.removeEventListener(this._fullscreenchange,this._onFullscreenChange)}_setupUI(){const d=this._fullscreenButton=w.create("button","maplibregl-ctrl-fullscreen",this._controlContainer);w.create("span","maplibregl-ctrl-icon",d).setAttribute("aria-hidden","true"),d.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),window.document.addEventListener(this._fullscreenchange,this._onFullscreenChange)}_updateTitle(){const d=this._getTitle();this._fullscreenButton.setAttribute("aria-label",d),this._fullscreenButton.title=d}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_handleFullscreenChange(){this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("maplibregl-ctrl-shrink"),this._fullscreenButton.classList.toggle("maplibregl-ctrl-fullscreen"),this._updateTitle(),this._fullscreen?(this.fire(new u.Event("fullscreenstart")),this._map._cooperativeGestures&&(this._prevCooperativeGestures=this._map._cooperativeGestures,this._map.setCooperativeGestures())):(this.fire(new u.Event("fullscreenend")),this._prevCooperativeGestures&&(this._map.setCooperativeGestures(this._prevCooperativeGestures),delete this._prevCooperativeGestures))}_exitFullscreen(){window.document.exitFullscreen?window.document.exitFullscreen():window.document.mozCancelFullScreen?window.document.mozCancelFullScreen():window.document.msExitFullscreen?window.document.msExitFullscreen():window.document.webkitCancelFullScreen?window.document.webkitCancelFullScreen():this._togglePseudoFullScreen()}_requestFullscreen(){this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen?this._container.webkitRequestFullscreen():this._togglePseudoFullScreen()}_togglePseudoFullScreen(){this._container.classList.toggle("maplibregl-pseudo-fullscreen"),this._handleFullscreenChange(),this._map.resize()}},TerrainControl:class{constructor(d){this.options=d,u.bindAll(["_toggleTerrain","_updateTerrainIcon"],this)}onAdd(d){return this._map=d,this._container=w.create("div","maplibregl-ctrl maplibregl-ctrl-group"),this._terrainButton=w.create("button","maplibregl-ctrl-terrain",this._container),w.create("span","maplibregl-ctrl-icon",this._terrainButton).setAttribute("aria-hidden","true"),this._terrainButton.type="button",this._terrainButton.addEventListener("click",this._toggleTerrain),this._updateTerrainIcon(),this._map.on("terrain",this._updateTerrainIcon),this._container}onRemove(){w.remove(this._container),this._map.off("terrain",this._updateTerrainIcon),this._map=void 0}_toggleTerrain(){this._map.getTerrain()?this._map.setTerrain(null):this._map.setTerrain(this.options),this._updateTerrainIcon()}_updateTerrainIcon(){this._terrainButton.classList.remove("maplibregl-ctrl-terrain"),this._terrainButton.classList.remove("maplibregl-ctrl-terrain-enabled"),this._map.terrain?(this._terrainButton.classList.add("maplibregl-ctrl-terrain-enabled"),this._terrainButton.title=this._map._getUIString("TerrainControl.disableTerrain")):(this._terrainButton.classList.add("maplibregl-ctrl-terrain"),this._terrainButton.title=this._map._getUIString("TerrainControl.enableTerrain"))}},Popup:class extends u.Evented{constructor(d){super(),this.options=u.extend(Object.create(Ph),d),u.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}addTo(d){return this._map&&this.remove(),this._map=d,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")):this._map.on("move",this._update),this.fire(new u.Event("open")),this}isOpen(){return!!this._map}remove(){return this._content&&w.remove(this._content),this._container&&(w.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new u.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(d){return this._lngLat=u.LngLat.convert(d),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.remove("maplibregl-track-pointer")),this}trackPointer(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("maplibregl-popup-track-pointer"),this._map._canvasContainer.classList.add("maplibregl-track-pointer")),this}getElement(){return this._container}setText(d){return this.setDOMContent(document.createTextNode(d))}setHTML(d){const i=document.createDocumentFragment(),c=document.createElement("body");let f;for(c.innerHTML=d;f=c.firstChild,f;)i.appendChild(f);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(d){return this.options.maxWidth=d,this._update(),this}setDOMContent(d){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=w.create("div","maplibregl-popup-content",this._container);return this._content.appendChild(d),this._createCloseButton(),this._update(),this._focusFirstElement(),this}addClassName(d){this._container&&this._container.classList.add(d)}removeClassName(d){this._container&&this._container.classList.remove(d)}setOffset(d){return this.options.offset=d,this._update(),this}toggleClassName(d){if(this._container)return this._container.classList.toggle(d)}_createCloseButton(){this.options.closeButton&&(this._closeButton=w.create("button","maplibregl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))}_onMouseUp(d){this._update(d.point)}_onMouseMove(d){this._update(d.point)}_onDrag(d){this._update(d.point)}_update(d){if(!this._map||!this._lngLat&&!this._trackPointer||!this._content||(this._container||(this._container=w.create("div","maplibregl-popup",this._map.getContainer()),this._tip=w.create("div","maplibregl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(x=>this._container.classList.add(x)),this._trackPointer&&this._container.classList.add("maplibregl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Sh(this._lngLat,this._pos,this._map.transform)),this._trackPointer&&!d))return;const i=this._pos=this._trackPointer&&d?d:this._map.project(this._lngLat);let c=this.options.anchor;const f=Mh(this.options.offset);if(!c){const x=this._container.offsetWidth,S=this._container.offsetHeight;let P;P=i.y+f.bottom.y<S?["top"]:i.y>this._map.transform.height-S?["bottom"]:[],i.x<x/2?P.push("left"):i.x>this._map.transform.width-x/2&&P.push("right"),c=P.length===0?"bottom":P.join("-")}const m=i.add(f[c]).round();w.setTransform(this._container,`${pu[c]} translate(${m.x}px,${m.y}px)`),Th(this._container,c,"popup")}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const d=this._container.querySelector(jp);d&&d.focus()}_onClose(){this.remove()}},Marker:Uc,Style:vi,LngLat:u.LngLat,LngLatBounds:ur,Point:u.Point,MercatorCoordinate:u.MercatorCoordinate,Evented:u.Evented,AJAXError:u.AJAXError,config:u.config,CanvasSource:St,GeoJSONSource:_n,ImageSource:We,RasterDEMTileSource:Ni,RasterTileSource:Qe,VectorTileSource:Ur,VideoSource:js,prewarm:function(){ss().acquire(Co)},clearPrewarmedResources:function(){const d=Vr;d&&(d.isPreloaded()&&d.numActive()===1?(d.release(Co),Vr=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get version(){return Ah},get workerCount(){return te.workerCount},set workerCount(d){te.workerCount=d},get maxParallelImageRequests(){return u.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(d){u.config.MAX_PARALLEL_IMAGE_REQUESTS=d},get workerUrl(){return u.config.WORKER_URL},set workerUrl(d){u.config.WORKER_URL=d},addProtocol(d,i){u.config.REGISTERED_PROTOCOLS[d]=i},removeProtocol(d){delete u.config.REGISTERED_PROTOCOLS[d]}};return Eh.extend(Lh,{isSafari:u.isSafari,getPerformanceMetrics:u.PerformanceUtils.getPerformanceMetrics}),Lh});var _=l;return _})})(av);var Od=av.exports;const Pb=sv(Od);var Mb=Object.defineProperty,Ab=(t,e,n)=>e in t?Mb(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n,Ky=(t,e,n)=>(Ab(t,typeof e!="symbol"?e+"":e,n),n);function Cf(){}function uv(t){return t()}function Jy(){return Object.create(null)}function lg(t){t.forEach(uv)}function cv(t){return typeof t=="function"}function Lb(t,e){return t!=t?e==e:t!==e||t&&typeof t=="object"||typeof t=="function"}function Db(t){return Object.keys(t).length===0}function kb(t,e){t.appendChild(e)}function Nb(t,e,n){t.insertBefore(e,n||null)}function hv(t){t.parentNode&&t.parentNode.removeChild(t)}function Qy(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function tc(t,e,n){n==null?t.removeAttribute(e):t.getAttribute(e)!==n&&t.setAttribute(e,n)}function Rb(t){return Array.from(t.childNodes)}function Cd(t,e,n){t.classList.toggle(e,!!n)}let Qm;function Ef(t){Qm=t}const Hh=[],t0=[];let ep=[];const e0=[],Ob=Promise.resolve();let Tm=!1;function zb(){Tm||(Tm=!0,Ob.then(pv))}function Cm(t){ep.push(t)}const ym=new Set;let Zh=0;function pv(){if(Zh!==0)return;const t=Qm;do{try{for(;Zh<Hh.length;){const e=Hh[Zh];Zh++,Ef(e),Fb(e.$$)}}catch(e){throw Hh.length=0,Zh=0,e}for(Ef(null),Hh.length=0,Zh=0;t0.length;)t0.pop()();for(let e=0;e<ep.length;e+=1){const n=ep[e];ym.has(n)||(ym.add(n),n())}ep.length=0}while(Hh.length);for(;e0.length;)e0.pop()();Tm=!1,ym.clear(),Ef(t)}function Fb(t){if(t.fragment!==null){t.update(),lg(t.before_update);const e=t.dirty;t.dirty=[-1],t.fragment&&t.fragment.p(t.ctx,e),t.after_update.forEach(Cm)}}function Bb(t){const e=[],n=[];ep.forEach(o=>t.indexOf(o)===-1?e.push(o):n.push(o)),n.forEach(o=>o()),ep=e}const Ub=new Set;function Vb(t,e){t&&t.i&&(Ub.delete(t),t.i(e))}function Gb(t,e,n){const{fragment:o,after_update:l}=t.$$;o&&o.m(e,n),Cm(()=>{const h=t.$$.on_mount.map(uv).filter(cv);t.$$.on_destroy?t.$$.on_destroy.push(...h):lg(h),t.$$.on_mount=[]}),l.forEach(Cm)}function jb(t,e){const n=t.$$;n.fragment!==null&&(Bb(n.after_update),lg(n.on_destroy),n.fragment&&n.fragment.d(e),n.on_destroy=n.fragment=null,n.ctx=[])}function qb(t,e){t.$$.dirty[0]===-1&&(Hh.push(t),zb(),t.$$.dirty.fill(0)),t.$$.dirty[e/31|0]|=1<<e%31}function Zb(t,e,n,o,l,h,_=null,u=[-1]){const I=Qm;Ef(t);const w=t.$$={fragment:null,ctx:[],props:h,update:Cf,not_equal:l,bound:Jy(),on_mount:[],on_destroy:[],on_disconnect:[],before_update:[],after_update:[],context:new Map(e.context||(I?I.$$.context:[])),callbacks:Jy(),dirty:u,skip_bound:!1,root:e.target||I.$$.root};_&&_(w.root);let D=!1;if(w.ctx=n?n(t,e.props||{},(k,G,...H)=>{const j=H.length?H[0]:G;return w.ctx&&l(w.ctx[k],w.ctx[k]=j)&&(!w.skip_bound&&w.bound[k]&&w.bound[k](j),D&&qb(t,k)),G}):[],w.update(),D=!0,lg(w.before_update),w.fragment=o?o(w.ctx):!1,e.target){if(e.hydrate){const k=Rb(e.target);w.fragment&&w.fragment.l(k),k.forEach(hv)}else w.fragment&&w.fragment.c();e.intro&&Vb(t.$$.fragment),Gb(t,e.target,e.anchor),pv()}Ef(I)}class Xb{constructor(){Ky(this,"$$"),Ky(this,"$$set")}$destroy(){jb(this,1),this.$destroy=Cf}$on(e,n){if(!cv(n))return Cf;const o=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return o.push(n),()=>{const l=o.indexOf(n);l!==-1&&o.splice(l,1)}}$set(e){this.$$set&&!Db(e)&&(this.$$.skip_bound=!0,this.$$set(e),this.$$.skip_bound=!1)}}const Yb="4";typeof window<"u"&&(window.__svelte||(window.__svelte={v:new Set})).v.add(Yb);function Wb(t){let e,n,o;return{c(){e=Qy("svg"),n=Qy("path"),tc(n,"stroke-width","4"),tc(n,"d","M 5,33.103579 C 5,17.607779 18.457,5 35,5 C 51.543,5 65,17.607779 65,33.103579 C 65,56.388679 40.4668,76.048179 36.6112,79.137779 C 36.3714,79.329879 36.2116,79.457979 36.1427,79.518879 C 35.8203,79.800879 35.4102,79.942779 35,79.942779 C 34.5899,79.942779 34.1797,79.800879 33.8575,79.518879 C 33.7886,79.457979 33.6289,79.330079 33.3893,79.138079 C 29.5346,76.049279 5,56.389379 5,33.103579 Z M 35.0001,49.386379 C 43.1917,49.386379 49.8323,42.646079 49.8323,34.331379 C 49.8323,26.016779 43.1917,19.276479 35.0001,19.276479 C 26.8085,19.276479 20.1679,26.016779 20.1679,34.331379 C 20.1679,42.646079 26.8085,49.386379 35.0001,49.386379 Z"),tc(n,"class","svelte-gzo3ar"),tc(e,"width",o=t[0]==="list"?20:void 0),tc(e,"viewBox","0 0 70 85"),tc(e,"fill","none"),tc(e,"class","svelte-gzo3ar"),Cd(e,"in-map",t[0]!=="list"),Cd(e,"list-icon",t[0]==="list")},m(l,h){Nb(l,e,h),kb(e,n)},p(l,[h]){h&1&&o!==(o=l[0]==="list"?20:void 0)&&tc(e,"width",o),h&1&&Cd(e,"in-map",l[0]!=="list"),h&1&&Cd(e,"list-icon",l[0]==="list")},i:Cf,o:Cf,d(l){l&&hv(e)}}}function Hb(t,e,n){let{displayIn:o}=e;return t.$$set=l=>{"displayIn"in l&&n(0,o=l.displayIn)},[o]}class $b extends Xb{constructor(e){super(),Zb(this,e,Hb,Wb,Lb,{displayIn:0})}}/**
 * splaytree v3.1.2
 * Fast Splay tree for Node and browser
 *
 * @author Alexander Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 *//*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */function Kb(t,e){var n={label:0,sent:function(){if(h[0]&1)throw h[1];return h[1]},trys:[],ops:[]},o,l,h,_;return _={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(_[Symbol.iterator]=function(){return this}),_;function u(w){return function(D){return I([w,D])}}function I(w){if(o)throw new TypeError("Generator is already executing.");for(;n;)try{if(o=1,l&&(h=w[0]&2?l.return:w[0]?l.throw||((h=l.return)&&h.call(l),0):l.next)&&!(h=h.call(l,w[1])).done)return h;switch(l=0,h&&(w=[w[0]&2,h.value]),w[0]){case 0:case 1:h=w;break;case 4:return n.label++,{value:w[1],done:!1};case 5:n.label++,l=w[1],w=[0];continue;case 7:w=n.ops.pop(),n.trys.pop();continue;default:if(h=n.trys,!(h=h.length>0&&h[h.length-1])&&(w[0]===6||w[0]===2)){n=0;continue}if(w[0]===3&&(!h||w[1]>h[0]&&w[1]<h[3])){n.label=w[1];break}if(w[0]===6&&n.label<h[1]){n.label=h[1],h=w;break}if(h&&n.label<h[2]){n.label=h[2],n.ops.push(w);break}h[2]&&n.ops.pop(),n.trys.pop();continue}w=e.call(t,n)}catch(D){w=[6,D],l=0}finally{o=h=0}if(w[0]&5)throw w[1];return{value:w[0]?w[1]:void 0,done:!0}}}var hc=function(){function t(e,n){this.next=null,this.key=e,this.data=n,this.left=null,this.right=null}return t}();function Jb(t,e){return t>e?1:t<e?-1:0}function ic(t,e,n){for(var o=new hc(null,null),l=o,h=o;;){var _=n(t,e.key);if(_<0){if(e.left===null)break;if(n(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,e.left===null)break}h.left=e,h=e,e=e.left}else if(_>0){if(e.right===null)break;if(n(t,e.right.key)>0){var u=e.right;if(e.right=u.left,u.left=e,e=u,e.right===null)break}l.right=e,l=e,e=e.right}else break}return l.right=e.left,h.left=e.right,e.left=o.right,e.right=o.left,e}function vm(t,e,n,o){var l=new hc(t,e);if(n===null)return l.left=l.right=null,l;n=ic(t,n,o);var h=o(t,n.key);return h<0?(l.left=n.left,l.right=n,n.left=null):h>=0&&(l.right=n.right,l.left=n,n.right=null),l}function n0(t,e,n){var o=null,l=null;if(e){e=ic(t,e,n);var h=n(e.key,t);h===0?(o=e.left,l=e.right):h<0?(l=e.right,e.right=null,o=e):(o=e.left,e.left=null,l=e)}return{left:o,right:l}}function Qb(t,e,n){return e===null?t:(t===null||(e=ic(t.key,e,n),e.left=t),e)}function Pm(t,e,n,o,l){if(t){o(""+e+(n?"└── ":"├── ")+l(t)+`
`);var h=e+(n?"    ":"│   ");t.left&&Pm(t.left,h,!1,o,l),t.right&&Pm(t.right,h,!0,o,l)}}var t_=function(){function t(e){e===void 0&&(e=Jb),this._root=null,this._size=0,this._comparator=e}return t.prototype.insert=function(e,n){return this._size++,this._root=vm(e,n,this._root,this._comparator)},t.prototype.add=function(e,n){var o=new hc(e,n);this._root===null&&(o.left=o.right=null,this._size++,this._root=o);var l=this._comparator,h=ic(e,this._root,l),_=l(e,h.key);return _===0?this._root=h:(_<0?(o.left=h.left,o.right=h,h.left=null):_>0&&(o.right=h.right,o.left=h,h.right=null),this._size++,this._root=o),this._root},t.prototype.remove=function(e){this._root=this._remove(e,this._root,this._comparator)},t.prototype._remove=function(e,n,o){var l;if(n===null)return null;n=ic(e,n,o);var h=o(e,n.key);return h===0?(n.left===null?l=n.right:(l=ic(e,n.left,o),l.right=n.right),this._size--,l):n},t.prototype.pop=function(){var e=this._root;if(e){for(;e.left;)e=e.left;return this._root=ic(e.key,this._root,this._comparator),this._root=this._remove(e.key,this._root,this._comparator),{key:e.key,data:e.data}}return null},t.prototype.findStatic=function(e){for(var n=this._root,o=this._comparator;n;){var l=o(e,n.key);if(l===0)return n;l<0?n=n.left:n=n.right}return null},t.prototype.find=function(e){return this._root&&(this._root=ic(e,this._root,this._comparator),this._comparator(e,this._root.key)!==0)?null:this._root},t.prototype.contains=function(e){for(var n=this._root,o=this._comparator;n;){var l=o(e,n.key);if(l===0)return!0;l<0?n=n.left:n=n.right}return!1},t.prototype.forEach=function(e,n){for(var o=this._root,l=[],h=!1;!h;)o!==null?(l.push(o),o=o.left):l.length!==0?(o=l.pop(),e.call(n,o),o=o.right):h=!0;return this},t.prototype.range=function(e,n,o,l){for(var h=[],_=this._comparator,u=this._root,I;h.length!==0||u;)if(u)h.push(u),u=u.left;else{if(u=h.pop(),I=_(u.key,n),I>0)break;if(_(u.key,e)>=0&&o.call(l,u))return this;u=u.right}return this},t.prototype.keys=function(){var e=[];return this.forEach(function(n){var o=n.key;return e.push(o)}),e},t.prototype.values=function(){var e=[];return this.forEach(function(n){var o=n.data;return e.push(o)}),e},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.left;)e=e.left;return e},t.prototype.maxNode=function(e){if(e===void 0&&(e=this._root),e)for(;e.right;)e=e.right;return e},t.prototype.at=function(e){for(var n=this._root,o=!1,l=0,h=[];!o;)if(n)h.push(n),n=n.left;else if(h.length>0){if(n=h.pop(),l===e)return n;l++,n=n.right}else o=!0;return null},t.prototype.next=function(e){var n=this._root,o=null;if(e.right){for(o=e.right;o.left;)o=o.left;return o}for(var l=this._comparator;n;){var h=l(e.key,n.key);if(h===0)break;h<0?(o=n,n=n.left):n=n.right}return o},t.prototype.prev=function(e){var n=this._root,o=null;if(e.left!==null){for(o=e.left;o.right;)o=o.right;return o}for(var l=this._comparator;n;){var h=l(e.key,n.key);if(h===0)break;h<0?n=n.left:(o=n,n=n.right)}return o},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return ew(this._root)},t.prototype.load=function(e,n,o){n===void 0&&(n=[]),o===void 0&&(o=!1);var l=e.length,h=this._comparator;if(o&&Lm(e,n,0,l-1,h),this._root===null)this._root=Mm(e,n,0,l),this._size=l;else{var _=nw(this.toList(),tw(e,n),h);l=this._size+l,this._root=Am({head:_},0,l)}return this},t.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(e){e===void 0&&(e=function(o){return String(o.key)});var n=[];return Pm(this._root,"",!0,function(o){return n.push(o)},e),n.join("")},t.prototype.update=function(e,n,o){var l=this._comparator,h=n0(e,this._root,l),_=h.left,u=h.right;l(e,n)<0?u=vm(n,o,u,l):_=vm(n,o,_,l),this._root=Qb(_,u,l)},t.prototype.split=function(e){return n0(e,this._root,this._comparator)},t.prototype[Symbol.iterator]=function(){var e,n,o;return Kb(this,function(l){switch(l.label){case 0:e=this._root,n=[],o=!1,l.label=1;case 1:return o?[3,6]:e===null?[3,2]:(n.push(e),e=e.left,[3,5]);case 2:return n.length===0?[3,4]:(e=n.pop(),[4,e]);case 3:return l.sent(),e=e.right,[3,5];case 4:o=!0,l.label=5;case 5:return[3,1];case 6:return[2]}})},t}();function Mm(t,e,n,o){var l=o-n;if(l>0){var h=n+Math.floor(l/2),_=t[h],u=e[h],I=new hc(_,u);return I.left=Mm(t,e,n,h),I.right=Mm(t,e,h+1,o),I}return null}function tw(t,e){for(var n=new hc(null,null),o=n,l=0;l<t.length;l++)o=o.next=new hc(t[l],e[l]);return o.next=null,n.next}function ew(t){for(var e=t,n=[],o=!1,l=new hc(null,null),h=l;!o;)e?(n.push(e),e=e.left):n.length>0?(e=h=h.next=n.pop(),e=e.right):o=!0;return h.next=null,l.next}function Am(t,e,n){var o=n-e;if(o>0){var l=e+Math.floor(o/2),h=Am(t,e,l),_=t.head;return _.left=h,t.head=t.head.next,_.right=Am(t,l+1,n),_}return null}function nw(t,e,n){for(var o=new hc(null,null),l=o,h=t,_=e;h!==null&&_!==null;)n(h.key,_.key)<0?(l.next=h,h=h.next):(l.next=_,_=_.next),l=l.next;return h!==null?l.next=h:_!==null&&(l.next=_),o.next}function Lm(t,e,n,o,l){if(!(n>=o)){for(var h=t[n+o>>1],_=n-1,u=o+1;;){do _++;while(l(t[_],h)<0);do u--;while(l(t[u],h)>0);if(_>=u)break;var I=t[_];t[_]=t[u],t[u]=I,I=e[_],e[_]=e[u],e[u]=I}Lm(t,e,n,u,l),Lm(t,e,u+1,o,l)}}function Za(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r0(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function ws(t,e,n){return e&&r0(t.prototype,e),n&&r0(t,n),t}var hf=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},Dm=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,o=t.ur.x<e.ur.x?t.ur.x:e.ur.x,l=t.ll.y<e.ll.y?e.ll.y:t.ll.y,h=t.ur.y<e.ur.y?t.ur.y:e.ur.y;return{ll:{x:n,y:l},ur:{x:o,y:h}}},sc=Number.EPSILON;sc===void 0&&(sc=Math.pow(2,-52));var rw=sc*sc,km=function(t,e){if(-sc<t&&t<sc&&-sc<e&&e<sc)return 0;var n=t-e;return n*n<rw*t*e?0:t<e?-1:1},iw=function(){function t(){Za(this,t),this.reset()}return ws(t,[{key:"reset",value:function(){this.xRounder=new i0,this.yRounder=new i0}},{key:"round",value:function(e,n){return{x:this.xRounder.round(e),y:this.yRounder.round(n)}}}]),t}(),i0=function(){function t(){Za(this,t),this.tree=new t_,this.round(0)}return ws(t,[{key:"round",value:function(e){var n=this.tree.add(e),o=this.tree.prev(n);if(o!==null&&km(n.key,o.key)===0)return this.tree.remove(e),o.key;var l=this.tree.next(n);return l!==null&&km(n.key,l.key)===0?(this.tree.remove(e),l.key):e}}]),t}(),Pf=new iw,If=function(t,e){return t.x*e.y-t.y*e.x},fv=function(t,e){return t.x*e.x+t.y*e.y},o0=function(t,e,n){var o={x:e.x-t.x,y:e.y-t.y},l={x:n.x-t.x,y:n.y-t.y},h=If(o,l);return km(h,0)},Zd=function(t){return Math.sqrt(fv(t,t))},ow=function(t,e,n){var o={x:e.x-t.x,y:e.y-t.y},l={x:n.x-t.x,y:n.y-t.y};return If(l,o)/Zd(l)/Zd(o)},sw=function(t,e,n){var o={x:e.x-t.x,y:e.y-t.y},l={x:n.x-t.x,y:n.y-t.y};return fv(l,o)/Zd(l)/Zd(o)},s0=function(t,e,n){return e.y===0?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},a0=function(t,e,n){return e.x===0?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},aw=function(t,e,n,o){if(e.x===0)return a0(n,o,t.x);if(o.x===0)return a0(t,e,n.x);if(e.y===0)return s0(n,o,t.y);if(o.y===0)return s0(t,e,n.y);var l=If(e,o);if(l==0)return null;var h={x:n.x-t.x,y:n.y-t.y},_=If(h,e)/l,u=If(h,o)/l,I=t.x+u*e.x,w=n.x+_*o.x,D=t.y+u*e.y,k=n.y+_*o.y,G=(I+w)/2,H=(D+k)/2;return{x:G,y:H}},Vl=function(){ws(t,null,[{key:"compare",value:function(e,n){var o=t.comparePoints(e.point,n.point);return o!==0?o:(e.point!==n.point&&e.link(n),e.isLeft!==n.isLeft?e.isLeft?1:-1:Xd.compare(e.segment,n.segment))}},{key:"comparePoints",value:function(e,n){return e.x<n.x?-1:e.x>n.x?1:e.y<n.y?-1:e.y>n.y?1:0}}]);function t(e,n){Za(this,t),e.events===void 0?e.events=[this]:e.events.push(this),this.point=e,this.isLeft=n}return ws(t,[{key:"link",value:function(e){if(e.point===this.point)throw new Error("Tried to link already linked events");for(var n=e.point.events,o=0,l=n.length;o<l;o++){var h=n[o];this.point.events.push(h),h.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var e=this.point.events.length,n=0;n<e;n++){var o=this.point.events[n];if(o.segment.consumedBy===void 0)for(var l=n+1;l<e;l++){var h=this.point.events[l];h.consumedBy===void 0&&o.otherSE.point.events===h.otherSE.point.events&&o.segment.consume(h.segment)}}}},{key:"getAvailableLinkedEvents",value:function(){for(var e=[],n=0,o=this.point.events.length;n<o;n++){var l=this.point.events[n];l!==this&&!l.segment.ringOut&&l.segment.isInResult()&&e.push(l)}return e}},{key:"getLeftmostComparator",value:function(e){var n=this,o=new Map,l=function(h){var _=h.otherSE;o.set(h,{sine:ow(n.point,e.point,_.point),cosine:sw(n.point,e.point,_.point)})};return function(h,_){o.has(h)||l(h),o.has(_)||l(_);var u=o.get(h),I=u.sine,w=u.cosine,D=o.get(_),k=D.sine,G=D.cosine;return I>=0&&k>=0?w<G?1:w>G?-1:0:I<0&&k<0?w<G?-1:w>G?1:0:k<I?-1:k>I?1:0}}}]),t}(),lw=0,Xd=function(){ws(t,null,[{key:"compare",value:function(e,n){var o=e.leftSE.point.x,l=n.leftSE.point.x,h=e.rightSE.point.x,_=n.rightSE.point.x;if(_<o)return 1;if(h<l)return-1;var u=e.leftSE.point.y,I=n.leftSE.point.y,w=e.rightSE.point.y,D=n.rightSE.point.y;if(o<l){if(I<u&&I<w)return 1;if(I>u&&I>w)return-1;var k=e.comparePoint(n.leftSE.point);if(k<0)return 1;if(k>0)return-1;var G=n.comparePoint(e.rightSE.point);return G!==0?G:-1}if(o>l){if(u<I&&u<D)return-1;if(u>I&&u>D)return 1;var H=n.comparePoint(e.leftSE.point);if(H!==0)return H;var j=e.comparePoint(n.rightSE.point);return j<0?1:j>0?-1:1}if(u<I)return-1;if(u>I)return 1;if(h<_){var K=n.comparePoint(e.rightSE.point);if(K!==0)return K}if(h>_){var lt=e.comparePoint(n.rightSE.point);if(lt<0)return 1;if(lt>0)return-1}if(h!==_){var dt=w-u,xt=h-o,gt=D-I,yt=_-l;if(dt>xt&&gt<yt)return 1;if(dt<xt&&gt>yt)return-1}return h>_?1:h<_||w<D?-1:w>D?1:e.id<n.id?-1:e.id>n.id?1:0}}]);function t(e,n,o,l){Za(this,t),this.id=++lw,this.leftSE=e,e.segment=this,e.otherSE=n,this.rightSE=n,n.segment=this,n.otherSE=e,this.rings=o,this.windings=l}return ws(t,[{key:"replaceRightSE",value:function(e){this.rightSE=e,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var e=this.leftSE.point.y,n=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:e<n?e:n},ur:{x:this.rightSE.point.x,y:e>n?e:n}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(e){return e.x===this.leftSE.point.x&&e.y===this.leftSE.point.y||e.x===this.rightSE.point.x&&e.y===this.rightSE.point.y}},{key:"comparePoint",value:function(e){if(this.isAnEndpoint(e))return 0;var n=this.leftSE.point,o=this.rightSE.point,l=this.vector();if(n.x===o.x)return e.x===n.x?0:e.x<n.x?1:-1;var h=(e.y-n.y)/l.y,_=n.x+h*l.x;if(e.x===_)return 0;var u=(e.x-n.x)/l.x,I=n.y+u*l.y;return e.y===I?0:e.y<I?-1:1}},{key:"getIntersection",value:function(e){var n=this.bbox(),o=e.bbox(),l=Dm(n,o);if(l===null)return null;var h=this.leftSE.point,_=this.rightSE.point,u=e.leftSE.point,I=e.rightSE.point,w=hf(n,u)&&this.comparePoint(u)===0,D=hf(o,h)&&e.comparePoint(h)===0,k=hf(n,I)&&this.comparePoint(I)===0,G=hf(o,_)&&e.comparePoint(_)===0;if(D&&w)return G&&!k?_:!G&&k?I:null;if(D)return k&&h.x===I.x&&h.y===I.y?null:h;if(w)return G&&_.x===u.x&&_.y===u.y?null:u;if(G&&k)return null;if(G)return _;if(k)return I;var H=aw(h,this.vector(),u,e.vector());return H===null||!hf(l,H)?null:Pf.round(H.x,H.y)}},{key:"split",value:function(e){var n=[],o=e.events!==void 0,l=new Vl(e,!0),h=new Vl(e,!1),_=this.rightSE;this.replaceRightSE(h),n.push(h),n.push(l);var u=new t(l,_,this.rings.slice(),this.windings.slice());return Vl.comparePoints(u.leftSE.point,u.rightSE.point)>0&&u.swapEvents(),Vl.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),o&&(l.checkForConsuming(),h.checkForConsuming()),n}},{key:"swapEvents",value:function(){var e=this.rightSE;this.rightSE=this.leftSE,this.leftSE=e,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var n=0,o=this.windings.length;n<o;n++)this.windings[n]*=-1}},{key:"consume",value:function(e){for(var n=this,o=e;n.consumedBy;)n=n.consumedBy;for(;o.consumedBy;)o=o.consumedBy;var l=t.compare(n,o);if(l!==0){if(l>0){var h=n;n=o,o=h}if(n.prev===o){var _=n;n=o,o=_}for(var u=0,I=o.rings.length;u<I;u++){var w=o.rings[u],D=o.windings[u],k=n.rings.indexOf(w);k===-1?(n.rings.push(w),n.windings.push(D)):n.windings[k]+=D}o.rings=null,o.windings=null,o.consumedBy=n,o.leftSE.consumedBy=n.leftSE,o.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}},{key:"beforeState",value:function(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{var e=this.prev.consumedBy||this.prev;this._beforeState=e.afterState()}return this._beforeState}},{key:"afterState",value:function(){if(this._afterState!==void 0)return this._afterState;var e=this.beforeState();this._afterState={rings:e.rings.slice(0),windings:e.windings.slice(0),multiPolys:[]};for(var n=this._afterState.rings,o=this._afterState.windings,l=this._afterState.multiPolys,h=0,_=this.rings.length;h<_;h++){var u=this.rings[h],I=this.windings[h],w=n.indexOf(u);w===-1?(n.push(u),o.push(I)):o[w]+=I}for(var D=[],k=[],G=0,H=n.length;G<H;G++)if(o[G]!==0){var j=n[G],K=j.poly;if(k.indexOf(K)===-1)if(j.isExterior)D.push(K);else{k.indexOf(K)===-1&&k.push(K);var lt=D.indexOf(j.poly);lt!==-1&&D.splice(lt,1)}}for(var dt=0,xt=D.length;dt<xt;dt++){var gt=D[dt].multiPoly;l.indexOf(gt)===-1&&l.push(gt)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;var e=this.beforeState().multiPolys,n=this.afterState().multiPolys;switch(pl.type){case"union":{var o=e.length===0,l=n.length===0;this._isInResult=o!==l;break}case"intersection":{var h,_;e.length<n.length?(h=e.length,_=n.length):(h=n.length,_=e.length),this._isInResult=_===pl.numMultiPolys&&h<_;break}case"xor":{var u=Math.abs(e.length-n.length);this._isInResult=u%2===1;break}case"difference":{var I=function(w){return w.length===1&&w[0].isSubject};this._isInResult=I(e)!==I(n);break}default:throw new Error("Unrecognized operation type found ".concat(pl.type))}return this._isInResult}}],[{key:"fromRing",value:function(e,n,o){var l,h,_,u=Vl.comparePoints(e,n);if(u<0)l=e,h=n,_=1;else if(u>0)l=n,h=e,_=-1;else throw new Error("Tried to create degenerate segment at [".concat(e.x,", ").concat(e.y,"]"));var I=new Vl(l,!0),w=new Vl(h,!1);return new t(I,w,[o],[_])}}]),t}(),l0=function(){function t(e,n,o){if(Za(this,t),!Array.isArray(e)||e.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=n,this.isExterior=o,this.segments=[],typeof e[0][0]!="number"||typeof e[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var l=Pf.round(e[0][0],e[0][1]);this.bbox={ll:{x:l.x,y:l.y},ur:{x:l.x,y:l.y}};for(var h=l,_=1,u=e.length;_<u;_++){if(typeof e[_][0]!="number"||typeof e[_][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var I=Pf.round(e[_][0],e[_][1]);I.x===h.x&&I.y===h.y||(this.segments.push(Xd.fromRing(h,I,this)),I.x<this.bbox.ll.x&&(this.bbox.ll.x=I.x),I.y<this.bbox.ll.y&&(this.bbox.ll.y=I.y),I.x>this.bbox.ur.x&&(this.bbox.ur.x=I.x),I.y>this.bbox.ur.y&&(this.bbox.ur.y=I.y),h=I)}(l.x!==h.x||l.y!==h.y)&&this.segments.push(Xd.fromRing(h,l,this))}return ws(t,[{key:"getSweepEvents",value:function(){for(var e=[],n=0,o=this.segments.length;n<o;n++){var l=this.segments[n];e.push(l.leftSE),e.push(l.rightSE)}return e}}]),t}(),uw=function(){function t(e,n){if(Za(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new l0(e[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var o=1,l=e.length;o<l;o++){var h=new l0(e[o],this,!1);h.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=h.bbox.ur.y),this.interiorRings.push(h)}this.multiPoly=n}return ws(t,[{key:"getSweepEvents",value:function(){for(var e=this.exteriorRing.getSweepEvents(),n=0,o=this.interiorRings.length;n<o;n++)for(var l=this.interiorRings[n].getSweepEvents(),h=0,_=l.length;h<_;h++)e.push(l[h]);return e}}]),t}(),u0=function(){function t(e,n){if(Za(this,t),!Array.isArray(e))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof e[0][0][0]=="number"&&(e=[e])}catch{}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var o=0,l=e.length;o<l;o++){var h=new uw(e[o],this);h.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=h.bbox.ll.x),h.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=h.bbox.ll.y),h.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=h.bbox.ur.x),h.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=h.bbox.ur.y),this.polys.push(h)}this.isSubject=n}return ws(t,[{key:"getSweepEvents",value:function(){for(var e=[],n=0,o=this.polys.length;n<o;n++)for(var l=this.polys[n].getSweepEvents(),h=0,_=l.length;h<_;h++)e.push(l[h]);return e}}]),t}(),cw=function(){ws(t,null,[{key:"factory",value:function(e){for(var n=[],o=0,l=e.length;o<l;o++){var h=e[o];if(!(!h.isInResult()||h.ringOut)){for(var _=null,u=h.leftSE,I=h.rightSE,w=[u],D=u.point,k=[];_=u,u=I,w.push(u),u.point!==D;)for(;;){var G=u.getAvailableLinkedEvents();if(G.length===0){var H=w[0].point,j=w[w.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(H.x,",")+" ".concat(H.y,"]. Last matching segment found ends at")+" [".concat(j.x,", ").concat(j.y,"]."))}if(G.length===1){I=G[0].otherSE;break}for(var K=null,lt=0,dt=k.length;lt<dt;lt++)if(k[lt].point===u.point){K=lt;break}if(K!==null){var xt=k.splice(K)[0],gt=w.splice(xt.index);gt.unshift(gt[0].otherSE),n.push(new t(gt.reverse()));continue}k.push({index:w.length,point:u.point});var yt=u.getLeftmostComparator(_);I=G.sort(yt)[0].otherSE;break}n.push(new t(w))}}return n}}]);function t(e){Za(this,t),this.events=e;for(var n=0,o=e.length;n<o;n++)e[n].segment.ringOut=this;this.poly=null}return ws(t,[{key:"getGeom",value:function(){for(var e=this.events[0].point,n=[e],o=1,l=this.events.length-1;o<l;o++){var h=this.events[o].point,_=this.events[o+1].point;o0(h,e,_)!==0&&(n.push(h),e=h)}if(n.length===1)return null;var u=n[0],I=n[1];o0(u,e,I)===0&&n.shift(),n.push(n[0]);for(var w=this.isExteriorRing()?1:-1,D=this.isExteriorRing()?0:n.length-1,k=this.isExteriorRing()?n.length:-1,G=[],H=D;H!=k;H+=w)G.push([n[H].x,n[H].y]);return G}},{key:"isExteriorRing",value:function(){if(this._isExteriorRing===void 0){var e=this.enclosingRing();this._isExteriorRing=e?!e.isExteriorRing():!0}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var e=this.events[0],n=1,o=this.events.length;n<o;n++){var l=this.events[n];Vl.compare(e,l)>0&&(e=l)}for(var h=e.segment.prevInResult(),_=h?h.prevInResult():null;;){if(!h)return null;if(!_)return h.ringOut;if(_.ringOut!==h.ringOut)return _.ringOut.enclosingRing()!==h.ringOut?h.ringOut:h.ringOut.enclosingRing();h=_.prevInResult(),_=h?h.prevInResult():null}}}]),t}(),c0=function(){function t(e){Za(this,t),this.exteriorRing=e,e.poly=this,this.interiorRings=[]}return ws(t,[{key:"addInterior",value:function(e){this.interiorRings.push(e),e.poly=this}},{key:"getGeom",value:function(){var e=[this.exteriorRing.getGeom()];if(e[0]===null)return null;for(var n=0,o=this.interiorRings.length;n<o;n++){var l=this.interiorRings[n].getGeom();l!==null&&e.push(l)}return e}}]),t}(),hw=function(){function t(e){Za(this,t),this.rings=e,this.polys=this._composePolys(e)}return ws(t,[{key:"getGeom",value:function(){for(var e=[],n=0,o=this.polys.length;n<o;n++){var l=this.polys[n].getGeom();l!==null&&e.push(l)}return e}},{key:"_composePolys",value:function(e){for(var n=[],o=0,l=e.length;o<l;o++){var h=e[o];if(!h.poly)if(h.isExteriorRing())n.push(new c0(h));else{var _=h.enclosingRing();_.poly||n.push(new c0(_)),_.poly.addInterior(h)}}return n}}]),t}(),pw=function(){function t(e){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Xd.compare;Za(this,t),this.queue=e,this.tree=new t_(n),this.segments=[]}return ws(t,[{key:"process",value:function(e){var n=e.segment,o=[];if(e.consumedBy)return e.isLeft?this.queue.remove(e.otherSE):this.tree.remove(n),o;var l=e.isLeft?this.tree.insert(n):this.tree.find(n);if(!l)throw new Error("Unable to find segment #".concat(n.id," ")+"[".concat(n.leftSE.point.x,", ").concat(n.leftSE.point.y,"] -> ")+"[".concat(n.rightSE.point.x,", ").concat(n.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");for(var h=l,_=l,u=void 0,I=void 0;u===void 0;)h=this.tree.prev(h),h===null?u=null:h.key.consumedBy===void 0&&(u=h.key);for(;I===void 0;)_=this.tree.next(_),_===null?I=null:_.key.consumedBy===void 0&&(I=_.key);if(e.isLeft){var w=null;if(u){var D=u.getIntersection(n);if(D!==null&&(n.isAnEndpoint(D)||(w=D),!u.isAnEndpoint(D)))for(var k=this._splitSafely(u,D),G=0,H=k.length;G<H;G++)o.push(k[G])}var j=null;if(I){var K=I.getIntersection(n);if(K!==null&&(n.isAnEndpoint(K)||(j=K),!I.isAnEndpoint(K)))for(var lt=this._splitSafely(I,K),dt=0,xt=lt.length;dt<xt;dt++)o.push(lt[dt])}if(w!==null||j!==null){var gt=null;if(w===null)gt=j;else if(j===null)gt=w;else{var yt=Vl.comparePoints(w,j);gt=yt<=0?w:j}this.queue.remove(n.rightSE),o.push(n.rightSE);for(var Nt=n.split(gt),Gt=0,Ut=Nt.length;Gt<Ut;Gt++)o.push(Nt[Gt])}o.length>0?(this.tree.remove(n),o.push(e)):(this.segments.push(n),n.prev=u)}else{if(u&&I){var Zt=u.getIntersection(I);if(Zt!==null){if(!u.isAnEndpoint(Zt))for(var qt=this._splitSafely(u,Zt),Qt=0,ie=qt.length;Qt<ie;Qt++)o.push(qt[Qt]);if(!I.isAnEndpoint(Zt))for(var ve=this._splitSafely(I,Zt),Ue=0,Rt=ve.length;Ue<Rt;Ue++)o.push(ve[Ue])}}this.tree.remove(n)}return o}},{key:"_splitSafely",value:function(e,n){this.tree.remove(e);var o=e.rightSE;this.queue.remove(o);var l=e.split(n);return l.push(o),e.consumedBy===void 0&&this.tree.insert(e),l}}]),t}(),h0=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,fw=typeof process<"u"&&{}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,dw=function(){function t(){Za(this,t)}return ws(t,[{key:"run",value:function(e,n,o){pl.type=e,Pf.reset();for(var l=[new u0(n,!0)],h=0,_=o.length;h<_;h++)l.push(new u0(o[h],!1));if(pl.numMultiPolys=l.length,pl.type==="difference")for(var u=l[0],I=1;I<l.length;)Dm(l[I].bbox,u.bbox)!==null?I++:l.splice(I,1);if(pl.type==="intersection"){for(var w=0,D=l.length;w<D;w++)for(var k=l[w],G=w+1,H=l.length;G<H;G++)if(Dm(k.bbox,l[G].bbox)===null)return[]}for(var j=new t_(Vl.compare),K=0,lt=l.length;K<lt;K++)for(var dt=l[K].getSweepEvents(),xt=0,gt=dt.length;xt<gt;xt++)if(j.insert(dt[xt]),j.size>h0)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");for(var yt=new pw(j),Nt=j.size,Gt=j.pop();Gt;){var Ut=Gt.key;if(j.size===Nt){var Zt=Ut.segment;throw new Error("Unable to pop() ".concat(Ut.isLeft?"left":"right"," SweepEvent ")+"[".concat(Ut.point.x,", ").concat(Ut.point.y,"] from segment #").concat(Zt.id," ")+"[".concat(Zt.leftSE.point.x,", ").concat(Zt.leftSE.point.y,"] -> ")+"[".concat(Zt.rightSE.point.x,", ").concat(Zt.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(j.size>h0)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(yt.segments.length>fw)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var qt=yt.process(Ut),Qt=0,ie=qt.length;Qt<ie;Qt++){var ve=qt[Qt];ve.consumedBy===void 0&&j.insert(ve)}Nt=j.size,Gt=j.pop()}Pf.reset();var Ue=cw.factory(yt.segments),Rt=new hw(Ue);return Rt.getGeom()}}]),t}(),pl=new dw,gw=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return pl.run("union",t,n)},mw=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return pl.run("intersection",t,n)},_w=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return pl.run("xor",t,n)},yw=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),o=1;o<e;o++)n[o-1]=arguments[o];return pl.run("difference",t,n)},dv={union:gw,intersection:mw,xor:_w,difference:yw},ys=63710088e-1,gv={centimeters:ys*100,centimetres:ys*100,degrees:ys/111325,feet:ys*3.28084,inches:ys*39.37,kilometers:ys/1e3,kilometres:ys/1e3,meters:ys,metres:ys,miles:ys/1609.344,millimeters:ys*1e3,millimetres:ys*1e3,nauticalmiles:ys/1852,radians:1,yards:ys*1.0936};function ug(t,e,n){n===void 0&&(n={});var o={type:"Feature"};return(n.id===0||n.id)&&(o.id=n.id),n.bbox&&(o.bbox=n.bbox),o.properties=e||{},o.geometry=t,o}function vw(t,e,n){if(n===void 0&&(n={}),!t)throw new Error("coordinates is required");if(!Array.isArray(t))throw new Error("coordinates must be an Array");if(t.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!p0(t[0])||!p0(t[1]))throw new Error("coordinates must contain numbers");var o={type:"Point",coordinates:t};return ug(o,e,n)}function mv(t,e,n){n===void 0&&(n={});for(var o=0,l=t;o<l.length;o++){var h=l[o];if(h.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var _=0;_<h[h.length-1].length;_++)if(h[h.length-1][_]!==h[0][_])throw new Error("First and last Position are not equivalent.")}var u={type:"Polygon",coordinates:t};return ug(u,e,n)}function Nm(t,e){e===void 0&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function _v(t,e,n){n===void 0&&(n={});var o={type:"MultiPolygon",coordinates:t};return ug(o,e,n)}function xw(t,e){e===void 0&&(e="kilometers");var n=gv[e];if(!n)throw new Error(e+" units is invalid");return t*n}function bw(t,e){e===void 0&&(e="kilometers");var n=gv[e];if(!n)throw new Error(e+" units is invalid");return t/n}function p0(t){return!isNaN(t)&&t!==null&&!Array.isArray(t)}function Yd(t){return t.type==="Feature"?t.geometry:t}function ww(t,e,n){n===void 0&&(n={});var o=Yd(t),l=Yd(e),h=dv.union(o.coordinates,l.coordinates);return h.length===0?null:h.length===1?mv(h[0],n.properties):_v(h,n.properties)}function yv(t,e,n){if(t!==null)for(var o,l,h,_,u,I,w,D=0,k=0,G,H=t.type,j=H==="FeatureCollection",K=H==="Feature",lt=j?t.features.length:1,dt=0;dt<lt;dt++){w=j?t.features[dt].geometry:K?t.geometry:t,G=w?w.type==="GeometryCollection":!1,u=G?w.geometries.length:1;for(var xt=0;xt<u;xt++){var gt=0,yt=0;if(_=G?w.geometries[xt]:w,_!==null){I=_.coordinates;var Nt=_.type;switch(D=n&&(Nt==="Polygon"||Nt==="MultiPolygon")?1:0,Nt){case null:break;case"Point":if(e(I,k,dt,gt,yt)===!1)return!1;k++,gt++;break;case"LineString":case"MultiPoint":for(o=0;o<I.length;o++){if(e(I[o],k,dt,gt,yt)===!1)return!1;k++,Nt==="MultiPoint"&&gt++}Nt==="LineString"&&gt++;break;case"Polygon":case"MultiLineString":for(o=0;o<I.length;o++){for(l=0;l<I[o].length-D;l++){if(e(I[o][l],k,dt,gt,yt)===!1)return!1;k++}Nt==="MultiLineString"&&gt++,Nt==="Polygon"&&yt++}Nt==="Polygon"&&gt++;break;case"MultiPolygon":for(o=0;o<I.length;o++){for(yt=0,l=0;l<I[o].length;l++){for(h=0;h<I[o][l].length-D;h++){if(e(I[o][l][h],k,dt,gt,yt)===!1)return!1;k++}yt++}gt++}break;case"GeometryCollection":for(o=0;o<_.geometries.length;o++)if(yv(_.geometries[o],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function f0(t,e){if(t.type==="Feature")e(t,0);else if(t.type==="FeatureCollection")for(var n=0;n<t.features.length&&e(t.features[n],n)!==!1;n++);}function vv(t,e){var n,o,l,h,_,u,I,w,D,k,G=0,H=t.type==="FeatureCollection",j=t.type==="Feature",K=H?t.features.length:1;for(n=0;n<K;n++){for(u=H?t.features[n].geometry:j?t.geometry:t,w=H?t.features[n].properties:j?t.properties:{},D=H?t.features[n].bbox:j?t.bbox:void 0,k=H?t.features[n].id:j?t.id:void 0,I=u?u.type==="GeometryCollection":!1,_=I?u.geometries.length:1,l=0;l<_;l++){if(h=I?u.geometries[l]:u,h===null){if(e(null,G,w,D,k)===!1)return!1;continue}switch(h.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(e(h,G,w,D,k)===!1)return!1;break}case"GeometryCollection":{for(o=0;o<h.geometries.length;o++)if(e(h.geometries[o],G,w,D,k)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}G++}}function Rm(t){var e=[1/0,1/0,-1/0,-1/0];return yv(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}Rm.default=Rm;function Ew(t,e){e===void 0&&(e={});var n=Rm(t),o=(n[0]+n[2])/2,l=(n[1]+n[3])/2;return vw([o,l],e.properties,e)}"fill"in Array.prototype||Object.defineProperty(Array.prototype,"fill",{configurable:!0,value:function(t){if(this===void 0||this===null)throw new TypeError(this+" is not an object");var e=Object(this),n=Math.max(Math.min(e.length,9007199254740991),0)||0,o=1 in arguments&&parseInt(Number(arguments[1]),10)||0;o=o<0?Math.max(n+o,0):Math.min(o,n);var l=2 in arguments&&arguments[2]!==void 0?parseInt(Number(arguments[2]),10)||0:n;for(l=l<0?Math.max(n+arguments[2],0):Math.min(l,n);o<l;)e[o]=t,++o;return e},writable:!0});Number.isFinite=Number.isFinite||function(t){return typeof t=="number"&&isFinite(t)};Number.isInteger=Number.isInteger||function(t){return typeof t=="number"&&isFinite(t)&&Math.floor(t)===t};Number.parseFloat=Number.parseFloat||parseFloat;Number.isNaN=Number.isNaN||function(t){return t!==t};Math.trunc=Math.trunc||function(t){return t<0?Math.ceil(t):Math.floor(t)};var Yc=function(){};Yc.prototype.interfaces_=function(){return[]};Yc.prototype.getClass=function(){return Yc};Yc.prototype.equalsWithTolerance=function(t,e,n){return Math.abs(t-e)<=n};var Ir=function(t){function e(n){t.call(this,n),this.name="IllegalArgumentException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Je=function(){},xv={MAX_VALUE:{configurable:!0}};Je.isNaN=function(t){return Number.isNaN(t)};Je.doubleToLongBits=function(t){return t};Je.longBitsToDouble=function(t){return t};Je.isInfinite=function(t){return!Number.isFinite(t)};xv.MAX_VALUE.get=function(){return Number.MAX_VALUE};Object.defineProperties(Je,xv);var Vs=function(){},cg=function(){},np=function(){};function Gs(){}var It=function t(){if(this.x=null,this.y=null,this.z=null,arguments.length===0)this.x=0,this.y=0,this.z=t.NULL_ORDINATE;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.z=e.z}else arguments.length===2?(this.x=arguments[0],this.y=arguments[1],this.z=t.NULL_ORDINATE):arguments.length===3&&(this.x=arguments[0],this.y=arguments[1],this.z=arguments[2])},ah={DimensionalComparator:{configurable:!0},serialVersionUID:{configurable:!0},NULL_ORDINATE:{configurable:!0},X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0}};It.prototype.setOrdinate=function(t,e){switch(t){case It.X:this.x=e;break;case It.Y:this.y=e;break;case It.Z:this.z=e;break;default:throw new Ir("Invalid ordinate index: "+t)}};It.prototype.equals2D=function(){if(arguments.length===1){var t=arguments[0];return!(this.x!==t.x||this.y!==t.y)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return!(!Yc.equalsWithTolerance(this.x,e.x,n)||!Yc.equalsWithTolerance(this.y,e.y,n))}};It.prototype.getOrdinate=function(t){switch(t){case It.X:return this.x;case It.Y:return this.y;case It.Z:return this.z}throw new Ir("Invalid ordinate index: "+t)};It.prototype.equals3D=function(t){return this.x===t.x&&this.y===t.y&&(this.z===t.z||Je.isNaN(this.z))&&Je.isNaN(t.z)};It.prototype.equals=function(t){return t instanceof It?this.equals2D(t):!1};It.prototype.equalInZ=function(t,e){return Yc.equalsWithTolerance(this.z,t.z,e)};It.prototype.compareTo=function(t){var e=t;return this.x<e.x?-1:this.x>e.x?1:this.y<e.y?-1:this.y>e.y?1:0};It.prototype.clone=function(){};It.prototype.copy=function(){return new It(this)};It.prototype.toString=function(){return"("+this.x+", "+this.y+", "+this.z+")"};It.prototype.distance3D=function(t){var e=this.x-t.x,n=this.y-t.y,o=this.z-t.z;return Math.sqrt(e*e+n*n+o*o)};It.prototype.distance=function(t){var e=this.x-t.x,n=this.y-t.y;return Math.sqrt(e*e+n*n)};It.prototype.hashCode=function(){var t=17;return t=37*t+It.hashCode(this.x),t=37*t+It.hashCode(this.y),t};It.prototype.setCoordinate=function(t){this.x=t.x,this.y=t.y,this.z=t.z};It.prototype.interfaces_=function(){return[Vs,cg,Gs]};It.prototype.getClass=function(){return It};It.hashCode=function(){if(arguments.length===1){var t=arguments[0],e=Je.doubleToLongBits(t);return Math.trunc((e^e)>>>32)}};ah.DimensionalComparator.get=function(){return xu};ah.serialVersionUID.get=function(){return 6683108902428367e3};ah.NULL_ORDINATE.get=function(){return Je.NaN};ah.X.get=function(){return 0};ah.Y.get=function(){return 1};ah.Z.get=function(){return 2};Object.defineProperties(It,ah);var xu=function(t){if(this._dimensionsToTest=2,arguments.length!==0&&arguments.length===1){var e=arguments[0];if(e!==2&&e!==3)throw new Ir("only 2 or 3 dimensions may be specified");this._dimensionsToTest=e}};xu.prototype.compare=function(t,e){var n=t,o=e,l=xu.compare(n.x,o.x);if(l!==0)return l;var h=xu.compare(n.y,o.y);if(h!==0)return h;if(this._dimensionsToTest<=2)return 0;var _=xu.compare(n.z,o.z);return _};xu.prototype.interfaces_=function(){return[np]};xu.prototype.getClass=function(){return xu};xu.compare=function(t,e){return t<e?-1:t>e?1:Je.isNaN(t)?Je.isNaN(e)?0:-1:Je.isNaN(e)?1:0};var rp=function(){};rp.prototype.create=function(){};rp.prototype.interfaces_=function(){return[]};rp.prototype.getClass=function(){return rp};var Mt=function(){},jf={INTERIOR:{configurable:!0},BOUNDARY:{configurable:!0},EXTERIOR:{configurable:!0},NONE:{configurable:!0}};Mt.prototype.interfaces_=function(){return[]};Mt.prototype.getClass=function(){return Mt};Mt.toLocationSymbol=function(t){switch(t){case Mt.EXTERIOR:return"e";case Mt.BOUNDARY:return"b";case Mt.INTERIOR:return"i";case Mt.NONE:return"-"}throw new Ir("Unknown location value: "+t)};jf.INTERIOR.get=function(){return 0};jf.BOUNDARY.get=function(){return 1};jf.EXTERIOR.get=function(){return 2};jf.NONE.get=function(){return-1};Object.defineProperties(Mt,jf);var qe=function(t,e){return t.interfaces_&&t.interfaces_().indexOf(e)>-1},Es=function(){},bv={LOG_10:{configurable:!0}};Es.prototype.interfaces_=function(){return[]};Es.prototype.getClass=function(){return Es};Es.log10=function(t){var e=Math.log(t);return Je.isInfinite(e)||Je.isNaN(e)?e:e/Es.LOG_10};Es.min=function(t,e,n,o){var l=t;return e<l&&(l=e),n<l&&(l=n),o<l&&(l=o),l};Es.clamp=function(){if(typeof arguments[2]=="number"&&typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1],n=arguments[2];return t<e?e:t>n?n:t}else if(Number.isInteger(arguments[2])&&Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var o=arguments[0],l=arguments[1],h=arguments[2];return o<l?l:o>h?h:o}};Es.wrap=function(t,e){return t<0?e- -t%e:t%e};Es.max=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2],o=t;return e>o&&(o=e),n>o&&(o=n),o}else if(arguments.length===4){var l=arguments[0],h=arguments[1],_=arguments[2],u=arguments[3],I=l;return h>I&&(I=h),_>I&&(I=_),u>I&&(I=u),I}};Es.average=function(t,e){return(t+e)/2};bv.LOG_10.get=function(){return Math.log(10)};Object.defineProperties(Es,bv);var Xa=function(t){this.str=t};Xa.prototype.append=function(t){this.str+=t};Xa.prototype.setCharAt=function(t,e){this.str=this.str.substr(0,t)+e+this.str.substr(t+1)};Xa.prototype.toString=function(t){return this.str};var Ra=function(t){this.value=t};Ra.prototype.intValue=function(){return this.value};Ra.prototype.compareTo=function(t){return this.value<t?-1:this.value>t?1:0};Ra.isNaN=function(t){return Number.isNaN(t)};var Mf=function(){};Mf.isWhitespace=function(t){return t<=32&&t>=0||t===127};Mf.toUpperCase=function(t){return t.toUpperCase()};var Dt=function t(){if(this._hi=0,this._lo=0,arguments.length===0)this.init(0);else if(arguments.length===1){if(typeof arguments[0]=="number"){var e=arguments[0];this.init(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}else if(typeof arguments[0]=="string"){var o=arguments[0];t.call(this,t.parse(o))}}else if(arguments.length===2){var l=arguments[0],h=arguments[1];this.init(l,h)}},ca={PI:{configurable:!0},TWO_PI:{configurable:!0},PI_2:{configurable:!0},E:{configurable:!0},NaN:{configurable:!0},EPS:{configurable:!0},SPLIT:{configurable:!0},MAX_PRINT_DIGITS:{configurable:!0},TEN:{configurable:!0},ONE:{configurable:!0},SCI_NOT_EXPONENT_CHAR:{configurable:!0},SCI_NOT_ZERO:{configurable:!0}};Dt.prototype.le=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<=t._lo};Dt.prototype.extractSignificantDigits=function(t,e){var n=this.abs(),o=Dt.magnitude(n._hi),l=Dt.TEN.pow(o);n=n.divide(l),n.gt(Dt.TEN)?(n=n.divide(Dt.TEN),o+=1):n.lt(Dt.ONE)&&(n=n.multiply(Dt.TEN),o-=1);for(var h=o+1,_=new Xa,u=Dt.MAX_PRINT_DIGITS-1,I=0;I<=u;I++){t&&I===h&&_.append(".");var w=Math.trunc(n._hi);if(w<0)break;var D=!1,k=0;w>9?(D=!0,k="9"):k="0"+w,_.append(k),n=n.subtract(Dt.valueOf(w)).multiply(Dt.TEN),D&&n.selfAdd(Dt.TEN);var G=!0,H=Dt.magnitude(n._hi);if(H<0&&Math.abs(H)>=u-I&&(G=!1),!G)break}return e[0]=o,_.toString()};Dt.prototype.sqr=function(){return this.multiply(this)};Dt.prototype.doubleValue=function(){return this._hi+this._lo};Dt.prototype.subtract=function(){if(arguments[0]instanceof Dt){var t=arguments[0];return this.add(t.negate())}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.add(-e)}};Dt.prototype.equals=function(){if(arguments.length===1){var t=arguments[0];return this._hi===t._hi&&this._lo===t._lo}};Dt.prototype.isZero=function(){return this._hi===0&&this._lo===0};Dt.prototype.selfSubtract=function(){if(arguments[0]instanceof Dt){var t=arguments[0];return this.isNaN()?this:this.selfAdd(-t._hi,-t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.isNaN()?this:this.selfAdd(-e,0)}};Dt.prototype.getSpecialNumberString=function(){return this.isZero()?"0.0":this.isNaN()?"NaN ":null};Dt.prototype.min=function(t){return this.le(t)?this:t};Dt.prototype.selfDivide=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var t=arguments[0];return this.selfDivide(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfDivide(e,0)}}else if(arguments.length===2){var n=arguments[0],o=arguments[1],l=null,h=null,_=null,u=null,I=null,w=null,D=null,k=null;return I=this._hi/n,w=Dt.SPLIT*I,l=w-I,k=Dt.SPLIT*n,l=w-l,h=I-l,_=k-n,D=I*n,_=k-_,u=n-_,k=l*_-D+l*u+h*_+h*u,w=(this._hi-D-k+this._lo-I*o)/n,k=I+w,this._hi=k,this._lo=I-k+w,this}};Dt.prototype.dump=function(){return"DD<"+this._hi+", "+this._lo+">"};Dt.prototype.divide=function(){if(arguments[0]instanceof Dt){var t=arguments[0],e=null,n=null,o=null,l=null,h=null,_=null,u=null,I=null;h=this._hi/t._hi,_=Dt.SPLIT*h,e=_-h,I=Dt.SPLIT*t._hi,e=_-e,n=h-e,o=I-t._hi,u=h*t._hi,o=I-o,l=t._hi-o,I=e*o-u+e*l+n*o+n*l,_=(this._hi-u-I+this._lo-h*t._lo)/t._hi,I=h+_;var w=I,D=h-I+_;return new Dt(w,D)}else if(typeof arguments[0]=="number"){var k=arguments[0];return Je.isNaN(k)?Dt.createNaN():Dt.copy(this).selfDivide(k,0)}};Dt.prototype.ge=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>=t._lo};Dt.prototype.pow=function(t){if(t===0)return Dt.valueOf(1);var e=new Dt(this),n=Dt.valueOf(1),o=Math.abs(t);if(o>1)for(;o>0;)o%2===1&&n.selfMultiply(e),o/=2,o>0&&(e=e.sqr());else n=e;return t<0?n.reciprocal():n};Dt.prototype.ceil=function(){if(this.isNaN())return Dt.NaN;var t=Math.ceil(this._hi),e=0;return t===this._hi&&(e=Math.ceil(this._lo)),new Dt(t,e)};Dt.prototype.compareTo=function(t){var e=t;return this._hi<e._hi?-1:this._hi>e._hi?1:this._lo<e._lo?-1:this._lo>e._lo?1:0};Dt.prototype.rint=function(){if(this.isNaN())return this;var t=this.add(.5);return t.floor()};Dt.prototype.setValue=function(){if(arguments[0]instanceof Dt){var t=arguments[0];return this.init(t),this}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.init(e),this}};Dt.prototype.max=function(t){return this.ge(t)?this:t};Dt.prototype.sqrt=function(){if(this.isZero())return Dt.valueOf(0);if(this.isNegative())return Dt.NaN;var t=1/Math.sqrt(this._hi),e=this._hi*t,n=Dt.valueOf(e),o=this.subtract(n.sqr()),l=o._hi*(t*.5);return n.add(l)};Dt.prototype.selfAdd=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var t=arguments[0];return this.selfAdd(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0],n=null,o=null,l=null,h=null,_=null,u=null;return l=this._hi+e,_=l-this._hi,h=l-_,h=e-_+(this._hi-h),u=h+this._lo,n=l+u,o=u+(l-n),this._hi=n+o,this._lo=o+(n-this._hi),this}}else if(arguments.length===2){var I=arguments[0],w=arguments[1],D=null,k=null,G=null,H=null,j=null,K=null,lt=null,dt=null;j=this._hi+I,G=this._lo+w,lt=j-this._hi,dt=G-this._lo,K=j-lt,H=G-dt,K=I-lt+(this._hi-K),H=w-dt+(this._lo-H),lt=K+G,D=j+lt,k=lt+(j-D),lt=H+k;var xt=D+lt,gt=lt+(D-xt);return this._hi=xt,this._lo=gt,this}};Dt.prototype.selfMultiply=function(){if(arguments.length===1){if(arguments[0]instanceof Dt){var t=arguments[0];return this.selfMultiply(t._hi,t._lo)}else if(typeof arguments[0]=="number"){var e=arguments[0];return this.selfMultiply(e,0)}}else if(arguments.length===2){var n=arguments[0],o=arguments[1],l=null,h=null,_=null,u=null,I=null,w=null;I=Dt.SPLIT*this._hi,l=I-this._hi,w=Dt.SPLIT*n,l=I-l,h=this._hi-l,_=w-n,I=this._hi*n,_=w-_,u=n-_,w=l*_-I+l*u+h*_+h*u+(this._hi*o+this._lo*n);var D=I+w;l=I-D;var k=w+l;return this._hi=D,this._lo=k,this}};Dt.prototype.selfSqr=function(){return this.selfMultiply(this)};Dt.prototype.floor=function(){if(this.isNaN())return Dt.NaN;var t=Math.floor(this._hi),e=0;return t===this._hi&&(e=Math.floor(this._lo)),new Dt(t,e)};Dt.prototype.negate=function(){return this.isNaN()?this:new Dt(-this._hi,-this._lo)};Dt.prototype.clone=function(){};Dt.prototype.multiply=function(){if(arguments[0]instanceof Dt){var t=arguments[0];return t.isNaN()?Dt.createNaN():Dt.copy(this).selfMultiply(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return Je.isNaN(e)?Dt.createNaN():Dt.copy(this).selfMultiply(e,0)}};Dt.prototype.isNaN=function(){return Je.isNaN(this._hi)};Dt.prototype.intValue=function(){return Math.trunc(this._hi)};Dt.prototype.toString=function(){var t=Dt.magnitude(this._hi);return t>=-3&&t<=20?this.toStandardNotation():this.toSciNotation()};Dt.prototype.toStandardNotation=function(){var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!0,e),o=e[0]+1,l=n;if(n.charAt(0)===".")l="0"+n;else if(o<0)l="0."+Dt.stringOfChar("0",-o)+n;else if(n.indexOf(".")===-1){var h=o-n.length,_=Dt.stringOfChar("0",h);l=n+_+".0"}return this.isNegative()?"-"+l:l};Dt.prototype.reciprocal=function(){var t=null,e=null,n=null,o=null,l=null,h=null,_=null,u=null;l=1/this._hi,h=Dt.SPLIT*l,t=h-l,u=Dt.SPLIT*this._hi,t=h-t,e=l-t,n=u-this._hi,_=l*this._hi,n=u-n,o=this._hi-n,u=t*n-_+t*o+e*n+e*o,h=(1-_-u-l*this._lo)/this._hi;var I=l+h,w=l-I+h;return new Dt(I,w)};Dt.prototype.toSciNotation=function(){if(this.isZero())return Dt.SCI_NOT_ZERO;var t=this.getSpecialNumberString();if(t!==null)return t;var e=new Array(1).fill(null),n=this.extractSignificantDigits(!1,e),o=Dt.SCI_NOT_EXPONENT_CHAR+e[0];if(n.charAt(0)==="0")throw new Error("Found leading zero: "+n);var l="";n.length>1&&(l=n.substring(1));var h=n.charAt(0)+"."+l;return this.isNegative()?"-"+h+o:h+o};Dt.prototype.abs=function(){return this.isNaN()?Dt.NaN:this.isNegative()?this.negate():new Dt(this)};Dt.prototype.isPositive=function(){return(this._hi>0||this._hi===0)&&this._lo>0};Dt.prototype.lt=function(t){return(this._hi<t._hi||this._hi===t._hi)&&this._lo<t._lo};Dt.prototype.add=function(){if(arguments[0]instanceof Dt){var t=arguments[0];return Dt.copy(this).selfAdd(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return Dt.copy(this).selfAdd(e)}};Dt.prototype.init=function(){if(arguments.length===1){if(typeof arguments[0]=="number"){var t=arguments[0];this._hi=t,this._lo=0}else if(arguments[0]instanceof Dt){var e=arguments[0];this._hi=e._hi,this._lo=e._lo}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];this._hi=n,this._lo=o}};Dt.prototype.gt=function(t){return(this._hi>t._hi||this._hi===t._hi)&&this._lo>t._lo};Dt.prototype.isNegative=function(){return(this._hi<0||this._hi===0)&&this._lo<0};Dt.prototype.trunc=function(){return this.isNaN()?Dt.NaN:this.isPositive()?this.floor():this.ceil()};Dt.prototype.signum=function(){return this._hi>0?1:this._hi<0?-1:this._lo>0?1:this._lo<0?-1:0};Dt.prototype.interfaces_=function(){return[Gs,Vs,cg]};Dt.prototype.getClass=function(){return Dt};Dt.sqr=function(t){return Dt.valueOf(t).selfMultiply(t)};Dt.valueOf=function(){if(typeof arguments[0]=="string"){var t=arguments[0];return Dt.parse(t)}else if(typeof arguments[0]=="number"){var e=arguments[0];return new Dt(e)}};Dt.sqrt=function(t){return Dt.valueOf(t).sqrt()};Dt.parse=function(t){for(var e=0,n=t.length;Mf.isWhitespace(t.charAt(e));)e++;var o=!1;if(e<n){var l=t.charAt(e);(l==="-"||l==="+")&&(e++,l==="-"&&(o=!0))}for(var h=new Dt,_=0,u=0,I=0;!(e>=n);){var w=t.charAt(e);if(e++,Mf.isDigit(w)){var D=w-"0";h.selfMultiply(Dt.TEN),h.selfAdd(D),_++;continue}if(w==="."){u=_;continue}if(w==="e"||w==="E"){var k=t.substring(e);try{I=Ra.parseInt(k)}catch(lt){throw lt instanceof Error?new Error("Invalid exponent "+k+" in string "+t):lt}finally{}break}throw new Error("Unexpected character '"+w+"' at position "+e+" in string "+t)}var G=h,H=_-u-I;if(H===0)G=h;else if(H>0){var j=Dt.TEN.pow(H);G=h.divide(j)}else if(H<0){var K=Dt.TEN.pow(-H);G=h.multiply(K)}return o?G.negate():G};Dt.createNaN=function(){return new Dt(Je.NaN,Je.NaN)};Dt.copy=function(t){return new Dt(t)};Dt.magnitude=function(t){var e=Math.abs(t),n=Math.log(e)/Math.log(10),o=Math.trunc(Math.floor(n)),l=Math.pow(10,o);return l*10<=e&&(o+=1),o};Dt.stringOfChar=function(t,e){for(var n=new Xa,o=0;o<e;o++)n.append(t);return n.toString()};ca.PI.get=function(){return new Dt(3.141592653589793,12246467991473532e-32)};ca.TWO_PI.get=function(){return new Dt(6.283185307179586,24492935982947064e-32)};ca.PI_2.get=function(){return new Dt(1.5707963267948966,6123233995736766e-32)};ca.E.get=function(){return new Dt(2.718281828459045,14456468917292502e-32)};ca.NaN.get=function(){return new Dt(Je.NaN,Je.NaN)};ca.EPS.get=function(){return 123259516440783e-46};ca.SPLIT.get=function(){return 134217729};ca.MAX_PRINT_DIGITS.get=function(){return 32};ca.TEN.get=function(){return Dt.valueOf(10)};ca.ONE.get=function(){return Dt.valueOf(1)};ca.SCI_NOT_EXPONENT_CHAR.get=function(){return"E"};ca.SCI_NOT_ZERO.get=function(){return"0.0E0"};Object.defineProperties(Dt,ca);var Oo=function(){},wv={DP_SAFE_EPSILON:{configurable:!0}};Oo.prototype.interfaces_=function(){return[]};Oo.prototype.getClass=function(){return Oo};Oo.orientationIndex=function(t,e,n){var o=Oo.orientationIndexFilter(t,e,n);if(o<=1)return o;var l=Dt.valueOf(e.x).selfAdd(-t.x),h=Dt.valueOf(e.y).selfAdd(-t.y),_=Dt.valueOf(n.x).selfAdd(-e.x),u=Dt.valueOf(n.y).selfAdd(-e.y);return l.selfMultiply(u).selfSubtract(h.selfMultiply(_)).signum()};Oo.signOfDet2x2=function(t,e,n,o){var l=t.multiply(o).selfSubtract(e.multiply(n));return l.signum()};Oo.intersection=function(t,e,n,o){var l=Dt.valueOf(o.y).selfSubtract(n.y).selfMultiply(Dt.valueOf(e.x).selfSubtract(t.x)),h=Dt.valueOf(o.x).selfSubtract(n.x).selfMultiply(Dt.valueOf(e.y).selfSubtract(t.y)),_=l.subtract(h),u=Dt.valueOf(o.x).selfSubtract(n.x).selfMultiply(Dt.valueOf(t.y).selfSubtract(n.y)),I=Dt.valueOf(o.y).selfSubtract(n.y).selfMultiply(Dt.valueOf(t.x).selfSubtract(n.x)),w=u.subtract(I),D=w.selfDivide(_).doubleValue(),k=Dt.valueOf(t.x).selfAdd(Dt.valueOf(e.x).selfSubtract(t.x).selfMultiply(D)).doubleValue(),G=Dt.valueOf(e.x).selfSubtract(t.x).selfMultiply(Dt.valueOf(t.y).selfSubtract(n.y)),H=Dt.valueOf(e.y).selfSubtract(t.y).selfMultiply(Dt.valueOf(t.x).selfSubtract(n.x)),j=G.subtract(H),K=j.selfDivide(_).doubleValue(),lt=Dt.valueOf(n.y).selfAdd(Dt.valueOf(o.y).selfSubtract(n.y).selfMultiply(K)).doubleValue();return new It(k,lt)};Oo.orientationIndexFilter=function(t,e,n){var o=null,l=(t.x-n.x)*(e.y-n.y),h=(t.y-n.y)*(e.x-n.x),_=l-h;if(l>0){if(h<=0)return Oo.signum(_);o=l+h}else if(l<0){if(h>=0)return Oo.signum(_);o=-l-h}else return Oo.signum(_);var u=Oo.DP_SAFE_EPSILON*o;return _>=u||-_>=u?Oo.signum(_):2};Oo.signum=function(t){return t>0?1:t<0?-1:0};wv.DP_SAFE_EPSILON.get=function(){return 1e-15};Object.defineProperties(Oo,wv);var Cn=function(){},qf={X:{configurable:!0},Y:{configurable:!0},Z:{configurable:!0},M:{configurable:!0}};qf.X.get=function(){return 0};qf.Y.get=function(){return 1};qf.Z.get=function(){return 2};qf.M.get=function(){return 3};Cn.prototype.setOrdinate=function(t,e,n){};Cn.prototype.size=function(){};Cn.prototype.getOrdinate=function(t,e){};Cn.prototype.getCoordinate=function(){};Cn.prototype.getCoordinateCopy=function(t){};Cn.prototype.getDimension=function(){};Cn.prototype.getX=function(t){};Cn.prototype.clone=function(){};Cn.prototype.expandEnvelope=function(t){};Cn.prototype.copy=function(){};Cn.prototype.getY=function(t){};Cn.prototype.toCoordinateArray=function(){};Cn.prototype.interfaces_=function(){return[cg]};Cn.prototype.getClass=function(){return Cn};Object.defineProperties(Cn,qf);var Ev=function(){},Ep=function(t){function e(){t.call(this,"Projective point not representable on the Cartesian plane.")}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Ev),Yi=function(){};Yi.arraycopy=function(t,e,n,o,l){for(var h=0,_=e;_<e+l;_++)n[o+h]=t[_],h++};Yi.getProperty=function(t){return{"line.separator":`
`}[t]};var ta=function t(){if(this.x=null,this.y=null,this.w=null,arguments.length===0)this.x=0,this.y=0,this.w=1;else if(arguments.length===1){var e=arguments[0];this.x=e.x,this.y=e.y,this.w=1}else if(arguments.length===2){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var n=arguments[0],o=arguments[1];this.x=n,this.y=o,this.w=1}else if(arguments[0]instanceof t&&arguments[1]instanceof t){var l=arguments[0],h=arguments[1];this.x=l.y*h.w-h.y*l.w,this.y=h.x*l.w-l.x*h.w,this.w=l.x*h.y-h.x*l.y}else if(arguments[0]instanceof It&&arguments[1]instanceof It){var _=arguments[0],u=arguments[1];this.x=_.y-u.y,this.y=u.x-_.x,this.w=_.x*u.y-u.x*_.y}}else if(arguments.length===3){var I=arguments[0],w=arguments[1],D=arguments[2];this.x=I,this.y=w,this.w=D}else if(arguments.length===4){var k=arguments[0],G=arguments[1],H=arguments[2],j=arguments[3],K=k.y-G.y,lt=G.x-k.x,dt=k.x*G.y-G.x*k.y,xt=H.y-j.y,gt=j.x-H.x,yt=H.x*j.y-j.x*H.y;this.x=lt*yt-gt*dt,this.y=xt*dt-K*yt,this.w=K*gt-xt*lt}};ta.prototype.getY=function(){var t=this.y/this.w;if(Je.isNaN(t)||Je.isInfinite(t))throw new Ep;return t};ta.prototype.getX=function(){var t=this.x/this.w;if(Je.isNaN(t)||Je.isInfinite(t))throw new Ep;return t};ta.prototype.getCoordinate=function(){var t=new It;return t.x=this.getX(),t.y=this.getY(),t};ta.prototype.interfaces_=function(){return[]};ta.prototype.getClass=function(){return ta};ta.intersection=function(t,e,n,o){var l=t.y-e.y,h=e.x-t.x,_=t.x*e.y-e.x*t.y,u=n.y-o.y,I=o.x-n.x,w=n.x*o.y-o.x*n.y,D=h*w-I*_,k=u*_-l*w,G=l*I-u*h,H=D/G,j=k/G;if(Je.isNaN(H)||Je.isInfinite(H)||Je.isNaN(j)||Je.isInfinite(j))throw new Ep;return new It(H,j)};var De=function t(){if(this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,arguments.length===0)this.init();else if(arguments.length===1){if(arguments[0]instanceof It){var e=arguments[0];this.init(e.x,e.x,e.y,e.y)}else if(arguments[0]instanceof t){var n=arguments[0];this.init(n)}}else if(arguments.length===2){var o=arguments[0],l=arguments[1];this.init(o.x,l.x,o.y,l.y)}else if(arguments.length===4){var h=arguments[0],_=arguments[1],u=arguments[2],I=arguments[3];this.init(h,_,u,I)}},Iv={serialVersionUID:{configurable:!0}};De.prototype.getArea=function(){return this.getWidth()*this.getHeight()};De.prototype.equals=function(t){if(!(t instanceof De))return!1;var e=t;return this.isNull()?e.isNull():this._maxx===e.getMaxX()&&this._maxy===e.getMaxY()&&this._minx===e.getMinX()&&this._miny===e.getMinY()};De.prototype.intersection=function(t){if(this.isNull()||t.isNull()||!this.intersects(t))return new De;var e=this._minx>t._minx?this._minx:t._minx,n=this._miny>t._miny?this._miny:t._miny,o=this._maxx<t._maxx?this._maxx:t._maxx,l=this._maxy<t._maxy?this._maxy:t._maxy;return new De(e,o,n,l)};De.prototype.isNull=function(){return this._maxx<this._minx};De.prototype.getMaxX=function(){return this._maxx};De.prototype.covers=function(){if(arguments.length===1){if(arguments[0]instanceof It){var t=arguments[0];return this.covers(t.x,t.y)}else if(arguments[0]instanceof De){var e=arguments[0];return this.isNull()||e.isNull()?!1:e.getMinX()>=this._minx&&e.getMaxX()<=this._maxx&&e.getMinY()>=this._miny&&e.getMaxY()<=this._maxy}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.isNull()?!1:n>=this._minx&&n<=this._maxx&&o>=this._miny&&o<=this._maxy}};De.prototype.intersects=function(){if(arguments.length===1){if(arguments[0]instanceof De){var t=arguments[0];return this.isNull()||t.isNull()?!1:!(t._minx>this._maxx||t._maxx<this._minx||t._miny>this._maxy||t._maxy<this._miny)}else if(arguments[0]instanceof It){var e=arguments[0];return this.intersects(e.x,e.y)}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.isNull()?!1:!(n>this._maxx||n<this._minx||o>this._maxy||o<this._miny)}};De.prototype.getMinY=function(){return this._miny};De.prototype.getMinX=function(){return this._minx};De.prototype.expandToInclude=function(){if(arguments.length===1){if(arguments[0]instanceof It){var t=arguments[0];this.expandToInclude(t.x,t.y)}else if(arguments[0]instanceof De){var e=arguments[0];if(e.isNull())return null;this.isNull()?(this._minx=e.getMinX(),this._maxx=e.getMaxX(),this._miny=e.getMinY(),this._maxy=e.getMaxY()):(e._minx<this._minx&&(this._minx=e._minx),e._maxx>this._maxx&&(this._maxx=e._maxx),e._miny<this._miny&&(this._miny=e._miny),e._maxy>this._maxy&&(this._maxy=e._maxy))}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];this.isNull()?(this._minx=n,this._maxx=n,this._miny=o,this._maxy=o):(n<this._minx&&(this._minx=n),n>this._maxx&&(this._maxx=n),o<this._miny&&(this._miny=o),o>this._maxy&&(this._maxy=o))}};De.prototype.minExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t<e?t:e};De.prototype.getWidth=function(){return this.isNull()?0:this._maxx-this._minx};De.prototype.compareTo=function(t){var e=t;return this.isNull()?e.isNull()?0:-1:e.isNull()?1:this._minx<e._minx?-1:this._minx>e._minx?1:this._miny<e._miny?-1:this._miny>e._miny?1:this._maxx<e._maxx?-1:this._maxx>e._maxx?1:this._maxy<e._maxy?-1:this._maxy>e._maxy?1:0};De.prototype.translate=function(t,e){if(this.isNull())return null;this.init(this.getMinX()+t,this.getMaxX()+t,this.getMinY()+e,this.getMaxY()+e)};De.prototype.toString=function(){return"Env["+this._minx+" : "+this._maxx+", "+this._miny+" : "+this._maxy+"]"};De.prototype.setToNull=function(){this._minx=0,this._maxx=-1,this._miny=0,this._maxy=-1};De.prototype.getHeight=function(){return this.isNull()?0:this._maxy-this._miny};De.prototype.maxExtent=function(){if(this.isNull())return 0;var t=this.getWidth(),e=this.getHeight();return t>e?t:e};De.prototype.expandBy=function(){if(arguments.length===1){var t=arguments[0];this.expandBy(t,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this.isNull())return null;this._minx-=e,this._maxx+=e,this._miny-=n,this._maxy+=n,(this._minx>this._maxx||this._miny>this._maxy)&&this.setToNull()}};De.prototype.contains=function(){if(arguments.length===1){if(arguments[0]instanceof De){var t=arguments[0];return this.covers(t)}else if(arguments[0]instanceof It){var e=arguments[0];return this.covers(e)}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.covers(n,o)}};De.prototype.centre=function(){return this.isNull()?null:new It((this.getMinX()+this.getMaxX())/2,(this.getMinY()+this.getMaxY())/2)};De.prototype.init=function(){if(arguments.length===0)this.setToNull();else if(arguments.length===1){if(arguments[0]instanceof It){var t=arguments[0];this.init(t.x,t.x,t.y,t.y)}else if(arguments[0]instanceof De){var e=arguments[0];this._minx=e._minx,this._maxx=e._maxx,this._miny=e._miny,this._maxy=e._maxy}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];this.init(n.x,o.x,n.y,o.y)}else if(arguments.length===4){var l=arguments[0],h=arguments[1],_=arguments[2],u=arguments[3];l<h?(this._minx=l,this._maxx=h):(this._minx=h,this._maxx=l),_<u?(this._miny=_,this._maxy=u):(this._miny=u,this._maxy=_)}};De.prototype.getMaxY=function(){return this._maxy};De.prototype.distance=function(t){if(this.intersects(t))return 0;var e=0;this._maxx<t._minx?e=t._minx-this._maxx:this._minx>t._maxx&&(e=this._minx-t._maxx);var n=0;return this._maxy<t._miny?n=t._miny-this._maxy:this._miny>t._maxy&&(n=this._miny-t._maxy),e===0?n:n===0?e:Math.sqrt(e*e+n*n)};De.prototype.hashCode=function(){var t=17;return t=37*t+It.hashCode(this._minx),t=37*t+It.hashCode(this._maxx),t=37*t+It.hashCode(this._miny),t=37*t+It.hashCode(this._maxy),t};De.prototype.interfaces_=function(){return[Vs,Gs]};De.prototype.getClass=function(){return De};De.intersects=function(){if(arguments.length===3){var t=arguments[0],e=arguments[1],n=arguments[2];return n.x>=(t.x<e.x?t.x:e.x)&&n.x<=(t.x>e.x?t.x:e.x)&&n.y>=(t.y<e.y?t.y:e.y)&&n.y<=(t.y>e.y?t.y:e.y)}else if(arguments.length===4){var o=arguments[0],l=arguments[1],h=arguments[2],_=arguments[3],u=Math.min(h.x,_.x),I=Math.max(h.x,_.x),w=Math.min(o.x,l.x),D=Math.max(o.x,l.x);return!(w>I||D<u||(u=Math.min(h.y,_.y),I=Math.max(h.y,_.y),w=Math.min(o.y,l.y),D=Math.max(o.y,l.y),w>I)||D<u)}};Iv.serialVersionUID.get=function(){return 5873921885273102e3};Object.defineProperties(De,Iv);var Ma={typeStr:/^\s*(\w+)\s*\(\s*(.*)\s*\)\s*$/,emptyTypeStr:/^\s*(\w+)\s*EMPTY\s*$/,spaces:/\s+/,parenComma:/\)\s*,\s*\(/,doubleParenComma:/\)\s*\)\s*,\s*\(\s*\(/,trimParens:/^\s*\(?(.*?)\)?\s*$/},hg=function(t){this.geometryFactory=t||new gn};hg.prototype.read=function(t){var e,n,o;t=t.replace(/[\n\r]/g," ");var l=Ma.typeStr.exec(t);if(t.search("EMPTY")!==-1&&(l=Ma.emptyTypeStr.exec(t),l[2]=void 0),l&&(n=l[1].toLowerCase(),o=l[2],$h[n]&&(e=$h[n].apply(this,[o]))),e===void 0)throw new Error("Could not parse WKT "+t);return e};hg.prototype.write=function(t){return this.extractGeometry(t)};hg.prototype.extractGeometry=function(t){var e=t.getGeometryType().toLowerCase();if(!Bl[e])return null;var n=e.toUpperCase(),o;return t.isEmpty()?o=n+" EMPTY":o=n+"("+Bl[e].apply(this,[t])+")",o};var Bl={coordinate:function(t){return t.x+" "+t.y},point:function(t){return Bl.coordinate.call(this,t._coordinates._coordinates[0])},multipoint:function(t){for(var e=this,n=[],o=0,l=t._geometries.length;o<l;++o)n.push("("+Bl.point.apply(e,[t._geometries[o]])+")");return n.join(",")},linestring:function(t){for(var e=this,n=[],o=0,l=t._points._coordinates.length;o<l;++o)n.push(Bl.coordinate.apply(e,[t._points._coordinates[o]]));return n.join(",")},linearring:function(t){for(var e=this,n=[],o=0,l=t._points._coordinates.length;o<l;++o)n.push(Bl.coordinate.apply(e,[t._points._coordinates[o]]));return n.join(",")},multilinestring:function(t){for(var e=this,n=[],o=0,l=t._geometries.length;o<l;++o)n.push("("+Bl.linestring.apply(e,[t._geometries[o]])+")");return n.join(",")},polygon:function(t){var e=this,n=[];n.push("("+Bl.linestring.apply(this,[t._shell])+")");for(var o=0,l=t._holes.length;o<l;++o)n.push("("+Bl.linestring.apply(e,[t._holes[o]])+")");return n.join(",")},multipolygon:function(t){for(var e=this,n=[],o=0,l=t._geometries.length;o<l;++o)n.push("("+Bl.polygon.apply(e,[t._geometries[o]])+")");return n.join(",")},geometrycollection:function(t){for(var e=this,n=[],o=0,l=t._geometries.length;o<l;++o)n.push(e.extractGeometry(t._geometries[o]));return n.join(",")}},$h={point:function(t){if(t===void 0)return this.geometryFactory.createPoint();var e=t.trim().split(Ma.spaces);return this.geometryFactory.createPoint(new It(Number.parseFloat(e[0]),Number.parseFloat(e[1])))},multipoint:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPoint();for(var n,o=t.trim().split(","),l=[],h=0,_=o.length;h<_;++h)n=o[h].replace(Ma.trimParens,"$1"),l.push($h.point.apply(e,[n]));return this.geometryFactory.createMultiPoint(l)},linestring:function(t){if(t===void 0)return this.geometryFactory.createLineString();for(var e=t.trim().split(","),n=[],o,l=0,h=e.length;l<h;++l)o=e[l].trim().split(Ma.spaces),n.push(new It(Number.parseFloat(o[0]),Number.parseFloat(o[1])));return this.geometryFactory.createLineString(n)},linearring:function(t){if(t===void 0)return this.geometryFactory.createLinearRing();for(var e=t.trim().split(","),n=[],o,l=0,h=e.length;l<h;++l)o=e[l].trim().split(Ma.spaces),n.push(new It(Number.parseFloat(o[0]),Number.parseFloat(o[1])));return this.geometryFactory.createLinearRing(n)},multilinestring:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiLineString();for(var n,o=t.trim().split(Ma.parenComma),l=[],h=0,_=o.length;h<_;++h)n=o[h].replace(Ma.trimParens,"$1"),l.push($h.linestring.apply(e,[n]));return this.geometryFactory.createMultiLineString(l)},polygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createPolygon();for(var n,o,l,h=t.trim().split(Ma.parenComma),_,u=[],I=0,w=h.length;I<w;++I)n=h[I].replace(Ma.trimParens,"$1"),o=$h.linestring.apply(e,[n]),l=e.geometryFactory.createLinearRing(o._points),I===0?_=l:u.push(l);return this.geometryFactory.createPolygon(_,u)},multipolygon:function(t){var e=this;if(t===void 0)return this.geometryFactory.createMultiPolygon();for(var n,o=t.trim().split(Ma.doubleParenComma),l=[],h=0,_=o.length;h<_;++h)n=o[h].replace(Ma.trimParens,"$1"),l.push($h.polygon.apply(e,[n]));return this.geometryFactory.createMultiPolygon(l)},geometrycollection:function(t){var e=this;if(t===void 0)return this.geometryFactory.createGeometryCollection();t=t.replace(/,\s*([A-Za-z])/g,"|$1");for(var n=t.trim().split("|"),o=[],l=0,h=n.length;l<h;++l)o.push(e.read(n[l]));return this.geometryFactory.createGeometryCollection(o)}},na=function(t){this.parser=new hg(t)};na.prototype.write=function(t){return this.parser.write(t)};na.toLineString=function(t,e){if(arguments.length!==2)throw new Error("Not implemented");return"LINESTRING ( "+t.x+" "+t.y+", "+e.x+" "+e.y+" )"};var Zl=function(t){function e(n){t.call(this,n),this.name="RuntimeException",this.message=n,this.stack=new t().stack}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(Error),Wd=function(t){function e(){if(t.call(this),arguments.length===0)t.call(this);else if(arguments.length===1){var n=arguments[0];t.call(this,n)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Zl),cn=function(){};cn.prototype.interfaces_=function(){return[]};cn.prototype.getClass=function(){return cn};cn.shouldNeverReachHere=function(){if(arguments.length===0)cn.shouldNeverReachHere(null);else if(arguments.length===1){var t=arguments[0];throw new Wd("Should never reach here"+(t!==null?": "+t:""))}};cn.isTrue=function(){var t,e;if(arguments.length===1)t=arguments[0],cn.isTrue(t,null);else if(arguments.length===2&&(t=arguments[0],e=arguments[1],!t))throw e===null?new Wd:new Wd(e)};cn.equals=function(){var t,e,n;if(arguments.length===2)t=arguments[0],e=arguments[1],cn.equals(t,e,null);else if(arguments.length===3&&(t=arguments[0],e=arguments[1],n=arguments[2],!e.equals(t)))throw new Wd("Expected "+t+" but encountered "+e+(n!==null?": "+n:""))};var Dr=function(){this._result=null,this._inputLines=Array(2).fill().map(function(){return Array(2)}),this._intPt=new Array(2).fill(null),this._intLineIndex=null,this._isProper=null,this._pa=null,this._pb=null,this._precisionModel=null,this._intPt[0]=new It,this._intPt[1]=new It,this._pa=this._intPt[0],this._pb=this._intPt[1],this._result=0},lh={DONT_INTERSECT:{configurable:!0},DO_INTERSECT:{configurable:!0},COLLINEAR:{configurable:!0},NO_INTERSECTION:{configurable:!0},POINT_INTERSECTION:{configurable:!0},COLLINEAR_INTERSECTION:{configurable:!0}};Dr.prototype.getIndexAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intLineIndex[t][e]};Dr.prototype.getTopologySummary=function(){var t=new Xa;return this.isEndPoint()&&t.append(" endpoint"),this._isProper&&t.append(" proper"),this.isCollinear()&&t.append(" collinear"),t.toString()};Dr.prototype.computeIntersection=function(t,e,n,o){this._inputLines[0][0]=t,this._inputLines[0][1]=e,this._inputLines[1][0]=n,this._inputLines[1][1]=o,this._result=this.computeIntersect(t,e,n,o)};Dr.prototype.getIntersectionNum=function(){return this._result};Dr.prototype.computeIntLineIndex=function(){if(arguments.length===0)this._intLineIndex===null&&(this._intLineIndex=Array(2).fill().map(function(){return Array(2)}),this.computeIntLineIndex(0),this.computeIntLineIndex(1));else if(arguments.length===1){var t=arguments[0],e=this.getEdgeDistance(t,0),n=this.getEdgeDistance(t,1);e>n?(this._intLineIndex[t][0]=0,this._intLineIndex[t][1]=1):(this._intLineIndex[t][0]=1,this._intLineIndex[t][1]=0)}};Dr.prototype.isProper=function(){return this.hasIntersection()&&this._isProper};Dr.prototype.setPrecisionModel=function(t){this._precisionModel=t};Dr.prototype.isInteriorIntersection=function(){var t=this;if(arguments.length===0)return!!(this.isInteriorIntersection(0)||this.isInteriorIntersection(1));if(arguments.length===1){for(var e=arguments[0],n=0;n<this._result;n++)if(!(t._intPt[n].equals2D(t._inputLines[e][0])||t._intPt[n].equals2D(t._inputLines[e][1])))return!0;return!1}};Dr.prototype.getIntersection=function(t){return this._intPt[t]};Dr.prototype.isEndPoint=function(){return this.hasIntersection()&&!this._isProper};Dr.prototype.hasIntersection=function(){return this._result!==Dr.NO_INTERSECTION};Dr.prototype.getEdgeDistance=function(t,e){var n=Dr.computeEdgeDistance(this._intPt[e],this._inputLines[t][0],this._inputLines[t][1]);return n};Dr.prototype.isCollinear=function(){return this._result===Dr.COLLINEAR_INTERSECTION};Dr.prototype.toString=function(){return na.toLineString(this._inputLines[0][0],this._inputLines[0][1])+" - "+na.toLineString(this._inputLines[1][0],this._inputLines[1][1])+this.getTopologySummary()};Dr.prototype.getEndpoint=function(t,e){return this._inputLines[t][e]};Dr.prototype.isIntersection=function(t){for(var e=this,n=0;n<this._result;n++)if(e._intPt[n].equals2D(t))return!0;return!1};Dr.prototype.getIntersectionAlongSegment=function(t,e){return this.computeIntLineIndex(),this._intPt[this._intLineIndex[t][e]]};Dr.prototype.interfaces_=function(){return[]};Dr.prototype.getClass=function(){return Dr};Dr.computeEdgeDistance=function(t,e,n){var o=Math.abs(n.x-e.x),l=Math.abs(n.y-e.y),h=-1;if(t.equals(e))h=0;else if(t.equals(n))o>l?h=o:h=l;else{var _=Math.abs(t.x-e.x),u=Math.abs(t.y-e.y);o>l?h=_:h=u,h===0&&!t.equals(e)&&(h=Math.max(_,u))}return cn.isTrue(!(h===0&&!t.equals(e)),"Bad distance calculation"),h};Dr.nonRobustComputeEdgeDistance=function(t,e,n){var o=t.x-e.x,l=t.y-e.y,h=Math.sqrt(o*o+l*l);return cn.isTrue(!(h===0&&!t.equals(e)),"Invalid distance calculation"),h};lh.DONT_INTERSECT.get=function(){return 0};lh.DO_INTERSECT.get=function(){return 1};lh.COLLINEAR.get=function(){return 2};lh.NO_INTERSECTION.get=function(){return 0};lh.POINT_INTERSECTION.get=function(){return 1};lh.COLLINEAR_INTERSECTION.get=function(){return 2};Object.defineProperties(Dr,lh);var bc=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isInSegmentEnvelopes=function(n){var o=new De(this._inputLines[0][0],this._inputLines[0][1]),l=new De(this._inputLines[1][0],this._inputLines[1][1]);return o.contains(n)&&l.contains(n)},e.prototype.computeIntersection=function(){if(arguments.length===3){var n=arguments[0],o=arguments[1],l=arguments[2];if(this._isProper=!1,De.intersects(o,l,n)&&ge.orientationIndex(o,l,n)===0&&ge.orientationIndex(l,o,n)===0)return this._isProper=!0,(n.equals(o)||n.equals(l))&&(this._isProper=!1),this._result=t.POINT_INTERSECTION,null;this._result=t.NO_INTERSECTION}else return t.prototype.computeIntersection.apply(this,arguments)},e.prototype.normalizeToMinimum=function(n,o,l,h,_){_.x=this.smallestInAbsValue(n.x,o.x,l.x,h.x),_.y=this.smallestInAbsValue(n.y,o.y,l.y,h.y),n.x-=_.x,n.y-=_.y,o.x-=_.x,o.y-=_.y,l.x-=_.x,l.y-=_.y,h.x-=_.x,h.y-=_.y},e.prototype.safeHCoordinateIntersection=function(n,o,l,h){var _=null;try{_=ta.intersection(n,o,l,h)}catch(u){if(u instanceof Ep)_=e.nearestEndpoint(n,o,l,h);else throw u}finally{}return _},e.prototype.intersection=function(n,o,l,h){var _=this.intersectionWithNormalization(n,o,l,h);return this.isInSegmentEnvelopes(_)||(_=new It(e.nearestEndpoint(n,o,l,h))),this._precisionModel!==null&&this._precisionModel.makePrecise(_),_},e.prototype.smallestInAbsValue=function(n,o,l,h){var _=n,u=Math.abs(_);return Math.abs(o)<u&&(_=o,u=Math.abs(o)),Math.abs(l)<u&&(_=l,u=Math.abs(l)),Math.abs(h)<u&&(_=h),_},e.prototype.checkDD=function(n,o,l,h,_){var u=Oo.intersection(n,o,l,h),I=this.isInSegmentEnvelopes(u);Yi.out.println("DD in env = "+I+"  --------------------- "+u),_.distance(u)>1e-4&&Yi.out.println("Distance = "+_.distance(u))},e.prototype.intersectionWithNormalization=function(n,o,l,h){var _=new It(n),u=new It(o),I=new It(l),w=new It(h),D=new It;this.normalizeToEnvCentre(_,u,I,w,D);var k=this.safeHCoordinateIntersection(_,u,I,w);return k.x+=D.x,k.y+=D.y,k},e.prototype.computeCollinearIntersection=function(n,o,l,h){var _=De.intersects(n,o,l),u=De.intersects(n,o,h),I=De.intersects(l,h,n),w=De.intersects(l,h,o);return _&&u?(this._intPt[0]=l,this._intPt[1]=h,t.COLLINEAR_INTERSECTION):I&&w?(this._intPt[0]=n,this._intPt[1]=o,t.COLLINEAR_INTERSECTION):_&&I?(this._intPt[0]=l,this._intPt[1]=n,l.equals(n)&&!u&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):_&&w?(this._intPt[0]=l,this._intPt[1]=o,l.equals(o)&&!u&&!I?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&I?(this._intPt[0]=h,this._intPt[1]=n,h.equals(n)&&!_&&!w?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):u&&w?(this._intPt[0]=h,this._intPt[1]=o,h.equals(o)&&!_&&!I?t.POINT_INTERSECTION:t.COLLINEAR_INTERSECTION):t.NO_INTERSECTION},e.prototype.normalizeToEnvCentre=function(n,o,l,h,_){var u=n.x<o.x?n.x:o.x,I=n.y<o.y?n.y:o.y,w=n.x>o.x?n.x:o.x,D=n.y>o.y?n.y:o.y,k=l.x<h.x?l.x:h.x,G=l.y<h.y?l.y:h.y,H=l.x>h.x?l.x:h.x,j=l.y>h.y?l.y:h.y,K=u>k?u:k,lt=w<H?w:H,dt=I>G?I:G,xt=D<j?D:j,gt=(K+lt)/2,yt=(dt+xt)/2;_.x=gt,_.y=yt,n.x-=_.x,n.y-=_.y,o.x-=_.x,o.y-=_.y,l.x-=_.x,l.y-=_.y,h.x-=_.x,h.y-=_.y},e.prototype.computeIntersect=function(n,o,l,h){if(this._isProper=!1,!De.intersects(n,o,l,h))return t.NO_INTERSECTION;var _=ge.orientationIndex(n,o,l),u=ge.orientationIndex(n,o,h);if(_>0&&u>0||_<0&&u<0)return t.NO_INTERSECTION;var I=ge.orientationIndex(l,h,n),w=ge.orientationIndex(l,h,o);if(I>0&&w>0||I<0&&w<0)return t.NO_INTERSECTION;var D=_===0&&u===0&&I===0&&w===0;return D?this.computeCollinearIntersection(n,o,l,h):(_===0||u===0||I===0||w===0?(this._isProper=!1,n.equals2D(l)||n.equals2D(h)?this._intPt[0]=n:o.equals2D(l)||o.equals2D(h)?this._intPt[0]=o:_===0?this._intPt[0]=new It(l):u===0?this._intPt[0]=new It(h):I===0?this._intPt[0]=new It(n):w===0&&(this._intPt[0]=new It(o))):(this._isProper=!0,this._intPt[0]=this.intersection(n,o,l,h)),t.POINT_INTERSECTION)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.nearestEndpoint=function(n,o,l,h){var _=n,u=ge.distancePointLine(n,l,h),I=ge.distancePointLine(o,l,h);return I<u&&(u=I,_=o),I=ge.distancePointLine(l,n,o),I<u&&(u=I,_=l),I=ge.distancePointLine(h,n,o),I<u&&(u=I,_=h),_},e}(Dr),Wc=function(){};Wc.prototype.interfaces_=function(){return[]};Wc.prototype.getClass=function(){return Wc};Wc.orientationIndex=function(t,e,n){var o=e.x-t.x,l=e.y-t.y,h=n.x-e.x,_=n.y-e.y;return Wc.signOfDet2x2(o,l,h,_)};Wc.signOfDet2x2=function(t,e,n,o){var l=null,h=null,_=null;if(l=1,t===0||o===0)return e===0||n===0?0:e>0?n>0?-l:l:n>0?l:-l;if(e===0||n===0)return o>0?t>0?l:-l:t>0?-l:l;if(e>0?o>0?e<=o||(l=-l,h=t,t=n,n=h,h=e,e=o,o=h):e<=-o?(l=-l,n=-n,o=-o):(h=t,t=-n,n=h,h=e,e=-o,o=h):o>0?-e<=o?(l=-l,t=-t,e=-e):(h=-t,t=n,n=h,h=-e,e=o,o=h):e>=o?(t=-t,e=-e,n=-n,o=-o):(l=-l,h=-t,t=-n,n=h,h=-e,e=-o,o=h),t>0)if(n>0){if(!(t<=n))return l}else return l;else{if(n>0)return-l;if(t>=n)l=-l,t=-t,n=-n;else return-l}for(;;){if(_=Math.floor(n/t),n=n-_*t,o=o-_*e,o<0)return-l;if(o>e)return l;if(t>n+n){if(e<o+o)return l}else{if(e>o+o)return-l;n=t-n,o=e-o,l=-l}if(o===0)return n===0?0:-l;if(n===0||(_=Math.floor(t/n),t=t-_*n,e=e-_*o,e<0))return l;if(e>o)return-l;if(n>t+t){if(o<e+e)return-l}else{if(o>e+e)return l;t=n-t,e=o-e,l=-l}if(e===0)return t===0?0:l;if(t===0)return-l}};var ka=function(){this._p=null,this._crossingCount=0,this._isPointOnSegment=!1;var t=arguments[0];this._p=t};ka.prototype.countSegment=function(t,e){if(t.x<this._p.x&&e.x<this._p.x)return null;if(this._p.x===e.x&&this._p.y===e.y)return this._isPointOnSegment=!0,null;if(t.y===this._p.y&&e.y===this._p.y){var n=t.x,o=e.x;return n>o&&(n=e.x,o=t.x),this._p.x>=n&&this._p.x<=o&&(this._isPointOnSegment=!0),null}if(t.y>this._p.y&&e.y<=this._p.y||e.y>this._p.y&&t.y<=this._p.y){var l=t.x-this._p.x,h=t.y-this._p.y,_=e.x-this._p.x,u=e.y-this._p.y,I=Wc.signOfDet2x2(l,h,_,u);if(I===0)return this._isPointOnSegment=!0,null;u<h&&(I=-I),I>0&&this._crossingCount++}};ka.prototype.isPointInPolygon=function(){return this.getLocation()!==Mt.EXTERIOR};ka.prototype.getLocation=function(){return this._isPointOnSegment?Mt.BOUNDARY:this._crossingCount%2===1?Mt.INTERIOR:Mt.EXTERIOR};ka.prototype.isOnSegment=function(){return this._isPointOnSegment};ka.prototype.interfaces_=function(){return[]};ka.prototype.getClass=function(){return ka};ka.locatePointInRing=function(){if(arguments[0]instanceof It&&qe(arguments[1],Cn)){for(var t=arguments[0],e=arguments[1],n=new ka(t),o=new It,l=new It,h=1;h<e.size();h++)if(e.getCoordinate(h,o),e.getCoordinate(h-1,l),n.countSegment(o,l),n.isOnSegment())return n.getLocation();return n.getLocation()}else if(arguments[0]instanceof It&&arguments[1]instanceof Array){for(var _=arguments[0],u=arguments[1],I=new ka(_),w=1;w<u.length;w++){var D=u[w],k=u[w-1];if(I.countSegment(D,k),I.isOnSegment())return I.getLocation()}return I.getLocation()}};var ge=function(){},uh={CLOCKWISE:{configurable:!0},RIGHT:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},LEFT:{configurable:!0},COLLINEAR:{configurable:!0},STRAIGHT:{configurable:!0}};ge.prototype.interfaces_=function(){return[]};ge.prototype.getClass=function(){return ge};ge.orientationIndex=function(t,e,n){return Oo.orientationIndex(t,e,n)};ge.signedArea=function(){if(arguments[0]instanceof Array){var t=arguments[0];if(t.length<3)return 0;for(var e=0,n=t[0].x,o=1;o<t.length-1;o++){var l=t[o].x-n,h=t[o+1].y,_=t[o-1].y;e+=l*(_-h)}return e/2}else if(qe(arguments[0],Cn)){var u=arguments[0],I=u.size();if(I<3)return 0;var w=new It,D=new It,k=new It;u.getCoordinate(0,D),u.getCoordinate(1,k);var G=D.x;k.x-=G;for(var H=0,j=1;j<I-1;j++)w.y=D.y,D.x=k.x,D.y=k.y,u.getCoordinate(j+1,k),k.x-=G,H+=D.x*(w.y-k.y);return H/2}};ge.distanceLineLine=function(t,e,n,o){if(t.equals(e))return ge.distancePointLine(t,n,o);if(n.equals(o))return ge.distancePointLine(o,t,e);var l=!1;if(!De.intersects(t,e,n,o))l=!0;else{var h=(e.x-t.x)*(o.y-n.y)-(e.y-t.y)*(o.x-n.x);if(h===0)l=!0;else{var _=(t.y-n.y)*(o.x-n.x)-(t.x-n.x)*(o.y-n.y),u=(t.y-n.y)*(e.x-t.x)-(t.x-n.x)*(e.y-t.y),I=u/h,w=_/h;(w<0||w>1||I<0||I>1)&&(l=!0)}}return l?Es.min(ge.distancePointLine(t,n,o),ge.distancePointLine(e,n,o),ge.distancePointLine(n,t,e),ge.distancePointLine(o,t,e)):0};ge.isPointInRing=function(t,e){return ge.locatePointInRing(t,e)!==Mt.EXTERIOR};ge.computeLength=function(t){var e=t.size();if(e<=1)return 0;var n=0,o=new It;t.getCoordinate(0,o);for(var l=o.x,h=o.y,_=1;_<e;_++){t.getCoordinate(_,o);var u=o.x,I=o.y,w=u-l,D=I-h;n+=Math.sqrt(w*w+D*D),l=u,h=I}return n};ge.isCCW=function(t){var e=t.length-1;if(e<3)throw new Ir("Ring has fewer than 4 points, so orientation cannot be determined");for(var n=t[0],o=0,l=1;l<=e;l++){var h=t[l];h.y>n.y&&(n=h,o=l)}var _=o;do _=_-1,_<0&&(_=e);while(t[_].equals2D(n)&&_!==o);var u=o;do u=(u+1)%e;while(t[u].equals2D(n)&&u!==o);var I=t[_],w=t[u];if(I.equals2D(n)||w.equals2D(n)||I.equals2D(w))return!1;var D=ge.computeOrientation(I,n,w),k=!1;return D===0?k=I.x>w.x:k=D>0,k};ge.locatePointInRing=function(t,e){return ka.locatePointInRing(t,e)};ge.distancePointLinePerpendicular=function(t,e,n){var o=(n.x-e.x)*(n.x-e.x)+(n.y-e.y)*(n.y-e.y),l=((e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y))/o;return Math.abs(l)*Math.sqrt(o)};ge.computeOrientation=function(t,e,n){return ge.orientationIndex(t,e,n)};ge.distancePointLine=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(e.length===0)throw new Ir("Line array must contain at least one vertex");for(var n=t.distance(e[0]),o=0;o<e.length-1;o++){var l=ge.distancePointLine(t,e[o],e[o+1]);l<n&&(n=l)}return n}else if(arguments.length===3){var h=arguments[0],_=arguments[1],u=arguments[2];if(_.x===u.x&&_.y===u.y)return h.distance(_);var I=(u.x-_.x)*(u.x-_.x)+(u.y-_.y)*(u.y-_.y),w=((h.x-_.x)*(u.x-_.x)+(h.y-_.y)*(u.y-_.y))/I;if(w<=0)return h.distance(_);if(w>=1)return h.distance(u);var D=((_.y-h.y)*(u.x-_.x)-(_.x-h.x)*(u.y-_.y))/I;return Math.abs(D)*Math.sqrt(I)}};ge.isOnLine=function(t,e){for(var n=new bc,o=1;o<e.length;o++){var l=e[o-1],h=e[o];if(n.computeIntersection(t,l,h),n.hasIntersection())return!0}return!1};uh.CLOCKWISE.get=function(){return-1};uh.RIGHT.get=function(){return ge.CLOCKWISE};uh.COUNTERCLOCKWISE.get=function(){return 1};uh.LEFT.get=function(){return ge.COUNTERCLOCKWISE};uh.COLLINEAR.get=function(){return 0};uh.STRAIGHT.get=function(){return ge.COLLINEAR};Object.defineProperties(ge,uh);var Xl=function(){};Xl.prototype.filter=function(t){};Xl.prototype.interfaces_=function(){return[]};Xl.prototype.getClass=function(){return Xl};var Ge=function(){var t=arguments[0];this._envelope=null,this._factory=null,this._SRID=null,this._userData=null,this._factory=t,this._SRID=t.getSRID()},Il={serialVersionUID:{configurable:!0},SORTINDEX_POINT:{configurable:!0},SORTINDEX_MULTIPOINT:{configurable:!0},SORTINDEX_LINESTRING:{configurable:!0},SORTINDEX_LINEARRING:{configurable:!0},SORTINDEX_MULTILINESTRING:{configurable:!0},SORTINDEX_POLYGON:{configurable:!0},SORTINDEX_MULTIPOLYGON:{configurable:!0},SORTINDEX_GEOMETRYCOLLECTION:{configurable:!0},geometryChangedFilter:{configurable:!0}};Ge.prototype.isGeometryCollection=function(){return this.getSortIndex()===Ge.SORTINDEX_GEOMETRYCOLLECTION};Ge.prototype.getFactory=function(){return this._factory};Ge.prototype.getGeometryN=function(t){return this};Ge.prototype.getArea=function(){return 0};Ge.prototype.isRectangle=function(){return!1};Ge.prototype.equals=function(){if(arguments[0]instanceof Ge){var t=arguments[0];return t===null?!1:this.equalsTopo(t)}else if(arguments[0]instanceof Object){var e=arguments[0];if(!(e instanceof Ge))return!1;var n=e;return this.equalsExact(n)}};Ge.prototype.equalsExact=function(t){return this===t||this.equalsExact(t,0)};Ge.prototype.geometryChanged=function(){this.apply(Ge.geometryChangedFilter)};Ge.prototype.geometryChangedAction=function(){this._envelope=null};Ge.prototype.equalsNorm=function(t){return t===null?!1:this.norm().equalsExact(t.norm())};Ge.prototype.getLength=function(){return 0};Ge.prototype.getNumGeometries=function(){return 1};Ge.prototype.compareTo=function(){if(arguments.length===1){var t=arguments[0],e=t;return this.getSortIndex()!==e.getSortIndex()?this.getSortIndex()-e.getSortIndex():this.isEmpty()&&e.isEmpty()?0:this.isEmpty()?-1:e.isEmpty()?1:this.compareToSameClass(t)}else if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.getSortIndex()!==n.getSortIndex()?this.getSortIndex()-n.getSortIndex():this.isEmpty()&&n.isEmpty()?0:this.isEmpty()?-1:n.isEmpty()?1:this.compareToSameClass(n,o)}};Ge.prototype.getUserData=function(){return this._userData};Ge.prototype.getSRID=function(){return this._SRID};Ge.prototype.getEnvelope=function(){return this.getFactory().toGeometry(this.getEnvelopeInternal())};Ge.prototype.checkNotGeometryCollection=function(t){if(t.getSortIndex()===Ge.SORTINDEX_GEOMETRYCOLLECTION)throw new Ir("This method does not support GeometryCollection arguments")};Ge.prototype.equal=function(t,e,n){return n===0?t.equals(e):t.distance(e)<=n};Ge.prototype.norm=function(){var t=this.copy();return t.normalize(),t};Ge.prototype.getPrecisionModel=function(){return this._factory.getPrecisionModel()};Ge.prototype.getEnvelopeInternal=function(){return this._envelope===null&&(this._envelope=this.computeEnvelopeInternal()),new De(this._envelope)};Ge.prototype.setSRID=function(t){this._SRID=t};Ge.prototype.setUserData=function(t){this._userData=t};Ge.prototype.compare=function(t,e){for(var n=t.iterator(),o=e.iterator();n.hasNext()&&o.hasNext();){var l=n.next(),h=o.next(),_=l.compareTo(h);if(_!==0)return _}return n.hasNext()?1:o.hasNext()?-1:0};Ge.prototype.hashCode=function(){return this.getEnvelopeInternal().hashCode()};Ge.prototype.isGeometryCollectionOrDerived=function(){return this.getSortIndex()===Ge.SORTINDEX_GEOMETRYCOLLECTION||this.getSortIndex()===Ge.SORTINDEX_MULTIPOINT||this.getSortIndex()===Ge.SORTINDEX_MULTILINESTRING||this.getSortIndex()===Ge.SORTINDEX_MULTIPOLYGON};Ge.prototype.interfaces_=function(){return[cg,Vs,Gs]};Ge.prototype.getClass=function(){return Ge};Ge.hasNonEmptyElements=function(t){for(var e=0;e<t.length;e++)if(!t[e].isEmpty())return!0;return!1};Ge.hasNullElements=function(t){for(var e=0;e<t.length;e++)if(t[e]===null)return!0;return!1};Il.serialVersionUID.get=function(){return 8763622679187377e3};Il.SORTINDEX_POINT.get=function(){return 0};Il.SORTINDEX_MULTIPOINT.get=function(){return 1};Il.SORTINDEX_LINESTRING.get=function(){return 2};Il.SORTINDEX_LINEARRING.get=function(){return 3};Il.SORTINDEX_MULTILINESTRING.get=function(){return 4};Il.SORTINDEX_POLYGON.get=function(){return 5};Il.SORTINDEX_MULTIPOLYGON.get=function(){return 6};Il.SORTINDEX_GEOMETRYCOLLECTION.get=function(){return 7};Il.geometryChangedFilter.get=function(){return e_};Object.defineProperties(Ge,Il);var e_=function(){};e_.interfaces_=function(){return[Xl]};e_.filter=function(t){t.geometryChangedAction()};var gl=function(){};gl.prototype.filter=function(t){};gl.prototype.interfaces_=function(){return[]};gl.prototype.getClass=function(){return gl};var Fs=function(){},Kl={Mod2BoundaryNodeRule:{configurable:!0},EndPointBoundaryNodeRule:{configurable:!0},MultiValentEndPointBoundaryNodeRule:{configurable:!0},MonoValentEndPointBoundaryNodeRule:{configurable:!0},MOD2_BOUNDARY_RULE:{configurable:!0},ENDPOINT_BOUNDARY_RULE:{configurable:!0},MULTIVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},MONOVALENT_ENDPOINT_BOUNDARY_RULE:{configurable:!0},OGC_SFS_BOUNDARY_RULE:{configurable:!0}};Fs.prototype.isInBoundary=function(t){};Fs.prototype.interfaces_=function(){return[]};Fs.prototype.getClass=function(){return Fs};Kl.Mod2BoundaryNodeRule.get=function(){return ip};Kl.EndPointBoundaryNodeRule.get=function(){return op};Kl.MultiValentEndPointBoundaryNodeRule.get=function(){return sp};Kl.MonoValentEndPointBoundaryNodeRule.get=function(){return ap};Kl.MOD2_BOUNDARY_RULE.get=function(){return new ip};Kl.ENDPOINT_BOUNDARY_RULE.get=function(){return new op};Kl.MULTIVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new sp};Kl.MONOVALENT_ENDPOINT_BOUNDARY_RULE.get=function(){return new ap};Kl.OGC_SFS_BOUNDARY_RULE.get=function(){return Fs.MOD2_BOUNDARY_RULE};Object.defineProperties(Fs,Kl);var ip=function(){};ip.prototype.isInBoundary=function(t){return t%2===1};ip.prototype.interfaces_=function(){return[Fs]};ip.prototype.getClass=function(){return ip};var op=function(){};op.prototype.isInBoundary=function(t){return t>0};op.prototype.interfaces_=function(){return[Fs]};op.prototype.getClass=function(){return op};var sp=function(){};sp.prototype.isInBoundary=function(t){return t>1};sp.prototype.interfaces_=function(){return[Fs]};sp.prototype.getClass=function(){return sp};var ap=function(){};ap.prototype.isInBoundary=function(t){return t===1};ap.prototype.interfaces_=function(){return[Fs]};ap.prototype.getClass=function(){return ap};var ci=function(){};ci.prototype.add=function(){};ci.prototype.addAll=function(){};ci.prototype.isEmpty=function(){};ci.prototype.iterator=function(){};ci.prototype.size=function(){};ci.prototype.toArray=function(){};ci.prototype.remove=function(){};function n_(t){this.message=t||""}n_.prototype=new Error;n_.prototype.name="IndexOutOfBoundsException";var Ip=function(){};Ip.prototype.hasNext=function(){};Ip.prototype.next=function(){};Ip.prototype.remove=function(){};var ea=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(){},e.prototype.set=function(){},e.prototype.isEmpty=function(){},e}(ci);function Sp(t){this.message=t||""}Sp.prototype=new Error;Sp.prototype.name="NoSuchElementException";var se=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof ci&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.ensureCapacity=function(){},e.prototype.interfaces_=function(){return[t,ci]},e.prototype.add=function(n){return arguments.length===1?this.array_.push(n):this.array_.splice(arguments[0],arguments[1]),!0},e.prototype.clear=function(){this.array_=[]},e.prototype.addAll=function(n){for(var o=this,l=n.iterator();l.hasNext();)o.add(l.next());return!0},e.prototype.set=function(n,o){var l=this.array_[n];return this.array_[n]=o,l},e.prototype.iterator=function(){return new Iw(this)},e.prototype.get=function(n){if(n<0||n>=this.size())throw new n_;return this.array_[n]},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.size=function(){return this.array_.length},e.prototype.toArray=function(){for(var n=this,o=[],l=0,h=this.array_.length;l<h;l++)o.push(n.array_[l]);return o},e.prototype.remove=function(n){for(var o=this,l=!1,h=0,_=this.array_.length;h<_;h++)if(o.array_[h]===n){o.array_.splice(h,1),l=!0;break}return l},e}(ea),Iw=function(t){function e(n){t.call(this),this.arrayList_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.arrayList_.size())throw new Sp;return this.arrayList_.get(this.position_++)},e.prototype.hasNext=function(){return this.position_<this.arrayList_.size()},e.prototype.set=function(n){return this.arrayList_.set(this.position_-1,n)},e.prototype.remove=function(){this.arrayList_.remove(this.arrayList_.get(this.position_))},e}(Ip),Zf=function(t){function e(){if(t.call(this),arguments.length!==0){if(arguments.length===1){var o=arguments[0];this.ensureCapacity(o.length),this.add(o,!0)}else if(arguments.length===2){var l=arguments[0],h=arguments[1];this.ensureCapacity(l.length),this.add(l,h)}}}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={coordArrayType:{configurable:!0}};return n.coordArrayType.get=function(){return new Array(0).fill(null)},e.prototype.getCoordinate=function(o){return this.get(o)},e.prototype.addAll=function(){var o=this;if(arguments.length===2){for(var l=arguments[0],h=arguments[1],_=!1,u=l.iterator();u.hasNext();)o.add(u.next(),h),_=!0;return _}else return t.prototype.addAll.apply(this,arguments)},e.prototype.clone=function(){for(var o=this,l=t.prototype.clone.call(this),h=0;h<this.size();h++)l.add(h,o.get(h).copy());return l},e.prototype.toCoordinateArray=function(){return this.toArray(e.coordArrayType)},e.prototype.add=function(){var o=this;if(arguments.length===1){var l=arguments[0];t.prototype.add.call(this,l)}else if(arguments.length===2){if(arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var h=arguments[0],_=arguments[1];return this.add(h,_,!0),!0}else if(arguments[0]instanceof It&&typeof arguments[1]=="boolean"){var u=arguments[0],I=arguments[1];if(!I&&this.size()>=1){var w=this.get(this.size()-1);if(w.equals2D(u))return null}t.prototype.add.call(this,u)}else if(arguments[0]instanceof Object&&typeof arguments[1]=="boolean"){var D=arguments[0],k=arguments[1];return this.add(D,k),!0}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Array&&typeof arguments[1]=="boolean"){var G=arguments[0],H=arguments[1],j=arguments[2];if(j)for(var K=0;K<G.length;K++)o.add(G[K],H);else for(var lt=G.length-1;lt>=0;lt--)o.add(G[lt],H);return!0}else if(typeof arguments[2]=="boolean"&&Number.isInteger(arguments[0])&&arguments[1]instanceof It){var dt=arguments[0],xt=arguments[1],gt=arguments[2];if(!gt){var yt=this.size();if(yt>0){if(dt>0){var Nt=this.get(dt-1);if(Nt.equals2D(xt))return null}if(dt<yt){var Gt=this.get(dt);if(Gt.equals2D(xt))return null}}}t.prototype.add.call(this,dt,xt)}}else if(arguments.length===4){var Ut=arguments[0],Zt=arguments[1],qt=arguments[2],Qt=arguments[3],ie=1;qt>Qt&&(ie=-1);for(var ve=qt;ve!==Qt;ve+=ie)o.add(Ut[ve],Zt);return!0}},e.prototype.closeRing=function(){this.size()>0&&this.add(new It(this.get(0)),!1)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},Object.defineProperties(e,n),e}(se),mn=function(){},pg={ForwardComparator:{configurable:!0},BidirectionalComparator:{configurable:!0},coordArrayType:{configurable:!0}};pg.ForwardComparator.get=function(){return Af};pg.BidirectionalComparator.get=function(){return lp};pg.coordArrayType.get=function(){return new Array(0).fill(null)};mn.prototype.interfaces_=function(){return[]};mn.prototype.getClass=function(){return mn};mn.isRing=function(t){return!(t.length<4||!t[0].equals2D(t[t.length-1]))};mn.ptNotInList=function(t,e){for(var n=0;n<t.length;n++){var o=t[n];if(mn.indexOf(o,e)<0)return o}return null};mn.scroll=function(t,e){var n=mn.indexOf(e,t);if(n<0)return null;var o=new Array(t.length).fill(null);Yi.arraycopy(t,n,o,0,t.length-n),Yi.arraycopy(t,0,o,t.length-n,n),Yi.arraycopy(o,0,t,0,t.length)};mn.equals=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];if(t===e)return!0;if(t===null||e===null||t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].equals(e[n]))return!1;return!0}else if(arguments.length===3){var o=arguments[0],l=arguments[1],h=arguments[2];if(o===l)return!0;if(o===null||l===null||o.length!==l.length)return!1;for(var _=0;_<o.length;_++)if(h.compare(o[_],l[_])!==0)return!1;return!0}};mn.intersection=function(t,e){for(var n=new Zf,o=0;o<t.length;o++)e.intersects(t[o])&&n.add(t[o],!0);return n.toCoordinateArray()};mn.hasRepeatedPoints=function(t){for(var e=1;e<t.length;e++)if(t[e-1].equals(t[e]))return!0;return!1};mn.removeRepeatedPoints=function(t){if(!mn.hasRepeatedPoints(t))return t;var e=new Zf(t,!1);return e.toCoordinateArray()};mn.reverse=function(t){for(var e=t.length-1,n=Math.trunc(e/2),o=0;o<=n;o++){var l=t[o];t[o]=t[e-o],t[e-o]=l}};mn.removeNull=function(t){for(var e=0,n=0;n<t.length;n++)t[n]!==null&&e++;var o=new Array(e).fill(null);if(e===0)return o;for(var l=0,h=0;h<t.length;h++)t[h]!==null&&(o[l++]=t[h]);return o};mn.copyDeep=function(){if(arguments.length===1){for(var t=arguments[0],e=new Array(t.length).fill(null),n=0;n<t.length;n++)e[n]=new It(t[n]);return e}else if(arguments.length===5)for(var o=arguments[0],l=arguments[1],h=arguments[2],_=arguments[3],u=arguments[4],I=0;I<u;I++)h[_+I]=new It(o[l+I])};mn.isEqualReversed=function(t,e){for(var n=0;n<t.length;n++){var o=t[n],l=e[t.length-n-1];if(o.compareTo(l)!==0)return!1}return!0};mn.envelope=function(t){for(var e=new De,n=0;n<t.length;n++)e.expandToInclude(t[n]);return e};mn.toCoordinateArray=function(t){return t.toArray(mn.coordArrayType)};mn.atLeastNCoordinatesOrNothing=function(t,e){return e.length>=t?e:[]};mn.indexOf=function(t,e){for(var n=0;n<e.length;n++)if(t.equals(e[n]))return n;return-1};mn.increasingDirection=function(t){for(var e=0;e<Math.trunc(t.length/2);e++){var n=t.length-1-e,o=t[e].compareTo(t[n]);if(o!==0)return o}return 1};mn.compare=function(t,e){for(var n=0;n<t.length&&n<e.length;){var o=t[n].compareTo(e[n]);if(o!==0)return o;n++}return n<e.length?-1:n<t.length?1:0};mn.minCoordinate=function(t){for(var e=null,n=0;n<t.length;n++)(e===null||e.compareTo(t[n])>0)&&(e=t[n]);return e};mn.extract=function(t,e,n){e=Es.clamp(e,0,t.length),n=Es.clamp(n,-1,t.length);var o=n-e+1;n<0&&(o=0),e>=t.length&&(o=0),n<e&&(o=0);var l=new Array(o).fill(null);if(o===0)return l;for(var h=0,_=e;_<=n;_++)l[h++]=t[_];return l};Object.defineProperties(mn,pg);var Af=function(){};Af.prototype.compare=function(t,e){var n=t,o=e;return mn.compare(n,o)};Af.prototype.interfaces_=function(){return[np]};Af.prototype.getClass=function(){return Af};var lp=function(){};lp.prototype.compare=function(t,e){var n=t,o=e;if(n.length<o.length)return-1;if(n.length>o.length)return 1;if(n.length===0)return 0;var l=mn.compare(n,o),h=mn.isEqualReversed(n,o);return h?0:l};lp.prototype.OLDcompare=function(t,e){var n=t,o=e;if(n.length<o.length)return-1;if(n.length>o.length)return 1;if(n.length===0)return 0;for(var l=mn.increasingDirection(n),h=mn.increasingDirection(o),_=l>0?0:n.length-1,u=h>0?0:n.length-1,I=0;I<n.length;I++){var w=n[_].compareTo(o[u]);if(w!==0)return w;_+=l,u+=h}return 0};lp.prototype.interfaces_=function(){return[np]};lp.prototype.getClass=function(){return lp};var ch=function(){};ch.prototype.get=function(){};ch.prototype.put=function(){};ch.prototype.size=function(){};ch.prototype.values=function(){};ch.prototype.entrySet=function(){};var Sw=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e}(ch);function Xf(t){this.message=t||""}Xf.prototype=new Error;Xf.prototype.name="OperationNotSupported";function fg(){}fg.prototype=new ci;fg.prototype.contains=function(){};var r_=function(t){function e(){t.call(this),this.array_=[],arguments[0]instanceof ci&&this.addAll(arguments[0])}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.contains=function(n){for(var o=this,l=0,h=this.array_.length;l<h;l++){var _=o.array_[l];if(_===n)return!0}return!1},e.prototype.add=function(n){return this.contains(n)?!1:(this.array_.push(n),!0)},e.prototype.addAll=function(n){for(var o=this,l=n.iterator();l.hasNext();)o.add(l.next());return!0},e.prototype.remove=function(n){throw new Error},e.prototype.size=function(){return this.array_.length},e.prototype.isEmpty=function(){return this.array_.length===0},e.prototype.toArray=function(){for(var n=this,o=[],l=0,h=this.array_.length;l<h;l++)o.push(n.array_[l]);return o},e.prototype.iterator=function(){return new Tw(this)},e}(fg),Tw=function(t){function e(n){t.call(this),this.hashSet_=n,this.position_=0}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.next=function(){if(this.position_===this.hashSet_.size())throw new Sp;return this.hashSet_.array_[this.position_++]},e.prototype.hasNext=function(){return this.position_<this.hashSet_.size()},e.prototype.remove=function(){throw new Xf},e}(Ip),Gl=0,ec=1;function d0(t){return t===null?Gl:t.color}function sr(t){return t===null?null:t.parent}function Fl(t,e){t!==null&&(t.color=e)}function xm(t){return t===null?null:t.left}function g0(t){return t===null?null:t.right}function eo(){this.root_=null,this.size_=0}eo.prototype=new Sw;eo.prototype.get=function(t){for(var e=this.root_;e!==null;){var n=t.compareTo(e.key);if(n<0)e=e.left;else if(n>0)e=e.right;else return e.value}return null};eo.prototype.put=function(t,e){if(this.root_===null)return this.root_={key:t,value:e,left:null,right:null,parent:null,color:Gl,getValue:function(){return this.value},getKey:function(){return this.key}},this.size_=1,null;var n=this.root_,o,l;do if(o=n,l=t.compareTo(n.key),l<0)n=n.left;else if(l>0)n=n.right;else{var h=n.value;return n.value=e,h}while(n!==null);var _={key:t,left:null,right:null,value:e,parent:o,color:Gl,getValue:function(){return this.value},getKey:function(){return this.key}};return l<0?o.left=_:o.right=_,this.fixAfterInsertion(_),this.size_++,null};eo.prototype.fixAfterInsertion=function(t){var e=this;for(t.color=ec;t!=null&&t!==this.root_&&t.parent.color===ec;)if(sr(t)===xm(sr(sr(t)))){var n=g0(sr(sr(t)));d0(n)===ec?(Fl(sr(t),Gl),Fl(n,Gl),Fl(sr(sr(t)),ec),t=sr(sr(t))):(t===g0(sr(t))&&(t=sr(t),e.rotateLeft(t)),Fl(sr(t),Gl),Fl(sr(sr(t)),ec),e.rotateRight(sr(sr(t))))}else{var o=xm(sr(sr(t)));d0(o)===ec?(Fl(sr(t),Gl),Fl(o,Gl),Fl(sr(sr(t)),ec),t=sr(sr(t))):(t===xm(sr(t))&&(t=sr(t),e.rotateRight(t)),Fl(sr(t),Gl),Fl(sr(sr(t)),ec),e.rotateLeft(sr(sr(t))))}this.root_.color=Gl};eo.prototype.values=function(){var t=new se,e=this.getFirstEntry();if(e!==null)for(t.add(e.value);(e=eo.successor(e))!==null;)t.add(e.value);return t};eo.prototype.entrySet=function(){var t=new r_,e=this.getFirstEntry();if(e!==null)for(t.add(e);(e=eo.successor(e))!==null;)t.add(e);return t};eo.prototype.rotateLeft=function(t){if(t!=null){var e=t.right;t.right=e.left,e.left!=null&&(e.left.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.left===t?t.parent.left=e:t.parent.right=e,e.left=t,t.parent=e}};eo.prototype.rotateRight=function(t){if(t!=null){var e=t.left;t.left=e.right,e.right!=null&&(e.right.parent=t),e.parent=t.parent,t.parent===null?this.root_=e:t.parent.right===t?t.parent.right=e:t.parent.left=e,e.right=t,t.parent=e}};eo.prototype.getFirstEntry=function(){var t=this.root_;if(t!=null)for(;t.left!=null;)t=t.left;return t};eo.successor=function(t){if(t===null)return null;if(t.right!==null){for(var e=t.right;e.left!==null;)e=e.left;return e}else{for(var n=t.parent,o=t;n!==null&&o===n.right;)o=n,n=n.parent;return n}};eo.prototype.size=function(){return this.size_};var Lf=function(){};Lf.prototype.interfaces_=function(){return[]};Lf.prototype.getClass=function(){return Lf};function Sv(){}Sv.prototype=new fg;function Oa(){this.array_=[],arguments[0]instanceof ci&&this.addAll(arguments[0])}Oa.prototype=new Sv;Oa.prototype.contains=function(t){for(var e=this,n=0,o=this.array_.length;n<o;n++){var l=e.array_[n];if(l.compareTo(t)===0)return!0}return!1};Oa.prototype.add=function(t){var e=this;if(this.contains(t))return!1;for(var n=0,o=this.array_.length;n<o;n++){var l=e.array_[n];if(l.compareTo(t)===1)return e.array_.splice(n,0,t),!0}return this.array_.push(t),!0};Oa.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next());return!0};Oa.prototype.remove=function(t){throw new Xf};Oa.prototype.size=function(){return this.array_.length};Oa.prototype.isEmpty=function(){return this.array_.length===0};Oa.prototype.toArray=function(){for(var t=this,e=[],n=0,o=this.array_.length;n<o;n++)e.push(t.array_[n]);return e};Oa.prototype.iterator=function(){return new dg(this)};var dg=function(t){this.treeSet_=t,this.position_=0};dg.prototype.next=function(){if(this.position_===this.treeSet_.size())throw new Sp;return this.treeSet_.array_[this.position_++]};dg.prototype.hasNext=function(){return this.position_<this.treeSet_.size()};dg.prototype.remove=function(){throw new Xf};var lc=function(){};lc.sort=function(){var t=arguments[0],e,n,o,l;if(arguments.length===1)l=function(_,u){return _.compareTo(u)},t.sort(l);else if(arguments.length===2)o=arguments[1],l=function(_,u){return o.compare(_,u)},t.sort(l);else if(arguments.length===3){n=t.slice(arguments[1],arguments[2]),n.sort();var h=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length));for(t.splice(0,t.length),e=0;e<h.length;e++)t.push(h[e])}else if(arguments.length===4)for(n=t.slice(arguments[1],arguments[2]),o=arguments[3],l=function(_,u){return o.compare(_,u)},n.sort(l),h=t.slice(0,arguments[1]).concat(n,t.slice(arguments[2],t.length)),t.splice(0,t.length),e=0;e<h.length;e++)t.push(h[e])};lc.asList=function(t){for(var e=new se,n=0,o=t.length;n<o;n++)e.add(t[n]);return e};var Nn=function(){},ha={P:{configurable:!0},L:{configurable:!0},A:{configurable:!0},FALSE:{configurable:!0},TRUE:{configurable:!0},DONTCARE:{configurable:!0},SYM_FALSE:{configurable:!0},SYM_TRUE:{configurable:!0},SYM_DONTCARE:{configurable:!0},SYM_P:{configurable:!0},SYM_L:{configurable:!0},SYM_A:{configurable:!0}};ha.P.get=function(){return 0};ha.L.get=function(){return 1};ha.A.get=function(){return 2};ha.FALSE.get=function(){return-1};ha.TRUE.get=function(){return-2};ha.DONTCARE.get=function(){return-3};ha.SYM_FALSE.get=function(){return"F"};ha.SYM_TRUE.get=function(){return"T"};ha.SYM_DONTCARE.get=function(){return"*"};ha.SYM_P.get=function(){return"0"};ha.SYM_L.get=function(){return"1"};ha.SYM_A.get=function(){return"2"};Nn.prototype.interfaces_=function(){return[]};Nn.prototype.getClass=function(){return Nn};Nn.toDimensionSymbol=function(t){switch(t){case Nn.FALSE:return Nn.SYM_FALSE;case Nn.TRUE:return Nn.SYM_TRUE;case Nn.DONTCARE:return Nn.SYM_DONTCARE;case Nn.P:return Nn.SYM_P;case Nn.L:return Nn.SYM_L;case Nn.A:return Nn.SYM_A}throw new Ir("Unknown dimension value: "+t)};Nn.toDimensionValue=function(t){switch(Mf.toUpperCase(t)){case Nn.SYM_FALSE:return Nn.FALSE;case Nn.SYM_TRUE:return Nn.TRUE;case Nn.SYM_DONTCARE:return Nn.DONTCARE;case Nn.SYM_P:return Nn.P;case Nn.SYM_L:return Nn.L;case Nn.SYM_A:return Nn.A}throw new Ir("Unknown dimension symbol: "+t)};Object.defineProperties(Nn,ha);var za=function(){};za.prototype.filter=function(t){};za.prototype.interfaces_=function(){return[]};za.prototype.getClass=function(){return za};var ra=function(){};ra.prototype.filter=function(t,e){};ra.prototype.isDone=function(){};ra.prototype.isGeometryChanged=function(){};ra.prototype.interfaces_=function(){return[]};ra.prototype.getClass=function(){return ra};var Eo=function(t){function e(o,l){if(t.call(this,l),this._geometries=o||[],t.hasNullElements(this._geometries))throw new Ir("geometries must not contain null elements")}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){for(var o=this,l=new De,h=0;h<this._geometries.length;h++)l.expandToInclude(o._geometries[h].getEnvelopeInternal());return l},e.prototype.getGeometryN=function(o){return this._geometries[o]},e.prototype.getSortIndex=function(){return t.SORTINDEX_GEOMETRYCOLLECTION},e.prototype.getCoordinates=function(){for(var o=this,l=new Array(this.getNumPoints()).fill(null),h=-1,_=0;_<this._geometries.length;_++)for(var u=o._geometries[_].getCoordinates(),I=0;I<u.length;I++)h++,l[h]=u[I];return l},e.prototype.getArea=function(){for(var o=this,l=0,h=0;h<this._geometries.length;h++)l+=o._geometries[h].getArea();return l},e.prototype.equalsExact=function(){var o=this;if(arguments.length===2){var l=arguments[0],h=arguments[1];if(!this.isEquivalentClass(l))return!1;var _=l;if(this._geometries.length!==_._geometries.length)return!1;for(var u=0;u<this._geometries.length;u++)if(!o._geometries[u].equalsExact(_._geometries[u],h))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var o=this,l=0;l<this._geometries.length;l++)o._geometries[l].normalize();lc.sort(this._geometries)},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._geometries[0].getCoordinate()},e.prototype.getBoundaryDimension=function(){for(var o=this,l=Nn.FALSE,h=0;h<this._geometries.length;h++)l=Math.max(l,o._geometries[h].getBoundaryDimension());return l},e.prototype.getDimension=function(){for(var o=this,l=Nn.FALSE,h=0;h<this._geometries.length;h++)l=Math.max(l,o._geometries[h].getDimension());return l},e.prototype.getLength=function(){for(var o=this,l=0,h=0;h<this._geometries.length;h++)l+=o._geometries[h].getLength();return l},e.prototype.getNumPoints=function(){for(var o=this,l=0,h=0;h<this._geometries.length;h++)l+=o._geometries[h].getNumPoints();return l},e.prototype.getNumGeometries=function(){return this._geometries.length},e.prototype.reverse=function(){for(var o=this,l=this._geometries.length,h=new Array(l).fill(null),_=0;_<this._geometries.length;_++)h[_]=o._geometries[_].reverse();return this.getFactory().createGeometryCollection(h)},e.prototype.compareToSameClass=function(){var o=this;if(arguments.length===1){var l=arguments[0],h=new Oa(lc.asList(this._geometries)),_=new Oa(lc.asList(l._geometries));return this.compare(h,_)}else if(arguments.length===2){for(var u=arguments[0],I=arguments[1],w=u,D=this.getNumGeometries(),k=w.getNumGeometries(),G=0;G<D&&G<k;){var H=o.getGeometryN(G),j=w.getGeometryN(G),K=H.compareToSameClass(j,I);if(K!==0)return K;G++}return G<D?1:G<k?-1:0}},e.prototype.apply=function(){var o=this;if(qe(arguments[0],gl))for(var l=arguments[0],h=0;h<this._geometries.length;h++)o._geometries[h].apply(l);else if(qe(arguments[0],ra)){var _=arguments[0];if(this._geometries.length===0)return null;for(var u=0;u<this._geometries.length&&(o._geometries[u].apply(_),!_.isDone());u++);_.isGeometryChanged()&&this.geometryChanged()}else if(qe(arguments[0],za)){var I=arguments[0];I.filter(this);for(var w=0;w<this._geometries.length;w++)o._geometries[w].apply(I)}else if(qe(arguments[0],Xl)){var D=arguments[0];D.filter(this);for(var k=0;k<this._geometries.length;k++)o._geometries[k].apply(D)}},e.prototype.getBoundary=function(){return this.checkNotGeometryCollection(this),cn.shouldNeverReachHere(),null},e.prototype.clone=function(){var o=this,l=t.prototype.clone.call(this);l._geometries=new Array(this._geometries.length).fill(null);for(var h=0;h<this._geometries.length;h++)l._geometries[h]=o._geometries[h].clone();return l},e.prototype.getGeometryType=function(){return"GeometryCollection"},e.prototype.copy=function(){for(var o=this,l=new Array(this._geometries.length).fill(null),h=0;h<l.length;h++)l[h]=o._geometries[h].copy();return new e(l,this._factory)},e.prototype.isEmpty=function(){for(var o=this,l=0;l<this._geometries.length;l++)if(!o._geometries[l].isEmpty())return!1;return!0},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-5694727726395021e3},Object.defineProperties(e,n),e}(Ge),pc=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Ge.SORTINDEX_MULTILINESTRING},e.prototype.equalsExact=function(){if(arguments.length===2){var o=arguments[0],l=arguments[1];return this.isEquivalentClass(o)?t.prototype.equalsExact.call(this,o,l):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Nn.FALSE:0},e.prototype.isClosed=function(){var o=this;if(this.isEmpty())return!1;for(var l=0;l<this._geometries.length;l++)if(!o._geometries[l].isClosed())return!1;return!0},e.prototype.getDimension=function(){return 1},e.prototype.reverse=function(){for(var o=this,l=this._geometries.length,h=new Array(l).fill(null),_=0;_<this._geometries.length;_++)h[l-1-_]=o._geometries[_].reverse();return this.getFactory().createMultiLineString(h)},e.prototype.getBoundary=function(){return new Ns(this).getBoundary()},e.prototype.getGeometryType=function(){return"MultiLineString"},e.prototype.copy=function(){for(var o=this,l=new Array(this._geometries.length).fill(null),h=0;h<l.length;h++)l[h]=o._geometries[h].copy();return new e(l,this._factory)},e.prototype.interfaces_=function(){return[Lf]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 8166665132445434e3},Object.defineProperties(e,n),e}(Eo),Ns=function(){if(this._geom=null,this._geomFact=null,this._bnRule=null,this._endpointMap=null,arguments.length===1){var t=arguments[0],e=Fs.MOD2_BOUNDARY_RULE;this._geom=t,this._geomFact=t.getFactory(),this._bnRule=e}else if(arguments.length===2){var n=arguments[0],o=arguments[1];this._geom=n,this._geomFact=n.getFactory(),this._bnRule=o}};Ns.prototype.boundaryMultiLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();var e=this.computeBoundaryCoordinates(t);return e.length===1?this._geomFact.createPoint(e[0]):this._geomFact.createMultiPointFromCoords(e)};Ns.prototype.getBoundary=function(){return this._geom instanceof Fr?this.boundaryLineString(this._geom):this._geom instanceof pc?this.boundaryMultiLineString(this._geom):this._geom.getBoundary()};Ns.prototype.boundaryLineString=function(t){if(this._geom.isEmpty())return this.getEmptyMultiPoint();if(t.isClosed()){var e=this._bnRule.isInBoundary(2);return e?t.getStartPoint():this._geomFact.createMultiPoint()}return this._geomFact.createMultiPoint([t.getStartPoint(),t.getEndPoint()])};Ns.prototype.getEmptyMultiPoint=function(){return this._geomFact.createMultiPoint()};Ns.prototype.computeBoundaryCoordinates=function(t){var e=this,n=new se;this._endpointMap=new eo;for(var o=0;o<t.getNumGeometries();o++){var l=t.getGeometryN(o);l.getNumPoints()!==0&&(e.addEndpoint(l.getCoordinateN(0)),e.addEndpoint(l.getCoordinateN(l.getNumPoints()-1)))}for(var h=this._endpointMap.entrySet().iterator();h.hasNext();){var _=h.next(),u=_.getValue(),I=u.count;e._bnRule.isInBoundary(I)&&n.add(_.getKey())}return mn.toCoordinateArray(n)};Ns.prototype.addEndpoint=function(t){var e=this._endpointMap.get(t);e===null&&(e=new Hd,this._endpointMap.put(t,e)),e.count++};Ns.prototype.interfaces_=function(){return[]};Ns.prototype.getClass=function(){return Ns};Ns.getBoundary=function(){if(arguments.length===1){var t=arguments[0],e=new Ns(t);return e.getBoundary()}else if(arguments.length===2){var n=arguments[0],o=arguments[1],l=new Ns(n,o);return l.getBoundary()}};var Hd=function(){this.count=null};Hd.prototype.interfaces_=function(){return[]};Hd.prototype.getClass=function(){return Hd};function Cw(){}function Pw(){}var Mw=function(){};function Aw(){}function Lw(){}function Dw(){}var Rs=function(){},i_={NEWLINE:{configurable:!0},SIMPLE_ORDINATE_FORMAT:{configurable:!0}};Rs.prototype.interfaces_=function(){return[]};Rs.prototype.getClass=function(){return Rs};Rs.chars=function(t,e){for(var n=new Array(e).fill(null),o=0;o<e;o++)n[o]=t;return String(n)};Rs.getStackTrace=function(){if(arguments.length===1){var t=arguments[0],e=new Aw,n=new Cw;return t.printStackTrace(n),e.toString()}else if(arguments.length===2){var o=arguments[0],l=arguments[1],h="";new Pw(Rs.getStackTrace(o));for(var _=new Dw,u=0;u<l;u++)try{h+=_.readLine()+Rs.NEWLINE}catch(I){if(I instanceof Lw)cn.shouldNeverReachHere();else throw I}finally{}return h}};Rs.split=function(t,e){for(var n=e.length,o=new se,l=""+t,h=l.indexOf(e);h>=0;){var _=l.substring(0,h);o.add(_),l=l.substring(h+n),h=l.indexOf(e)}l.length>0&&o.add(l);for(var u=new Array(o.size()).fill(null),I=0;I<u.length;I++)u[I]=o.get(I);return u};Rs.toString=function(){if(arguments.length===1){var t=arguments[0];return Rs.SIMPLE_ORDINATE_FORMAT.format(t)}};Rs.spaces=function(t){return Rs.chars(" ",t)};i_.NEWLINE.get=function(){return Yi.getProperty("line.separator")};i_.SIMPLE_ORDINATE_FORMAT.get=function(){return new Mw};Object.defineProperties(Rs,i_);var $r=function(){};$r.prototype.interfaces_=function(){return[]};$r.prototype.getClass=function(){return $r};$r.copyCoord=function(t,e,n,o){for(var l=Math.min(t.getDimension(),n.getDimension()),h=0;h<l;h++)n.setOrdinate(o,h,t.getOrdinate(e,h))};$r.isRing=function(t){var e=t.size();return e===0?!0:e<=3?!1:t.getOrdinate(0,Cn.X)===t.getOrdinate(e-1,Cn.X)&&t.getOrdinate(0,Cn.Y)===t.getOrdinate(e-1,Cn.Y)};$r.isEqual=function(t,e){var n=t.size(),o=e.size();if(n!==o)return!1;for(var l=Math.min(t.getDimension(),e.getDimension()),h=0;h<n;h++)for(var _=0;_<l;_++){var u=t.getOrdinate(h,_),I=e.getOrdinate(h,_);if(t.getOrdinate(h,_)!==e.getOrdinate(h,_)&&!(Je.isNaN(u)&&Je.isNaN(I)))return!1}return!0};$r.extend=function(t,e,n){var o=t.create(n,e.getDimension()),l=e.size();if($r.copy(e,0,o,0,l),l>0)for(var h=l;h<n;h++)$r.copy(e,l-1,o,h,1);return o};$r.reverse=function(t){for(var e=t.size()-1,n=Math.trunc(e/2),o=0;o<=n;o++)$r.swap(t,o,e-o)};$r.swap=function(t,e,n){if(e===n)return null;for(var o=0;o<t.getDimension();o++){var l=t.getOrdinate(e,o);t.setOrdinate(e,o,t.getOrdinate(n,o)),t.setOrdinate(n,o,l)}};$r.copy=function(t,e,n,o,l){for(var h=0;h<l;h++)$r.copyCoord(t,e+h,n,o+h)};$r.toString=function(){if(arguments.length===1){var t=arguments[0],e=t.size();if(e===0)return"()";var n=t.getDimension(),o=new Xa;o.append("(");for(var l=0;l<e;l++){l>0&&o.append(" ");for(var h=0;h<n;h++)h>0&&o.append(","),o.append(Rs.toString(t.getOrdinate(l,h)))}return o.append(")"),o.toString()}};$r.ensureValidRing=function(t,e){var n=e.size();if(n===0)return e;if(n<=3)return $r.createClosedRing(t,e,4);var o=e.getOrdinate(0,Cn.X)===e.getOrdinate(n-1,Cn.X)&&e.getOrdinate(0,Cn.Y)===e.getOrdinate(n-1,Cn.Y);return o?e:$r.createClosedRing(t,e,n+1)};$r.createClosedRing=function(t,e,n){var o=t.create(n,e.getDimension()),l=e.size();$r.copy(e,0,o,0,l);for(var h=l;h<n;h++)$r.copy(e,0,o,h,1);return o};var Fr=function(t){function e(o,l){t.call(this,l),this._points=null,this.init(o)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this.isEmpty()?new De:this._points.expandEnvelope(new De)},e.prototype.isRing=function(){return this.isClosed()&&this.isSimple()},e.prototype.getSortIndex=function(){return t.SORTINDEX_LINESTRING},e.prototype.getCoordinates=function(){return this._points.toCoordinateArray()},e.prototype.equalsExact=function(){var o=this;if(arguments.length===2){var l=arguments[0],h=arguments[1];if(!this.isEquivalentClass(l))return!1;var _=l;if(this._points.size()!==_._points.size())return!1;for(var u=0;u<this._points.size();u++)if(!o.equal(o._points.getCoordinate(u),_._points.getCoordinate(u),h))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){for(var o=this,l=0;l<Math.trunc(this._points.size()/2);l++){var h=o._points.size()-1-l;if(!o._points.getCoordinate(l).equals(o._points.getCoordinate(h)))return o._points.getCoordinate(l).compareTo(o._points.getCoordinate(h))>0&&$r.reverse(o._points),null}},e.prototype.getCoordinate=function(){return this.isEmpty()?null:this._points.getCoordinate(0)},e.prototype.getBoundaryDimension=function(){return this.isClosed()?Nn.FALSE:0},e.prototype.isClosed=function(){return this.isEmpty()?!1:this.getCoordinateN(0).equals2D(this.getCoordinateN(this.getNumPoints()-1))},e.prototype.getEndPoint=function(){return this.isEmpty()?null:this.getPointN(this.getNumPoints()-1)},e.prototype.getDimension=function(){return 1},e.prototype.getLength=function(){return ge.computeLength(this._points)},e.prototype.getNumPoints=function(){return this._points.size()},e.prototype.reverse=function(){var o=this._points.copy();$r.reverse(o);var l=this.getFactory().createLineString(o);return l},e.prototype.compareToSameClass=function(){var o=this;if(arguments.length===1){for(var l=arguments[0],h=l,_=0,u=0;_<this._points.size()&&u<h._points.size();){var I=o._points.getCoordinate(_).compareTo(h._points.getCoordinate(u));if(I!==0)return I;_++,u++}return _<this._points.size()?1:u<h._points.size()?-1:0}else if(arguments.length===2){var w=arguments[0],D=arguments[1],k=w;return D.compare(this._points,k._points)}},e.prototype.apply=function(){var o=this;if(qe(arguments[0],gl))for(var l=arguments[0],h=0;h<this._points.size();h++)l.filter(o._points.getCoordinate(h));else if(qe(arguments[0],ra)){var _=arguments[0];if(this._points.size()===0)return null;for(var u=0;u<this._points.size()&&(_.filter(o._points,u),!_.isDone());u++);_.isGeometryChanged()&&this.geometryChanged()}else if(qe(arguments[0],za)){var I=arguments[0];I.filter(this)}else if(qe(arguments[0],Xl)){var w=arguments[0];w.filter(this)}},e.prototype.getBoundary=function(){return new Ns(this).getBoundary()},e.prototype.isEquivalentClass=function(o){return o instanceof e},e.prototype.clone=function(){var o=t.prototype.clone.call(this);return o._points=this._points.clone(),o},e.prototype.getCoordinateN=function(o){return this._points.getCoordinate(o)},e.prototype.getGeometryType=function(){return"LineString"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._points},e.prototype.isEmpty=function(){return this._points.size()===0},e.prototype.init=function(o){if(o===null&&(o=this.getFactory().getCoordinateSequenceFactory().create([])),o.size()===1)throw new Ir("Invalid number of points in LineString (found "+o.size()+" - must be 0 or >= 2)");this._points=o},e.prototype.isCoordinate=function(o){for(var l=this,h=0;h<this._points.size();h++)if(l._points.getCoordinate(h).equals(o))return!0;return!1},e.prototype.getStartPoint=function(){return this.isEmpty()?null:this.getPointN(0)},e.prototype.getPointN=function(o){return this.getFactory().createPoint(this._points.getCoordinate(o))},e.prototype.interfaces_=function(){return[Lf]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 0x2b2b51ba435c8e00},Object.defineProperties(e,n),e}(Ge),Df=function(){};Df.prototype.interfaces_=function(){return[]};Df.prototype.getClass=function(){return Df};var Qo=function(t){function e(o,l){t.call(this,l),this._coordinates=o||null,this.init(this._coordinates)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){if(this.isEmpty())return new De;var o=new De;return o.expandToInclude(this._coordinates.getX(0),this._coordinates.getY(0)),o},e.prototype.getSortIndex=function(){return t.SORTINDEX_POINT},e.prototype.getCoordinates=function(){return this.isEmpty()?[]:[this.getCoordinate()]},e.prototype.equalsExact=function(){if(arguments.length===2){var o=arguments[0],l=arguments[1];return this.isEquivalentClass(o)?this.isEmpty()&&o.isEmpty()?!0:this.isEmpty()!==o.isEmpty()?!1:this.equal(o.getCoordinate(),this.getCoordinate(),l):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){},e.prototype.getCoordinate=function(){return this._coordinates.size()!==0?this._coordinates.getCoordinate(0):null},e.prototype.getBoundaryDimension=function(){return Nn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getNumPoints=function(){return this.isEmpty()?0:1},e.prototype.reverse=function(){return this.copy()},e.prototype.getX=function(){if(this.getCoordinate()===null)throw new Error("getX called on empty Point");return this.getCoordinate().x},e.prototype.compareToSameClass=function(){if(arguments.length===1){var o=arguments[0],l=o;return this.getCoordinate().compareTo(l.getCoordinate())}else if(arguments.length===2){var h=arguments[0],_=arguments[1],u=h;return _.compare(this._coordinates,u._coordinates)}},e.prototype.apply=function(){if(qe(arguments[0],gl)){var o=arguments[0];if(this.isEmpty())return null;o.filter(this.getCoordinate())}else if(qe(arguments[0],ra)){var l=arguments[0];if(this.isEmpty())return null;l.filter(this._coordinates,0),l.isGeometryChanged()&&this.geometryChanged()}else if(qe(arguments[0],za)){var h=arguments[0];h.filter(this)}else if(qe(arguments[0],Xl)){var _=arguments[0];_.filter(this)}},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.clone=function(){var o=t.prototype.clone.call(this);return o._coordinates=this._coordinates.clone(),o},e.prototype.getGeometryType=function(){return"Point"},e.prototype.copy=function(){return new e(this._coordinates.copy(),this._factory)},e.prototype.getCoordinateSequence=function(){return this._coordinates},e.prototype.getY=function(){if(this.getCoordinate()===null)throw new Error("getY called on empty Point");return this.getCoordinate().y},e.prototype.isEmpty=function(){return this._coordinates.size()===0},e.prototype.init=function(o){o===null&&(o=this.getFactory().getCoordinateSequenceFactory().create([])),cn.isTrue(o.size()<=1),this._coordinates=o},e.prototype.isSimple=function(){return!0},e.prototype.interfaces_=function(){return[Df]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return 4902022702746615e3},Object.defineProperties(e,n),e}(Ge),Su=function(){};Su.prototype.interfaces_=function(){return[]};Su.prototype.getClass=function(){return Su};var di=function(t){function e(o,l,h){if(t.call(this,h),this._shell=null,this._holes=null,o===null&&(o=this.getFactory().createLinearRing()),l===null&&(l=[]),t.hasNullElements(l))throw new Ir("holes must not contain null elements");if(o.isEmpty()&&t.hasNonEmptyElements(l))throw new Ir("shell is empty but holes are not");this._shell=o,this._holes=l}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.computeEnvelopeInternal=function(){return this._shell.getEnvelopeInternal()},e.prototype.getSortIndex=function(){return t.SORTINDEX_POLYGON},e.prototype.getCoordinates=function(){var o=this;if(this.isEmpty())return[];for(var l=new Array(this.getNumPoints()).fill(null),h=-1,_=this._shell.getCoordinates(),u=0;u<_.length;u++)h++,l[h]=_[u];for(var I=0;I<this._holes.length;I++)for(var w=o._holes[I].getCoordinates(),D=0;D<w.length;D++)h++,l[h]=w[D];return l},e.prototype.getArea=function(){var o=this,l=0;l+=Math.abs(ge.signedArea(this._shell.getCoordinateSequence()));for(var h=0;h<this._holes.length;h++)l-=Math.abs(ge.signedArea(o._holes[h].getCoordinateSequence()));return l},e.prototype.isRectangle=function(){if(this.getNumInteriorRing()!==0||this._shell===null||this._shell.getNumPoints()!==5)return!1;for(var o=this._shell.getCoordinateSequence(),l=this.getEnvelopeInternal(),h=0;h<5;h++){var _=o.getX(h);if(!(_===l.getMinX()||_===l.getMaxX()))return!1;var u=o.getY(h);if(!(u===l.getMinY()||u===l.getMaxY()))return!1}for(var I=o.getX(0),w=o.getY(0),D=1;D<=4;D++){var k=o.getX(D),G=o.getY(D),H=k!==I,j=G!==w;if(H===j)return!1;I=k,w=G}return!0},e.prototype.equalsExact=function(){var o=this;if(arguments.length===2){var l=arguments[0],h=arguments[1];if(!this.isEquivalentClass(l))return!1;var _=l,u=this._shell,I=_._shell;if(!u.equalsExact(I,h)||this._holes.length!==_._holes.length)return!1;for(var w=0;w<this._holes.length;w++)if(!o._holes[w].equalsExact(_._holes[w],h))return!1;return!0}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.normalize=function(){var o=this;if(arguments.length===0){this.normalize(this._shell,!0);for(var l=0;l<this._holes.length;l++)o.normalize(o._holes[l],!1);lc.sort(this._holes)}else if(arguments.length===2){var h=arguments[0],_=arguments[1];if(h.isEmpty())return null;var u=new Array(h.getCoordinates().length-1).fill(null);Yi.arraycopy(h.getCoordinates(),0,u,0,u.length);var I=mn.minCoordinate(h.getCoordinates());mn.scroll(u,I),Yi.arraycopy(u,0,h.getCoordinates(),0,u.length),h.getCoordinates()[u.length]=u[0],ge.isCCW(h.getCoordinates())===_&&mn.reverse(h.getCoordinates())}},e.prototype.getCoordinate=function(){return this._shell.getCoordinate()},e.prototype.getNumInteriorRing=function(){return this._holes.length},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.getLength=function(){var o=this,l=0;l+=this._shell.getLength();for(var h=0;h<this._holes.length;h++)l+=o._holes[h].getLength();return l},e.prototype.getNumPoints=function(){for(var o=this,l=this._shell.getNumPoints(),h=0;h<this._holes.length;h++)l+=o._holes[h].getNumPoints();return l},e.prototype.reverse=function(){var o=this,l=this.copy();l._shell=this._shell.copy().reverse(),l._holes=new Array(this._holes.length).fill(null);for(var h=0;h<this._holes.length;h++)l._holes[h]=o._holes[h].copy().reverse();return l},e.prototype.convexHull=function(){return this.getExteriorRing().convexHull()},e.prototype.compareToSameClass=function(){var o=this;if(arguments.length===1){var l=arguments[0],h=this._shell,_=l._shell;return h.compareToSameClass(_)}else if(arguments.length===2){var u=arguments[0],I=arguments[1],w=u,D=this._shell,k=w._shell,G=D.compareToSameClass(k,I);if(G!==0)return G;for(var H=this.getNumInteriorRing(),j=w.getNumInteriorRing(),K=0;K<H&&K<j;){var lt=o.getInteriorRingN(K),dt=w.getInteriorRingN(K),xt=lt.compareToSameClass(dt,I);if(xt!==0)return xt;K++}return K<H?1:K<j?-1:0}},e.prototype.apply=function(o){var l=this;if(qe(o,gl)){this._shell.apply(o);for(var h=0;h<this._holes.length;h++)l._holes[h].apply(o)}else if(qe(o,ra)){if(this._shell.apply(o),!o.isDone())for(var _=0;_<this._holes.length&&(l._holes[_].apply(o),!o.isDone());_++);o.isGeometryChanged()&&this.geometryChanged()}else if(qe(o,za))o.filter(this);else if(qe(o,Xl)){o.filter(this),this._shell.apply(o);for(var u=0;u<this._holes.length;u++)l._holes[u].apply(o)}},e.prototype.getBoundary=function(){var o=this;if(this.isEmpty())return this.getFactory().createMultiLineString();var l=new Array(this._holes.length+1).fill(null);l[0]=this._shell;for(var h=0;h<this._holes.length;h++)l[h+1]=o._holes[h];return l.length<=1?this.getFactory().createLinearRing(l[0].getCoordinateSequence()):this.getFactory().createMultiLineString(l)},e.prototype.clone=function(){var o=this,l=t.prototype.clone.call(this);l._shell=this._shell.clone(),l._holes=new Array(this._holes.length).fill(null);for(var h=0;h<this._holes.length;h++)l._holes[h]=o._holes[h].clone();return l},e.prototype.getGeometryType=function(){return"Polygon"},e.prototype.copy=function(){for(var o=this,l=this._shell.copy(),h=new Array(this._holes.length).fill(null),_=0;_<h.length;_++)h[_]=o._holes[_].copy();return new e(l,h,this._factory)},e.prototype.getExteriorRing=function(){return this._shell},e.prototype.isEmpty=function(){return this._shell.isEmpty()},e.prototype.getInteriorRingN=function(o){return this._holes[o]},e.prototype.interfaces_=function(){return[Su]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x307ffefd8dc97200},Object.defineProperties(e,n),e}(Ge),up=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Ge.SORTINDEX_MULTIPOINT},e.prototype.isValid=function(){return!0},e.prototype.equalsExact=function(){if(arguments.length===2){var o=arguments[0],l=arguments[1];return this.isEquivalentClass(o)?t.prototype.equalsExact.call(this,o,l):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getCoordinate=function(){if(arguments.length===1){var o=arguments[0];return this._geometries[o].getCoordinate()}else return t.prototype.getCoordinate.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return Nn.FALSE},e.prototype.getDimension=function(){return 0},e.prototype.getBoundary=function(){return this.getFactory().createGeometryCollection(null)},e.prototype.getGeometryType=function(){return"MultiPoint"},e.prototype.copy=function(){for(var o=this,l=new Array(this._geometries.length).fill(null),h=0;h<l.length;h++)l[h]=o._geometries[h].copy();return new e(l,this._factory)},e.prototype.interfaces_=function(){return[Df]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-8048474874175356e3},Object.defineProperties(e,n),e}(Eo),ml=function(t){function e(o,l){o instanceof It&&l instanceof gn&&(o=l.getCoordinateSequenceFactory().create(o)),t.call(this,o,l),this.validateConstruction()}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={MINIMUM_VALID_SIZE:{configurable:!0},serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Ge.SORTINDEX_LINEARRING},e.prototype.getBoundaryDimension=function(){return Nn.FALSE},e.prototype.isClosed=function(){return this.isEmpty()?!0:t.prototype.isClosed.call(this)},e.prototype.reverse=function(){var o=this._points.copy();$r.reverse(o);var l=this.getFactory().createLinearRing(o);return l},e.prototype.validateConstruction=function(){if(!this.isEmpty()&&!t.prototype.isClosed.call(this))throw new Ir("Points of LinearRing do not form a closed linestring");if(this.getCoordinateSequence().size()>=1&&this.getCoordinateSequence().size()<e.MINIMUM_VALID_SIZE)throw new Ir("Invalid number of points in LinearRing (found "+this.getCoordinateSequence().size()+" - must be 0 or >= 4)")},e.prototype.getGeometryType=function(){return"LinearRing"},e.prototype.copy=function(){return new e(this._points.copy(),this._factory)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.MINIMUM_VALID_SIZE.get=function(){return 4},n.serialVersionUID.get=function(){return-0x3b229e262367a600},Object.defineProperties(e,n),e}(Fr),fl=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={serialVersionUID:{configurable:!0}};return e.prototype.getSortIndex=function(){return Ge.SORTINDEX_MULTIPOLYGON},e.prototype.equalsExact=function(){if(arguments.length===2){var o=arguments[0],l=arguments[1];return this.isEquivalentClass(o)?t.prototype.equalsExact.call(this,o,l):!1}else return t.prototype.equalsExact.apply(this,arguments)},e.prototype.getBoundaryDimension=function(){return 1},e.prototype.getDimension=function(){return 2},e.prototype.reverse=function(){for(var o=this,l=this._geometries.length,h=new Array(l).fill(null),_=0;_<this._geometries.length;_++)h[_]=o._geometries[_].reverse();return this.getFactory().createMultiPolygon(h)},e.prototype.getBoundary=function(){var o=this;if(this.isEmpty())return this.getFactory().createMultiLineString();for(var l=new se,h=0;h<this._geometries.length;h++)for(var _=o._geometries[h],u=_.getBoundary(),I=0;I<u.getNumGeometries();I++)l.add(u.getGeometryN(I));var w=new Array(l.size()).fill(null);return this.getFactory().createMultiLineString(l.toArray(w))},e.prototype.getGeometryType=function(){return"MultiPolygon"},e.prototype.copy=function(){for(var o=this,l=new Array(this._geometries.length).fill(null),h=0;h<l.length;h++)l[h]=o._geometries[h].copy();return new e(l,this._factory)},e.prototype.interfaces_=function(){return[Su]},e.prototype.getClass=function(){return e},n.serialVersionUID.get=function(){return-0x7a5aa1369171980},Object.defineProperties(e,n),e}(Eo),Bs=function(t){this._factory=t||null,this._isUserDataCopied=!1},gg={NoOpGeometryOperation:{configurable:!0},CoordinateOperation:{configurable:!0},CoordinateSequenceOperation:{configurable:!0}};Bs.prototype.setCopyUserData=function(t){this._isUserDataCopied=t};Bs.prototype.edit=function(t,e){if(t===null)return null;var n=this.editInternal(t,e);return this._isUserDataCopied&&n.setUserData(t.getUserData()),n};Bs.prototype.editInternal=function(t,e){return this._factory===null&&(this._factory=t.getFactory()),t instanceof Eo?this.editGeometryCollection(t,e):t instanceof di?this.editPolygon(t,e):t instanceof Qo?e.edit(t,this._factory):t instanceof Fr?e.edit(t,this._factory):(cn.shouldNeverReachHere("Unsupported Geometry class: "+t.getClass().getName()),null)};Bs.prototype.editGeometryCollection=function(t,e){for(var n=this,o=e.edit(t,this._factory),l=new se,h=0;h<o.getNumGeometries();h++){var _=n.edit(o.getGeometryN(h),e);_===null||_.isEmpty()||l.add(_)}return o.getClass()===up?this._factory.createMultiPoint(l.toArray([])):o.getClass()===pc?this._factory.createMultiLineString(l.toArray([])):o.getClass()===fl?this._factory.createMultiPolygon(l.toArray([])):this._factory.createGeometryCollection(l.toArray([]))};Bs.prototype.editPolygon=function(t,e){var n=this,o=e.edit(t,this._factory);if(o===null&&(o=this._factory.createPolygon(null)),o.isEmpty())return o;var l=this.edit(o.getExteriorRing(),e);if(l===null||l.isEmpty())return this._factory.createPolygon();for(var h=new se,_=0;_<o.getNumInteriorRing();_++){var u=n.edit(o.getInteriorRingN(_),e);u===null||u.isEmpty()||h.add(u)}return this._factory.createPolygon(l,h.toArray([]))};Bs.prototype.interfaces_=function(){return[]};Bs.prototype.getClass=function(){return Bs};Bs.GeometryEditorOperation=function(){};gg.NoOpGeometryOperation.get=function(){return kf};gg.CoordinateOperation.get=function(){return Nf};gg.CoordinateSequenceOperation.get=function(){return Rf};Object.defineProperties(Bs,gg);var kf=function(){};kf.prototype.edit=function(t,e){return t};kf.prototype.interfaces_=function(){return[Bs.GeometryEditorOperation]};kf.prototype.getClass=function(){return kf};var Nf=function(){};Nf.prototype.edit=function(t,e){var n=this.editCoordinates(t.getCoordinates(),t);return n===null?t:t instanceof ml?e.createLinearRing(n):t instanceof Fr?e.createLineString(n):t instanceof Qo?n.length>0?e.createPoint(n[0]):e.createPoint():t};Nf.prototype.interfaces_=function(){return[Bs.GeometryEditorOperation]};Nf.prototype.getClass=function(){return Nf};var Rf=function(){};Rf.prototype.edit=function(t,e){return t instanceof ml?e.createLinearRing(this.edit(t.getCoordinateSequence(),t)):t instanceof Fr?e.createLineString(this.edit(t.getCoordinateSequence(),t)):t instanceof Qo?e.createPoint(this.edit(t.getCoordinateSequence(),t)):t};Rf.prototype.interfaces_=function(){return[Bs.GeometryEditorOperation]};Rf.prototype.getClass=function(){return Rf};var Wr=function(){var t=this;if(this._dimension=3,this._coordinates=null,arguments.length===1){if(arguments[0]instanceof Array)this._coordinates=arguments[0],this._dimension=3;else if(Number.isInteger(arguments[0])){var e=arguments[0];this._coordinates=new Array(e).fill(null);for(var n=0;n<e;n++)t._coordinates[n]=new It}else if(qe(arguments[0],Cn)){var o=arguments[0];if(o===null)return this._coordinates=new Array(0).fill(null),null;this._dimension=o.getDimension(),this._coordinates=new Array(o.size()).fill(null);for(var l=0;l<this._coordinates.length;l++)t._coordinates[l]=o.getCoordinateCopy(l)}}else if(arguments.length===2){if(arguments[0]instanceof Array&&Number.isInteger(arguments[1])){var h=arguments[0],_=arguments[1];this._coordinates=h,this._dimension=_,h===null&&(this._coordinates=new Array(0).fill(null))}else if(Number.isInteger(arguments[0])&&Number.isInteger(arguments[1])){var u=arguments[0],I=arguments[1];this._coordinates=new Array(u).fill(null),this._dimension=I;for(var w=0;w<u;w++)t._coordinates[w]=new It}}},Tv={serialVersionUID:{configurable:!0}};Wr.prototype.setOrdinate=function(t,e,n){switch(e){case Cn.X:this._coordinates[t].x=n;break;case Cn.Y:this._coordinates[t].y=n;break;case Cn.Z:this._coordinates[t].z=n;break;default:throw new Ir("invalid ordinateIndex")}};Wr.prototype.size=function(){return this._coordinates.length};Wr.prototype.getOrdinate=function(t,e){switch(e){case Cn.X:return this._coordinates[t].x;case Cn.Y:return this._coordinates[t].y;case Cn.Z:return this._coordinates[t].z}return Je.NaN};Wr.prototype.getCoordinate=function(){if(arguments.length===1){var t=arguments[0];return this._coordinates[t]}else if(arguments.length===2){var e=arguments[0],n=arguments[1];n.x=this._coordinates[e].x,n.y=this._coordinates[e].y,n.z=this._coordinates[e].z}};Wr.prototype.getCoordinateCopy=function(t){return new It(this._coordinates[t])};Wr.prototype.getDimension=function(){return this._dimension};Wr.prototype.getX=function(t){return this._coordinates[t].x};Wr.prototype.clone=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].clone();return new Wr(e,this._dimension)};Wr.prototype.expandEnvelope=function(t){for(var e=this,n=0;n<this._coordinates.length;n++)t.expandToInclude(e._coordinates[n]);return t};Wr.prototype.copy=function(){for(var t=this,e=new Array(this.size()).fill(null),n=0;n<this._coordinates.length;n++)e[n]=t._coordinates[n].copy();return new Wr(e,this._dimension)};Wr.prototype.toString=function(){var t=this;if(this._coordinates.length>0){var e=new Xa(17*this._coordinates.length);e.append("("),e.append(this._coordinates[0]);for(var n=1;n<this._coordinates.length;n++)e.append(", "),e.append(t._coordinates[n]);return e.append(")"),e.toString()}else return"()"};Wr.prototype.getY=function(t){return this._coordinates[t].y};Wr.prototype.toCoordinateArray=function(){return this._coordinates};Wr.prototype.interfaces_=function(){return[Cn,Gs]};Wr.prototype.getClass=function(){return Wr};Tv.serialVersionUID.get=function(){return-0xcb44a778db18e00};Object.defineProperties(Wr,Tv);var _l=function(){},o_={serialVersionUID:{configurable:!0},instanceObject:{configurable:!0}};_l.prototype.readResolve=function(){return _l.instance()};_l.prototype.create=function(){if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return new Wr(t)}else if(qe(arguments[0],Cn)){var e=arguments[0];return new Wr(e)}}else if(arguments.length===2){var n=arguments[0],o=arguments[1];return o>3&&(o=3),o<2?new Wr(n):new Wr(n,o)}};_l.prototype.interfaces_=function(){return[rp,Gs]};_l.prototype.getClass=function(){return _l};_l.instance=function(){return _l.instanceObject};o_.serialVersionUID.get=function(){return-0x38e49fa6cf6f2e00};o_.instanceObject.get=function(){return new _l};Object.defineProperties(_l,o_);var Cv=function(t){function e(){t.call(this),this.map_=new Map}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.get=function(n){return this.map_.get(n)||null},e.prototype.put=function(n,o){return this.map_.set(n,o),o},e.prototype.values=function(){for(var n=new se,o=this.map_.values(),l=o.next();!l.done;)n.add(l.value),l=o.next();return n},e.prototype.entrySet=function(){var n=new r_;return this.map_.entries().forEach(function(o){return n.add(o)}),n},e.prototype.size=function(){return this.map_.size()},e}(ch),On=function t(){if(this._modelType=null,this._scale=null,arguments.length===0)this._modelType=t.FLOATING;else if(arguments.length===1){if(arguments[0]instanceof Fa){var e=arguments[0];this._modelType=e,e===t.FIXED&&this.setScale(1)}else if(typeof arguments[0]=="number"){var n=arguments[0];this._modelType=t.FIXED,this.setScale(n)}else if(arguments[0]instanceof t){var o=arguments[0];this._modelType=o._modelType,this._scale=o._scale}}},s_={serialVersionUID:{configurable:!0},maximumPreciseValue:{configurable:!0}};On.prototype.equals=function(t){if(!(t instanceof On))return!1;var e=t;return this._modelType===e._modelType&&this._scale===e._scale};On.prototype.compareTo=function(t){var e=t,n=this.getMaximumSignificantDigits(),o=e.getMaximumSignificantDigits();return new Ra(n).compareTo(new Ra(o))};On.prototype.getScale=function(){return this._scale};On.prototype.isFloating=function(){return this._modelType===On.FLOATING||this._modelType===On.FLOATING_SINGLE};On.prototype.getType=function(){return this._modelType};On.prototype.toString=function(){var t="UNKNOWN";return this._modelType===On.FLOATING?t="Floating":this._modelType===On.FLOATING_SINGLE?t="Floating-Single":this._modelType===On.FIXED&&(t="Fixed (Scale="+this.getScale()+")"),t};On.prototype.makePrecise=function(){if(typeof arguments[0]=="number"){var t=arguments[0];if(Je.isNaN(t))return t;if(this._modelType===On.FLOATING_SINGLE){var e=t;return e}return this._modelType===On.FIXED?Math.round(t*this._scale)/this._scale:t}else if(arguments[0]instanceof It){var n=arguments[0];if(this._modelType===On.FLOATING)return null;n.x=this.makePrecise(n.x),n.y=this.makePrecise(n.y)}};On.prototype.getMaximumSignificantDigits=function(){var t=16;return this._modelType===On.FLOATING?t=16:this._modelType===On.FLOATING_SINGLE?t=6:this._modelType===On.FIXED&&(t=1+Math.trunc(Math.ceil(Math.log(this.getScale())/Math.log(10)))),t};On.prototype.setScale=function(t){this._scale=Math.abs(t)};On.prototype.interfaces_=function(){return[Gs,Vs]};On.prototype.getClass=function(){return On};On.mostPrecise=function(t,e){return t.compareTo(e)>=0?t:e};s_.serialVersionUID.get=function(){return 7777263578777804e3};s_.maximumPreciseValue.get=function(){return 9007199254740992};Object.defineProperties(On,s_);var Fa=function t(e){this._name=e||null,t.nameToTypeMap.put(e,this)},a_={serialVersionUID:{configurable:!0},nameToTypeMap:{configurable:!0}};Fa.prototype.readResolve=function(){return Fa.nameToTypeMap.get(this._name)};Fa.prototype.toString=function(){return this._name};Fa.prototype.interfaces_=function(){return[Gs]};Fa.prototype.getClass=function(){return Fa};a_.serialVersionUID.get=function(){return-552860263173159e4};a_.nameToTypeMap.get=function(){return new Cv};Object.defineProperties(Fa,a_);On.Type=Fa;On.FIXED=new Fa("FIXED");On.FLOATING=new Fa("FLOATING");On.FLOATING_SINGLE=new Fa("FLOATING SINGLE");var gn=function t(){this._precisionModel=new On,this._SRID=0,this._coordinateSequenceFactory=t.getDefaultCoordinateSequenceFactory(),arguments.length===0||(arguments.length===1?qe(arguments[0],rp)?this._coordinateSequenceFactory=arguments[0]:arguments[0]instanceof On&&(this._precisionModel=arguments[0]):arguments.length===2?(this._precisionModel=arguments[0],this._SRID=arguments[1]):arguments.length===3&&(this._precisionModel=arguments[0],this._SRID=arguments[1],this._coordinateSequenceFactory=arguments[2]))},Pv={serialVersionUID:{configurable:!0}};gn.prototype.toGeometry=function(t){return t.isNull()?this.createPoint(null):t.getMinX()===t.getMaxX()&&t.getMinY()===t.getMaxY()?this.createPoint(new It(t.getMinX(),t.getMinY())):t.getMinX()===t.getMaxX()||t.getMinY()===t.getMaxY()?this.createLineString([new It(t.getMinX(),t.getMinY()),new It(t.getMaxX(),t.getMaxY())]):this.createPolygon(this.createLinearRing([new It(t.getMinX(),t.getMinY()),new It(t.getMinX(),t.getMaxY()),new It(t.getMaxX(),t.getMaxY()),new It(t.getMaxX(),t.getMinY()),new It(t.getMinX(),t.getMinY())]),null)};gn.prototype.createLineString=function(t){if(t){if(t instanceof Array)return new Fr(this.getCoordinateSequenceFactory().create(t),this);if(qe(t,Cn))return new Fr(t,this)}else return new Fr(this.getCoordinateSequenceFactory().create([]),this)};gn.prototype.createMultiLineString=function(){if(arguments.length===0)return new pc(null,this);if(arguments.length===1){var t=arguments[0];return new pc(t,this)}};gn.prototype.buildGeometry=function(t){for(var e=null,n=!1,o=!1,l=t.iterator();l.hasNext();){var h=l.next(),_=h.getClass();e===null&&(e=_),_!==e&&(n=!0),h.isGeometryCollectionOrDerived()&&(o=!0)}if(e===null)return this.createGeometryCollection();if(n||o)return this.createGeometryCollection(gn.toGeometryArray(t));var u=t.iterator().next(),I=t.size()>1;if(I){if(u instanceof di)return this.createMultiPolygon(gn.toPolygonArray(t));if(u instanceof Fr)return this.createMultiLineString(gn.toLineStringArray(t));if(u instanceof Qo)return this.createMultiPoint(gn.toPointArray(t));cn.shouldNeverReachHere("Unhandled class: "+u.getClass().getName())}return u};gn.prototype.createMultiPointFromCoords=function(t){return this.createMultiPoint(t!==null?this.getCoordinateSequenceFactory().create(t):null)};gn.prototype.createPoint=function(){if(arguments.length===0)return this.createPoint(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof It){var t=arguments[0];return this.createPoint(t!==null?this.getCoordinateSequenceFactory().create([t]):null)}else if(qe(arguments[0],Cn)){var e=arguments[0];return new Qo(e,this)}}};gn.prototype.getCoordinateSequenceFactory=function(){return this._coordinateSequenceFactory};gn.prototype.createPolygon=function(){if(arguments.length===0)return new di(null,null,this);if(arguments.length===1){if(qe(arguments[0],Cn)){var t=arguments[0];return this.createPolygon(this.createLinearRing(t))}else if(arguments[0]instanceof Array){var e=arguments[0];return this.createPolygon(this.createLinearRing(e))}else if(arguments[0]instanceof ml){var n=arguments[0];return this.createPolygon(n,null)}}else if(arguments.length===2){var o=arguments[0],l=arguments[1];return new di(o,l,this)}};gn.prototype.getSRID=function(){return this._SRID};gn.prototype.createGeometryCollection=function(){if(arguments.length===0)return new Eo(null,this);if(arguments.length===1){var t=arguments[0];return new Eo(t,this)}};gn.prototype.createGeometry=function(t){var e=new Bs(this);return e.edit(t,{edit:function(){if(arguments.length===2){var n=arguments[0];return this._coordinateSequenceFactory.create(n)}}})};gn.prototype.getPrecisionModel=function(){return this._precisionModel};gn.prototype.createLinearRing=function(){if(arguments.length===0)return this.createLinearRing(this.getCoordinateSequenceFactory().create([]));if(arguments.length===1){if(arguments[0]instanceof Array){var t=arguments[0];return this.createLinearRing(t!==null?this.getCoordinateSequenceFactory().create(t):null)}else if(qe(arguments[0],Cn)){var e=arguments[0];return new ml(e,this)}}};gn.prototype.createMultiPolygon=function(){if(arguments.length===0)return new fl(null,this);if(arguments.length===1){var t=arguments[0];return new fl(t,this)}};gn.prototype.createMultiPoint=function(){var t=this;if(arguments.length===0)return new up(null,this);if(arguments.length===1){if(arguments[0]instanceof Array){var e=arguments[0];return new up(e,this)}else if(arguments[0]instanceof Array){var n=arguments[0];return this.createMultiPoint(n!==null?this.getCoordinateSequenceFactory().create(n):null)}else if(qe(arguments[0],Cn)){var o=arguments[0];if(o===null)return this.createMultiPoint(new Array(0).fill(null));for(var l=new Array(o.size()).fill(null),h=0;h<o.size();h++){var _=t.getCoordinateSequenceFactory().create(1,o.getDimension());$r.copy(o,h,_,0,1),l[h]=t.createPoint(_)}return this.createMultiPoint(l)}}};gn.prototype.interfaces_=function(){return[Gs]};gn.prototype.getClass=function(){return gn};gn.toMultiPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};gn.toGeometryArray=function(t){if(t===null)return null;var e=new Array(t.size()).fill(null);return t.toArray(e)};gn.getDefaultCoordinateSequenceFactory=function(){return _l.instance()};gn.toMultiLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};gn.toLineStringArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};gn.toMultiPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};gn.toLinearRingArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};gn.toPointArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};gn.toPolygonArray=function(t){var e=new Array(t.size()).fill(null);return t.toArray(e)};gn.createPointFromInternalCoord=function(t,e){return e.getPrecisionModel().makePrecise(t),e.getFactory().createPoint(t)};Pv.serialVersionUID.get=function(){return-6820524753094096e3};Object.defineProperties(gn,Pv);var kw=["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],mg=function(t){this.geometryFactory=t||new gn};mg.prototype.read=function(t){var e;typeof t=="string"?e=JSON.parse(t):e=t;var n=e.type;if(!La[n])throw new Error("Unknown GeoJSON type: "+e.type);return kw.indexOf(n)!==-1?La[n].apply(this,[e.coordinates]):n==="GeometryCollection"?La[n].apply(this,[e.geometries]):La[n].apply(this,[e])};mg.prototype.write=function(t){var e=t.getGeometryType();if(!Ul[e])throw new Error("Geometry is not supported");return Ul[e].apply(this,[t])};var La={Feature:function(t){var e={};for(var n in t)e[n]=t[n];if(t.geometry){var o=t.geometry.type;if(!La[o])throw new Error("Unknown GeoJSON type: "+t.type);e.geometry=this.read(t.geometry)}return t.bbox&&(e.bbox=La.bbox.apply(this,[t.bbox])),e},FeatureCollection:function(t){var e=this,n={};if(t.features){n.features=[];for(var o=0;o<t.features.length;++o)n.features.push(e.read(t.features[o]))}return t.bbox&&(n.bbox=this.parse.bbox.apply(this,[t.bbox])),n},coordinates:function(t){for(var e=[],n=0;n<t.length;++n){var o=t[n];e.push(new It(o[0],o[1]))}return e},bbox:function(t){return this.geometryFactory.createLinearRing([new It(t[0],t[1]),new It(t[2],t[1]),new It(t[2],t[3]),new It(t[0],t[3]),new It(t[0],t[1])])},Point:function(t){var e=new It(t[0],t[1]);return this.geometryFactory.createPoint(e)},MultiPoint:function(t){for(var e=this,n=[],o=0;o<t.length;++o)n.push(La.Point.apply(e,[t[o]]));return this.geometryFactory.createMultiPoint(n)},LineString:function(t){var e=La.coordinates.apply(this,[t]);return this.geometryFactory.createLineString(e)},MultiLineString:function(t){for(var e=this,n=[],o=0;o<t.length;++o)n.push(La.LineString.apply(e,[t[o]]));return this.geometryFactory.createMultiLineString(n)},Polygon:function(t){for(var e=this,n=La.coordinates.apply(this,[t[0]]),o=this.geometryFactory.createLinearRing(n),l=[],h=1;h<t.length;++h){var _=t[h],u=La.coordinates.apply(e,[_]),I=e.geometryFactory.createLinearRing(u);l.push(I)}return this.geometryFactory.createPolygon(o,l)},MultiPolygon:function(t){for(var e=this,n=[],o=0;o<t.length;++o){var l=t[o];n.push(La.Polygon.apply(e,[l]))}return this.geometryFactory.createMultiPolygon(n)},GeometryCollection:function(t){for(var e=this,n=[],o=0;o<t.length;++o){var l=t[o];n.push(e.read(l))}return this.geometryFactory.createGeometryCollection(n)}},Ul={coordinate:function(t){return[t.x,t.y]},Point:function(t){var e=Ul.coordinate.apply(this,[t.getCoordinate()]);return{type:"Point",coordinates:e}},MultiPoint:function(t){for(var e=this,n=[],o=0;o<t._geometries.length;++o){var l=t._geometries[o],h=Ul.Point.apply(e,[l]);n.push(h.coordinates)}return{type:"MultiPoint",coordinates:n}},LineString:function(t){for(var e=this,n=[],o=t.getCoordinates(),l=0;l<o.length;++l){var h=o[l];n.push(Ul.coordinate.apply(e,[h]))}return{type:"LineString",coordinates:n}},MultiLineString:function(t){for(var e=this,n=[],o=0;o<t._geometries.length;++o){var l=t._geometries[o],h=Ul.LineString.apply(e,[l]);n.push(h.coordinates)}return{type:"MultiLineString",coordinates:n}},Polygon:function(t){var e=this,n=[],o=Ul.LineString.apply(this,[t._shell]);n.push(o.coordinates);for(var l=0;l<t._holes.length;++l){var h=t._holes[l],_=Ul.LineString.apply(e,[h]);n.push(_.coordinates)}return{type:"Polygon",coordinates:n}},MultiPolygon:function(t){for(var e=this,n=[],o=0;o<t._geometries.length;++o){var l=t._geometries[o],h=Ul.Polygon.apply(e,[l]);n.push(h.coordinates)}return{type:"MultiPolygon",coordinates:n}},GeometryCollection:function(t){for(var e=this,n=[],o=0;o<t._geometries.length;++o){var l=t._geometries[o],h=l.getGeometryType();n.push(Ul[h].apply(e,[l]))}return{type:"GeometryCollection",geometries:n}}},l_=function(t){this.geometryFactory=t||new gn,this.precisionModel=this.geometryFactory.getPrecisionModel(),this.parser=new mg(this.geometryFactory)};l_.prototype.read=function(t){var e=this.parser.read(t);return this.precisionModel.getType()===On.FIXED&&this.reducePrecision(e),e};l_.prototype.reducePrecision=function(t){var e=this,n,o;if(t.coordinate)this.precisionModel.makePrecise(t.coordinate);else if(t.points)for(n=0,o=t.points.length;n<o;n++)e.precisionModel.makePrecise(t.points[n]);else if(t.geometries)for(n=0,o=t.geometries.length;n<o;n++)e.reducePrecision(t.geometries[n])};var Mv=function(){this.parser=new mg(this.geometryFactory)};Mv.prototype.write=function(t){return this.parser.write(t)};var Kt=function(){},_g={ON:{configurable:!0},LEFT:{configurable:!0},RIGHT:{configurable:!0}};Kt.prototype.interfaces_=function(){return[]};Kt.prototype.getClass=function(){return Kt};Kt.opposite=function(t){return t===Kt.LEFT?Kt.RIGHT:t===Kt.RIGHT?Kt.LEFT:t};_g.ON.get=function(){return 0};_g.LEFT.get=function(){return 1};_g.RIGHT.get=function(){return 2};Object.defineProperties(Kt,_g);function yg(t){this.message=t||""}yg.prototype=new Error;yg.prototype.name="EmptyStackException";function Ya(){this.array_=[]}Ya.prototype=new ea;Ya.prototype.add=function(t){return this.array_.push(t),!0};Ya.prototype.get=function(t){if(t<0||t>=this.size())throw new Error;return this.array_[t]};Ya.prototype.push=function(t){return this.array_.push(t),t};Ya.prototype.pop=function(t){if(this.array_.length===0)throw new yg;return this.array_.pop()};Ya.prototype.peek=function(){if(this.array_.length===0)throw new yg;return this.array_[this.array_.length-1]};Ya.prototype.empty=function(){return this.array_.length===0};Ya.prototype.isEmpty=function(){return this.empty()};Ya.prototype.search=function(t){return this.array_.indexOf(t)};Ya.prototype.size=function(){return this.array_.length};Ya.prototype.toArray=function(){for(var t=this,e=[],n=0,o=this.array_.length;n<o;n++)e.push(t.array_[n]);return e};var Ba=function(){this._minIndex=-1,this._minCoord=null,this._minDe=null,this._orientedDe=null};Ba.prototype.getCoordinate=function(){return this._minCoord};Ba.prototype.getRightmostSide=function(t,e){var n=this.getRightmostSideOfSegment(t,e);return n<0&&(n=this.getRightmostSideOfSegment(t,e-1)),n<0&&(this._minCoord=null,this.checkForRightmostCoordinate(t)),n};Ba.prototype.findRightmostEdgeAtVertex=function(){var t=this._minDe.getEdge().getCoordinates();cn.isTrue(this._minIndex>0&&this._minIndex<t.length,"rightmost point expected to be interior vertex of edge");var e=t[this._minIndex-1],n=t[this._minIndex+1],o=ge.computeOrientation(this._minCoord,n,e),l=!1;(e.y<this._minCoord.y&&n.y<this._minCoord.y&&o===ge.COUNTERCLOCKWISE||e.y>this._minCoord.y&&n.y>this._minCoord.y&&o===ge.CLOCKWISE)&&(l=!0),l&&(this._minIndex=this._minIndex-1)};Ba.prototype.getRightmostSideOfSegment=function(t,e){var n=t.getEdge(),o=n.getCoordinates();if(e<0||e+1>=o.length||o[e].y===o[e+1].y)return-1;var l=Kt.LEFT;return o[e].y<o[e+1].y&&(l=Kt.RIGHT),l};Ba.prototype.getEdge=function(){return this._orientedDe};Ba.prototype.checkForRightmostCoordinate=function(t){for(var e=this,n=t.getEdge().getCoordinates(),o=0;o<n.length-1;o++)(e._minCoord===null||n[o].x>e._minCoord.x)&&(e._minDe=t,e._minIndex=o,e._minCoord=n[o])};Ba.prototype.findRightmostEdgeAtNode=function(){var t=this._minDe.getNode(),e=t.getEdges();this._minDe=e.getRightmostEdge(),this._minDe.isForward()||(this._minDe=this._minDe.getSym(),this._minIndex=this._minDe.getEdge().getCoordinates().length-1)};Ba.prototype.findEdge=function(t){for(var e=this,n=t.iterator();n.hasNext();){var o=n.next();o.isForward()&&e.checkForRightmostCoordinate(o)}cn.isTrue(this._minIndex!==0||this._minCoord.equals(this._minDe.getCoordinate()),"inconsistency in rightmost processing"),this._minIndex===0?this.findRightmostEdgeAtNode():this.findRightmostEdgeAtVertex(),this._orientedDe=this._minDe;var l=this.getRightmostSide(this._minDe,this._minIndex);l===Kt.LEFT&&(this._orientedDe=this._minDe.getSym())};Ba.prototype.interfaces_=function(){return[]};Ba.prototype.getClass=function(){return Ba};var Yl=function(t){function e(n,o){t.call(this,e.msgWithCoord(n,o)),this.pt=o?new It(o):null,this.name="TopologyException"}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getCoordinate=function(){return this.pt},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.msgWithCoord=function(n,o){return o?n:n+" [ "+o+" ]"},e}(Zl),vg=function(){this.array_=[]};vg.prototype.addLast=function(t){this.array_.push(t)};vg.prototype.removeFirst=function(){return this.array_.shift()};vg.prototype.isEmpty=function(){return this.array_.length===0};var Io=function(){this._finder=null,this._dirEdgeList=new se,this._nodes=new se,this._rightMostCoord=null,this._env=null,this._finder=new Ba};Io.prototype.clearVisitedEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.setVisited(!1)}};Io.prototype.getRightmostCoordinate=function(){return this._rightMostCoord};Io.prototype.computeNodeDepth=function(t){for(var e=this,n=null,o=t.getEdges().iterator();o.hasNext();){var l=o.next();if(l.isVisited()||l.getSym().isVisited()){n=l;break}}if(n===null)throw new Yl("unable to find edge to compute depths at "+t.getCoordinate());t.getEdges().computeDepths(n);for(var h=t.getEdges().iterator();h.hasNext();){var _=h.next();_.setVisited(!0),e.copySymDepths(_)}};Io.prototype.computeDepth=function(t){this.clearVisitedEdges();var e=this._finder.getEdge();e.setEdgeDepths(Kt.RIGHT,t),this.copySymDepths(e),this.computeDepths(e)};Io.prototype.create=function(t){this.addReachable(t),this._finder.findEdge(this._dirEdgeList),this._rightMostCoord=this._finder.getCoordinate()};Io.prototype.findResultEdges=function(){for(var t=this._dirEdgeList.iterator();t.hasNext();){var e=t.next();e.getDepth(Kt.RIGHT)>=1&&e.getDepth(Kt.LEFT)<=0&&!e.isInteriorAreaEdge()&&e.setInResult(!0)}};Io.prototype.computeDepths=function(t){var e=this,n=new r_,o=new vg,l=t.getNode();for(o.addLast(l),n.add(l),t.setVisited(!0);!o.isEmpty();){var h=o.removeFirst();n.add(h),e.computeNodeDepth(h);for(var _=h.getEdges().iterator();_.hasNext();){var u=_.next(),I=u.getSym();if(!I.isVisited()){var w=I.getNode();n.contains(w)||(o.addLast(w),n.add(w))}}}};Io.prototype.compareTo=function(t){var e=t;return this._rightMostCoord.x<e._rightMostCoord.x?-1:this._rightMostCoord.x>e._rightMostCoord.x?1:0};Io.prototype.getEnvelope=function(){if(this._env===null){for(var t=new De,e=this._dirEdgeList.iterator();e.hasNext();)for(var n=e.next(),o=n.getEdge().getCoordinates(),l=0;l<o.length-1;l++)t.expandToInclude(o[l]);this._env=t}return this._env};Io.prototype.addReachable=function(t){var e=this,n=new Ya;for(n.add(t);!n.empty();){var o=n.pop();e.add(o,n)}};Io.prototype.copySymDepths=function(t){var e=t.getSym();e.setDepth(Kt.LEFT,t.getDepth(Kt.RIGHT)),e.setDepth(Kt.RIGHT,t.getDepth(Kt.LEFT))};Io.prototype.add=function(t,e){var n=this;t.setVisited(!0),this._nodes.add(t);for(var o=t.getEdges().iterator();o.hasNext();){var l=o.next();n._dirEdgeList.add(l);var h=l.getSym(),_=h.getNode();_.isVisited()||e.push(_)}};Io.prototype.getNodes=function(){return this._nodes};Io.prototype.getDirectedEdges=function(){return this._dirEdgeList};Io.prototype.interfaces_=function(){return[Vs]};Io.prototype.getClass=function(){return Io};var ar=function t(){var e=this;if(this.location=null,arguments.length===1){if(arguments[0]instanceof Array){var n=arguments[0];this.init(n.length)}else if(Number.isInteger(arguments[0])){var o=arguments[0];this.init(1),this.location[Kt.ON]=o}else if(arguments[0]instanceof t){var l=arguments[0];if(this.init(l.location.length),l!==null)for(var h=0;h<this.location.length;h++)e.location[h]=l.location[h]}}else if(arguments.length===3){var _=arguments[0],u=arguments[1],I=arguments[2];this.init(3),this.location[Kt.ON]=_,this.location[Kt.LEFT]=u,this.location[Kt.RIGHT]=I}};ar.prototype.setAllLocations=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]=t};ar.prototype.isNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]!==Mt.NONE)return!1;return!0};ar.prototype.setAllLocationsIfNull=function(t){for(var e=this,n=0;n<this.location.length;n++)e.location[n]===Mt.NONE&&(e.location[n]=t)};ar.prototype.isLine=function(){return this.location.length===1};ar.prototype.merge=function(t){var e=this;if(t.location.length>this.location.length){var n=new Array(3).fill(null);n[Kt.ON]=this.location[Kt.ON],n[Kt.LEFT]=Mt.NONE,n[Kt.RIGHT]=Mt.NONE,this.location=n}for(var o=0;o<this.location.length;o++)e.location[o]===Mt.NONE&&o<t.location.length&&(e.location[o]=t.location[o])};ar.prototype.getLocations=function(){return this.location};ar.prototype.flip=function(){if(this.location.length<=1)return null;var t=this.location[Kt.LEFT];this.location[Kt.LEFT]=this.location[Kt.RIGHT],this.location[Kt.RIGHT]=t};ar.prototype.toString=function(){var t=new Xa;return this.location.length>1&&t.append(Mt.toLocationSymbol(this.location[Kt.LEFT])),t.append(Mt.toLocationSymbol(this.location[Kt.ON])),this.location.length>1&&t.append(Mt.toLocationSymbol(this.location[Kt.RIGHT])),t.toString()};ar.prototype.setLocations=function(t,e,n){this.location[Kt.ON]=t,this.location[Kt.LEFT]=e,this.location[Kt.RIGHT]=n};ar.prototype.get=function(t){return t<this.location.length?this.location[t]:Mt.NONE};ar.prototype.isArea=function(){return this.location.length>1};ar.prototype.isAnyNull=function(){for(var t=this,e=0;e<this.location.length;e++)if(t.location[e]===Mt.NONE)return!0;return!1};ar.prototype.setLocation=function(){if(arguments.length===1){var t=arguments[0];this.setLocation(Kt.ON,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.location[e]=n}};ar.prototype.init=function(t){this.location=new Array(t).fill(null),this.setAllLocations(Mt.NONE)};ar.prototype.isEqualOnSide=function(t,e){return this.location[e]===t.location[e]};ar.prototype.allPositionsEqual=function(t){for(var e=this,n=0;n<this.location.length;n++)if(e.location[n]!==t)return!1;return!0};ar.prototype.interfaces_=function(){return[]};ar.prototype.getClass=function(){return ar};var Zn=function t(){if(this.elt=new Array(2).fill(null),arguments.length===1){if(Number.isInteger(arguments[0])){var e=arguments[0];this.elt[0]=new ar(e),this.elt[1]=new ar(e)}else if(arguments[0]instanceof t){var n=arguments[0];this.elt[0]=new ar(n.elt[0]),this.elt[1]=new ar(n.elt[1])}}else if(arguments.length===2){var o=arguments[0],l=arguments[1];this.elt[0]=new ar(Mt.NONE),this.elt[1]=new ar(Mt.NONE),this.elt[o].setLocation(l)}else if(arguments.length===3){var h=arguments[0],_=arguments[1],u=arguments[2];this.elt[0]=new ar(h,_,u),this.elt[1]=new ar(h,_,u)}else if(arguments.length===4){var I=arguments[0],w=arguments[1],D=arguments[2],k=arguments[3];this.elt[0]=new ar(Mt.NONE,Mt.NONE,Mt.NONE),this.elt[1]=new ar(Mt.NONE,Mt.NONE,Mt.NONE),this.elt[I].setLocations(w,D,k)}};Zn.prototype.getGeometryCount=function(){var t=0;return this.elt[0].isNull()||t++,this.elt[1].isNull()||t++,t};Zn.prototype.setAllLocations=function(t,e){this.elt[t].setAllLocations(e)};Zn.prototype.isNull=function(t){return this.elt[t].isNull()};Zn.prototype.setAllLocationsIfNull=function(){if(arguments.length===1){var t=arguments[0];this.setAllLocationsIfNull(0,t),this.setAllLocationsIfNull(1,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.elt[e].setAllLocationsIfNull(n)}};Zn.prototype.isLine=function(t){return this.elt[t].isLine()};Zn.prototype.merge=function(t){for(var e=this,n=0;n<2;n++)e.elt[n]===null&&t.elt[n]!==null?e.elt[n]=new ar(t.elt[n]):e.elt[n].merge(t.elt[n])};Zn.prototype.flip=function(){this.elt[0].flip(),this.elt[1].flip()};Zn.prototype.getLocation=function(){if(arguments.length===1){var t=arguments[0];return this.elt[t].get(Kt.ON)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.elt[e].get(n)}};Zn.prototype.toString=function(){var t=new Xa;return this.elt[0]!==null&&(t.append("A:"),t.append(this.elt[0].toString())),this.elt[1]!==null&&(t.append(" B:"),t.append(this.elt[1].toString())),t.toString()};Zn.prototype.isArea=function(){if(arguments.length===0)return this.elt[0].isArea()||this.elt[1].isArea();if(arguments.length===1){var t=arguments[0];return this.elt[t].isArea()}};Zn.prototype.isAnyNull=function(t){return this.elt[t].isAnyNull()};Zn.prototype.setLocation=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.elt[t].setLocation(Kt.ON,e)}else if(arguments.length===3){var n=arguments[0],o=arguments[1],l=arguments[2];this.elt[n].setLocation(o,l)}};Zn.prototype.isEqualOnSide=function(t,e){return this.elt[0].isEqualOnSide(t.elt[0],e)&&this.elt[1].isEqualOnSide(t.elt[1],e)};Zn.prototype.allPositionsEqual=function(t,e){return this.elt[t].allPositionsEqual(e)};Zn.prototype.toLine=function(t){this.elt[t].isArea()&&(this.elt[t]=new ar(this.elt[t].location[0]))};Zn.prototype.interfaces_=function(){return[]};Zn.prototype.getClass=function(){return Zn};Zn.toLineLabel=function(t){for(var e=new Zn(Mt.NONE),n=0;n<2;n++)e.setLocation(n,t.getLocation(n));return e};var oi=function(){this._startDe=null,this._maxNodeDegree=-1,this._edges=new se,this._pts=new se,this._label=new Zn(Mt.NONE),this._ring=null,this._isHole=null,this._shell=null,this._holes=new se,this._geometryFactory=null;var t=arguments[0],e=arguments[1];this._geometryFactory=e,this.computePoints(t),this.computeRing()};oi.prototype.computeRing=function(){var t=this;if(this._ring!==null)return null;for(var e=new Array(this._pts.size()).fill(null),n=0;n<this._pts.size();n++)e[n]=t._pts.get(n);this._ring=this._geometryFactory.createLinearRing(e),this._isHole=ge.isCCW(this._ring.getCoordinates())};oi.prototype.isIsolated=function(){return this._label.getGeometryCount()===1};oi.prototype.computePoints=function(t){var e=this;this._startDe=t;var n=t,o=!0;do{if(n===null)throw new Yl("Found null DirectedEdge");if(n.getEdgeRing()===e)throw new Yl("Directed Edge visited twice during ring-building at "+n.getCoordinate());e._edges.add(n);var l=n.getLabel();cn.isTrue(l.isArea()),e.mergeLabel(l),e.addPoints(n.getEdge(),n.isForward(),o),o=!1,e.setEdgeRing(n,e),n=e.getNext(n)}while(n!==this._startDe)};oi.prototype.getLinearRing=function(){return this._ring};oi.prototype.getCoordinate=function(t){return this._pts.get(t)};oi.prototype.computeMaxNodeDegree=function(){var t=this;this._maxNodeDegree=0;var e=this._startDe;do{var n=e.getNode(),o=n.getEdges().getOutgoingDegree(t);o>t._maxNodeDegree&&(t._maxNodeDegree=o),e=t.getNext(e)}while(e!==this._startDe);this._maxNodeDegree*=2};oi.prototype.addPoints=function(t,e,n){var o=this,l=t.getCoordinates();if(e){var h=1;n&&(h=0);for(var _=h;_<l.length;_++)o._pts.add(l[_])}else{var u=l.length-2;n&&(u=l.length-1);for(var I=u;I>=0;I--)o._pts.add(l[I])}};oi.prototype.isHole=function(){return this._isHole};oi.prototype.setInResult=function(){var t=this._startDe;do t.getEdge().setInResult(!0),t=t.getNext();while(t!==this._startDe)};oi.prototype.containsPoint=function(t){var e=this.getLinearRing(),n=e.getEnvelopeInternal();if(!n.contains(t)||!ge.isPointInRing(t,e.getCoordinates()))return!1;for(var o=this._holes.iterator();o.hasNext();){var l=o.next();if(l.containsPoint(t))return!1}return!0};oi.prototype.addHole=function(t){this._holes.add(t)};oi.prototype.isShell=function(){return this._shell===null};oi.prototype.getLabel=function(){return this._label};oi.prototype.getEdges=function(){return this._edges};oi.prototype.getMaxNodeDegree=function(){return this._maxNodeDegree<0&&this.computeMaxNodeDegree(),this._maxNodeDegree};oi.prototype.getShell=function(){return this._shell};oi.prototype.mergeLabel=function(){if(arguments.length===1){var t=arguments[0];this.mergeLabel(t,0),this.mergeLabel(t,1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],o=e.getLocation(n,Kt.RIGHT);if(o===Mt.NONE)return null;if(this._label.getLocation(n)===Mt.NONE)return this._label.setLocation(n,o),null}};oi.prototype.setShell=function(t){this._shell=t,t!==null&&t.addHole(this)};oi.prototype.toPolygon=function(t){for(var e=this,n=new Array(this._holes.size()).fill(null),o=0;o<this._holes.size();o++)n[o]=e._holes.get(o).getLinearRing();var l=t.createPolygon(this.getLinearRing(),n);return l};oi.prototype.interfaces_=function(){return[]};oi.prototype.getClass=function(){return oi};var Nw=function(t){function e(){var n=arguments[0],o=arguments[1];t.call(this,n,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.setEdgeRing=function(n,o){n.setMinEdgeRing(o)},e.prototype.getNext=function(n){return n.getNextMin()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(oi),Rw=function(t){function e(){var n=arguments[0],o=arguments[1];t.call(this,n,o)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildMinimalRings=function(){var n=this,o=new se,l=this._startDe;do{if(l.getMinEdgeRing()===null){var h=new Nw(l,n._geometryFactory);o.add(h)}l=l.getNext()}while(l!==this._startDe);return o},e.prototype.setEdgeRing=function(n,o){n.setEdgeRing(o)},e.prototype.linkDirectedEdgesForMinimalEdgeRings=function(){var n=this,o=this._startDe;do{var l=o.getNode();l.getEdges().linkMinimalDirectedEdges(n),o=o.getNext()}while(o!==this._startDe)},e.prototype.getNext=function(n){return n.getNext()},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(oi),Is=function(){if(this._label=null,this._isInResult=!1,this._isCovered=!1,this._isCoveredSet=!1,this._isVisited=!1,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._label=t}};Is.prototype.setVisited=function(t){this._isVisited=t};Is.prototype.setInResult=function(t){this._isInResult=t};Is.prototype.isCovered=function(){return this._isCovered};Is.prototype.isCoveredSet=function(){return this._isCoveredSet};Is.prototype.setLabel=function(t){this._label=t};Is.prototype.getLabel=function(){return this._label};Is.prototype.setCovered=function(t){this._isCovered=t,this._isCoveredSet=!0};Is.prototype.updateIM=function(t){cn.isTrue(this._label.getGeometryCount()>=2,"found partial label"),this.computeIM(t)};Is.prototype.isInResult=function(){return this._isInResult};Is.prototype.isVisited=function(){return this._isVisited};Is.prototype.interfaces_=function(){return[]};Is.prototype.getClass=function(){return Is};var xg=function(t){function e(){t.call(this),this._coord=null,this._edges=null;var n=arguments[0],o=arguments[1];this._coord=n,this._edges=o,this._label=new Zn(0,Mt.NONE)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isIncidentEdgeInResult=function(){for(var n=this.getEdges().getEdges().iterator();n.hasNext();){var o=n.next();if(o.getEdge().isInResult())return!0}return!1},e.prototype.isIsolated=function(){return this._label.getGeometryCount()===1},e.prototype.getCoordinate=function(){return this._coord},e.prototype.print=function(n){n.println("node "+this._coord+" lbl: "+this._label)},e.prototype.computeIM=function(n){},e.prototype.computeMergedLocation=function(n,o){var l=Mt.NONE;if(l=this._label.getLocation(o),!n.isNull(o)){var h=n.getLocation(o);l!==Mt.BOUNDARY&&(l=h)}return l},e.prototype.setLabel=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];this._label===null?this._label=new Zn(n,o):this._label.setLocation(n,o)}else return t.prototype.setLabel.apply(this,arguments)},e.prototype.getEdges=function(){return this._edges},e.prototype.mergeLabel=function(){var n=this;if(arguments[0]instanceof e){var o=arguments[0];this.mergeLabel(o._label)}else if(arguments[0]instanceof Zn)for(var l=arguments[0],h=0;h<2;h++){var _=n.computeMergedLocation(l,h),u=n._label.getLocation(h);u===Mt.NONE&&n._label.setLocation(h,_)}},e.prototype.add=function(n){this._edges.insert(n),n.setNode(this)},e.prototype.setLabelBoundary=function(n){if(this._label===null)return null;var o=Mt.NONE;this._label!==null&&(o=this._label.getLocation(n));var l=null;switch(o){case Mt.BOUNDARY:l=Mt.INTERIOR;break;case Mt.INTERIOR:l=Mt.BOUNDARY;break;default:l=Mt.BOUNDARY;break}this._label.setLocation(n,l)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Is),Ua=function(){this.nodeMap=new eo,this.nodeFact=null;var t=arguments[0];this.nodeFact=t};Ua.prototype.find=function(t){return this.nodeMap.get(t)};Ua.prototype.addNode=function(){if(arguments[0]instanceof It){var t=arguments[0],e=this.nodeMap.get(t);return e===null&&(e=this.nodeFact.createNode(t),this.nodeMap.put(t,e)),e}else if(arguments[0]instanceof xg){var n=arguments[0],o=this.nodeMap.get(n.getCoordinate());return o===null?(this.nodeMap.put(n.getCoordinate(),n),n):(o.mergeLabel(n),o)}};Ua.prototype.print=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};Ua.prototype.iterator=function(){return this.nodeMap.values().iterator()};Ua.prototype.values=function(){return this.nodeMap.values()};Ua.prototype.getBoundaryNodes=function(t){for(var e=new se,n=this.iterator();n.hasNext();){var o=n.next();o.getLabel().getLocation(t)===Mt.BOUNDARY&&e.add(o)}return e};Ua.prototype.add=function(t){var e=t.getCoordinate(),n=this.addNode(e);n.add(t)};Ua.prototype.interfaces_=function(){return[]};Ua.prototype.getClass=function(){return Ua};var Qn=function(){},Yf={NE:{configurable:!0},NW:{configurable:!0},SW:{configurable:!0},SE:{configurable:!0}};Qn.prototype.interfaces_=function(){return[]};Qn.prototype.getClass=function(){return Qn};Qn.isNorthern=function(t){return t===Qn.NE||t===Qn.NW};Qn.isOpposite=function(t,e){if(t===e)return!1;var n=(t-e+4)%4;return n===2};Qn.commonHalfPlane=function(t,e){if(t===e)return t;var n=(t-e+4)%4;if(n===2)return-1;var o=t<e?t:e,l=t>e?t:e;return o===0&&l===3?3:o};Qn.isInHalfPlane=function(t,e){return e===Qn.SE?t===Qn.SE||t===Qn.SW:t===e||t===e+1};Qn.quadrant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new Ir("Cannot compute the quadrant for point ( "+t+", "+e+" )");return t>=0?e>=0?Qn.NE:Qn.SE:e>=0?Qn.NW:Qn.SW}else if(arguments[0]instanceof It&&arguments[1]instanceof It){var n=arguments[0],o=arguments[1];if(o.x===n.x&&o.y===n.y)throw new Ir("Cannot compute the quadrant for two identical points "+n);return o.x>=n.x?o.y>=n.y?Qn.NE:Qn.SE:o.y>=n.y?Qn.NW:Qn.SW}};Yf.NE.get=function(){return 0};Yf.NW.get=function(){return 1};Yf.SW.get=function(){return 2};Yf.SE.get=function(){return 3};Object.defineProperties(Qn,Yf);var no=function(){if(this._edge=null,this._label=null,this._node=null,this._p0=null,this._p1=null,this._dx=null,this._dy=null,this._quadrant=null,arguments.length===1){var t=arguments[0];this._edge=t}else if(arguments.length===3){var e=arguments[0],n=arguments[1],o=arguments[2],l=null;this._edge=e,this.init(n,o),this._label=l}else if(arguments.length===4){var h=arguments[0],_=arguments[1],u=arguments[2],I=arguments[3];this._edge=h,this.init(_,u),this._label=I}};no.prototype.compareDirection=function(t){return this._dx===t._dx&&this._dy===t._dy?0:this._quadrant>t._quadrant?1:this._quadrant<t._quadrant?-1:ge.computeOrientation(t._p0,t._p1,this._p1)};no.prototype.getDy=function(){return this._dy};no.prototype.getCoordinate=function(){return this._p0};no.prototype.setNode=function(t){this._node=t};no.prototype.print=function(t){var e=Math.atan2(this._dy,this._dx),n=this.getClass().getName(),o=n.lastIndexOf("."),l=n.substring(o+1);t.print("  "+l+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+e+"   "+this._label)};no.prototype.compareTo=function(t){var e=t;return this.compareDirection(e)};no.prototype.getDirectedCoordinate=function(){return this._p1};no.prototype.getDx=function(){return this._dx};no.prototype.getLabel=function(){return this._label};no.prototype.getEdge=function(){return this._edge};no.prototype.getQuadrant=function(){return this._quadrant};no.prototype.getNode=function(){return this._node};no.prototype.toString=function(){var t=Math.atan2(this._dy,this._dx),e=this.getClass().getName(),n=e.lastIndexOf("."),o=e.substring(n+1);return"  "+o+": "+this._p0+" - "+this._p1+" "+this._quadrant+":"+t+"   "+this._label};no.prototype.computeLabel=function(t){};no.prototype.init=function(t,e){this._p0=t,this._p1=e,this._dx=e.x-t.x,this._dy=e.y-t.y,this._quadrant=Qn.quadrant(this._dx,this._dy),cn.isTrue(!(this._dx===0&&this._dy===0),"EdgeEnd with identical endpoints found")};no.prototype.interfaces_=function(){return[Vs]};no.prototype.getClass=function(){return no};var Om=function(t){function e(){var n=arguments[0],o=arguments[1];if(t.call(this,n),this._isForward=null,this._isInResult=!1,this._isVisited=!1,this._sym=null,this._next=null,this._nextMin=null,this._edgeRing=null,this._minEdgeRing=null,this._depth=[0,-999,-999],this._isForward=o,o)this.init(n.getCoordinate(0),n.getCoordinate(1));else{var l=n.getNumPoints()-1;this.init(n.getCoordinate(l),n.getCoordinate(l-1))}this.computeDirectedLabel()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getNextMin=function(){return this._nextMin},e.prototype.getDepth=function(n){return this._depth[n]},e.prototype.setVisited=function(n){this._isVisited=n},e.prototype.computeDirectedLabel=function(){this._label=new Zn(this._edge.getLabel()),this._isForward||this._label.flip()},e.prototype.getNext=function(){return this._next},e.prototype.setDepth=function(n,o){if(this._depth[n]!==-999&&this._depth[n]!==o)throw new Yl("assigned depths do not match",this.getCoordinate());this._depth[n]=o},e.prototype.isInteriorAreaEdge=function(){for(var n=this,o=!0,l=0;l<2;l++)n._label.isArea(l)&&n._label.getLocation(l,Kt.LEFT)===Mt.INTERIOR&&n._label.getLocation(l,Kt.RIGHT)===Mt.INTERIOR||(o=!1);return o},e.prototype.setNextMin=function(n){this._nextMin=n},e.prototype.print=function(n){t.prototype.print.call(this,n),n.print(" "+this._depth[Kt.LEFT]+"/"+this._depth[Kt.RIGHT]),n.print(" ("+this.getDepthDelta()+")"),this._isInResult&&n.print(" inResult")},e.prototype.setMinEdgeRing=function(n){this._minEdgeRing=n},e.prototype.isLineEdge=function(){var n=this._label.isLine(0)||this._label.isLine(1),o=!this._label.isArea(0)||this._label.allPositionsEqual(0,Mt.EXTERIOR),l=!this._label.isArea(1)||this._label.allPositionsEqual(1,Mt.EXTERIOR);return n&&o&&l},e.prototype.setEdgeRing=function(n){this._edgeRing=n},e.prototype.getMinEdgeRing=function(){return this._minEdgeRing},e.prototype.getDepthDelta=function(){var n=this._edge.getDepthDelta();return this._isForward||(n=-n),n},e.prototype.setInResult=function(n){this._isInResult=n},e.prototype.getSym=function(){return this._sym},e.prototype.isForward=function(){return this._isForward},e.prototype.getEdge=function(){return this._edge},e.prototype.printEdge=function(n){this.print(n),n.print(" "),this._isForward?this._edge.print(n):this._edge.printReverse(n)},e.prototype.setSym=function(n){this._sym=n},e.prototype.setVisitedEdge=function(n){this.setVisited(n),this._sym.setVisited(n)},e.prototype.setEdgeDepths=function(n,o){var l=this.getEdge().getDepthDelta();this._isForward||(l=-l);var h=1;n===Kt.LEFT&&(h=-1);var _=Kt.opposite(n),u=l*h,I=o+u;this.setDepth(n,o),this.setDepth(_,I)},e.prototype.getEdgeRing=function(){return this._edgeRing},e.prototype.isInResult=function(){return this._isInResult},e.prototype.setNext=function(n){this._next=n},e.prototype.isVisited=function(){return this._isVisited},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.depthFactor=function(n,o){return n===Mt.EXTERIOR&&o===Mt.INTERIOR?1:n===Mt.INTERIOR&&o===Mt.EXTERIOR?-1:0},e}(no),cp=function(){};cp.prototype.createNode=function(t){return new xg(t,null)};cp.prototype.interfaces_=function(){return[]};cp.prototype.getClass=function(){return cp};var kr=function(){if(this._edges=new se,this._nodes=null,this._edgeEndList=new se,arguments.length===0)this._nodes=new Ua(new cp);else if(arguments.length===1){var t=arguments[0];this._nodes=new Ua(t)}};kr.prototype.printEdges=function(t){var e=this;t.println("Edges:");for(var n=0;n<this._edges.size();n++){t.println("edge "+n+":");var o=e._edges.get(n);o.print(t),o.eiList.print(t)}};kr.prototype.find=function(t){return this._nodes.find(t)};kr.prototype.addNode=function(){if(arguments[0]instanceof xg){var t=arguments[0];return this._nodes.addNode(t)}else if(arguments[0]instanceof It){var e=arguments[0];return this._nodes.addNode(e)}};kr.prototype.getNodeIterator=function(){return this._nodes.iterator()};kr.prototype.linkResultDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkResultDirectedEdges()}};kr.prototype.debugPrintln=function(t){Yi.out.println(t)};kr.prototype.isBoundaryNode=function(t,e){var n=this._nodes.find(e);if(n===null)return!1;var o=n.getLabel();return o!==null&&o.getLocation(t)===Mt.BOUNDARY};kr.prototype.linkAllDirectedEdges=function(){for(var t=this._nodes.iterator();t.hasNext();){var e=t.next();e.getEdges().linkAllDirectedEdges()}};kr.prototype.matchInSameDirection=function(t,e,n,o){return t.equals(n)?ge.computeOrientation(t,e,o)===ge.COLLINEAR&&Qn.quadrant(t,e)===Qn.quadrant(n,o):!1};kr.prototype.getEdgeEnds=function(){return this._edgeEndList};kr.prototype.debugPrint=function(t){Yi.out.print(t)};kr.prototype.getEdgeIterator=function(){return this._edges.iterator()};kr.prototype.findEdgeInSameDirection=function(t,e){for(var n=this,o=0;o<this._edges.size();o++){var l=n._edges.get(o),h=l.getCoordinates();if(n.matchInSameDirection(t,e,h[0],h[1])||n.matchInSameDirection(t,e,h[h.length-1],h[h.length-2]))return l}return null};kr.prototype.insertEdge=function(t){this._edges.add(t)};kr.prototype.findEdgeEnd=function(t){for(var e=this.getEdgeEnds().iterator();e.hasNext();){var n=e.next();if(n.getEdge()===t)return n}return null};kr.prototype.addEdges=function(t){for(var e=this,n=t.iterator();n.hasNext();){var o=n.next();e._edges.add(o);var l=new Om(o,!0),h=new Om(o,!1);l.setSym(h),h.setSym(l),e.add(l),e.add(h)}};kr.prototype.add=function(t){this._nodes.add(t),this._edgeEndList.add(t)};kr.prototype.getNodes=function(){return this._nodes.values()};kr.prototype.findEdge=function(t,e){for(var n=this,o=0;o<this._edges.size();o++){var l=n._edges.get(o),h=l.getCoordinates();if(t.equals(h[0])&&e.equals(h[1]))return l}return null};kr.prototype.interfaces_=function(){return[]};kr.prototype.getClass=function(){return kr};kr.linkResultDirectedEdges=function(t){for(var e=t.iterator();e.hasNext();){var n=e.next();n.getEdges().linkResultDirectedEdges()}};var ts=function(){this._geometryFactory=null,this._shellList=new se;var t=arguments[0];this._geometryFactory=t};ts.prototype.sortShellsAndHoles=function(t,e,n){for(var o=t.iterator();o.hasNext();){var l=o.next();l.isHole()?n.add(l):e.add(l)}};ts.prototype.computePolygons=function(t){for(var e=this,n=new se,o=t.iterator();o.hasNext();){var l=o.next(),h=l.toPolygon(e._geometryFactory);n.add(h)}return n};ts.prototype.placeFreeHoles=function(t,e){for(var n=this,o=e.iterator();o.hasNext();){var l=o.next();if(l.getShell()===null){var h=n.findEdgeRingContaining(l,t);if(h===null)throw new Yl("unable to assign hole to a shell",l.getCoordinate(0));l.setShell(h)}}};ts.prototype.buildMinimalEdgeRings=function(t,e,n){for(var o=this,l=new se,h=t.iterator();h.hasNext();){var _=h.next();if(_.getMaxNodeDegree()>2){_.linkDirectedEdgesForMinimalEdgeRings();var u=_.buildMinimalRings(),I=o.findShell(u);I!==null?(o.placePolygonHoles(I,u),e.add(I)):n.addAll(u)}else l.add(_)}return l};ts.prototype.containsPoint=function(t){for(var e=this._shellList.iterator();e.hasNext();){var n=e.next();if(n.containsPoint(t))return!0}return!1};ts.prototype.buildMaximalEdgeRings=function(t){for(var e=this,n=new se,o=t.iterator();o.hasNext();){var l=o.next();if(l.isInResult()&&l.getLabel().isArea()&&l.getEdgeRing()===null){var h=new Rw(l,e._geometryFactory);n.add(h),h.setInResult()}}return n};ts.prototype.placePolygonHoles=function(t,e){for(var n=e.iterator();n.hasNext();){var o=n.next();o.isHole()&&o.setShell(t)}};ts.prototype.getPolygons=function(){var t=this.computePolygons(this._shellList);return t};ts.prototype.findEdgeRingContaining=function(t,e){for(var n=t.getLinearRing(),o=n.getEnvelopeInternal(),l=n.getCoordinateN(0),h=null,_=null,u=e.iterator();u.hasNext();){var I=u.next(),w=I.getLinearRing(),D=w.getEnvelopeInternal();h!==null&&(_=h.getLinearRing().getEnvelopeInternal());var k=!1;D.contains(o)&&ge.isPointInRing(l,w.getCoordinates())&&(k=!0),k&&(h===null||_.contains(D))&&(h=I)}return h};ts.prototype.findShell=function(t){for(var e=0,n=null,o=t.iterator();o.hasNext();){var l=o.next();l.isHole()||(n=l,e++)}return cn.isTrue(e<=1,"found two shells in MinimalEdgeRing list"),n};ts.prototype.add=function(){if(arguments.length===1){var t=arguments[0];this.add(t.getEdgeEnds(),t.getNodes())}else if(arguments.length===2){var e=arguments[0],n=arguments[1];kr.linkResultDirectedEdges(n);var o=this.buildMaximalEdgeRings(e),l=new se,h=this.buildMinimalEdgeRings(o,this._shellList,l);this.sortShellsAndHoles(h,this._shellList,l),this.placeFreeHoles(this._shellList,l)}};ts.prototype.interfaces_=function(){return[]};ts.prototype.getClass=function(){return ts};var hp=function(){};hp.prototype.getBounds=function(){};hp.prototype.interfaces_=function(){return[]};hp.prototype.getClass=function(){return hp};var ia=function(){this._bounds=null,this._item=null;var t=arguments[0],e=arguments[1];this._bounds=t,this._item=e};ia.prototype.getItem=function(){return this._item};ia.prototype.getBounds=function(){return this._bounds};ia.prototype.interfaces_=function(){return[hp,Gs]};ia.prototype.getClass=function(){return ia};var Wl=function(){this._size=null,this._items=null,this._size=0,this._items=new se,this._items.add(null)};Wl.prototype.poll=function(){if(this.isEmpty())return null;var t=this._items.get(1);return this._items.set(1,this._items.get(this._size)),this._size-=1,this.reorder(1),t};Wl.prototype.size=function(){return this._size};Wl.prototype.reorder=function(t){for(var e=this,n=null,o=this._items.get(t);t*2<=this._size&&(n=t*2,n!==e._size&&e._items.get(n+1).compareTo(e._items.get(n))<0&&n++,e._items.get(n).compareTo(o)<0);t=n)e._items.set(t,e._items.get(n));this._items.set(t,o)};Wl.prototype.clear=function(){this._size=0,this._items.clear()};Wl.prototype.isEmpty=function(){return this._size===0};Wl.prototype.add=function(t){var e=this;this._items.add(null),this._size+=1;var n=this._size;for(this._items.set(0,t);t.compareTo(this._items.get(Math.trunc(n/2)))<0;n/=2)e._items.set(n,e._items.get(Math.trunc(n/2)));this._items.set(n,t)};Wl.prototype.interfaces_=function(){return[]};Wl.prototype.getClass=function(){return Wl};var Tu=function(){};Tu.prototype.visitItem=function(t){};Tu.prototype.interfaces_=function(){return[]};Tu.prototype.getClass=function(){return Tu};var Hc=function(){};Hc.prototype.insert=function(t,e){};Hc.prototype.remove=function(t,e){};Hc.prototype.query=function(){};Hc.prototype.interfaces_=function(){return[]};Hc.prototype.getClass=function(){return Hc};var fi=function(){if(this._childBoundables=new se,this._bounds=null,this._level=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this._level=t}},Av={serialVersionUID:{configurable:!0}};fi.prototype.getLevel=function(){return this._level};fi.prototype.size=function(){return this._childBoundables.size()};fi.prototype.getChildBoundables=function(){return this._childBoundables};fi.prototype.addChildBoundable=function(t){cn.isTrue(this._bounds===null),this._childBoundables.add(t)};fi.prototype.isEmpty=function(){return this._childBoundables.isEmpty()};fi.prototype.getBounds=function(){return this._bounds===null&&(this._bounds=this.computeBounds()),this._bounds};fi.prototype.interfaces_=function(){return[hp,Gs]};fi.prototype.getClass=function(){return fi};Av.serialVersionUID.get=function(){return 6493722185909574e3};Object.defineProperties(fi,Av);var oa=function(){};oa.reverseOrder=function(){return{compare:function(t,e){return e.compareTo(t)}}};oa.min=function(t){return oa.sort(t),t.get(0)};oa.sort=function(t,e){var n=t.toArray();e?lc.sort(n,e):lc.sort(n);for(var o=t.iterator(),l=0,h=n.length;l<h;l++)o.next(),o.set(n[l])};oa.singletonList=function(t){var e=new se;return e.add(t),e};var ri=function(){this._boundable1=null,this._boundable2=null,this._distance=null,this._itemDistance=null;var t=arguments[0],e=arguments[1],n=arguments[2];this._boundable1=t,this._boundable2=e,this._itemDistance=n,this._distance=this.distance()};ri.prototype.expandToQueue=function(t,e){var n=ri.isComposite(this._boundable1),o=ri.isComposite(this._boundable2);if(n&&o)return ri.area(this._boundable1)>ri.area(this._boundable2)?(this.expand(this._boundable1,this._boundable2,t,e),null):(this.expand(this._boundable2,this._boundable1,t,e),null);if(n)return this.expand(this._boundable1,this._boundable2,t,e),null;if(o)return this.expand(this._boundable2,this._boundable1,t,e),null;throw new Ir("neither boundable is composite")};ri.prototype.isLeaves=function(){return!(ri.isComposite(this._boundable1)||ri.isComposite(this._boundable2))};ri.prototype.compareTo=function(t){var e=t;return this._distance<e._distance?-1:this._distance>e._distance?1:0};ri.prototype.expand=function(t,e,n,o){for(var l=this,h=t.getChildBoundables(),_=h.iterator();_.hasNext();){var u=_.next(),I=new ri(u,e,l._itemDistance);I.getDistance()<o&&n.add(I)}};ri.prototype.getBoundable=function(t){return t===0?this._boundable1:this._boundable2};ri.prototype.getDistance=function(){return this._distance};ri.prototype.distance=function(){return this.isLeaves()?this._itemDistance.distance(this._boundable1,this._boundable2):this._boundable1.getBounds().distance(this._boundable2.getBounds())};ri.prototype.interfaces_=function(){return[Vs]};ri.prototype.getClass=function(){return ri};ri.area=function(t){return t.getBounds().getArea()};ri.isComposite=function(t){return t instanceof fi};var Li=function t(){if(this._root=null,this._built=!1,this._itemBoundables=new se,this._nodeCapacity=null,arguments.length===0){var e=t.DEFAULT_NODE_CAPACITY;this._nodeCapacity=e}else if(arguments.length===1){var n=arguments[0];cn.isTrue(n>1,"Node capacity must be greater than 1"),this._nodeCapacity=n}},bg={IntersectsOp:{configurable:!0},serialVersionUID:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};Li.prototype.getNodeCapacity=function(){return this._nodeCapacity};Li.prototype.lastNode=function(t){return t.get(t.size()-1)};Li.prototype.size=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.size(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,o=e.getChildBoundables().iterator();o.hasNext();){var l=o.next();l instanceof fi?n+=t.size(l):l instanceof ia&&(n+=1)}return n}};Li.prototype.removeItem=function(t,e){for(var n=null,o=t.getChildBoundables().iterator();o.hasNext();){var l=o.next();l instanceof ia&&l.getItem()===e&&(n=l)}return n!==null?(t.getChildBoundables().remove(n),!0):!1};Li.prototype.itemsTree=function(){var t=this;if(arguments.length===0){this.build();var e=this.itemsTree(this._root);return e===null?new se:e}else if(arguments.length===1){for(var n=arguments[0],o=new se,l=n.getChildBoundables().iterator();l.hasNext();){var h=l.next();if(h instanceof fi){var _=t.itemsTree(h);_!==null&&o.add(_)}else h instanceof ia?o.add(h.getItem()):cn.shouldNeverReachHere()}return o.size()<=0?null:o}};Li.prototype.insert=function(t,e){cn.isTrue(!this._built,"Cannot insert items into an STR packed R-tree after it has been built."),this._itemBoundables.add(new ia(t,e))};Li.prototype.boundablesAtLevel=function(){var t=this;if(arguments.length===1){var e=arguments[0],n=new se;return this.boundablesAtLevel(e,this._root,n),n}else if(arguments.length===3){var o=arguments[0],l=arguments[1],h=arguments[2];if(cn.isTrue(o>-2),l.getLevel()===o)return h.add(l),null;for(var _=l.getChildBoundables().iterator();_.hasNext();){var u=_.next();u instanceof fi?t.boundablesAtLevel(o,u,h):(cn.isTrue(u instanceof ia),o===-1&&h.add(u))}return null}};Li.prototype.query=function(){var t=this;if(arguments.length===1){var e=arguments[0];this.build();var n=new se;return this.isEmpty()||this.getIntersectsOp().intersects(this._root.getBounds(),e)&&this.query(e,this._root,n),n}else if(arguments.length===2){var o=arguments[0],l=arguments[1];if(this.build(),this.isEmpty())return null;this.getIntersectsOp().intersects(this._root.getBounds(),o)&&this.query(o,this._root,l)}else if(arguments.length===3){if(qe(arguments[2],Tu)&&arguments[0]instanceof Object&&arguments[1]instanceof fi)for(var h=arguments[0],_=arguments[1],u=arguments[2],I=_.getChildBoundables(),w=0;w<I.size();w++){var D=I.get(w);t.getIntersectsOp().intersects(D.getBounds(),h)&&(D instanceof fi?t.query(h,D,u):D instanceof ia?u.visitItem(D.getItem()):cn.shouldNeverReachHere())}else if(qe(arguments[2],ea)&&arguments[0]instanceof Object&&arguments[1]instanceof fi)for(var k=arguments[0],G=arguments[1],H=arguments[2],j=G.getChildBoundables(),K=0;K<j.size();K++){var lt=j.get(K);t.getIntersectsOp().intersects(lt.getBounds(),k)&&(lt instanceof fi?t.query(k,lt,H):lt instanceof ia?H.add(lt.getItem()):cn.shouldNeverReachHere())}}};Li.prototype.build=function(){if(this._built)return null;this._root=this._itemBoundables.isEmpty()?this.createNode(0):this.createHigherLevels(this._itemBoundables,-1),this._itemBoundables=null,this._built=!0};Li.prototype.getRoot=function(){return this.build(),this._root};Li.prototype.remove=function(){var t=this;if(arguments.length===2){var e=arguments[0],n=arguments[1];return this.build(),this.getIntersectsOp().intersects(this._root.getBounds(),e)?this.remove(e,this._root,n):!1}else if(arguments.length===3){var o=arguments[0],l=arguments[1],h=arguments[2],_=this.removeItem(l,h);if(_)return!0;for(var u=null,I=l.getChildBoundables().iterator();I.hasNext();){var w=I.next();if(t.getIntersectsOp().intersects(w.getBounds(),o)&&w instanceof fi&&(_=t.remove(o,w,h),_)){u=w;break}}return u!==null&&u.getChildBoundables().isEmpty()&&l.getChildBoundables().remove(u),_}};Li.prototype.createHigherLevels=function(t,e){cn.isTrue(!t.isEmpty());var n=this.createParentBoundables(t,e+1);return n.size()===1?n.get(0):this.createHigherLevels(n,e+1)};Li.prototype.depth=function(){var t=this;if(arguments.length===0)return this.isEmpty()?0:(this.build(),this.depth(this._root));if(arguments.length===1){for(var e=arguments[0],n=0,o=e.getChildBoundables().iterator();o.hasNext();){var l=o.next();if(l instanceof fi){var h=t.depth(l);h>n&&(n=h)}}return n+1}};Li.prototype.createParentBoundables=function(t,e){var n=this;cn.isTrue(!t.isEmpty());var o=new se;o.add(this.createNode(e));var l=new se(t);oa.sort(l,this.getComparator());for(var h=l.iterator();h.hasNext();){var _=h.next();n.lastNode(o).getChildBoundables().size()===n.getNodeCapacity()&&o.add(n.createNode(e)),n.lastNode(o).addChildBoundable(_)}return o};Li.prototype.isEmpty=function(){return this._built?this._root.isEmpty():this._itemBoundables.isEmpty()};Li.prototype.interfaces_=function(){return[Gs]};Li.prototype.getClass=function(){return Li};Li.compareDoubles=function(t,e){return t>e?1:t<e?-1:0};bg.IntersectsOp.get=function(){return Ow};bg.serialVersionUID.get=function(){return-3886435814360241e3};bg.DEFAULT_NODE_CAPACITY.get=function(){return 10};Object.defineProperties(Li,bg);var Ow=function(){},pp=function(){};pp.prototype.distance=function(t,e){};pp.prototype.interfaces_=function(){return[]};pp.prototype.getClass=function(){return pp};var Lv=function(t){function e(o){o=o||e.DEFAULT_NODE_CAPACITY,t.call(this,o)}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={STRtreeNode:{configurable:!0},serialVersionUID:{configurable:!0},xComparator:{configurable:!0},yComparator:{configurable:!0},intersectsOp:{configurable:!0},DEFAULT_NODE_CAPACITY:{configurable:!0}};return e.prototype.createParentBoundablesFromVerticalSlices=function(o,l){var h=this;cn.isTrue(o.length>0);for(var _=new se,u=0;u<o.length;u++)_.addAll(h.createParentBoundablesFromVerticalSlice(o[u],l));return _},e.prototype.createNode=function(o){return new m0(o)},e.prototype.size=function(){return arguments.length===0?t.prototype.size.call(this):t.prototype.size.apply(this,arguments)},e.prototype.insert=function(){if(arguments.length===2){var o=arguments[0],l=arguments[1];if(o.isNull())return null;t.prototype.insert.call(this,o,l)}else return t.prototype.insert.apply(this,arguments)},e.prototype.getIntersectsOp=function(){return e.intersectsOp},e.prototype.verticalSlices=function(o,l){for(var h=Math.trunc(Math.ceil(o.size()/l)),_=new Array(l).fill(null),u=o.iterator(),I=0;I<l;I++){_[I]=new se;for(var w=0;u.hasNext()&&w<h;){var D=u.next();_[I].add(D),w++}}return _},e.prototype.query=function(){if(arguments.length===1){var o=arguments[0];return t.prototype.query.call(this,o)}else if(arguments.length===2){var l=arguments[0],h=arguments[1];t.prototype.query.call(this,l,h)}else if(arguments.length===3){if(qe(arguments[2],Tu)&&arguments[0]instanceof Object&&arguments[1]instanceof fi){var _=arguments[0],u=arguments[1],I=arguments[2];t.prototype.query.call(this,_,u,I)}else if(qe(arguments[2],ea)&&arguments[0]instanceof Object&&arguments[1]instanceof fi){var w=arguments[0],D=arguments[1],k=arguments[2];t.prototype.query.call(this,w,D,k)}}},e.prototype.getComparator=function(){return e.yComparator},e.prototype.createParentBoundablesFromVerticalSlice=function(o,l){return t.prototype.createParentBoundables.call(this,o,l)},e.prototype.remove=function(){if(arguments.length===2){var o=arguments[0],l=arguments[1];return t.prototype.remove.call(this,o,l)}else return t.prototype.remove.apply(this,arguments)},e.prototype.depth=function(){return arguments.length===0?t.prototype.depth.call(this):t.prototype.depth.apply(this,arguments)},e.prototype.createParentBoundables=function(o,l){cn.isTrue(!o.isEmpty());var h=Math.trunc(Math.ceil(o.size()/this.getNodeCapacity())),_=new se(o);oa.sort(_,e.xComparator);var u=this.verticalSlices(_,Math.trunc(Math.ceil(Math.sqrt(h))));return this.createParentBoundablesFromVerticalSlices(u,l)},e.prototype.nearestNeighbour=function(){if(arguments.length===1){if(qe(arguments[0],pp)){var o=arguments[0],l=new ri(this.getRoot(),this.getRoot(),o);return this.nearestNeighbour(l)}else if(arguments[0]instanceof ri){var h=arguments[0];return this.nearestNeighbour(h,Je.POSITIVE_INFINITY)}}else if(arguments.length===2){if(arguments[0]instanceof e&&qe(arguments[1],pp)){var _=arguments[0],u=arguments[1],I=new ri(this.getRoot(),_.getRoot(),u);return this.nearestNeighbour(I)}else if(arguments[0]instanceof ri&&typeof arguments[1]=="number"){var w=arguments[0],D=arguments[1],k=D,G=null,H=new Wl;for(H.add(w);!H.isEmpty()&&k>0;){var j=H.poll(),K=j.getDistance();if(K>=k)break;j.isLeaves()?(k=K,G=j):j.expandToQueue(H,k)}return[G.getBoundable(0).getItem(),G.getBoundable(1).getItem()]}}else if(arguments.length===3){var lt=arguments[0],dt=arguments[1],xt=arguments[2],gt=new ia(lt,dt),yt=new ri(this.getRoot(),gt,xt);return this.nearestNeighbour(yt)[0]}},e.prototype.interfaces_=function(){return[Hc,Gs]},e.prototype.getClass=function(){return e},e.centreX=function(o){return e.avg(o.getMinX(),o.getMaxX())},e.avg=function(o,l){return(o+l)/2},e.centreY=function(o){return e.avg(o.getMinY(),o.getMaxY())},n.STRtreeNode.get=function(){return m0},n.serialVersionUID.get=function(){return 0x39920f7d5f261e0},n.xComparator.get=function(){return{interfaces_:function(){return[np]},compare:function(o,l){return t.compareDoubles(e.centreX(o.getBounds()),e.centreX(l.getBounds()))}}},n.yComparator.get=function(){return{interfaces_:function(){return[np]},compare:function(o,l){return t.compareDoubles(e.centreY(o.getBounds()),e.centreY(l.getBounds()))}}},n.intersectsOp.get=function(){return{interfaces_:function(){return[t.IntersectsOp]},intersects:function(o,l){return o.intersects(l)}}},n.DEFAULT_NODE_CAPACITY.get=function(){return 10},Object.defineProperties(e,n),e}(Li),m0=function(t){function e(){var n=arguments[0];t.call(this,n)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.computeBounds=function(){for(var n=null,o=this.getChildBoundables().iterator();o.hasNext();){var l=o.next();n===null?n=new De(l.getBounds()):n.expandToInclude(l.getBounds())}return n},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(fi),Ro=function(){};Ro.prototype.interfaces_=function(){return[]};Ro.prototype.getClass=function(){return Ro};Ro.relativeSign=function(t,e){return t<e?-1:t>e?1:0};Ro.compare=function(t,e,n){if(e.equals2D(n))return 0;var o=Ro.relativeSign(e.x,n.x),l=Ro.relativeSign(e.y,n.y);switch(t){case 0:return Ro.compareValue(o,l);case 1:return Ro.compareValue(l,o);case 2:return Ro.compareValue(l,-o);case 3:return Ro.compareValue(-o,l);case 4:return Ro.compareValue(-o,-l);case 5:return Ro.compareValue(-l,-o);case 6:return Ro.compareValue(-l,o);case 7:return Ro.compareValue(o,-l)}return cn.shouldNeverReachHere("invalid octant value"),0};Ro.compareValue=function(t,e){return t<0?-1:t>0?1:e<0?-1:e>0?1:0};var Cu=function(){this._segString=null,this.coord=null,this.segmentIndex=null,this._segmentOctant=null,this._isInterior=null;var t=arguments[0],e=arguments[1],n=arguments[2],o=arguments[3];this._segString=t,this.coord=new It(e),this.segmentIndex=n,this._segmentOctant=o,this._isInterior=!e.equals2D(t.getCoordinate(n))};Cu.prototype.getCoordinate=function(){return this.coord};Cu.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex)};Cu.prototype.compareTo=function(t){var e=t;return this.segmentIndex<e.segmentIndex?-1:this.segmentIndex>e.segmentIndex?1:this.coord.equals2D(e.coord)?0:Ro.compare(this._segmentOctant,this.coord,e.coord)};Cu.prototype.isEndPoint=function(t){return this.segmentIndex===0&&!this._isInterior||this.segmentIndex===t};Cu.prototype.isInterior=function(){return this._isInterior};Cu.prototype.interfaces_=function(){return[Vs]};Cu.prototype.getClass=function(){return Cu};var So=function(){this._nodeMap=new eo,this._edge=null;var t=arguments[0];this._edge=t};So.prototype.getSplitCoordinates=function(){var t=this,e=new Zf;this.addEndpoints();for(var n=this.iterator(),o=n.next();n.hasNext();){var l=n.next();t.addEdgeCoordinates(o,l,e),o=l}return e.toCoordinateArray()};So.prototype.addCollapsedNodes=function(){var t=this,e=new se;this.findCollapsesFromInsertedNodes(e),this.findCollapsesFromExistingVertices(e);for(var n=e.iterator();n.hasNext();){var o=n.next().intValue();t.add(t._edge.getCoordinate(o),o)}};So.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};So.prototype.findCollapsesFromExistingVertices=function(t){for(var e=this,n=0;n<this._edge.size()-2;n++){var o=e._edge.getCoordinate(n),l=e._edge.getCoordinate(n+2);o.equals2D(l)&&t.add(new Ra(n+1))}};So.prototype.addEdgeCoordinates=function(t,e,n){var o=this,l=this._edge.getCoordinate(e.segmentIndex),h=e.isInterior()||!e.coord.equals2D(l);n.add(new It(t.coord),!1);for(var _=t.segmentIndex+1;_<=e.segmentIndex;_++)n.add(o._edge.getCoordinate(_));h&&n.add(new It(e.coord))};So.prototype.iterator=function(){return this._nodeMap.values().iterator()};So.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints(),this.addCollapsedNodes();for(var n=this.iterator(),o=n.next();n.hasNext();){var l=n.next(),h=e.createSplitEdge(o,l);t.add(h),o=l}};So.prototype.findCollapseIndex=function(t,e,n){if(!t.coord.equals2D(e.coord))return!1;var o=e.segmentIndex-t.segmentIndex;return e.isInterior()||o--,o===1?(n[0]=t.segmentIndex+1,!0):!1};So.prototype.findCollapsesFromInsertedNodes=function(t){for(var e=this,n=new Array(1).fill(null),o=this.iterator(),l=o.next();o.hasNext();){var h=o.next(),_=e.findCollapseIndex(l,h,n);_&&t.add(new Ra(n[0])),l=h}};So.prototype.getEdge=function(){return this._edge};So.prototype.addEndpoints=function(){var t=this._edge.size()-1;this.add(this._edge.getCoordinate(0),0),this.add(this._edge.getCoordinate(t),t)};So.prototype.createSplitEdge=function(t,e){var n=this,o=e.segmentIndex-t.segmentIndex+2,l=this._edge.getCoordinate(e.segmentIndex),h=e.isInterior()||!e.coord.equals2D(l);h||o--;var _=new Array(o).fill(null),u=0;_[u++]=new It(t.coord);for(var I=t.segmentIndex+1;I<=e.segmentIndex;I++)_[u++]=n._edge.getCoordinate(I);return h&&(_[u]=new It(e.coord)),new Kr(_,this._edge.getData())};So.prototype.add=function(t,e){var n=new Cu(this._edge,t,e,this._edge.getSegmentOctant(e)),o=this._nodeMap.get(n);return o!==null?(cn.isTrue(o.coord.equals2D(t),"Found equal nodes with different coordinates"),o):(this._nodeMap.put(n,n),n)};So.prototype.checkSplitEdgesCorrectness=function(t){var e=this._edge.getCoordinates(),n=t.get(0),o=n.getCoordinate(0);if(!o.equals2D(e[0]))throw new Zl("bad split edge start point at "+o);var l=t.get(t.size()-1),h=l.getCoordinates(),_=h[h.length-1];if(!_.equals2D(e[e.length-1]))throw new Zl("bad split edge end point at "+_)};So.prototype.interfaces_=function(){return[]};So.prototype.getClass=function(){return So};var $c=function(){};$c.prototype.interfaces_=function(){return[]};$c.prototype.getClass=function(){return $c};$c.octant=function(){if(typeof arguments[0]=="number"&&typeof arguments[1]=="number"){var t=arguments[0],e=arguments[1];if(t===0&&e===0)throw new Ir("Cannot compute the octant for point ( "+t+", "+e+" )");var n=Math.abs(t),o=Math.abs(e);return t>=0?e>=0?n>=o?0:1:n>=o?7:6:e>=0?n>=o?3:2:n>=o?4:5}else if(arguments[0]instanceof It&&arguments[1]instanceof It){var l=arguments[0],h=arguments[1],_=h.x-l.x,u=h.y-l.y;if(_===0&&u===0)throw new Ir("Cannot compute the octant for two identical points "+l);return $c.octant(_,u)}};var yl=function(){};yl.prototype.getCoordinates=function(){};yl.prototype.size=function(){};yl.prototype.getCoordinate=function(t){};yl.prototype.isClosed=function(){};yl.prototype.setData=function(t){};yl.prototype.getData=function(){};yl.prototype.interfaces_=function(){return[]};yl.prototype.getClass=function(){return yl};var Of=function(){};Of.prototype.addIntersection=function(t,e){};Of.prototype.interfaces_=function(){return[yl]};Of.prototype.getClass=function(){return Of};var Kr=function(){this._nodeList=new So(this),this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};Kr.prototype.getCoordinates=function(){return this._pts};Kr.prototype.size=function(){return this._pts.length};Kr.prototype.getCoordinate=function(t){return this._pts[t]};Kr.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};Kr.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:this.safeOctant(this.getCoordinate(t),this.getCoordinate(t+1))};Kr.prototype.setData=function(t){this._data=t};Kr.prototype.safeOctant=function(t,e){return t.equals2D(e)?0:$c.octant(t,e)};Kr.prototype.getData=function(){return this._data};Kr.prototype.addIntersection=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1];this.addIntersectionNode(t,e)}else if(arguments.length===4){var n=arguments[0],o=arguments[1],l=arguments[3],h=new It(n.getIntersection(l));this.addIntersection(h,o)}};Kr.prototype.toString=function(){return na.toLineString(new Wr(this._pts))};Kr.prototype.getNodeList=function(){return this._nodeList};Kr.prototype.addIntersectionNode=function(t,e){var n=e,o=n+1;if(o<this._pts.length){var l=this._pts[o];t.equals2D(l)&&(n=o)}var h=this._nodeList.add(t,n);return h};Kr.prototype.addIntersections=function(t,e,n){for(var o=this,l=0;l<t.getIntersectionNum();l++)o.addIntersection(t,e,n,l)};Kr.prototype.interfaces_=function(){return[Of]};Kr.prototype.getClass=function(){return Kr};Kr.getNodedSubstrings=function(){if(arguments.length===1){var t=arguments[0],e=new se;return Kr.getNodedSubstrings(t,e),e}else if(arguments.length===2)for(var n=arguments[0],o=arguments[1],l=n.iterator();l.hasNext();){var h=l.next();h.getNodeList().addSplitEdges(o)}};var Re=function(){if(this.p0=null,this.p1=null,arguments.length===0)this.p0=new It,this.p1=new It;else if(arguments.length===1){var t=arguments[0];this.p0=new It(t.p0),this.p1=new It(t.p1)}else if(arguments.length===2)this.p0=arguments[0],this.p1=arguments[1];else if(arguments.length===4){var e=arguments[0],n=arguments[1],o=arguments[2],l=arguments[3];this.p0=new It(e,n),this.p1=new It(o,l)}},Dv={serialVersionUID:{configurable:!0}};Re.prototype.minX=function(){return Math.min(this.p0.x,this.p1.x)};Re.prototype.orientationIndex=function(){if(arguments[0]instanceof Re){var t=arguments[0],e=ge.orientationIndex(this.p0,this.p1,t.p0),n=ge.orientationIndex(this.p0,this.p1,t.p1);return e>=0&&n>=0||e<=0&&n<=0?Math.max(e,n):0}else if(arguments[0]instanceof It){var o=arguments[0];return ge.orientationIndex(this.p0,this.p1,o)}};Re.prototype.toGeometry=function(t){return t.createLineString([this.p0,this.p1])};Re.prototype.isVertical=function(){return this.p0.x===this.p1.x};Re.prototype.equals=function(t){if(!(t instanceof Re))return!1;var e=t;return this.p0.equals(e.p0)&&this.p1.equals(e.p1)};Re.prototype.intersection=function(t){var e=new bc;return e.computeIntersection(this.p0,this.p1,t.p0,t.p1),e.hasIntersection()?e.getIntersection(0):null};Re.prototype.project=function(){if(arguments[0]instanceof It){var t=arguments[0];if(t.equals(this.p0)||t.equals(this.p1))return new It(t);var e=this.projectionFactor(t),n=new It;return n.x=this.p0.x+e*(this.p1.x-this.p0.x),n.y=this.p0.y+e*(this.p1.y-this.p0.y),n}else if(arguments[0]instanceof Re){var o=arguments[0],l=this.projectionFactor(o.p0),h=this.projectionFactor(o.p1);if(l>=1&&h>=1||l<=0&&h<=0)return null;var _=this.project(o.p0);l<0&&(_=this.p0),l>1&&(_=this.p1);var u=this.project(o.p1);return h<0&&(u=this.p0),h>1&&(u=this.p1),new Re(_,u)}};Re.prototype.normalize=function(){this.p1.compareTo(this.p0)<0&&this.reverse()};Re.prototype.angle=function(){return Math.atan2(this.p1.y-this.p0.y,this.p1.x-this.p0.x)};Re.prototype.getCoordinate=function(t){return t===0?this.p0:this.p1};Re.prototype.distancePerpendicular=function(t){return ge.distancePointLinePerpendicular(t,this.p0,this.p1)};Re.prototype.minY=function(){return Math.min(this.p0.y,this.p1.y)};Re.prototype.midPoint=function(){return Re.midPoint(this.p0,this.p1)};Re.prototype.projectionFactor=function(t){if(t.equals(this.p0))return 0;if(t.equals(this.p1))return 1;var e=this.p1.x-this.p0.x,n=this.p1.y-this.p0.y,o=e*e+n*n;if(o<=0)return Je.NaN;var l=((t.x-this.p0.x)*e+(t.y-this.p0.y)*n)/o;return l};Re.prototype.closestPoints=function(t){var e=this.intersection(t);if(e!==null)return[e,e];var n=new Array(2).fill(null),o=Je.MAX_VALUE,l=null,h=this.closestPoint(t.p0);o=h.distance(t.p0),n[0]=h,n[1]=t.p0;var _=this.closestPoint(t.p1);l=_.distance(t.p1),l<o&&(o=l,n[0]=_,n[1]=t.p1);var u=t.closestPoint(this.p0);l=u.distance(this.p0),l<o&&(o=l,n[0]=this.p0,n[1]=u);var I=t.closestPoint(this.p1);return l=I.distance(this.p1),l<o&&(o=l,n[0]=this.p1,n[1]=I),n};Re.prototype.closestPoint=function(t){var e=this.projectionFactor(t);if(e>0&&e<1)return this.project(t);var n=this.p0.distance(t),o=this.p1.distance(t);return n<o?this.p0:this.p1};Re.prototype.maxX=function(){return Math.max(this.p0.x,this.p1.x)};Re.prototype.getLength=function(){return this.p0.distance(this.p1)};Re.prototype.compareTo=function(t){var e=t,n=this.p0.compareTo(e.p0);return n!==0?n:this.p1.compareTo(e.p1)};Re.prototype.reverse=function(){var t=this.p0;this.p0=this.p1,this.p1=t};Re.prototype.equalsTopo=function(t){return this.p0.equals(t.p0)&&(this.p1.equals(t.p1)||this.p0.equals(t.p1))&&this.p1.equals(t.p0)};Re.prototype.lineIntersection=function(t){try{var e=ta.intersection(this.p0,this.p1,t.p0,t.p1);return e}catch(n){if(!(n instanceof Ep))throw n}finally{}return null};Re.prototype.maxY=function(){return Math.max(this.p0.y,this.p1.y)};Re.prototype.pointAlongOffset=function(t,e){var n=this.p0.x+t*(this.p1.x-this.p0.x),o=this.p0.y+t*(this.p1.y-this.p0.y),l=this.p1.x-this.p0.x,h=this.p1.y-this.p0.y,_=Math.sqrt(l*l+h*h),u=0,I=0;if(e!==0){if(_<=0)throw new Error("Cannot compute offset from zero-length line segment");u=e*l/_,I=e*h/_}var w=n-I,D=o+u,k=new It(w,D);return k};Re.prototype.setCoordinates=function(){if(arguments.length===1){var t=arguments[0];this.setCoordinates(t.p0,t.p1)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this.p0.x=e.x,this.p0.y=e.y,this.p1.x=n.x,this.p1.y=n.y}};Re.prototype.segmentFraction=function(t){var e=this.projectionFactor(t);return e<0?e=0:(e>1||Je.isNaN(e))&&(e=1),e};Re.prototype.toString=function(){return"LINESTRING( "+this.p0.x+" "+this.p0.y+", "+this.p1.x+" "+this.p1.y+")"};Re.prototype.isHorizontal=function(){return this.p0.y===this.p1.y};Re.prototype.distance=function(){if(arguments[0]instanceof Re){var t=arguments[0];return ge.distanceLineLine(this.p0,this.p1,t.p0,t.p1)}else if(arguments[0]instanceof It){var e=arguments[0];return ge.distancePointLine(e,this.p0,this.p1)}};Re.prototype.pointAlong=function(t){var e=new It;return e.x=this.p0.x+t*(this.p1.x-this.p0.x),e.y=this.p0.y+t*(this.p1.y-this.p0.y),e};Re.prototype.hashCode=function(){var t=Je.doubleToLongBits(this.p0.x);t^=Je.doubleToLongBits(this.p0.y)*31;var e=Math.trunc(t)^Math.trunc(t>>32),n=Je.doubleToLongBits(this.p1.x);n^=Je.doubleToLongBits(this.p1.y)*31;var o=Math.trunc(n)^Math.trunc(n>>32);return e^o};Re.prototype.interfaces_=function(){return[Vs,Gs]};Re.prototype.getClass=function(){return Re};Re.midPoint=function(t,e){return new It((t.x+e.x)/2,(t.y+e.y)/2)};Dv.serialVersionUID.get=function(){return 0x2d2172135f411c00};Object.defineProperties(Re,Dv);var zf=function(){this.tempEnv1=new De,this.tempEnv2=new De,this._overlapSeg1=new Re,this._overlapSeg2=new Re};zf.prototype.overlap=function(){if(arguments.length!==2&&arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],o=arguments[3];t.getLineSegment(e,this._overlapSeg1),n.getLineSegment(o,this._overlapSeg2),this.overlap(this._overlapSeg1,this._overlapSeg2)}};zf.prototype.interfaces_=function(){return[]};zf.prototype.getClass=function(){return zf};var es=function(){this._pts=null,this._start=null,this._end=null,this._env=null,this._context=null,this._id=null;var t=arguments[0],e=arguments[1],n=arguments[2],o=arguments[3];this._pts=t,this._start=e,this._end=n,this._context=o};es.prototype.getLineSegment=function(t,e){e.p0=this._pts[t],e.p1=this._pts[t+1]};es.prototype.computeSelect=function(t,e,n,o){var l=this._pts[e],h=this._pts[n];if(o.tempEnv1.init(l,h),n-e===1)return o.select(this,e),null;if(!t.intersects(o.tempEnv1))return null;var _=Math.trunc((e+n)/2);e<_&&this.computeSelect(t,e,_,o),_<n&&this.computeSelect(t,_,n,o)};es.prototype.getCoordinates=function(){for(var t=this,e=new Array(this._end-this._start+1).fill(null),n=0,o=this._start;o<=this._end;o++)e[n++]=t._pts[o];return e};es.prototype.computeOverlaps=function(t,e){this.computeOverlapsInternal(this._start,this._end,t,t._start,t._end,e)};es.prototype.setId=function(t){this._id=t};es.prototype.select=function(t,e){this.computeSelect(t,this._start,this._end,e)};es.prototype.getEnvelope=function(){if(this._env===null){var t=this._pts[this._start],e=this._pts[this._end];this._env=new De(t,e)}return this._env};es.prototype.getEndIndex=function(){return this._end};es.prototype.getStartIndex=function(){return this._start};es.prototype.getContext=function(){return this._context};es.prototype.getId=function(){return this._id};es.prototype.computeOverlapsInternal=function(t,e,n,o,l,h){var _=this._pts[t],u=this._pts[e],I=n._pts[o],w=n._pts[l];if(e-t===1&&l-o===1)return h.overlap(this,t,n,o),null;if(h.tempEnv1.init(_,u),h.tempEnv2.init(I,w),!h.tempEnv1.intersects(h.tempEnv2))return null;var D=Math.trunc((t+e)/2),k=Math.trunc((o+l)/2);t<D&&(o<k&&this.computeOverlapsInternal(t,D,n,o,k,h),k<l&&this.computeOverlapsInternal(t,D,n,k,l,h)),D<e&&(o<k&&this.computeOverlapsInternal(D,e,n,o,k,h),k<l&&this.computeOverlapsInternal(D,e,n,k,l,h))};es.prototype.interfaces_=function(){return[]};es.prototype.getClass=function(){return es};var Na=function(){};Na.prototype.interfaces_=function(){return[]};Na.prototype.getClass=function(){return Na};Na.getChainStartIndices=function(t){var e=0,n=new se;n.add(new Ra(e));do{var o=Na.findChainEnd(t,e);n.add(new Ra(o)),e=o}while(e<t.length-1);var l=Na.toIntArray(n);return l};Na.findChainEnd=function(t,e){for(var n=e;n<t.length-1&&t[n].equals2D(t[n+1]);)n++;if(n>=t.length-1)return t.length-1;for(var o=Qn.quadrant(t[n],t[n+1]),l=e+1;l<t.length;){if(!t[l-1].equals2D(t[l])){var h=Qn.quadrant(t[l-1],t[l]);if(h!==o)break}l++}return l-1};Na.getChains=function(){if(arguments.length===1){var t=arguments[0];return Na.getChains(t,null)}else if(arguments.length===2){for(var e=arguments[0],n=arguments[1],o=new se,l=Na.getChainStartIndices(e),h=0;h<l.length-1;h++){var _=new es(e,l[h],l[h+1],n);o.add(_)}return o}};Na.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var fc=function(){};fc.prototype.computeNodes=function(t){};fc.prototype.getNodedSubstrings=function(){};fc.prototype.interfaces_=function(){return[]};fc.prototype.getClass=function(){return fc};var Ff=function(){if(this._segInt=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];this.setSegmentIntersector(t)}};Ff.prototype.setSegmentIntersector=function(t){this._segInt=t};Ff.prototype.interfaces_=function(){return[fc]};Ff.prototype.getClass=function(){return Ff};var u_=function(t){function e(o){o?t.call(this,o):t.call(this),this._monoChains=new se,this._index=new Lv,this._idCounter=0,this._nodedSegStrings=null,this._nOverlaps=0}t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e;var n={SegmentOverlapAction:{configurable:!0}};return e.prototype.getMonotoneChains=function(){return this._monoChains},e.prototype.getNodedSubstrings=function(){return Kr.getNodedSubstrings(this._nodedSegStrings)},e.prototype.getIndex=function(){return this._index},e.prototype.add=function(o){for(var l=this,h=Na.getChains(o.getCoordinates(),o),_=h.iterator();_.hasNext();){var u=_.next();u.setId(l._idCounter++),l._index.insert(u.getEnvelope(),u),l._monoChains.add(u)}},e.prototype.computeNodes=function(o){var l=this;this._nodedSegStrings=o;for(var h=o.iterator();h.hasNext();)l.add(h.next());this.intersectChains()},e.prototype.intersectChains=function(){for(var o=this,l=new _0(this._segInt),h=this._monoChains.iterator();h.hasNext();)for(var _=h.next(),u=o._index.query(_.getEnvelope()),I=u.iterator();I.hasNext();){var w=I.next();if(w.getId()>_.getId()&&(_.computeOverlaps(w,l),o._nOverlaps++),o._segInt.isDone())return null}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},n.SegmentOverlapAction.get=function(){return _0},Object.defineProperties(e,n),e}(Ff),_0=function(t){function e(){t.call(this),this._si=null;var n=arguments[0];this._si=n}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.overlap=function(){if(arguments.length===4){var n=arguments[0],o=arguments[1],l=arguments[2],h=arguments[3],_=n.getContext(),u=l.getContext();this._si.processIntersections(_,o,u,h)}else return t.prototype.overlap.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(zf),Rn=function t(){if(this._quadrantSegments=t.DEFAULT_QUADRANT_SEGMENTS,this._endCapStyle=t.CAP_ROUND,this._joinStyle=t.JOIN_ROUND,this._mitreLimit=t.DEFAULT_MITRE_LIMIT,this._isSingleSided=!1,this._simplifyFactor=t.DEFAULT_SIMPLIFY_FACTOR,arguments.length!==0){if(arguments.length===1){var e=arguments[0];this.setQuadrantSegments(e)}else if(arguments.length===2){var n=arguments[0],o=arguments[1];this.setQuadrantSegments(n),this.setEndCapStyle(o)}else if(arguments.length===4){var l=arguments[0],h=arguments[1],_=arguments[2],u=arguments[3];this.setQuadrantSegments(l),this.setEndCapStyle(h),this.setJoinStyle(_),this.setMitreLimit(u)}}},Jl={CAP_ROUND:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},JOIN_ROUND:{configurable:!0},JOIN_MITRE:{configurable:!0},JOIN_BEVEL:{configurable:!0},DEFAULT_QUADRANT_SEGMENTS:{configurable:!0},DEFAULT_MITRE_LIMIT:{configurable:!0},DEFAULT_SIMPLIFY_FACTOR:{configurable:!0}};Rn.prototype.getEndCapStyle=function(){return this._endCapStyle};Rn.prototype.isSingleSided=function(){return this._isSingleSided};Rn.prototype.setQuadrantSegments=function(t){this._quadrantSegments=t,this._quadrantSegments===0&&(this._joinStyle=Rn.JOIN_BEVEL),this._quadrantSegments<0&&(this._joinStyle=Rn.JOIN_MITRE,this._mitreLimit=Math.abs(this._quadrantSegments)),t<=0&&(this._quadrantSegments=1),this._joinStyle!==Rn.JOIN_ROUND&&(this._quadrantSegments=Rn.DEFAULT_QUADRANT_SEGMENTS)};Rn.prototype.getJoinStyle=function(){return this._joinStyle};Rn.prototype.setJoinStyle=function(t){this._joinStyle=t};Rn.prototype.setSimplifyFactor=function(t){this._simplifyFactor=t<0?0:t};Rn.prototype.getSimplifyFactor=function(){return this._simplifyFactor};Rn.prototype.getQuadrantSegments=function(){return this._quadrantSegments};Rn.prototype.setEndCapStyle=function(t){this._endCapStyle=t};Rn.prototype.getMitreLimit=function(){return this._mitreLimit};Rn.prototype.setMitreLimit=function(t){this._mitreLimit=t};Rn.prototype.setSingleSided=function(t){this._isSingleSided=t};Rn.prototype.interfaces_=function(){return[]};Rn.prototype.getClass=function(){return Rn};Rn.bufferDistanceError=function(t){var e=Math.PI/2/t;return 1-Math.cos(e/2)};Jl.CAP_ROUND.get=function(){return 1};Jl.CAP_FLAT.get=function(){return 2};Jl.CAP_SQUARE.get=function(){return 3};Jl.JOIN_ROUND.get=function(){return 1};Jl.JOIN_MITRE.get=function(){return 2};Jl.JOIN_BEVEL.get=function(){return 3};Jl.DEFAULT_QUADRANT_SEGMENTS.get=function(){return 8};Jl.DEFAULT_MITRE_LIMIT.get=function(){return 5};Jl.DEFAULT_SIMPLIFY_FACTOR.get=function(){return .01};Object.defineProperties(Rn,Jl);var Br=function(t){this._distanceTol=null,this._isDeleted=null,this._angleOrientation=ge.COUNTERCLOCKWISE,this._inputLine=t||null},Wf={INIT:{configurable:!0},DELETE:{configurable:!0},KEEP:{configurable:!0},NUM_PTS_TO_CHECK:{configurable:!0}};Br.prototype.isDeletable=function(t,e,n,o){var l=this._inputLine[t],h=this._inputLine[e],_=this._inputLine[n];return!this.isConcave(l,h,_)||!this.isShallow(l,h,_,o)?!1:this.isShallowSampled(l,h,t,n,o)};Br.prototype.deleteShallowConcavities=function(){for(var t=this,e=1,n=this.findNextNonDeletedIndex(e),o=this.findNextNonDeletedIndex(n),l=!1;o<this._inputLine.length;){var h=!1;t.isDeletable(e,n,o,t._distanceTol)&&(t._isDeleted[n]=Br.DELETE,h=!0,l=!0),h?e=o:e=n,n=t.findNextNonDeletedIndex(e),o=t.findNextNonDeletedIndex(n)}return l};Br.prototype.isShallowConcavity=function(t,e,n,o){var l=ge.computeOrientation(t,e,n),h=l===this._angleOrientation;if(!h)return!1;var _=ge.distancePointLine(e,t,n);return _<o};Br.prototype.isShallowSampled=function(t,e,n,o,l){var h=this,_=Math.trunc((o-n)/Br.NUM_PTS_TO_CHECK);_<=0&&(_=1);for(var u=n;u<o;u+=_)if(!h.isShallow(t,e,h._inputLine[u],l))return!1;return!0};Br.prototype.isConcave=function(t,e,n){var o=ge.computeOrientation(t,e,n),l=o===this._angleOrientation;return l};Br.prototype.simplify=function(t){var e=this;this._distanceTol=Math.abs(t),t<0&&(this._angleOrientation=ge.CLOCKWISE),this._isDeleted=new Array(this._inputLine.length).fill(null);var n=!1;do n=e.deleteShallowConcavities();while(n);return this.collapseLine()};Br.prototype.findNextNonDeletedIndex=function(t){for(var e=t+1;e<this._inputLine.length&&this._isDeleted[e]===Br.DELETE;)e++;return e};Br.prototype.isShallow=function(t,e,n,o){var l=ge.distancePointLine(e,t,n);return l<o};Br.prototype.collapseLine=function(){for(var t=this,e=new Zf,n=0;n<this._inputLine.length;n++)t._isDeleted[n]!==Br.DELETE&&e.add(t._inputLine[n]);return e.toCoordinateArray()};Br.prototype.interfaces_=function(){return[]};Br.prototype.getClass=function(){return Br};Br.simplify=function(t,e){var n=new Br(t);return n.simplify(e)};Wf.INIT.get=function(){return 0};Wf.DELETE.get=function(){return 1};Wf.KEEP.get=function(){return 1};Wf.NUM_PTS_TO_CHECK.get=function(){return 10};Object.defineProperties(Br,Wf);var Ss=function(){this._ptList=null,this._precisionModel=null,this._minimimVertexDistance=0,this._ptList=new se},kv={COORDINATE_ARRAY_TYPE:{configurable:!0}};Ss.prototype.getCoordinates=function(){var t=this._ptList.toArray(Ss.COORDINATE_ARRAY_TYPE);return t};Ss.prototype.setPrecisionModel=function(t){this._precisionModel=t};Ss.prototype.addPt=function(t){var e=new It(t);if(this._precisionModel.makePrecise(e),this.isRedundant(e))return null;this._ptList.add(e)};Ss.prototype.revere=function(){};Ss.prototype.addPts=function(t,e){var n=this;if(e)for(var o=0;o<t.length;o++)n.addPt(t[o]);else for(var l=t.length-1;l>=0;l--)n.addPt(t[l])};Ss.prototype.isRedundant=function(t){if(this._ptList.size()<1)return!1;var e=this._ptList.get(this._ptList.size()-1),n=t.distance(e);return n<this._minimimVertexDistance};Ss.prototype.toString=function(){var t=new gn,e=t.createLineString(this.getCoordinates());return e.toString()};Ss.prototype.closeRing=function(){if(this._ptList.size()<1)return null;var t=new It(this._ptList.get(0)),e=this._ptList.get(this._ptList.size()-1);if(t.equals(e))return null;this._ptList.add(t)};Ss.prototype.setMinimumVertexDistance=function(t){this._minimimVertexDistance=t};Ss.prototype.interfaces_=function(){return[]};Ss.prototype.getClass=function(){return Ss};kv.COORDINATE_ARRAY_TYPE.get=function(){return new Array(0).fill(null)};Object.defineProperties(Ss,kv);var Sn=function(){},hh={PI_TIMES_2:{configurable:!0},PI_OVER_2:{configurable:!0},PI_OVER_4:{configurable:!0},COUNTERCLOCKWISE:{configurable:!0},CLOCKWISE:{configurable:!0},NONE:{configurable:!0}};Sn.prototype.interfaces_=function(){return[]};Sn.prototype.getClass=function(){return Sn};Sn.toDegrees=function(t){return t*180/Math.PI};Sn.normalize=function(t){for(;t>Math.PI;)t-=Sn.PI_TIMES_2;for(;t<=-Math.PI;)t+=Sn.PI_TIMES_2;return t};Sn.angle=function(){if(arguments.length===1){var t=arguments[0];return Math.atan2(t.y,t.x)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],o=n.x-e.x,l=n.y-e.y;return Math.atan2(l,o)}};Sn.isAcute=function(t,e,n){var o=t.x-e.x,l=t.y-e.y,h=n.x-e.x,_=n.y-e.y,u=o*h+l*_;return u>0};Sn.isObtuse=function(t,e,n){var o=t.x-e.x,l=t.y-e.y,h=n.x-e.x,_=n.y-e.y,u=o*h+l*_;return u<0};Sn.interiorAngle=function(t,e,n){var o=Sn.angle(e,t),l=Sn.angle(e,n);return Math.abs(l-o)};Sn.normalizePositive=function(t){if(t<0){for(;t<0;)t+=Sn.PI_TIMES_2;t>=Sn.PI_TIMES_2&&(t=0)}else{for(;t>=Sn.PI_TIMES_2;)t-=Sn.PI_TIMES_2;t<0&&(t=0)}return t};Sn.angleBetween=function(t,e,n){var o=Sn.angle(e,t),l=Sn.angle(e,n);return Sn.diff(o,l)};Sn.diff=function(t,e){var n=null;return t<e?n=e-t:n=t-e,n>Math.PI&&(n=2*Math.PI-n),n};Sn.toRadians=function(t){return t*Math.PI/180};Sn.getTurn=function(t,e){var n=Math.sin(e-t);return n>0?Sn.COUNTERCLOCKWISE:n<0?Sn.CLOCKWISE:Sn.NONE};Sn.angleBetweenOriented=function(t,e,n){var o=Sn.angle(e,t),l=Sn.angle(e,n),h=l-o;return h<=-Math.PI?h+Sn.PI_TIMES_2:h>Math.PI?h-Sn.PI_TIMES_2:h};hh.PI_TIMES_2.get=function(){return 2*Math.PI};hh.PI_OVER_2.get=function(){return Math.PI/2};hh.PI_OVER_4.get=function(){return Math.PI/4};hh.COUNTERCLOCKWISE.get=function(){return ge.COUNTERCLOCKWISE};hh.CLOCKWISE.get=function(){return ge.CLOCKWISE};hh.NONE.get=function(){return ge.COLLINEAR};Object.defineProperties(Sn,hh);var mr=function t(){this._maxCurveSegmentError=0,this._filletAngleQuantum=null,this._closingSegLengthFactor=1,this._segList=null,this._distance=0,this._precisionModel=null,this._bufParams=null,this._li=null,this._s0=null,this._s1=null,this._s2=null,this._seg0=new Re,this._seg1=new Re,this._offset0=new Re,this._offset1=new Re,this._side=0,this._hasNarrowConcaveAngle=!1;var e=arguments[0],n=arguments[1],o=arguments[2];this._precisionModel=e,this._bufParams=n,this._li=new bc,this._filletAngleQuantum=Math.PI/2/n.getQuadrantSegments(),n.getQuadrantSegments()>=8&&n.getJoinStyle()===Rn.JOIN_ROUND&&(this._closingSegLengthFactor=t.MAX_CLOSING_SEG_LEN_FACTOR),this.init(o)},Hf={OFFSET_SEGMENT_SEPARATION_FACTOR:{configurable:!0},INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},CURVE_VERTEX_SNAP_DISTANCE_FACTOR:{configurable:!0},MAX_CLOSING_SEG_LEN_FACTOR:{configurable:!0}};mr.prototype.addNextSegment=function(t,e){if(this._s0=this._s1,this._s1=this._s2,this._s2=t,this._seg0.setCoordinates(this._s0,this._s1),this.computeOffsetSegment(this._seg0,this._side,this._distance,this._offset0),this._seg1.setCoordinates(this._s1,this._s2),this.computeOffsetSegment(this._seg1,this._side,this._distance,this._offset1),this._s1.equals(this._s2))return null;var n=ge.computeOrientation(this._s0,this._s1,this._s2),o=n===ge.CLOCKWISE&&this._side===Kt.LEFT||n===ge.COUNTERCLOCKWISE&&this._side===Kt.RIGHT;n===0?this.addCollinear(e):o?this.addOutsideTurn(n,e):this.addInsideTurn(n,e)};mr.prototype.addLineEndCap=function(t,e){var n=new Re(t,e),o=new Re;this.computeOffsetSegment(n,Kt.LEFT,this._distance,o);var l=new Re;this.computeOffsetSegment(n,Kt.RIGHT,this._distance,l);var h=e.x-t.x,_=e.y-t.y,u=Math.atan2(_,h);switch(this._bufParams.getEndCapStyle()){case Rn.CAP_ROUND:this._segList.addPt(o.p1),this.addFilletArc(e,u+Math.PI/2,u-Math.PI/2,ge.CLOCKWISE,this._distance),this._segList.addPt(l.p1);break;case Rn.CAP_FLAT:this._segList.addPt(o.p1),this._segList.addPt(l.p1);break;case Rn.CAP_SQUARE:var I=new It;I.x=Math.abs(this._distance)*Math.cos(u),I.y=Math.abs(this._distance)*Math.sin(u);var w=new It(o.p1.x+I.x,o.p1.y+I.y),D=new It(l.p1.x+I.x,l.p1.y+I.y);this._segList.addPt(w),this._segList.addPt(D);break}};mr.prototype.getCoordinates=function(){var t=this._segList.getCoordinates();return t};mr.prototype.addMitreJoin=function(t,e,n,o){var l=!0,h=null;try{h=ta.intersection(e.p0,e.p1,n.p0,n.p1);var _=o<=0?1:h.distance(t)/Math.abs(o);_>this._bufParams.getMitreLimit()&&(l=!1)}catch(u){if(u instanceof Ep)h=new It(0,0),l=!1;else throw u}finally{}l?this._segList.addPt(h):this.addLimitedMitreJoin(e,n,o,this._bufParams.getMitreLimit())};mr.prototype.addFilletCorner=function(t,e,n,o,l){var h=e.x-t.x,_=e.y-t.y,u=Math.atan2(_,h),I=n.x-t.x,w=n.y-t.y,D=Math.atan2(w,I);o===ge.CLOCKWISE?u<=D&&(u+=2*Math.PI):u>=D&&(u-=2*Math.PI),this._segList.addPt(e),this.addFilletArc(t,u,D,o,l),this._segList.addPt(n)};mr.prototype.addOutsideTurn=function(t,e){if(this._offset0.p1.distance(this._offset1.p0)<this._distance*mr.OFFSET_SEGMENT_SEPARATION_FACTOR)return this._segList.addPt(this._offset0.p1),null;this._bufParams.getJoinStyle()===Rn.JOIN_MITRE?this.addMitreJoin(this._s1,this._offset0,this._offset1,this._distance):this._bufParams.getJoinStyle()===Rn.JOIN_BEVEL?this.addBevelJoin(this._offset0,this._offset1):(e&&this._segList.addPt(this._offset0.p1),this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,t,this._distance),this._segList.addPt(this._offset1.p0))};mr.prototype.createSquare=function(t){this._segList.addPt(new It(t.x+this._distance,t.y+this._distance)),this._segList.addPt(new It(t.x+this._distance,t.y-this._distance)),this._segList.addPt(new It(t.x-this._distance,t.y-this._distance)),this._segList.addPt(new It(t.x-this._distance,t.y+this._distance)),this._segList.closeRing()};mr.prototype.addSegments=function(t,e){this._segList.addPts(t,e)};mr.prototype.addFirstSegment=function(){this._segList.addPt(this._offset1.p0)};mr.prototype.addLastSegment=function(){this._segList.addPt(this._offset1.p1)};mr.prototype.initSideSegments=function(t,e,n){this._s1=t,this._s2=e,this._side=n,this._seg1.setCoordinates(t,e),this.computeOffsetSegment(this._seg1,n,this._distance,this._offset1)};mr.prototype.addLimitedMitreJoin=function(t,e,n,o){var l=this._seg0.p1,h=Sn.angle(l,this._seg0.p0),_=Sn.angleBetweenOriented(this._seg0.p0,l,this._seg1.p1),u=_/2,I=Sn.normalize(h+u),w=Sn.normalize(I+Math.PI),D=o*n,k=D*Math.abs(Math.sin(u)),G=n-k,H=l.x+D*Math.cos(w),j=l.y+D*Math.sin(w),K=new It(H,j),lt=new Re(l,K),dt=lt.pointAlongOffset(1,G),xt=lt.pointAlongOffset(1,-G);this._side===Kt.LEFT?(this._segList.addPt(dt),this._segList.addPt(xt)):(this._segList.addPt(xt),this._segList.addPt(dt))};mr.prototype.computeOffsetSegment=function(t,e,n,o){var l=e===Kt.LEFT?1:-1,h=t.p1.x-t.p0.x,_=t.p1.y-t.p0.y,u=Math.sqrt(h*h+_*_),I=l*n*h/u,w=l*n*_/u;o.p0.x=t.p0.x-w,o.p0.y=t.p0.y+I,o.p1.x=t.p1.x-w,o.p1.y=t.p1.y+I};mr.prototype.addFilletArc=function(t,e,n,o,l){var h=this,_=o===ge.CLOCKWISE?-1:1,u=Math.abs(e-n),I=Math.trunc(u/this._filletAngleQuantum+.5);if(I<1)return null;for(var w=0,D=u/I,k=w,G=new It;k<u;){var H=e+_*k;G.x=t.x+l*Math.cos(H),G.y=t.y+l*Math.sin(H),h._segList.addPt(G),k+=D}};mr.prototype.addInsideTurn=function(t,e){if(this._li.computeIntersection(this._offset0.p0,this._offset0.p1,this._offset1.p0,this._offset1.p1),this._li.hasIntersection())this._segList.addPt(this._li.getIntersection(0));else if(this._hasNarrowConcaveAngle=!0,this._offset0.p1.distance(this._offset1.p0)<this._distance*mr.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR)this._segList.addPt(this._offset0.p1);else{if(this._segList.addPt(this._offset0.p1),this._closingSegLengthFactor>0){var n=new It((this._closingSegLengthFactor*this._offset0.p1.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset0.p1.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(n);var o=new It((this._closingSegLengthFactor*this._offset1.p0.x+this._s1.x)/(this._closingSegLengthFactor+1),(this._closingSegLengthFactor*this._offset1.p0.y+this._s1.y)/(this._closingSegLengthFactor+1));this._segList.addPt(o)}else this._segList.addPt(this._s1);this._segList.addPt(this._offset1.p0)}};mr.prototype.createCircle=function(t){var e=new It(t.x+this._distance,t.y);this._segList.addPt(e),this.addFilletArc(t,0,2*Math.PI,-1,this._distance),this._segList.closeRing()};mr.prototype.addBevelJoin=function(t,e){this._segList.addPt(t.p1),this._segList.addPt(e.p0)};mr.prototype.init=function(t){this._distance=t,this._maxCurveSegmentError=t*(1-Math.cos(this._filletAngleQuantum/2)),this._segList=new Ss,this._segList.setPrecisionModel(this._precisionModel),this._segList.setMinimumVertexDistance(t*mr.CURVE_VERTEX_SNAP_DISTANCE_FACTOR)};mr.prototype.addCollinear=function(t){this._li.computeIntersection(this._s0,this._s1,this._s1,this._s2);var e=this._li.getIntersectionNum();e>=2&&(this._bufParams.getJoinStyle()===Rn.JOIN_BEVEL||this._bufParams.getJoinStyle()===Rn.JOIN_MITRE?(t&&this._segList.addPt(this._offset0.p1),this._segList.addPt(this._offset1.p0)):this.addFilletCorner(this._s1,this._offset0.p1,this._offset1.p0,ge.CLOCKWISE,this._distance))};mr.prototype.closeRing=function(){this._segList.closeRing()};mr.prototype.hasNarrowConcaveAngle=function(){return this._hasNarrowConcaveAngle};mr.prototype.interfaces_=function(){return[]};mr.prototype.getClass=function(){return mr};Hf.OFFSET_SEGMENT_SEPARATION_FACTOR.get=function(){return .001};Hf.INSIDE_TURN_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return .001};Hf.CURVE_VERTEX_SNAP_DISTANCE_FACTOR.get=function(){return 1e-6};Hf.MAX_CLOSING_SEG_LEN_FACTOR.get=function(){return 80};Object.defineProperties(mr,Hf);var zo=function(){this._distance=0,this._precisionModel=null,this._bufParams=null;var t=arguments[0],e=arguments[1];this._precisionModel=t,this._bufParams=e};zo.prototype.getOffsetCurve=function(t,e){if(this._distance=e,e===0)return null;var n=e<0,o=Math.abs(e),l=this.getSegGen(o);t.length<=1?this.computePointCurve(t[0],l):this.computeOffsetCurve(t,n,l);var h=l.getCoordinates();return n&&mn.reverse(h),h};zo.prototype.computeSingleSidedBufferCurve=function(t,e,n){var o=this.simplifyTolerance(this._distance);if(e){n.addSegments(t,!0);var l=Br.simplify(t,-o),h=l.length-1;n.initSideSegments(l[h],l[h-1],Kt.LEFT),n.addFirstSegment();for(var _=h-2;_>=0;_--)n.addNextSegment(l[_],!0)}else{n.addSegments(t,!1);var u=Br.simplify(t,o),I=u.length-1;n.initSideSegments(u[0],u[1],Kt.LEFT),n.addFirstSegment();for(var w=2;w<=I;w++)n.addNextSegment(u[w],!0)}n.addLastSegment(),n.closeRing()};zo.prototype.computeRingBufferCurve=function(t,e,n){var o=this.simplifyTolerance(this._distance);e===Kt.RIGHT&&(o=-o);var l=Br.simplify(t,o),h=l.length-1;n.initSideSegments(l[h-1],l[0],e);for(var _=1;_<=h;_++){var u=_!==1;n.addNextSegment(l[_],u)}n.closeRing()};zo.prototype.computeLineBufferCurve=function(t,e){var n=this.simplifyTolerance(this._distance),o=Br.simplify(t,n),l=o.length-1;e.initSideSegments(o[0],o[1],Kt.LEFT);for(var h=2;h<=l;h++)e.addNextSegment(o[h],!0);e.addLastSegment(),e.addLineEndCap(o[l-1],o[l]);var _=Br.simplify(t,-n),u=_.length-1;e.initSideSegments(_[u],_[u-1],Kt.LEFT);for(var I=u-2;I>=0;I--)e.addNextSegment(_[I],!0);e.addLastSegment(),e.addLineEndCap(_[1],_[0]),e.closeRing()};zo.prototype.computePointCurve=function(t,e){switch(this._bufParams.getEndCapStyle()){case Rn.CAP_ROUND:e.createCircle(t);break;case Rn.CAP_SQUARE:e.createSquare(t);break}};zo.prototype.getLineCurve=function(t,e){if(this._distance=e,e<0&&!this._bufParams.isSingleSided()||e===0)return null;var n=Math.abs(e),o=this.getSegGen(n);if(t.length<=1)this.computePointCurve(t[0],o);else if(this._bufParams.isSingleSided()){var l=e<0;this.computeSingleSidedBufferCurve(t,l,o)}else this.computeLineBufferCurve(t,o);var h=o.getCoordinates();return h};zo.prototype.getBufferParameters=function(){return this._bufParams};zo.prototype.simplifyTolerance=function(t){return t*this._bufParams.getSimplifyFactor()};zo.prototype.getRingCurve=function(t,e,n){if(this._distance=n,t.length<=2)return this.getLineCurve(t,n);if(n===0)return zo.copyCoordinates(t);var o=this.getSegGen(n);return this.computeRingBufferCurve(t,e,o),o.getCoordinates()};zo.prototype.computeOffsetCurve=function(t,e,n){var o=this.simplifyTolerance(this._distance);if(e){var l=Br.simplify(t,-o),h=l.length-1;n.initSideSegments(l[h],l[h-1],Kt.LEFT),n.addFirstSegment();for(var _=h-2;_>=0;_--)n.addNextSegment(l[_],!0)}else{var u=Br.simplify(t,o),I=u.length-1;n.initSideSegments(u[0],u[1],Kt.LEFT),n.addFirstSegment();for(var w=2;w<=I;w++)n.addNextSegment(u[w],!0)}n.addLastSegment()};zo.prototype.getSegGen=function(t){return new mr(this._precisionModel,this._bufParams,t)};zo.prototype.interfaces_=function(){return[]};zo.prototype.getClass=function(){return zo};zo.copyCoordinates=function(t){for(var e=new Array(t.length).fill(null),n=0;n<e.length;n++)e[n]=new It(t[n]);return e};var Kc=function(){this._subgraphs=null,this._seg=new Re,this._cga=new ge;var t=arguments[0];this._subgraphs=t},Nv={DepthSegment:{configurable:!0}};Kc.prototype.findStabbedSegments=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=new se,o=this._subgraphs.iterator();o.hasNext();){var l=o.next(),h=l.getEnvelope();e.y<h.getMinY()||e.y>h.getMaxY()||t.findStabbedSegments(e,l.getDirectedEdges(),n)}return n}else if(arguments.length===3){if(qe(arguments[2],ea)&&arguments[0]instanceof It&&arguments[1]instanceof Om)for(var _=arguments[0],u=arguments[1],I=arguments[2],w=u.getEdge().getCoordinates(),D=0;D<w.length-1;D++){t._seg.p0=w[D],t._seg.p1=w[D+1],t._seg.p0.y>t._seg.p1.y&&t._seg.reverse();var k=Math.max(t._seg.p0.x,t._seg.p1.x);if(!(k<_.x)&&!t._seg.isHorizontal()&&!(_.y<t._seg.p0.y||_.y>t._seg.p1.y)&&ge.computeOrientation(t._seg.p0,t._seg.p1,_)!==ge.RIGHT){var G=u.getDepth(Kt.LEFT);t._seg.p0.equals(w[D])||(G=u.getDepth(Kt.RIGHT));var H=new dc(t._seg,G);I.add(H)}}else if(qe(arguments[2],ea)&&arguments[0]instanceof It&&qe(arguments[1],ea))for(var j=arguments[0],K=arguments[1],lt=arguments[2],dt=K.iterator();dt.hasNext();){var xt=dt.next();xt.isForward()&&t.findStabbedSegments(j,xt,lt)}}};Kc.prototype.getDepth=function(t){var e=this.findStabbedSegments(t);if(e.size()===0)return 0;var n=oa.min(e);return n._leftDepth};Kc.prototype.interfaces_=function(){return[]};Kc.prototype.getClass=function(){return Kc};Nv.DepthSegment.get=function(){return dc};Object.defineProperties(Kc,Nv);var dc=function(){this._upwardSeg=null,this._leftDepth=null;var t=arguments[0],e=arguments[1];this._upwardSeg=new Re(t),this._leftDepth=e};dc.prototype.compareTo=function(t){var e=t;if(this._upwardSeg.minX()>=e._upwardSeg.maxX())return 1;if(this._upwardSeg.maxX()<=e._upwardSeg.minX())return-1;var n=this._upwardSeg.orientationIndex(e._upwardSeg);return n!==0||(n=-1*e._upwardSeg.orientationIndex(this._upwardSeg),n!==0)?n:this._upwardSeg.compareTo(e._upwardSeg)};dc.prototype.compareX=function(t,e){var n=t.p0.compareTo(e.p0);return n!==0?n:t.p1.compareTo(e.p1)};dc.prototype.toString=function(){return this._upwardSeg.toString()};dc.prototype.interfaces_=function(){return[Vs]};dc.prototype.getClass=function(){return dc};var zn=function(t,e,n){this.p0=t||null,this.p1=e||null,this.p2=n||null};zn.prototype.area=function(){return zn.area(this.p0,this.p1,this.p2)};zn.prototype.signedArea=function(){return zn.signedArea(this.p0,this.p1,this.p2)};zn.prototype.interpolateZ=function(t){if(t===null)throw new Ir("Supplied point is null.");return zn.interpolateZ(t,this.p0,this.p1,this.p2)};zn.prototype.longestSideLength=function(){return zn.longestSideLength(this.p0,this.p1,this.p2)};zn.prototype.isAcute=function(){return zn.isAcute(this.p0,this.p1,this.p2)};zn.prototype.circumcentre=function(){return zn.circumcentre(this.p0,this.p1,this.p2)};zn.prototype.area3D=function(){return zn.area3D(this.p0,this.p1,this.p2)};zn.prototype.centroid=function(){return zn.centroid(this.p0,this.p1,this.p2)};zn.prototype.inCentre=function(){return zn.inCentre(this.p0,this.p1,this.p2)};zn.prototype.interfaces_=function(){return[]};zn.prototype.getClass=function(){return zn};zn.area=function(t,e,n){return Math.abs(((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2)};zn.signedArea=function(t,e,n){return((n.x-t.x)*(e.y-t.y)-(e.x-t.x)*(n.y-t.y))/2};zn.det=function(t,e,n,o){return t*o-e*n};zn.interpolateZ=function(t,e,n,o){var l=e.x,h=e.y,_=n.x-l,u=o.x-l,I=n.y-h,w=o.y-h,D=_*w-u*I,k=t.x-l,G=t.y-h,H=(w*k-u*G)/D,j=(-I*k+_*G)/D,K=e.z+H*(n.z-e.z)+j*(o.z-e.z);return K};zn.longestSideLength=function(t,e,n){var o=t.distance(e),l=e.distance(n),h=n.distance(t),_=o;return l>_&&(_=l),h>_&&(_=h),_};zn.isAcute=function(t,e,n){return!(!Sn.isAcute(t,e,n)||!Sn.isAcute(e,n,t)||!Sn.isAcute(n,t,e))};zn.circumcentre=function(t,e,n){var o=n.x,l=n.y,h=t.x-o,_=t.y-l,u=e.x-o,I=e.y-l,w=2*zn.det(h,_,u,I),D=zn.det(_,h*h+_*_,I,u*u+I*I),k=zn.det(h,h*h+_*_,u,u*u+I*I),G=o-D/w,H=l+k/w;return new It(G,H)};zn.perpendicularBisector=function(t,e){var n=e.x-t.x,o=e.y-t.y,l=new ta(t.x+n/2,t.y+o/2,1),h=new ta(t.x-o+n/2,t.y+n+o/2,1);return new ta(l,h)};zn.angleBisector=function(t,e,n){var o=e.distance(t),l=e.distance(n),h=o/(o+l),_=n.x-t.x,u=n.y-t.y,I=new It(t.x+h*_,t.y+h*u);return I};zn.area3D=function(t,e,n){var o=e.x-t.x,l=e.y-t.y,h=e.z-t.z,_=n.x-t.x,u=n.y-t.y,I=n.z-t.z,w=l*I-h*u,D=h*_-o*I,k=o*u-l*_,G=w*w+D*D+k*k,H=Math.sqrt(G)/2;return H};zn.centroid=function(t,e,n){var o=(t.x+e.x+n.x)/3,l=(t.y+e.y+n.y)/3;return new It(o,l)};zn.inCentre=function(t,e,n){var o=e.distance(n),l=t.distance(n),h=t.distance(e),_=o+l+h,u=(o*t.x+l*e.x+h*n.x)/_,I=(o*t.y+l*e.y+h*n.y)/_;return new It(u,I)};var Us=function(){this._inputGeom=null,this._distance=null,this._curveBuilder=null,this._curveList=new se;var t=arguments[0],e=arguments[1],n=arguments[2];this._inputGeom=t,this._distance=e,this._curveBuilder=n};Us.prototype.addPoint=function(t){if(this._distance<=0)return null;var e=t.getCoordinates(),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,Mt.EXTERIOR,Mt.INTERIOR)};Us.prototype.addPolygon=function(t){var e=this,n=this._distance,o=Kt.LEFT;this._distance<0&&(n=-this._distance,o=Kt.RIGHT);var l=t.getExteriorRing(),h=mn.removeRepeatedPoints(l.getCoordinates());if(this._distance<0&&this.isErodedCompletely(l,this._distance)||this._distance<=0&&h.length<3)return null;this.addPolygonRing(h,n,o,Mt.EXTERIOR,Mt.INTERIOR);for(var _=0;_<t.getNumInteriorRing();_++){var u=t.getInteriorRingN(_),I=mn.removeRepeatedPoints(u.getCoordinates());e._distance>0&&e.isErodedCompletely(u,-e._distance)||e.addPolygonRing(I,n,Kt.opposite(o),Mt.INTERIOR,Mt.EXTERIOR)}};Us.prototype.isTriangleErodedCompletely=function(t,e){var n=new zn(t[0],t[1],t[2]),o=n.inCentre(),l=ge.distancePointLine(o,n.p0,n.p1);return l<Math.abs(e)};Us.prototype.addLineString=function(t){if(this._distance<=0&&!this._curveBuilder.getBufferParameters().isSingleSided())return null;var e=mn.removeRepeatedPoints(t.getCoordinates()),n=this._curveBuilder.getLineCurve(e,this._distance);this.addCurve(n,Mt.EXTERIOR,Mt.INTERIOR)};Us.prototype.addCurve=function(t,e,n){if(t===null||t.length<2)return null;var o=new Kr(t,new Zn(0,Mt.BOUNDARY,e,n));this._curveList.add(o)};Us.prototype.getCurves=function(){return this.add(this._inputGeom),this._curveList};Us.prototype.addPolygonRing=function(t,e,n,o,l){if(e===0&&t.length<ml.MINIMUM_VALID_SIZE)return null;var h=o,_=l;t.length>=ml.MINIMUM_VALID_SIZE&&ge.isCCW(t)&&(h=l,_=o,n=Kt.opposite(n));var u=this._curveBuilder.getRingCurve(t,n,e);this.addCurve(u,h,_)};Us.prototype.add=function(t){if(t.isEmpty())return null;t instanceof di?this.addPolygon(t):t instanceof Fr?this.addLineString(t):t instanceof Qo?this.addPoint(t):t instanceof up?this.addCollection(t):t instanceof pc?this.addCollection(t):t instanceof fl?this.addCollection(t):t instanceof Eo&&this.addCollection(t)};Us.prototype.isErodedCompletely=function(t,e){var n=t.getCoordinates();if(n.length<4)return e<0;if(n.length===4)return this.isTriangleErodedCompletely(n,e);var o=t.getEnvelopeInternal(),l=Math.min(o.getHeight(),o.getWidth());return e<0&&2*Math.abs(e)>l};Us.prototype.addCollection=function(t){for(var e=this,n=0;n<t.getNumGeometries();n++){var o=t.getGeometryN(n);e.add(o)}};Us.prototype.interfaces_=function(){return[]};Us.prototype.getClass=function(){return Us};var fp=function(){};fp.prototype.locate=function(t){};fp.prototype.interfaces_=function(){return[]};fp.prototype.getClass=function(){return fp};var dl=function(){this._parent=null,this._atStart=null,this._max=null,this._index=null,this._subcollectionIterator=null;var t=arguments[0];this._parent=t,this._atStart=!0,this._index=0,this._max=t.getNumGeometries()};dl.prototype.next=function(){if(this._atStart)return this._atStart=!1,dl.isAtomic(this._parent)&&this._index++,this._parent;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return this._subcollectionIterator.next();this._subcollectionIterator=null}if(this._index>=this._max)throw new Sp;var t=this._parent.getGeometryN(this._index++);return t instanceof Eo?(this._subcollectionIterator=new dl(t),this._subcollectionIterator.next()):t};dl.prototype.remove=function(){throw new Error(this.getClass().getName())};dl.prototype.hasNext=function(){if(this._atStart)return!0;if(this._subcollectionIterator!==null){if(this._subcollectionIterator.hasNext())return!0;this._subcollectionIterator=null}return!(this._index>=this._max)};dl.prototype.interfaces_=function(){return[Ip]};dl.prototype.getClass=function(){return dl};dl.isAtomic=function(t){return!(t instanceof Eo)};var bs=function(){this._geom=null;var t=arguments[0];this._geom=t};bs.prototype.locate=function(t){return bs.locate(t,this._geom)};bs.prototype.interfaces_=function(){return[fp]};bs.prototype.getClass=function(){return bs};bs.isPointInRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?ge.isPointInRing(t,e.getCoordinates()):!1};bs.containsPointInPolygon=function(t,e){if(e.isEmpty())return!1;var n=e.getExteriorRing();if(!bs.isPointInRing(t,n))return!1;for(var o=0;o<e.getNumInteriorRing();o++){var l=e.getInteriorRingN(o);if(bs.isPointInRing(t,l))return!1}return!0};bs.containsPoint=function(t,e){if(e instanceof di)return bs.containsPointInPolygon(t,e);if(e instanceof Eo)for(var n=new dl(e);n.hasNext();){var o=n.next();if(o!==e&&bs.containsPoint(t,o))return!0}return!1};bs.locate=function(t,e){return e.isEmpty()?Mt.EXTERIOR:bs.containsPoint(t,e)?Mt.INTERIOR:Mt.EXTERIOR};var ro=function(){this._edgeMap=new eo,this._edgeList=null,this._ptInAreaLocation=[Mt.NONE,Mt.NONE]};ro.prototype.getNextCW=function(t){this.getEdges();var e=this._edgeList.indexOf(t),n=e-1;return e===0&&(n=this._edgeList.size()-1),this._edgeList.get(n)};ro.prototype.propagateSideLabels=function(t){for(var e=Mt.NONE,n=this.iterator();n.hasNext();){var o=n.next(),l=o.getLabel();l.isArea(t)&&l.getLocation(t,Kt.LEFT)!==Mt.NONE&&(e=l.getLocation(t,Kt.LEFT))}if(e===Mt.NONE)return null;for(var h=e,_=this.iterator();_.hasNext();){var u=_.next(),I=u.getLabel();if(I.getLocation(t,Kt.ON)===Mt.NONE&&I.setLocation(t,Kt.ON,h),I.isArea(t)){var w=I.getLocation(t,Kt.LEFT),D=I.getLocation(t,Kt.RIGHT);if(D!==Mt.NONE){if(D!==h)throw new Yl("side location conflict",u.getCoordinate());w===Mt.NONE&&cn.shouldNeverReachHere("found single null side (at "+u.getCoordinate()+")"),h=w}else cn.isTrue(I.getLocation(t,Kt.LEFT)===Mt.NONE,"found single null side"),I.setLocation(t,Kt.RIGHT,h),I.setLocation(t,Kt.LEFT,h)}}};ro.prototype.getCoordinate=function(){var t=this.iterator();if(!t.hasNext())return null;var e=t.next();return e.getCoordinate()};ro.prototype.print=function(t){Yi.out.println("EdgeEndStar:   "+this.getCoordinate());for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};ro.prototype.isAreaLabelsConsistent=function(t){return this.computeEdgeEndLabels(t.getBoundaryNodeRule()),this.checkAreaLabelsConsistent(0)};ro.prototype.checkAreaLabelsConsistent=function(t){var e=this.getEdges();if(e.size()<=0)return!0;var n=e.size()-1,o=e.get(n).getLabel(),l=o.getLocation(t,Kt.LEFT);cn.isTrue(l!==Mt.NONE,"Found unlabelled area edge");for(var h=l,_=this.iterator();_.hasNext();){var u=_.next(),I=u.getLabel();cn.isTrue(I.isArea(t),"Found non-area edge");var w=I.getLocation(t,Kt.LEFT),D=I.getLocation(t,Kt.RIGHT);if(w===D||D!==h)return!1;h=w}return!0};ro.prototype.findIndex=function(t){var e=this;this.iterator();for(var n=0;n<this._edgeList.size();n++){var o=e._edgeList.get(n);if(o===t)return n}return-1};ro.prototype.iterator=function(){return this.getEdges().iterator()};ro.prototype.getEdges=function(){return this._edgeList===null&&(this._edgeList=new se(this._edgeMap.values())),this._edgeList};ro.prototype.getLocation=function(t,e,n){return this._ptInAreaLocation[t]===Mt.NONE&&(this._ptInAreaLocation[t]=bs.locate(e,n[t].getGeometry())),this._ptInAreaLocation[t]};ro.prototype.toString=function(){var t=new Xa;t.append("EdgeEndStar:   "+this.getCoordinate()),t.append(`
`);for(var e=this.iterator();e.hasNext();){var n=e.next();t.append(n),t.append(`
`)}return t.toString()};ro.prototype.computeEdgeEndLabels=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();n.computeLabel(t)}};ro.prototype.computeLabelling=function(t){var e=this;this.computeEdgeEndLabels(t[0].getBoundaryNodeRule()),this.propagateSideLabels(0),this.propagateSideLabels(1);for(var n=[!1,!1],o=this.iterator();o.hasNext();)for(var l=o.next(),h=l.getLabel(),_=0;_<2;_++)h.isLine(_)&&h.getLocation(_)===Mt.BOUNDARY&&(n[_]=!0);for(var u=this.iterator();u.hasNext();)for(var I=u.next(),w=I.getLabel(),D=0;D<2;D++)if(w.isAnyNull(D)){var k=Mt.NONE;if(n[D])k=Mt.EXTERIOR;else{var G=I.getCoordinate();k=e.getLocation(D,G,t)}w.setAllLocationsIfNull(D,k)}};ro.prototype.getDegree=function(){return this._edgeMap.size()};ro.prototype.insertEdgeEnd=function(t,e){this._edgeMap.put(t,e),this._edgeList=null};ro.prototype.interfaces_=function(){return[]};ro.prototype.getClass=function(){return ro};var zw=function(t){function e(){t.call(this),this._resultAreaEdgeList=null,this._label=null,this._SCANNING_FOR_INCOMING=1,this._LINKING_TO_OUTGOING=2}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.linkResultDirectedEdges=function(){var n=this;this.getResultAreaEdges();for(var o=null,l=null,h=this._SCANNING_FOR_INCOMING,_=0;_<this._resultAreaEdgeList.size();_++){var u=n._resultAreaEdgeList.get(_),I=u.getSym();if(u.getLabel().isArea())switch(o===null&&u.isInResult()&&(o=u),h){case n._SCANNING_FOR_INCOMING:if(!I.isInResult())continue;l=I,h=n._LINKING_TO_OUTGOING;break;case n._LINKING_TO_OUTGOING:if(!u.isInResult())continue;l.setNext(u),h=n._SCANNING_FOR_INCOMING;break}}if(h===this._LINKING_TO_OUTGOING){if(o===null)throw new Yl("no outgoing dirEdge found",this.getCoordinate());cn.isTrue(o.isInResult(),"unable to link last incoming dirEdge"),l.setNext(o)}},e.prototype.insert=function(n){var o=n;this.insertEdgeEnd(o,o)},e.prototype.getRightmostEdge=function(){var n=this.getEdges(),o=n.size();if(o<1)return null;var l=n.get(0);if(o===1)return l;var h=n.get(o-1),_=l.getQuadrant(),u=h.getQuadrant();return Qn.isNorthern(_)&&Qn.isNorthern(u)?l:!Qn.isNorthern(_)&&!Qn.isNorthern(u)?h:l.getDy()!==0?l:h.getDy()!==0?h:(cn.shouldNeverReachHere("found two horizontal edges incident on node"),null)},e.prototype.print=function(n){Yi.out.println("DirectedEdgeStar: "+this.getCoordinate());for(var o=this.iterator();o.hasNext();){var l=o.next();n.print("out "),l.print(n),n.println(),n.print("in "),l.getSym().print(n),n.println()}},e.prototype.getResultAreaEdges=function(){var n=this;if(this._resultAreaEdgeList!==null)return this._resultAreaEdgeList;this._resultAreaEdgeList=new se;for(var o=this.iterator();o.hasNext();){var l=o.next();(l.isInResult()||l.getSym().isInResult())&&n._resultAreaEdgeList.add(l)}return this._resultAreaEdgeList},e.prototype.updateLabelling=function(n){for(var o=this.iterator();o.hasNext();){var l=o.next(),h=l.getLabel();h.setAllLocationsIfNull(0,n.getLocation(0)),h.setAllLocationsIfNull(1,n.getLocation(1))}},e.prototype.linkAllDirectedEdges=function(){var n=this;this.getEdges();for(var o=null,l=null,h=this._edgeList.size()-1;h>=0;h--){var _=n._edgeList.get(h),u=_.getSym();l===null&&(l=u),o!==null&&u.setNext(o),o=_}l.setNext(o)},e.prototype.computeDepths=function(){var n=this;if(arguments.length===1){var o=arguments[0],l=this.findIndex(o),h=o.getDepth(Kt.LEFT),_=o.getDepth(Kt.RIGHT),u=this.computeDepths(l+1,this._edgeList.size(),h),I=this.computeDepths(0,l,u);if(I!==_)throw new Yl("depth mismatch at "+o.getCoordinate())}else if(arguments.length===3){for(var w=arguments[0],D=arguments[1],k=arguments[2],G=k,H=w;H<D;H++){var j=n._edgeList.get(H);j.setEdgeDepths(Kt.RIGHT,G),G=j.getDepth(Kt.LEFT)}return G}},e.prototype.mergeSymLabels=function(){for(var n=this.iterator();n.hasNext();){var o=n.next(),l=o.getLabel();l.merge(o.getSym().getLabel())}},e.prototype.linkMinimalDirectedEdges=function(n){for(var o=this,l=null,h=null,_=this._SCANNING_FOR_INCOMING,u=this._resultAreaEdgeList.size()-1;u>=0;u--){var I=o._resultAreaEdgeList.get(u),w=I.getSym();switch(l===null&&I.getEdgeRing()===n&&(l=I),_){case o._SCANNING_FOR_INCOMING:if(w.getEdgeRing()!==n)continue;h=w,_=o._LINKING_TO_OUTGOING;break;case o._LINKING_TO_OUTGOING:if(I.getEdgeRing()!==n)continue;h.setNextMin(I),_=o._SCANNING_FOR_INCOMING;break}}_===this._LINKING_TO_OUTGOING&&(cn.isTrue(l!==null,"found null for first outgoing dirEdge"),cn.isTrue(l.getEdgeRing()===n,"unable to link last incoming dirEdge"),h.setNextMin(l))},e.prototype.getOutgoingDegree=function(){if(arguments.length===0){for(var n=0,o=this.iterator();o.hasNext();){var l=o.next();l.isInResult()&&n++}return n}else if(arguments.length===1){for(var h=arguments[0],_=0,u=this.iterator();u.hasNext();){var I=u.next();I.getEdgeRing()===h&&_++}return _}},e.prototype.getLabel=function(){return this._label},e.prototype.findCoveredLineEdges=function(){for(var n=Mt.NONE,o=this.iterator();o.hasNext();){var l=o.next(),h=l.getSym();if(!l.isLineEdge()){if(l.isInResult()){n=Mt.INTERIOR;break}if(h.isInResult()){n=Mt.EXTERIOR;break}}}if(n===Mt.NONE)return null;for(var _=n,u=this.iterator();u.hasNext();){var I=u.next(),w=I.getSym();I.isLineEdge()?I.getEdge().setCovered(_===Mt.INTERIOR):(I.isInResult()&&(_=Mt.EXTERIOR),w.isInResult()&&(_=Mt.INTERIOR))}},e.prototype.computeLabelling=function(n){var o=this;t.prototype.computeLabelling.call(this,n),this._label=new Zn(Mt.NONE);for(var l=this.iterator();l.hasNext();)for(var h=l.next(),_=h.getEdge(),u=_.getLabel(),I=0;I<2;I++){var w=u.getLocation(I);(w===Mt.INTERIOR||w===Mt.BOUNDARY)&&o._label.setLocation(I,Mt.INTERIOR)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(ro),Rv=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.createNode=function(n){return new xg(n,new zw)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(cp),Pu=function t(){this._pts=null,this._orientation=null;var e=arguments[0];this._pts=e,this._orientation=t.orientation(e)};Pu.prototype.compareTo=function(t){var e=t,n=Pu.compareOriented(this._pts,this._orientation,e._pts,e._orientation);return n};Pu.prototype.interfaces_=function(){return[Vs]};Pu.prototype.getClass=function(){return Pu};Pu.orientation=function(t){return mn.increasingDirection(t)===1};Pu.compareOriented=function(t,e,n,o){for(var l=e?1:-1,h=o?1:-1,_=e?t.length:-1,u=o?n.length:-1,I=e?0:t.length-1,w=o?0:n.length-1;;){var D=t[I].compareTo(n[w]);if(D!==0)return D;I+=l,w+=h;var k=I===_,G=w===u;if(k&&!G)return-1;if(!k&&G)return 1;if(k&&G)return 0}};var sa=function(){this._edges=new se,this._ocaMap=new eo};sa.prototype.print=function(t){var e=this;t.print("MULTILINESTRING ( ");for(var n=0;n<this._edges.size();n++){var o=e._edges.get(n);n>0&&t.print(","),t.print("(");for(var l=o.getCoordinates(),h=0;h<l.length;h++)h>0&&t.print(","),t.print(l[h].x+" "+l[h].y);t.println(")")}t.print(")  ")};sa.prototype.addAll=function(t){for(var e=this,n=t.iterator();n.hasNext();)e.add(n.next())};sa.prototype.findEdgeIndex=function(t){for(var e=this,n=0;n<this._edges.size();n++)if(e._edges.get(n).equals(t))return n;return-1};sa.prototype.iterator=function(){return this._edges.iterator()};sa.prototype.getEdges=function(){return this._edges};sa.prototype.get=function(t){return this._edges.get(t)};sa.prototype.findEqualEdge=function(t){var e=new Pu(t.getCoordinates()),n=this._ocaMap.get(e);return n};sa.prototype.add=function(t){this._edges.add(t);var e=new Pu(t.getCoordinates());this._ocaMap.put(e,t)};sa.prototype.interfaces_=function(){return[]};sa.prototype.getClass=function(){return sa};var gc=function(){};gc.prototype.processIntersections=function(t,e,n,o){};gc.prototype.isDone=function(){};gc.prototype.interfaces_=function(){return[]};gc.prototype.getClass=function(){return gc};var Ts=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._hasInterior=!1,this._properIntersectionPoint=null,this._li=null,this._isSelfIntersection=null,this.numIntersections=0,this.numInteriorIntersections=0,this.numProperIntersections=0,this.numTests=0;var t=arguments[0];this._li=t};Ts.prototype.isTrivialIntersection=function(t,e,n,o){if(t===n&&this._li.getIntersectionNum()===1){if(Ts.isAdjacentSegments(e,o))return!0;if(t.isClosed()){var l=t.size()-1;if(e===0&&o===l||o===0&&e===l)return!0}}return!1};Ts.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};Ts.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};Ts.prototype.getLineIntersector=function(){return this._li};Ts.prototype.hasProperIntersection=function(){return this._hasProper};Ts.prototype.processIntersections=function(t,e,n,o){if(t===n&&e===o)return null;this.numTests++;var l=t.getCoordinates()[e],h=t.getCoordinates()[e+1],_=n.getCoordinates()[o],u=n.getCoordinates()[o+1];this._li.computeIntersection(l,h,_,u),this._li.hasIntersection()&&(this.numIntersections++,this._li.isInteriorIntersection()&&(this.numInteriorIntersections++,this._hasInterior=!0),this.isTrivialIntersection(t,e,n,o)||(this._hasIntersection=!0,t.addIntersections(this._li,e,0),n.addIntersections(this._li,o,1),this._li.isProper()&&(this.numProperIntersections++,this._hasProper=!0,this._hasProperInterior=!0)))};Ts.prototype.hasIntersection=function(){return this._hasIntersection};Ts.prototype.isDone=function(){return!1};Ts.prototype.hasInteriorIntersection=function(){return this._hasInterior};Ts.prototype.interfaces_=function(){return[gc]};Ts.prototype.getClass=function(){return Ts};Ts.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var Va=function(){this.coord=null,this.segmentIndex=null,this.dist=null;var t=arguments[0],e=arguments[1],n=arguments[2];this.coord=new It(t),this.segmentIndex=e,this.dist=n};Va.prototype.getSegmentIndex=function(){return this.segmentIndex};Va.prototype.getCoordinate=function(){return this.coord};Va.prototype.print=function(t){t.print(this.coord),t.print(" seg # = "+this.segmentIndex),t.println(" dist = "+this.dist)};Va.prototype.compareTo=function(t){var e=t;return this.compare(e.segmentIndex,e.dist)};Va.prototype.isEndPoint=function(t){return this.segmentIndex===0&&this.dist===0||this.segmentIndex===t};Va.prototype.toString=function(){return this.coord+" seg # = "+this.segmentIndex+" dist = "+this.dist};Va.prototype.getDistance=function(){return this.dist};Va.prototype.compare=function(t,e){return this.segmentIndex<t?-1:this.segmentIndex>t?1:this.dist<e?-1:this.dist>e?1:0};Va.prototype.interfaces_=function(){return[Vs]};Va.prototype.getClass=function(){return Va};var vl=function(){this._nodeMap=new eo,this.edge=null;var t=arguments[0];this.edge=t};vl.prototype.print=function(t){t.println("Intersections:");for(var e=this.iterator();e.hasNext();){var n=e.next();n.print(t)}};vl.prototype.iterator=function(){return this._nodeMap.values().iterator()};vl.prototype.addSplitEdges=function(t){var e=this;this.addEndpoints();for(var n=this.iterator(),o=n.next();n.hasNext();){var l=n.next(),h=e.createSplitEdge(o,l);t.add(h),o=l}};vl.prototype.addEndpoints=function(){var t=this.edge.pts.length-1;this.add(this.edge.pts[0],0,0),this.add(this.edge.pts[t],t,0)};vl.prototype.createSplitEdge=function(t,e){var n=this,o=e.segmentIndex-t.segmentIndex+2,l=this.edge.pts[e.segmentIndex],h=e.dist>0||!e.coord.equals2D(l);h||o--;var _=new Array(o).fill(null),u=0;_[u++]=new It(t.coord);for(var I=t.segmentIndex+1;I<=e.segmentIndex;I++)_[u++]=n.edge.pts[I];return h&&(_[u]=e.coord),new $d(_,new Zn(this.edge._label))};vl.prototype.add=function(t,e,n){var o=new Va(t,e,n),l=this._nodeMap.get(o);return l!==null?l:(this._nodeMap.put(o,o),o)};vl.prototype.isIntersection=function(t){for(var e=this.iterator();e.hasNext();){var n=e.next();if(n.coord.equals(t))return!0}return!1};vl.prototype.interfaces_=function(){return[]};vl.prototype.getClass=function(){return vl};var mc=function(){};mc.prototype.getChainStartIndices=function(t){var e=this,n=0,o=new se;o.add(new Ra(n));do{var l=e.findChainEnd(t,n);o.add(new Ra(l)),n=l}while(n<t.length-1);var h=mc.toIntArray(o);return h};mc.prototype.findChainEnd=function(t,e){for(var n=Qn.quadrant(t[e],t[e+1]),o=e+1;o<t.length;){var l=Qn.quadrant(t[o-1],t[o]);if(l!==n)break;o++}return o-1};mc.prototype.interfaces_=function(){return[]};mc.prototype.getClass=function(){return mc};mc.toIntArray=function(t){for(var e=new Array(t.size()).fill(null),n=0;n<e.length;n++)e[n]=t.get(n).intValue();return e};var Hl=function(){this.e=null,this.pts=null,this.startIndex=null,this.env1=new De,this.env2=new De;var t=arguments[0];this.e=t,this.pts=t.getCoordinates();var e=new mc;this.startIndex=e.getChainStartIndices(this.pts)};Hl.prototype.getCoordinates=function(){return this.pts};Hl.prototype.getMaxX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e>n?e:n};Hl.prototype.getMinX=function(t){var e=this.pts[this.startIndex[t]].x,n=this.pts[this.startIndex[t+1]].x;return e<n?e:n};Hl.prototype.computeIntersectsForChain=function(){if(arguments.length===4){var t=arguments[0],e=arguments[1],n=arguments[2],o=arguments[3];this.computeIntersectsForChain(this.startIndex[t],this.startIndex[t+1],e,e.startIndex[n],e.startIndex[n+1],o)}else if(arguments.length===6){var l=arguments[0],h=arguments[1],_=arguments[2],u=arguments[3],I=arguments[4],w=arguments[5],D=this.pts[l],k=this.pts[h],G=_.pts[u],H=_.pts[I];if(h-l===1&&I-u===1)return w.addIntersections(this.e,l,_.e,u),null;if(this.env1.init(D,k),this.env2.init(G,H),!this.env1.intersects(this.env2))return null;var j=Math.trunc((l+h)/2),K=Math.trunc((u+I)/2);l<j&&(u<K&&this.computeIntersectsForChain(l,j,_,u,K,w),K<I&&this.computeIntersectsForChain(l,j,_,K,I,w)),j<h&&(u<K&&this.computeIntersectsForChain(j,h,_,u,K,w),K<I&&this.computeIntersectsForChain(j,h,_,K,I,w))}};Hl.prototype.getStartIndexes=function(){return this.startIndex};Hl.prototype.computeIntersects=function(t,e){for(var n=this,o=0;o<this.startIndex.length-1;o++)for(var l=0;l<t.startIndex.length-1;l++)n.computeIntersectsForChain(o,t,l,e)};Hl.prototype.interfaces_=function(){return[]};Hl.prototype.getClass=function(){return Hl};var Xi=function t(){var e=this;this._depth=Array(2).fill().map(function(){return Array(3)});for(var n=0;n<2;n++)for(var o=0;o<3;o++)e._depth[n][o]=t.NULL_VALUE},Ov={NULL_VALUE:{configurable:!0}};Xi.prototype.getDepth=function(t,e){return this._depth[t][e]};Xi.prototype.setDepth=function(t,e,n){this._depth[t][e]=n};Xi.prototype.isNull=function(){var t=this;if(arguments.length===0){for(var e=0;e<2;e++)for(var n=0;n<3;n++)if(t._depth[e][n]!==Xi.NULL_VALUE)return!1;return!0}else if(arguments.length===1){var o=arguments[0];return this._depth[o][1]===Xi.NULL_VALUE}else if(arguments.length===2){var l=arguments[0],h=arguments[1];return this._depth[l][h]===Xi.NULL_VALUE}};Xi.prototype.normalize=function(){for(var t=this,e=0;e<2;e++)if(!t.isNull(e)){var n=t._depth[e][1];t._depth[e][2]<n&&(n=t._depth[e][2]),n<0&&(n=0);for(var o=1;o<3;o++){var l=0;t._depth[e][o]>n&&(l=1),t._depth[e][o]=l}}};Xi.prototype.getDelta=function(t){return this._depth[t][Kt.RIGHT]-this._depth[t][Kt.LEFT]};Xi.prototype.getLocation=function(t,e){return this._depth[t][e]<=0?Mt.EXTERIOR:Mt.INTERIOR};Xi.prototype.toString=function(){return"A: "+this._depth[0][1]+","+this._depth[0][2]+" B: "+this._depth[1][1]+","+this._depth[1][2]};Xi.prototype.add=function(){var t=this;if(arguments.length===1)for(var e=arguments[0],n=0;n<2;n++)for(var o=1;o<3;o++){var l=e.getLocation(n,o);(l===Mt.EXTERIOR||l===Mt.INTERIOR)&&(t.isNull(n,o)?t._depth[n][o]=Xi.depthAtLocation(l):t._depth[n][o]+=Xi.depthAtLocation(l))}else if(arguments.length===3){var h=arguments[0],_=arguments[1],u=arguments[2];u===Mt.INTERIOR&&this._depth[h][_]++}};Xi.prototype.interfaces_=function(){return[]};Xi.prototype.getClass=function(){return Xi};Xi.depthAtLocation=function(t){return t===Mt.EXTERIOR?0:t===Mt.INTERIOR?1:Xi.NULL_VALUE};Ov.NULL_VALUE.get=function(){return-1};Object.defineProperties(Xi,Ov);var $d=function(t){function e(){if(t.call(this),this.pts=null,this._env=null,this.eiList=new vl(this),this._name=null,this._mce=null,this._isIsolated=!0,this._depth=new Xi,this._depthDelta=0,arguments.length===1){var n=arguments[0];e.call(this,n,null)}else if(arguments.length===2){var o=arguments[0],l=arguments[1];this.pts=o,this._label=l}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.getDepth=function(){return this._depth},e.prototype.getCollapsedEdge=function(){var n=new Array(2).fill(null);n[0]=this.pts[0],n[1]=this.pts[1];var o=new e(n,Zn.toLineLabel(this._label));return o},e.prototype.isIsolated=function(){return this._isIsolated},e.prototype.getCoordinates=function(){return this.pts},e.prototype.setIsolated=function(n){this._isIsolated=n},e.prototype.setName=function(n){this._name=n},e.prototype.equals=function(n){var o=this;if(!(n instanceof e))return!1;var l=n;if(this.pts.length!==l.pts.length)return!1;for(var h=!0,_=!0,u=this.pts.length,I=0;I<this.pts.length;I++)if(o.pts[I].equals2D(l.pts[I])||(h=!1),o.pts[I].equals2D(l.pts[--u])||(_=!1),!h&&!_)return!1;return!0},e.prototype.getCoordinate=function(){if(arguments.length===0)return this.pts.length>0?this.pts[0]:null;if(arguments.length===1){var n=arguments[0];return this.pts[n]}},e.prototype.print=function(n){var o=this;n.print("edge "+this._name+": "),n.print("LINESTRING (");for(var l=0;l<this.pts.length;l++)l>0&&n.print(","),n.print(o.pts[l].x+" "+o.pts[l].y);n.print(")  "+this._label+" "+this._depthDelta)},e.prototype.computeIM=function(n){e.updateIM(this._label,n)},e.prototype.isCollapsed=function(){return!this._label.isArea()||this.pts.length!==3?!1:!!this.pts[0].equals(this.pts[2])},e.prototype.isClosed=function(){return this.pts[0].equals(this.pts[this.pts.length-1])},e.prototype.getMaximumSegmentIndex=function(){return this.pts.length-1},e.prototype.getDepthDelta=function(){return this._depthDelta},e.prototype.getNumPoints=function(){return this.pts.length},e.prototype.printReverse=function(n){var o=this;n.print("edge "+this._name+": ");for(var l=this.pts.length-1;l>=0;l--)n.print(o.pts[l]+" ");n.println("")},e.prototype.getMonotoneChainEdge=function(){return this._mce===null&&(this._mce=new Hl(this)),this._mce},e.prototype.getEnvelope=function(){var n=this;if(this._env===null){this._env=new De;for(var o=0;o<this.pts.length;o++)n._env.expandToInclude(n.pts[o])}return this._env},e.prototype.addIntersection=function(n,o,l,h){var _=new It(n.getIntersection(h)),u=o,I=n.getEdgeDistance(l,h),w=u+1;if(w<this.pts.length){var D=this.pts[w];_.equals2D(D)&&(u=w,I=0)}this.eiList.add(_,u,I)},e.prototype.toString=function(){var n=this,o=new Xa;o.append("edge "+this._name+": "),o.append("LINESTRING (");for(var l=0;l<this.pts.length;l++)l>0&&o.append(","),o.append(n.pts[l].x+" "+n.pts[l].y);return o.append(")  "+this._label+" "+this._depthDelta),o.toString()},e.prototype.isPointwiseEqual=function(n){var o=this;if(this.pts.length!==n.pts.length)return!1;for(var l=0;l<this.pts.length;l++)if(!o.pts[l].equals2D(n.pts[l]))return!1;return!0},e.prototype.setDepthDelta=function(n){this._depthDelta=n},e.prototype.getEdgeIntersectionList=function(){return this.eiList},e.prototype.addIntersections=function(n,o,l){for(var h=this,_=0;_<n.getIntersectionNum();_++)h.addIntersection(n,o,l,_)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.updateIM=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];o.setAtLeastIfValid(n.getLocation(0,Kt.ON),n.getLocation(1,Kt.ON),1),n.isArea()&&(o.setAtLeastIfValid(n.getLocation(0,Kt.LEFT),n.getLocation(1,Kt.LEFT),2),o.setAtLeastIfValid(n.getLocation(0,Kt.RIGHT),n.getLocation(1,Kt.RIGHT),2))}else return t.prototype.updateIM.apply(this,arguments)},e}(Is),wo=function(t){this._workingPrecisionModel=null,this._workingNoder=null,this._geomFact=null,this._graph=null,this._edgeList=new sa,this._bufParams=t||null};wo.prototype.setWorkingPrecisionModel=function(t){this._workingPrecisionModel=t};wo.prototype.insertUniqueEdge=function(t){var e=this._edgeList.findEqualEdge(t);if(e!==null){var n=e.getLabel(),o=t.getLabel();e.isPointwiseEqual(t)||(o=new Zn(t.getLabel()),o.flip()),n.merge(o);var l=wo.depthDelta(o),h=e.getDepthDelta(),_=h+l;e.setDepthDelta(_)}else this._edgeList.add(t),t.setDepthDelta(wo.depthDelta(t.getLabel()))};wo.prototype.buildSubgraphs=function(t,e){for(var n=new se,o=t.iterator();o.hasNext();){var l=o.next(),h=l.getRightmostCoordinate(),_=new Kc(n),u=_.getDepth(h);l.computeDepth(u),l.findResultEdges(),n.add(l),e.add(l.getDirectedEdges(),l.getNodes())}};wo.prototype.createSubgraphs=function(t){for(var e=new se,n=t.getNodes().iterator();n.hasNext();){var o=n.next();if(!o.isVisited()){var l=new Io;l.create(o),e.add(l)}}return oa.sort(e,oa.reverseOrder()),e};wo.prototype.createEmptyResultGeometry=function(){var t=this._geomFact.createPolygon();return t};wo.prototype.getNoder=function(t){if(this._workingNoder!==null)return this._workingNoder;var e=new u_,n=new bc;return n.setPrecisionModel(t),e.setSegmentIntersector(new Ts(n)),e};wo.prototype.buffer=function(t,e){var n=this._workingPrecisionModel;n===null&&(n=t.getPrecisionModel()),this._geomFact=t.getFactory();var o=new zo(n,this._bufParams),l=new Us(t,e,o),h=l.getCurves();if(h.size()<=0)return this.createEmptyResultGeometry();this.computeNodedEdges(h,n),this._graph=new kr(new Rv),this._graph.addEdges(this._edgeList.getEdges());var _=this.createSubgraphs(this._graph),u=new ts(this._geomFact);this.buildSubgraphs(_,u);var I=u.getPolygons();if(I.size()<=0)return this.createEmptyResultGeometry();var w=this._geomFact.buildGeometry(I);return w};wo.prototype.computeNodedEdges=function(t,e){var n=this,o=this.getNoder(e);o.computeNodes(t);for(var l=o.getNodedSubstrings(),h=l.iterator();h.hasNext();){var _=h.next(),u=_.getCoordinates();if(!(u.length===2&&u[0].equals2D(u[1]))){var I=_.getData(),w=new $d(_.getCoordinates(),new Zn(I));n.insertUniqueEdge(w)}}};wo.prototype.setNoder=function(t){this._workingNoder=t};wo.prototype.interfaces_=function(){return[]};wo.prototype.getClass=function(){return wo};wo.depthDelta=function(t){var e=t.getLocation(0,Kt.LEFT),n=t.getLocation(0,Kt.RIGHT);return e===Mt.INTERIOR&&n===Mt.EXTERIOR?1:e===Mt.EXTERIOR&&n===Mt.INTERIOR?-1:0};wo.convertSegStrings=function(t){for(var e=new gn,n=new se;t.hasNext();){var o=t.next(),l=e.createLineString(o.getCoordinates());n.add(l)}return e.buildGeometry(n)};var Mu=function(){if(this._noder=null,this._scaleFactor=null,this._offsetX=null,this._offsetY=null,this._isScaled=!1,arguments.length===2){var t=arguments[0],e=arguments[1];this._noder=t,this._scaleFactor=e,this._offsetX=0,this._offsetY=0,this._isScaled=!this.isIntegerPrecision()}else if(arguments.length===4){var n=arguments[0],o=arguments[1],l=arguments[2],h=arguments[3];this._noder=n,this._scaleFactor=o,this._offsetX=l,this._offsetY=h,this._isScaled=!this.isIntegerPrecision()}};Mu.prototype.rescale=function(){var t=this;if(qe(arguments[0],ci))for(var e=arguments[0],n=e.iterator();n.hasNext();){var o=n.next();t.rescale(o.getCoordinates())}else if(arguments[0]instanceof Array){for(var l=arguments[0],h=0;h<l.length;h++)l[h].x=l[h].x/t._scaleFactor+t._offsetX,l[h].y=l[h].y/t._scaleFactor+t._offsetY;l.length===2&&l[0].equals2D(l[1])&&Yi.out.println(l)}};Mu.prototype.scale=function(){var t=this;if(qe(arguments[0],ci)){for(var e=arguments[0],n=new se,o=e.iterator();o.hasNext();){var l=o.next();n.add(new Kr(t.scale(l.getCoordinates()),l.getData()))}return n}else if(arguments[0]instanceof Array){for(var h=arguments[0],_=new Array(h.length).fill(null),u=0;u<h.length;u++)_[u]=new It(Math.round((h[u].x-t._offsetX)*t._scaleFactor),Math.round((h[u].y-t._offsetY)*t._scaleFactor),h[u].z);var I=mn.removeRepeatedPoints(_);return I}};Mu.prototype.isIntegerPrecision=function(){return this._scaleFactor===1};Mu.prototype.getNodedSubstrings=function(){var t=this._noder.getNodedSubstrings();return this._isScaled&&this.rescale(t),t};Mu.prototype.computeNodes=function(t){var e=t;this._isScaled&&(e=this.scale(t)),this._noder.computeNodes(e)};Mu.prototype.interfaces_=function(){return[fc]};Mu.prototype.getClass=function(){return Mu};var Ga=function(){this._li=new bc,this._segStrings=null;var t=arguments[0];this._segStrings=t},zv={fact:{configurable:!0}};Ga.prototype.checkEndPtVertexIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next(),o=n.getCoordinates();t.checkEndPtVertexIntersections(o[0],t._segStrings),t.checkEndPtVertexIntersections(o[o.length-1],t._segStrings)}else if(arguments.length===2){for(var l=arguments[0],h=arguments[1],_=h.iterator();_.hasNext();)for(var u=_.next(),I=u.getCoordinates(),w=1;w<I.length-1;w++)if(I[w].equals(l))throw new Zl("found endpt/interior pt intersection at index "+w+" :pt "+l)}};Ga.prototype.checkInteriorIntersections=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();)for(var n=e.next(),o=this._segStrings.iterator();o.hasNext();){var l=o.next();t.checkInteriorIntersections(n,l)}else if(arguments.length===2)for(var h=arguments[0],_=arguments[1],u=h.getCoordinates(),I=_.getCoordinates(),w=0;w<u.length-1;w++)for(var D=0;D<I.length-1;D++)t.checkInteriorIntersections(h,w,_,D);else if(arguments.length===4){var k=arguments[0],G=arguments[1],H=arguments[2],j=arguments[3];if(k===H&&G===j)return null;var K=k.getCoordinates()[G],lt=k.getCoordinates()[G+1],dt=H.getCoordinates()[j],xt=H.getCoordinates()[j+1];if(this._li.computeIntersection(K,lt,dt,xt),this._li.hasIntersection()&&(this._li.isProper()||this.hasInteriorIntersection(this._li,K,lt)||this.hasInteriorIntersection(this._li,dt,xt)))throw new Zl("found non-noded intersection at "+K+"-"+lt+" and "+dt+"-"+xt)}};Ga.prototype.checkValid=function(){this.checkEndPtVertexIntersections(),this.checkInteriorIntersections(),this.checkCollapses()};Ga.prototype.checkCollapses=function(){var t=this;if(arguments.length===0)for(var e=this._segStrings.iterator();e.hasNext();){var n=e.next();t.checkCollapses(n)}else if(arguments.length===1)for(var o=arguments[0],l=o.getCoordinates(),h=0;h<l.length-2;h++)t.checkCollapse(l[h],l[h+1],l[h+2])};Ga.prototype.hasInteriorIntersection=function(t,e,n){for(var o=0;o<t.getIntersectionNum();o++){var l=t.getIntersection(o);if(!(l.equals(e)||l.equals(n)))return!0}return!1};Ga.prototype.checkCollapse=function(t,e,n){if(t.equals(n))throw new Zl("found non-noded collapse at "+Ga.fact.createLineString([t,e,n]))};Ga.prototype.interfaces_=function(){return[]};Ga.prototype.getClass=function(){return Ga};zv.fact.get=function(){return new gn};Object.defineProperties(Ga,zv);var Fo=function(){this._li=null,this._pt=null,this._originalPt=null,this._ptScaled=null,this._p0Scaled=null,this._p1Scaled=null,this._scaleFactor=null,this._minx=null,this._maxx=null,this._miny=null,this._maxy=null,this._corner=new Array(4).fill(null),this._safeEnv=null;var t=arguments[0],e=arguments[1],n=arguments[2];if(this._originalPt=t,this._pt=t,this._scaleFactor=e,this._li=n,e<=0)throw new Ir("Scale factor must be non-zero");e!==1&&(this._pt=new It(this.scale(t.x),this.scale(t.y)),this._p0Scaled=new It,this._p1Scaled=new It),this.initCorners(this._pt)},Fv={SAFE_ENV_EXPANSION_FACTOR:{configurable:!0}};Fo.prototype.intersectsScaled=function(t,e){var n=Math.min(t.x,e.x),o=Math.max(t.x,e.x),l=Math.min(t.y,e.y),h=Math.max(t.y,e.y),_=this._maxx<n||this._minx>o||this._maxy<l||this._miny>h;if(_)return!1;var u=this.intersectsToleranceSquare(t,e);return cn.isTrue(!(_&&u),"Found bad envelope test"),u};Fo.prototype.initCorners=function(t){var e=.5;this._minx=t.x-e,this._maxx=t.x+e,this._miny=t.y-e,this._maxy=t.y+e,this._corner[0]=new It(this._maxx,this._maxy),this._corner[1]=new It(this._minx,this._maxy),this._corner[2]=new It(this._minx,this._miny),this._corner[3]=new It(this._maxx,this._miny)};Fo.prototype.intersects=function(t,e){return this._scaleFactor===1?this.intersectsScaled(t,e):(this.copyScaled(t,this._p0Scaled),this.copyScaled(e,this._p1Scaled),this.intersectsScaled(this._p0Scaled,this._p1Scaled))};Fo.prototype.scale=function(t){return Math.round(t*this._scaleFactor)};Fo.prototype.getCoordinate=function(){return this._originalPt};Fo.prototype.copyScaled=function(t,e){e.x=this.scale(t.x),e.y=this.scale(t.y)};Fo.prototype.getSafeEnvelope=function(){if(this._safeEnv===null){var t=Fo.SAFE_ENV_EXPANSION_FACTOR/this._scaleFactor;this._safeEnv=new De(this._originalPt.x-t,this._originalPt.x+t,this._originalPt.y-t,this._originalPt.y+t)}return this._safeEnv};Fo.prototype.intersectsPixelClosure=function(t,e){return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.hasIntersection()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.hasIntersection())||(this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.hasIntersection()))};Fo.prototype.intersectsToleranceSquare=function(t,e){var n=!1,o=!1;return this._li.computeIntersection(t,e,this._corner[0],this._corner[1]),!!(this._li.isProper()||(this._li.computeIntersection(t,e,this._corner[1],this._corner[2]),this._li.isProper())||(this._li.hasIntersection()&&(n=!0),this._li.computeIntersection(t,e,this._corner[2],this._corner[3]),this._li.isProper())||(this._li.hasIntersection()&&(o=!0),this._li.computeIntersection(t,e,this._corner[3],this._corner[0]),this._li.isProper())||n&&o||t.equals(this._pt)||e.equals(this._pt))};Fo.prototype.addSnappedNode=function(t,e){var n=t.getCoordinate(e),o=t.getCoordinate(e+1);return this.intersects(n,o)?(t.addIntersection(this.getCoordinate(),e),!0):!1};Fo.prototype.interfaces_=function(){return[]};Fo.prototype.getClass=function(){return Fo};Fv.SAFE_ENV_EXPANSION_FACTOR.get=function(){return .75};Object.defineProperties(Fo,Fv);var Bf=function(){this.tempEnv1=new De,this.selectedSegment=new Re};Bf.prototype.select=function(){if(arguments.length!==1&&arguments.length===2){var t=arguments[0],e=arguments[1];t.getLineSegment(e,this.selectedSegment),this.select(this.selectedSegment)}};Bf.prototype.interfaces_=function(){return[]};Bf.prototype.getClass=function(){return Bf};var dp=function(){this._index=null;var t=arguments[0];this._index=t},Bv={HotPixelSnapAction:{configurable:!0}};dp.prototype.snap=function(){if(arguments.length===1){var t=arguments[0];return this.snap(t,null,-1)}else if(arguments.length===3){var e=arguments[0],n=arguments[1],o=arguments[2],l=e.getSafeEnvelope(),h=new Uv(e,n,o);return this._index.query(l,{interfaces_:function(){return[Tu]},visitItem:function(_){var u=_;u.select(l,h)}}),h.isNodeAdded()}};dp.prototype.interfaces_=function(){return[]};dp.prototype.getClass=function(){return dp};Bv.HotPixelSnapAction.get=function(){return Uv};Object.defineProperties(dp,Bv);var Uv=function(t){function e(){t.call(this),this._hotPixel=null,this._parentEdge=null,this._hotPixelVertexIndex=null,this._isNodeAdded=!1;var n=arguments[0],o=arguments[1],l=arguments[2];this._hotPixel=n,this._parentEdge=o,this._hotPixelVertexIndex=l}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.isNodeAdded=function(){return this._isNodeAdded},e.prototype.select=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1],l=n.getContext();if(this._parentEdge!==null&&l===this._parentEdge&&o===this._hotPixelVertexIndex)return null;this._isNodeAdded=this._hotPixel.addSnappedNode(l,o)}else return t.prototype.select.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Bf),Jc=function(){this._li=null,this._interiorIntersections=null;var t=arguments[0];this._li=t,this._interiorIntersections=new se};Jc.prototype.processIntersections=function(t,e,n,o){var l=this;if(t===n&&e===o)return null;var h=t.getCoordinates()[e],_=t.getCoordinates()[e+1],u=n.getCoordinates()[o],I=n.getCoordinates()[o+1];if(this._li.computeIntersection(h,_,u,I),this._li.hasIntersection()&&this._li.isInteriorIntersection()){for(var w=0;w<this._li.getIntersectionNum();w++)l._interiorIntersections.add(l._li.getIntersection(w));t.addIntersections(this._li,e,0),n.addIntersections(this._li,o,1)}};Jc.prototype.isDone=function(){return!1};Jc.prototype.getInteriorIntersections=function(){return this._interiorIntersections};Jc.prototype.interfaces_=function(){return[gc]};Jc.prototype.getClass=function(){return Jc};var xl=function(){this._pm=null,this._li=null,this._scaleFactor=null,this._noder=null,this._pointSnapper=null,this._nodedSegStrings=null;var t=arguments[0];this._pm=t,this._li=new bc,this._li.setPrecisionModel(t),this._scaleFactor=t.getScale()};xl.prototype.checkCorrectness=function(t){var e=Kr.getNodedSubstrings(t),n=new Ga(e);try{n.checkValid()}catch(o){if(o instanceof Ev)o.printStackTrace();else throw o}finally{}};xl.prototype.getNodedSubstrings=function(){return Kr.getNodedSubstrings(this._nodedSegStrings)};xl.prototype.snapRound=function(t,e){var n=this.findInteriorIntersections(t,e);this.computeIntersectionSnaps(n),this.computeVertexSnaps(t)};xl.prototype.findInteriorIntersections=function(t,e){var n=new Jc(e);return this._noder.setSegmentIntersector(n),this._noder.computeNodes(t),n.getInteriorIntersections()};xl.prototype.computeVertexSnaps=function(){var t=this;if(qe(arguments[0],ci))for(var e=arguments[0],n=e.iterator();n.hasNext();){var o=n.next();t.computeVertexSnaps(o)}else if(arguments[0]instanceof Kr)for(var l=arguments[0],h=l.getCoordinates(),_=0;_<h.length;_++){var u=new Fo(h[_],t._scaleFactor,t._li),I=t._pointSnapper.snap(u,l,_);I&&l.addIntersection(h[_],_)}};xl.prototype.computeNodes=function(t){this._nodedSegStrings=t,this._noder=new u_,this._pointSnapper=new dp(this._noder.getIndex()),this.snapRound(t,this._li)};xl.prototype.computeIntersectionSnaps=function(t){for(var e=this,n=t.iterator();n.hasNext();){var o=n.next(),l=new Fo(o,e._scaleFactor,e._li);e._pointSnapper.snap(l)}};xl.prototype.interfaces_=function(){return[fc]};xl.prototype.getClass=function(){return xl};var Zi=function(){if(this._argGeom=null,this._distance=null,this._bufParams=new Rn,this._resultGeometry=null,this._saveException=null,arguments.length===1){var t=arguments[0];this._argGeom=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._argGeom=e,this._bufParams=n}},Tp={CAP_ROUND:{configurable:!0},CAP_BUTT:{configurable:!0},CAP_FLAT:{configurable:!0},CAP_SQUARE:{configurable:!0},MAX_PRECISION_DIGITS:{configurable:!0}};Zi.prototype.bufferFixedPrecision=function(t){var e=new Mu(new xl(new On(1)),t.getScale()),n=new wo(this._bufParams);n.setWorkingPrecisionModel(t),n.setNoder(e),this._resultGeometry=n.buffer(this._argGeom,this._distance)};Zi.prototype.bufferReducedPrecision=function(){var t=this;if(arguments.length===0){for(var e=Zi.MAX_PRECISION_DIGITS;e>=0;e--){try{t.bufferReducedPrecision(e)}catch(h){if(h instanceof Yl)t._saveException=h;else throw h}finally{}if(t._resultGeometry!==null)return null}throw this._saveException}else if(arguments.length===1){var n=arguments[0],o=Zi.precisionScaleFactor(this._argGeom,this._distance,n),l=new On(o);this.bufferFixedPrecision(l)}};Zi.prototype.computeGeometry=function(){if(this.bufferOriginalPrecision(),this._resultGeometry!==null)return null;var t=this._argGeom.getFactory().getPrecisionModel();t.getType()===On.FIXED?this.bufferFixedPrecision(t):this.bufferReducedPrecision()};Zi.prototype.setQuadrantSegments=function(t){this._bufParams.setQuadrantSegments(t)};Zi.prototype.bufferOriginalPrecision=function(){try{var t=new wo(this._bufParams);this._resultGeometry=t.buffer(this._argGeom,this._distance)}catch(e){if(e instanceof Zl)this._saveException=e;else throw e}finally{}};Zi.prototype.getResultGeometry=function(t){return this._distance=t,this.computeGeometry(),this._resultGeometry};Zi.prototype.setEndCapStyle=function(t){this._bufParams.setEndCapStyle(t)};Zi.prototype.interfaces_=function(){return[]};Zi.prototype.getClass=function(){return Zi};Zi.bufferOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new Zi(t),o=n.getResultGeometry(e);return o}else if(arguments.length===3){if(Number.isInteger(arguments[2])&&arguments[0]instanceof Ge&&typeof arguments[1]=="number"){var l=arguments[0],h=arguments[1],_=arguments[2],u=new Zi(l);u.setQuadrantSegments(_);var I=u.getResultGeometry(h);return I}else if(arguments[2]instanceof Rn&&arguments[0]instanceof Ge&&typeof arguments[1]=="number"){var w=arguments[0],D=arguments[1],k=arguments[2],G=new Zi(w,k),H=G.getResultGeometry(D);return H}}else if(arguments.length===4){var j=arguments[0],K=arguments[1],lt=arguments[2],dt=arguments[3],xt=new Zi(j);xt.setQuadrantSegments(lt),xt.setEndCapStyle(dt);var gt=xt.getResultGeometry(K);return gt}};Zi.precisionScaleFactor=function(t,e,n){var o=t.getEnvelopeInternal(),l=Es.max(Math.abs(o.getMaxX()),Math.abs(o.getMaxY()),Math.abs(o.getMinX()),Math.abs(o.getMinY())),h=e>0?e:0,_=l+2*h,u=Math.trunc(Math.log(_)/Math.log(10)+1),I=n-u,w=Math.pow(10,I);return w};Tp.CAP_ROUND.get=function(){return Rn.CAP_ROUND};Tp.CAP_BUTT.get=function(){return Rn.CAP_FLAT};Tp.CAP_FLAT.get=function(){return Rn.CAP_FLAT};Tp.CAP_SQUARE.get=function(){return Rn.CAP_SQUARE};Tp.MAX_PRECISION_DIGITS.get=function(){return 12};Object.defineProperties(Zi,Tp);var vo=function(){this._pt=[new It,new It],this._distance=Je.NaN,this._isNull=!0};vo.prototype.getCoordinates=function(){return this._pt};vo.prototype.getCoordinate=function(t){return this._pt[t]};vo.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var o=e.distance(n);o<this._distance&&this.initialize(e,n,o)}};vo.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],o=arguments[1],l=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(o),this._distance=l,this._isNull=!1}};vo.prototype.getDistance=function(){return this._distance};vo.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var o=e.distance(n);o>this._distance&&this.initialize(e,n,o)}};vo.prototype.interfaces_=function(){return[]};vo.prototype.getClass=function(){return vo};var hl=function(){};hl.prototype.interfaces_=function(){return[]};hl.prototype.getClass=function(){return hl};hl.computeDistance=function(){if(arguments[2]instanceof vo&&arguments[0]instanceof Fr&&arguments[1]instanceof It)for(var t=arguments[0],e=arguments[1],n=arguments[2],o=t.getCoordinates(),l=new Re,h=0;h<o.length-1;h++){l.setCoordinates(o[h],o[h+1]);var _=l.closestPoint(e);n.setMinimum(_,e)}else if(arguments[2]instanceof vo&&arguments[0]instanceof di&&arguments[1]instanceof It){var u=arguments[0],I=arguments[1],w=arguments[2];hl.computeDistance(u.getExteriorRing(),I,w);for(var D=0;D<u.getNumInteriorRing();D++)hl.computeDistance(u.getInteriorRingN(D),I,w)}else if(arguments[2]instanceof vo&&arguments[0]instanceof Ge&&arguments[1]instanceof It){var k=arguments[0],G=arguments[1],H=arguments[2];if(k instanceof Fr)hl.computeDistance(k,G,H);else if(k instanceof di)hl.computeDistance(k,G,H);else if(k instanceof Eo)for(var j=k,K=0;K<j.getNumGeometries();K++){var lt=j.getGeometryN(K);hl.computeDistance(lt,G,H)}else H.setMinimum(k.getCoordinate(),G)}else if(arguments[2]instanceof vo&&arguments[0]instanceof Re&&arguments[1]instanceof It){var dt=arguments[0],xt=arguments[1],gt=arguments[2],yt=dt.closestPoint(xt);gt.setMinimum(yt,xt)}};var _c=function(t){this._maxPtDist=new vo,this._inputGeom=t||null},c_={MaxPointDistanceFilter:{configurable:!0},MaxMidpointDistanceFilter:{configurable:!0}};_c.prototype.computeMaxMidpointDistance=function(t){var e=new Au(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};_c.prototype.computeMaxVertexDistance=function(t){var e=new Qc(this._inputGeom);t.apply(e),this._maxPtDist.setMaximum(e.getMaxPointDistance())};_c.prototype.findDistance=function(t){return this.computeMaxVertexDistance(t),this.computeMaxMidpointDistance(t),this._maxPtDist.getDistance()};_c.prototype.getDistancePoints=function(){return this._maxPtDist};_c.prototype.interfaces_=function(){return[]};_c.prototype.getClass=function(){return _c};c_.MaxPointDistanceFilter.get=function(){return Qc};c_.MaxMidpointDistanceFilter.get=function(){return Au};Object.defineProperties(_c,c_);var Qc=function(t){this._maxPtDist=new vo,this._minPtDist=new vo,this._geom=t||null};Qc.prototype.filter=function(t){this._minPtDist.initialize(),hl.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Qc.prototype.getMaxPointDistance=function(){return this._maxPtDist};Qc.prototype.interfaces_=function(){return[gl]};Qc.prototype.getClass=function(){return Qc};var Au=function(t){this._maxPtDist=new vo,this._minPtDist=new vo,this._geom=t||null};Au.prototype.filter=function(t,e){if(e===0)return null;var n=t.getCoordinate(e-1),o=t.getCoordinate(e),l=new It((n.x+o.x)/2,(n.y+o.y)/2);this._minPtDist.initialize(),hl.computeDistance(this._geom,l,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};Au.prototype.isDone=function(){return!1};Au.prototype.isGeometryChanged=function(){return!1};Au.prototype.getMaxPointDistance=function(){return this._maxPtDist};Au.prototype.interfaces_=function(){return[ra]};Au.prototype.getClass=function(){return Au};var ql=function(t){this._comps=t||null};ql.prototype.filter=function(t){t instanceof di&&this._comps.add(t)};ql.prototype.interfaces_=function(){return[za]};ql.prototype.getClass=function(){return ql};ql.getPolygons=function(){if(arguments.length===1){var t=arguments[0];return ql.getPolygons(t,new se)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof di?n.add(e):e instanceof Eo&&e.apply(new ql(n)),n}};var qi=function(){if(this._lines=null,this._isForcedToLineString=!1,arguments.length===1){var t=arguments[0];this._lines=t}else if(arguments.length===2){var e=arguments[0],n=arguments[1];this._lines=e,this._isForcedToLineString=n}};qi.prototype.filter=function(t){if(this._isForcedToLineString&&t instanceof ml){var e=t.getFactory().createLineString(t.getCoordinateSequence());return this._lines.add(e),null}t instanceof Fr&&this._lines.add(t)};qi.prototype.setForceToLineString=function(t){this._isForcedToLineString=t};qi.prototype.interfaces_=function(){return[Xl]};qi.prototype.getClass=function(){return qi};qi.getGeometry=function(){if(arguments.length===1){var t=arguments[0];return t.getFactory().buildGeometry(qi.getLines(t))}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e.getFactory().buildGeometry(qi.getLines(e,n))}};qi.getLines=function(){if(arguments.length===1){var t=arguments[0];return qi.getLines(t,!1)}else if(arguments.length===2){if(qe(arguments[0],ci)&&qe(arguments[1],ci)){for(var e=arguments[0],n=arguments[1],o=e.iterator();o.hasNext();){var l=o.next();qi.getLines(l,n)}return n}else if(arguments[0]instanceof Ge&&typeof arguments[1]=="boolean"){var h=arguments[0],_=arguments[1],u=new se;return h.apply(new qi(u,_)),u}else if(arguments[0]instanceof Ge&&qe(arguments[1],ci)){var I=arguments[0],w=arguments[1];return I instanceof Fr?w.add(I):I.apply(new qi(w)),w}}else if(arguments.length===3){if(typeof arguments[2]=="boolean"&&qe(arguments[0],ci)&&qe(arguments[1],ci)){for(var D=arguments[0],k=arguments[1],G=arguments[2],H=D.iterator();H.hasNext();){var j=H.next();qi.getLines(j,k,G)}return k}else if(typeof arguments[2]=="boolean"&&arguments[0]instanceof Ge&&qe(arguments[1],ci)){var K=arguments[0],lt=arguments[1],dt=arguments[2];return K.apply(new qi(lt,dt)),lt}}};var aa=function(){if(this._boundaryRule=Fs.OGC_SFS_BOUNDARY_RULE,this._isIn=null,this._numBoundaries=null,arguments.length!==0&&arguments.length===1){var t=arguments[0];if(t===null)throw new Ir("Rule must be non-null");this._boundaryRule=t}};aa.prototype.locateInternal=function(){var t=this;if(arguments[0]instanceof It&&arguments[1]instanceof di){var e=arguments[0],n=arguments[1];if(n.isEmpty())return Mt.EXTERIOR;var o=n.getExteriorRing(),l=this.locateInPolygonRing(e,o);if(l===Mt.EXTERIOR)return Mt.EXTERIOR;if(l===Mt.BOUNDARY)return Mt.BOUNDARY;for(var h=0;h<n.getNumInteriorRing();h++){var _=n.getInteriorRingN(h),u=t.locateInPolygonRing(e,_);if(u===Mt.INTERIOR)return Mt.EXTERIOR;if(u===Mt.BOUNDARY)return Mt.BOUNDARY}return Mt.INTERIOR}else if(arguments[0]instanceof It&&arguments[1]instanceof Fr){var I=arguments[0],w=arguments[1];if(!w.getEnvelopeInternal().intersects(I))return Mt.EXTERIOR;var D=w.getCoordinates();return!w.isClosed()&&(I.equals(D[0])||I.equals(D[D.length-1]))?Mt.BOUNDARY:ge.isOnLine(I,D)?Mt.INTERIOR:Mt.EXTERIOR}else if(arguments[0]instanceof It&&arguments[1]instanceof Qo){var k=arguments[0],G=arguments[1],H=G.getCoordinate();return H.equals2D(k)?Mt.INTERIOR:Mt.EXTERIOR}};aa.prototype.locateInPolygonRing=function(t,e){return e.getEnvelopeInternal().intersects(t)?ge.locatePointInRing(t,e.getCoordinates()):Mt.EXTERIOR};aa.prototype.intersects=function(t,e){return this.locate(t,e)!==Mt.EXTERIOR};aa.prototype.updateLocationInfo=function(t){t===Mt.INTERIOR&&(this._isIn=!0),t===Mt.BOUNDARY&&this._numBoundaries++};aa.prototype.computeLocation=function(t,e){var n=this;if(e instanceof Qo&&this.updateLocationInfo(this.locateInternal(t,e)),e instanceof Fr)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof di)this.updateLocationInfo(this.locateInternal(t,e));else if(e instanceof pc)for(var o=e,l=0;l<o.getNumGeometries();l++){var h=o.getGeometryN(l);n.updateLocationInfo(n.locateInternal(t,h))}else if(e instanceof fl)for(var _=e,u=0;u<_.getNumGeometries();u++){var I=_.getGeometryN(u);n.updateLocationInfo(n.locateInternal(t,I))}else if(e instanceof Eo)for(var w=new dl(e);w.hasNext();){var D=w.next();D!==e&&n.computeLocation(t,D)}};aa.prototype.locate=function(t,e){return e.isEmpty()?Mt.EXTERIOR:e instanceof Fr?this.locateInternal(t,e):e instanceof di?this.locateInternal(t,e):(this._isIn=!1,this._numBoundaries=0,this.computeLocation(t,e),this._boundaryRule.isInBoundary(this._numBoundaries)?Mt.BOUNDARY:this._numBoundaries>0||this._isIn?Mt.INTERIOR:Mt.EXTERIOR)};aa.prototype.interfaces_=function(){return[]};aa.prototype.getClass=function(){return aa};var xo=function t(){if(this._component=null,this._segIndex=null,this._pt=null,arguments.length===2){var e=arguments[0],n=arguments[1];t.call(this,e,t.INSIDE_AREA,n)}else if(arguments.length===3){var o=arguments[0],l=arguments[1],h=arguments[2];this._component=o,this._segIndex=l,this._pt=h}},Vv={INSIDE_AREA:{configurable:!0}};xo.prototype.isInsideArea=function(){return this._segIndex===xo.INSIDE_AREA};xo.prototype.getCoordinate=function(){return this._pt};xo.prototype.getGeometryComponent=function(){return this._component};xo.prototype.getSegmentIndex=function(){return this._segIndex};xo.prototype.interfaces_=function(){return[]};xo.prototype.getClass=function(){return xo};Vv.INSIDE_AREA.get=function(){return-1};Object.defineProperties(xo,Vv);var bu=function(t){this._pts=t||null};bu.prototype.filter=function(t){t instanceof Qo&&this._pts.add(t)};bu.prototype.interfaces_=function(){return[za]};bu.prototype.getClass=function(){return bu};bu.getPoints=function(){if(arguments.length===1){var t=arguments[0];return t instanceof Qo?oa.singletonList(t):bu.getPoints(t,new se)}else if(arguments.length===2){var e=arguments[0],n=arguments[1];return e instanceof Qo?n.add(e):e instanceof Eo&&e.apply(new bu(n)),n}};var th=function(){this._locations=null;var t=arguments[0];this._locations=t};th.prototype.filter=function(t){(t instanceof Qo||t instanceof Fr||t instanceof di)&&this._locations.add(new xo(t,0,t.getCoordinate()))};th.prototype.interfaces_=function(){return[za]};th.prototype.getClass=function(){return th};th.getLocations=function(t){var e=new se;return t.apply(new th(e)),e};var Wi=function(){if(this._geom=null,this._terminateDistance=0,this._ptLocator=new aa,this._minDistanceLocation=null,this._minDistance=Je.MAX_VALUE,arguments.length===2){var t=arguments[0],e=arguments[1];this._geom=[t,e],this._terminateDistance=0}else if(arguments.length===3){var n=arguments[0],o=arguments[1],l=arguments[2];this._geom=new Array(2).fill(null),this._geom[0]=n,this._geom[1]=o,this._terminateDistance=l}};Wi.prototype.computeContainmentDistance=function(){var t=this;if(arguments.length===0){var e=new Array(2).fill(null);if(this.computeContainmentDistance(0,e),this._minDistance<=this._terminateDistance)return null;this.computeContainmentDistance(1,e)}else if(arguments.length===2){var n=arguments[0],o=arguments[1],l=1-n,h=ql.getPolygons(this._geom[n]);if(h.size()>0){var _=th.getLocations(this._geom[l]);if(this.computeContainmentDistance(_,h,o),this._minDistance<=this._terminateDistance)return this._minDistanceLocation[l]=o[0],this._minDistanceLocation[n]=o[1],null}}else if(arguments.length===3){if(arguments[2]instanceof Array&&qe(arguments[0],ea)&&qe(arguments[1],ea)){for(var u=arguments[0],I=arguments[1],w=arguments[2],D=0;D<u.size();D++)for(var k=u.get(D),G=0;G<I.size();G++)if(t.computeContainmentDistance(k,I.get(G),w),t._minDistance<=t._terminateDistance)return null}else if(arguments[2]instanceof Array&&arguments[0]instanceof xo&&arguments[1]instanceof di){var H=arguments[0],j=arguments[1],K=arguments[2],lt=H.getCoordinate();if(Mt.EXTERIOR!==this._ptLocator.locate(lt,j))return this._minDistance=0,K[0]=H,K[1]=new xo(j,lt),null}}};Wi.prototype.computeMinDistanceLinesPoints=function(t,e,n){for(var o=this,l=0;l<t.size();l++)for(var h=t.get(l),_=0;_<e.size();_++){var u=e.get(_);if(o.computeMinDistance(h,u,n),o._minDistance<=o._terminateDistance)return null}};Wi.prototype.computeFacetDistance=function(){var t=new Array(2).fill(null),e=qi.getLines(this._geom[0]),n=qi.getLines(this._geom[1]),o=bu.getPoints(this._geom[0]),l=bu.getPoints(this._geom[1]);if(this.computeMinDistanceLines(e,n,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(e,l,t),this.updateMinDistance(t,!1),this._minDistance<=this._terminateDistance)||(t[0]=null,t[1]=null,this.computeMinDistanceLinesPoints(n,o,t),this.updateMinDistance(t,!0),this._minDistance<=this._terminateDistance))return null;t[0]=null,t[1]=null,this.computeMinDistancePoints(o,l,t),this.updateMinDistance(t,!1)};Wi.prototype.nearestLocations=function(){return this.computeMinDistance(),this._minDistanceLocation};Wi.prototype.updateMinDistance=function(t,e){if(t[0]===null)return null;e?(this._minDistanceLocation[0]=t[1],this._minDistanceLocation[1]=t[0]):(this._minDistanceLocation[0]=t[0],this._minDistanceLocation[1]=t[1])};Wi.prototype.nearestPoints=function(){this.computeMinDistance();var t=[this._minDistanceLocation[0].getCoordinate(),this._minDistanceLocation[1].getCoordinate()];return t};Wi.prototype.computeMinDistance=function(){var t=this;if(arguments.length===0){if(this._minDistanceLocation!==null||(this._minDistanceLocation=new Array(2).fill(null),this.computeContainmentDistance(),this._minDistance<=this._terminateDistance))return null;this.computeFacetDistance()}else if(arguments.length===3){if(arguments[2]instanceof Array&&arguments[0]instanceof Fr&&arguments[1]instanceof Qo){var e=arguments[0],n=arguments[1],o=arguments[2];if(e.getEnvelopeInternal().distance(n.getEnvelopeInternal())>this._minDistance)return null;for(var l=e.getCoordinates(),h=n.getCoordinate(),_=0;_<l.length-1;_++){var u=ge.distancePointLine(h,l[_],l[_+1]);if(u<t._minDistance){t._minDistance=u;var I=new Re(l[_],l[_+1]),w=I.closestPoint(h);o[0]=new xo(e,_,w),o[1]=new xo(n,0,h)}if(t._minDistance<=t._terminateDistance)return null}}else if(arguments[2]instanceof Array&&arguments[0]instanceof Fr&&arguments[1]instanceof Fr){var D=arguments[0],k=arguments[1],G=arguments[2];if(D.getEnvelopeInternal().distance(k.getEnvelopeInternal())>this._minDistance)return null;for(var H=D.getCoordinates(),j=k.getCoordinates(),K=0;K<H.length-1;K++)for(var lt=0;lt<j.length-1;lt++){var dt=ge.distanceLineLine(H[K],H[K+1],j[lt],j[lt+1]);if(dt<t._minDistance){t._minDistance=dt;var xt=new Re(H[K],H[K+1]),gt=new Re(j[lt],j[lt+1]),yt=xt.closestPoints(gt);G[0]=new xo(D,K,yt[0]),G[1]=new xo(k,lt,yt[1])}if(t._minDistance<=t._terminateDistance)return null}}}};Wi.prototype.computeMinDistancePoints=function(t,e,n){for(var o=this,l=0;l<t.size();l++)for(var h=t.get(l),_=0;_<e.size();_++){var u=e.get(_),I=h.getCoordinate().distance(u.getCoordinate());if(I<o._minDistance&&(o._minDistance=I,n[0]=new xo(h,0,h.getCoordinate()),n[1]=new xo(u,0,u.getCoordinate())),o._minDistance<=o._terminateDistance)return null}};Wi.prototype.distance=function(){if(this._geom[0]===null||this._geom[1]===null)throw new Ir("null geometries are not supported");return this._geom[0].isEmpty()||this._geom[1].isEmpty()?0:(this.computeMinDistance(),this._minDistance)};Wi.prototype.computeMinDistanceLines=function(t,e,n){for(var o=this,l=0;l<t.size();l++)for(var h=t.get(l),_=0;_<e.size();_++){var u=e.get(_);if(o.computeMinDistance(h,u,n),o._minDistance<=o._terminateDistance)return null}};Wi.prototype.interfaces_=function(){return[]};Wi.prototype.getClass=function(){return Wi};Wi.distance=function(t,e){var n=new Wi(t,e);return n.distance()};Wi.isWithinDistance=function(t,e,n){var o=new Wi(t,e,n);return o.distance()<=n};Wi.nearestPoints=function(t,e){var n=new Wi(t,e);return n.nearestPoints()};var to=function(){this._pt=[new It,new It],this._distance=Je.NaN,this._isNull=!0};to.prototype.getCoordinates=function(){return this._pt};to.prototype.getCoordinate=function(t){return this._pt[t]};to.prototype.setMinimum=function(){if(arguments.length===1){var t=arguments[0];this.setMinimum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var o=e.distance(n);o<this._distance&&this.initialize(e,n,o)}};to.prototype.initialize=function(){if(arguments.length===0)this._isNull=!0;else if(arguments.length===2){var t=arguments[0],e=arguments[1];this._pt[0].setCoordinate(t),this._pt[1].setCoordinate(e),this._distance=t.distance(e),this._isNull=!1}else if(arguments.length===3){var n=arguments[0],o=arguments[1],l=arguments[2];this._pt[0].setCoordinate(n),this._pt[1].setCoordinate(o),this._distance=l,this._isNull=!1}};to.prototype.toString=function(){return na.toLineString(this._pt[0],this._pt[1])};to.prototype.getDistance=function(){return this._distance};to.prototype.setMaximum=function(){if(arguments.length===1){var t=arguments[0];this.setMaximum(t._pt[0],t._pt[1])}else if(arguments.length===2){var e=arguments[0],n=arguments[1];if(this._isNull)return this.initialize(e,n),null;var o=e.distance(n);o>this._distance&&this.initialize(e,n,o)}};to.prototype.interfaces_=function(){return[]};to.prototype.getClass=function(){return to};var Da=function(){};Da.prototype.interfaces_=function(){return[]};Da.prototype.getClass=function(){return Da};Da.computeDistance=function(){if(arguments[2]instanceof to&&arguments[0]instanceof Fr&&arguments[1]instanceof It)for(var t=arguments[0],e=arguments[1],n=arguments[2],o=new Re,l=t.getCoordinates(),h=0;h<l.length-1;h++){o.setCoordinates(l[h],l[h+1]);var _=o.closestPoint(e);n.setMinimum(_,e)}else if(arguments[2]instanceof to&&arguments[0]instanceof di&&arguments[1]instanceof It){var u=arguments[0],I=arguments[1],w=arguments[2];Da.computeDistance(u.getExteriorRing(),I,w);for(var D=0;D<u.getNumInteriorRing();D++)Da.computeDistance(u.getInteriorRingN(D),I,w)}else if(arguments[2]instanceof to&&arguments[0]instanceof Ge&&arguments[1]instanceof It){var k=arguments[0],G=arguments[1],H=arguments[2];if(k instanceof Fr)Da.computeDistance(k,G,H);else if(k instanceof di)Da.computeDistance(k,G,H);else if(k instanceof Eo)for(var j=k,K=0;K<j.getNumGeometries();K++){var lt=j.getGeometryN(K);Da.computeDistance(lt,G,H)}else H.setMinimum(k.getCoordinate(),G)}else if(arguments[2]instanceof to&&arguments[0]instanceof Re&&arguments[1]instanceof It){var dt=arguments[0],xt=arguments[1],gt=arguments[2],yt=dt.closestPoint(xt);gt.setMinimum(yt,xt)}};var Os=function(){this._g0=null,this._g1=null,this._ptDist=new to,this._densifyFrac=0;var t=arguments[0],e=arguments[1];this._g0=t,this._g1=e},h_={MaxPointDistanceFilter:{configurable:!0},MaxDensifiedByFractionDistanceFilter:{configurable:!0}};Os.prototype.getCoordinates=function(){return this._ptDist.getCoordinates()};Os.prototype.setDensifyFraction=function(t){if(t>1||t<=0)throw new Ir("Fraction is not in range (0.0 - 1.0]");this._densifyFrac=t};Os.prototype.compute=function(t,e){this.computeOrientedDistance(t,e,this._ptDist),this.computeOrientedDistance(e,t,this._ptDist)};Os.prototype.distance=function(){return this.compute(this._g0,this._g1),this._ptDist.getDistance()};Os.prototype.computeOrientedDistance=function(t,e,n){var o=new eh(e);if(t.apply(o),n.setMaximum(o.getMaxPointDistance()),this._densifyFrac>0){var l=new Lu(e,this._densifyFrac);t.apply(l),n.setMaximum(l.getMaxPointDistance())}};Os.prototype.orientedDistance=function(){return this.computeOrientedDistance(this._g0,this._g1,this._ptDist),this._ptDist.getDistance()};Os.prototype.interfaces_=function(){return[]};Os.prototype.getClass=function(){return Os};Os.distance=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new Os(t,e);return n.distance()}else if(arguments.length===3){var o=arguments[0],l=arguments[1],h=arguments[2],_=new Os(o,l);return _.setDensifyFraction(h),_.distance()}};h_.MaxPointDistanceFilter.get=function(){return eh};h_.MaxDensifiedByFractionDistanceFilter.get=function(){return Lu};Object.defineProperties(Os,h_);var eh=function(){this._maxPtDist=new to,this._minPtDist=new to,this._euclideanDist=new Da,this._geom=null;var t=arguments[0];this._geom=t};eh.prototype.filter=function(t){this._minPtDist.initialize(),Da.computeDistance(this._geom,t,this._minPtDist),this._maxPtDist.setMaximum(this._minPtDist)};eh.prototype.getMaxPointDistance=function(){return this._maxPtDist};eh.prototype.interfaces_=function(){return[gl]};eh.prototype.getClass=function(){return eh};var Lu=function(){this._maxPtDist=new to,this._minPtDist=new to,this._geom=null,this._numSubSegs=0;var t=arguments[0],e=arguments[1];this._geom=t,this._numSubSegs=Math.trunc(Math.round(1/e))};Lu.prototype.filter=function(t,e){var n=this;if(e===0)return null;for(var o=t.getCoordinate(e-1),l=t.getCoordinate(e),h=(l.x-o.x)/this._numSubSegs,_=(l.y-o.y)/this._numSubSegs,u=0;u<this._numSubSegs;u++){var I=o.x+u*h,w=o.y+u*_,D=new It(I,w);n._minPtDist.initialize(),Da.computeDistance(n._geom,D,n._minPtDist),n._maxPtDist.setMaximum(n._minPtDist)}};Lu.prototype.isDone=function(){return!1};Lu.prototype.isGeometryChanged=function(){return!1};Lu.prototype.getMaxPointDistance=function(){return this._maxPtDist};Lu.prototype.interfaces_=function(){return[ra]};Lu.prototype.getClass=function(){return Lu};var Jo=function(t,e,n){this._minValidDistance=null,this._maxValidDistance=null,this._minDistanceFound=null,this._maxDistanceFound=null,this._isValid=!0,this._errMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._bufDistance=e||null,this._result=n||null},p_={VERBOSE:{configurable:!0},MAX_DISTANCE_DIFF_FRAC:{configurable:!0}};Jo.prototype.checkMaximumDistance=function(t,e,n){var o=new Os(e,t);if(o.setDensifyFraction(.25),this._maxDistanceFound=o.orientedDistance(),this._maxDistanceFound>n){this._isValid=!1;var l=o.getCoordinates();this._errorLocation=l[1],this._errorIndicator=t.getFactory().createLineString(l),this._errMsg="Distance between buffer curve and input is too large ("+this._maxDistanceFound+" at "+na.toLineString(l[0],l[1])+")"}};Jo.prototype.isValid=function(){var t=Math.abs(this._bufDistance),e=Jo.MAX_DISTANCE_DIFF_FRAC*t;return this._minValidDistance=t-e,this._maxValidDistance=t+e,this._input.isEmpty()||this._result.isEmpty()?!0:(this._bufDistance>0?this.checkPositiveValid():this.checkNegativeValid(),Jo.VERBOSE&&Yi.out.println("Min Dist= "+this._minDistanceFound+"  err= "+(1-this._minDistanceFound/this._bufDistance)+"  Max Dist= "+this._maxDistanceFound+"  err= "+(this._maxDistanceFound/this._bufDistance-1)),this._isValid)};Jo.prototype.checkNegativeValid=function(){if(!(this._input instanceof di||this._input instanceof fl||this._input instanceof Eo))return null;var t=this.getPolygonLines(this._input);if(this.checkMinimumDistance(t,this._result,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(t,this._result,this._maxValidDistance)};Jo.prototype.getErrorIndicator=function(){return this._errorIndicator};Jo.prototype.checkMinimumDistance=function(t,e,n){var o=new Wi(t,e,n);if(this._minDistanceFound=o.distance(),this._minDistanceFound<n){this._isValid=!1;var l=o.nearestPoints();this._errorLocation=o.nearestPoints()[1],this._errorIndicator=t.getFactory().createLineString(l),this._errMsg="Distance between buffer curve and input is too small ("+this._minDistanceFound+" at "+na.toLineString(l[0],l[1])+" )"}};Jo.prototype.checkPositiveValid=function(){var t=this._result.getBoundary();if(this.checkMinimumDistance(this._input,t,this._minValidDistance),!this._isValid)return null;this.checkMaximumDistance(this._input,t,this._maxValidDistance)};Jo.prototype.getErrorLocation=function(){return this._errorLocation};Jo.prototype.getPolygonLines=function(t){for(var e=new se,n=new qi(e),o=ql.getPolygons(t),l=o.iterator();l.hasNext();){var h=l.next();h.apply(n)}return t.getFactory().buildGeometry(e)};Jo.prototype.getErrorMessage=function(){return this._errMsg};Jo.prototype.interfaces_=function(){return[]};Jo.prototype.getClass=function(){return Jo};p_.VERBOSE.get=function(){return!1};p_.MAX_DISTANCE_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Jo,p_);var Hi=function(t,e,n){this._isValid=!0,this._errorMsg=null,this._errorLocation=null,this._errorIndicator=null,this._input=t||null,this._distance=e||null,this._result=n||null},f_={VERBOSE:{configurable:!0},MAX_ENV_DIFF_FRAC:{configurable:!0}};Hi.prototype.isValid=function(){return this.checkPolygonal(),this._isValid?(this.checkExpectedEmpty(),this._isValid?(this.checkEnvelope(),this._isValid?(this.checkArea(),this._isValid?(this.checkDistance(),this._isValid):this._isValid):this._isValid):this._isValid):this._isValid};Hi.prototype.checkEnvelope=function(){if(this._distance<0)return null;var t=this._distance*Hi.MAX_ENV_DIFF_FRAC;t===0&&(t=.001);var e=new De(this._input.getEnvelopeInternal());e.expandBy(this._distance);var n=new De(this._result.getEnvelopeInternal());n.expandBy(t),n.contains(e)||(this._isValid=!1,this._errorMsg="Buffer envelope is incorrect",this._errorIndicator=this._input.getFactory().toGeometry(n)),this.report("Envelope")};Hi.prototype.checkDistance=function(){var t=new Jo(this._input,this._distance,this._result);t.isValid()||(this._isValid=!1,this._errorMsg=t.getErrorMessage(),this._errorLocation=t.getErrorLocation(),this._errorIndicator=t.getErrorIndicator()),this.report("Distance")};Hi.prototype.checkArea=function(){var t=this._input.getArea(),e=this._result.getArea();this._distance>0&&t>e&&(this._isValid=!1,this._errorMsg="Area of positive buffer is smaller than input",this._errorIndicator=this._result),this._distance<0&&t<e&&(this._isValid=!1,this._errorMsg="Area of negative buffer is larger than input",this._errorIndicator=this._result),this.report("Area")};Hi.prototype.checkPolygonal=function(){this._result instanceof di||this._result instanceof fl||(this._isValid=!1),this._errorMsg="Result is not polygonal",this._errorIndicator=this._result,this.report("Polygonal")};Hi.prototype.getErrorIndicator=function(){return this._errorIndicator};Hi.prototype.getErrorLocation=function(){return this._errorLocation};Hi.prototype.checkExpectedEmpty=function(){if(this._input.getDimension()>=2||this._distance>0)return null;this._result.isEmpty()||(this._isValid=!1,this._errorMsg="Result is non-empty",this._errorIndicator=this._result),this.report("ExpectedEmpty")};Hi.prototype.report=function(t){if(!Hi.VERBOSE)return null;Yi.out.println("Check "+t+": "+(this._isValid?"passed":"FAILED"))};Hi.prototype.getErrorMessage=function(){return this._errorMsg};Hi.prototype.interfaces_=function(){return[]};Hi.prototype.getClass=function(){return Hi};Hi.isValidMsg=function(t,e,n){var o=new Hi(t,e,n);return o.isValid()?null:o.getErrorMessage()};Hi.isValid=function(t,e,n){var o=new Hi(t,e,n);return!!o.isValid()};f_.VERBOSE.get=function(){return!1};f_.MAX_ENV_DIFF_FRAC.get=function(){return .012};Object.defineProperties(Hi,f_);var ja=function(){this._pts=null,this._data=null;var t=arguments[0],e=arguments[1];this._pts=t,this._data=e};ja.prototype.getCoordinates=function(){return this._pts};ja.prototype.size=function(){return this._pts.length};ja.prototype.getCoordinate=function(t){return this._pts[t]};ja.prototype.isClosed=function(){return this._pts[0].equals(this._pts[this._pts.length-1])};ja.prototype.getSegmentOctant=function(t){return t===this._pts.length-1?-1:$c.octant(this.getCoordinate(t),this.getCoordinate(t+1))};ja.prototype.setData=function(t){this._data=t};ja.prototype.getData=function(){return this._data};ja.prototype.toString=function(){return na.toLineString(new Wr(this._pts))};ja.prototype.interfaces_=function(){return[yl]};ja.prototype.getClass=function(){return ja};var Di=function(){this._findAllIntersections=!1,this._isCheckEndSegmentsOnly=!1,this._li=null,this._interiorIntersection=null,this._intSegments=null,this._intersections=new se,this._intersectionCount=0,this._keepIntersections=!0;var t=arguments[0];this._li=t,this._interiorIntersection=null};Di.prototype.getInteriorIntersection=function(){return this._interiorIntersection};Di.prototype.setCheckEndSegmentsOnly=function(t){this._isCheckEndSegmentsOnly=t};Di.prototype.getIntersectionSegments=function(){return this._intSegments};Di.prototype.count=function(){return this._intersectionCount};Di.prototype.getIntersections=function(){return this._intersections};Di.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};Di.prototype.setKeepIntersections=function(t){this._keepIntersections=t};Di.prototype.processIntersections=function(t,e,n,o){if(!this._findAllIntersections&&this.hasIntersection()||t===n&&e===o)return null;if(this._isCheckEndSegmentsOnly){var l=this.isEndSegment(t,e)||this.isEndSegment(n,o);if(!l)return null}var h=t.getCoordinates()[e],_=t.getCoordinates()[e+1],u=n.getCoordinates()[o],I=n.getCoordinates()[o+1];this._li.computeIntersection(h,_,u,I),this._li.hasIntersection()&&this._li.isInteriorIntersection()&&(this._intSegments=new Array(4).fill(null),this._intSegments[0]=h,this._intSegments[1]=_,this._intSegments[2]=u,this._intSegments[3]=I,this._interiorIntersection=this._li.getIntersection(0),this._keepIntersections&&this._intersections.add(this._interiorIntersection),this._intersectionCount++)};Di.prototype.isEndSegment=function(t,e){return e===0||e>=t.size()-2};Di.prototype.hasIntersection=function(){return this._interiorIntersection!==null};Di.prototype.isDone=function(){return this._findAllIntersections?!1:this._interiorIntersection!==null};Di.prototype.interfaces_=function(){return[gc]};Di.prototype.getClass=function(){return Di};Di.createAllIntersectionsFinder=function(t){var e=new Di(t);return e.setFindAllIntersections(!0),e};Di.createAnyIntersectionFinder=function(t){return new Di(t)};Di.createIntersectionCounter=function(t){var e=new Di(t);return e.setFindAllIntersections(!0),e.setKeepIntersections(!1),e};var la=function(){this._li=new bc,this._segStrings=null,this._findAllIntersections=!1,this._segInt=null,this._isValid=!0;var t=arguments[0];this._segStrings=t};la.prototype.execute=function(){if(this._segInt!==null)return null;this.checkInteriorIntersections()};la.prototype.getIntersections=function(){return this._segInt.getIntersections()};la.prototype.isValid=function(){return this.execute(),this._isValid};la.prototype.setFindAllIntersections=function(t){this._findAllIntersections=t};la.prototype.checkInteriorIntersections=function(){this._isValid=!0,this._segInt=new Di(this._li),this._segInt.setFindAllIntersections(this._findAllIntersections);var t=new u_;if(t.setSegmentIntersector(this._segInt),t.computeNodes(this._segStrings),this._segInt.hasIntersection())return this._isValid=!1,null};la.prototype.checkValid=function(){if(this.execute(),!this._isValid)throw new Yl(this.getErrorMessage(),this._segInt.getInteriorIntersection())};la.prototype.getErrorMessage=function(){if(this._isValid)return"no intersections found";var t=this._segInt.getIntersectionSegments();return"found non-noded intersection between "+na.toLineString(t[0],t[1])+" and "+na.toLineString(t[2],t[3])};la.prototype.interfaces_=function(){return[]};la.prototype.getClass=function(){return la};la.computeIntersections=function(t){var e=new la(t);return e.setFindAllIntersections(!0),e.isValid(),e.getIntersections()};var yc=function t(){this._nv=null;var e=arguments[0];this._nv=new la(t.toSegmentStrings(e))};yc.prototype.checkValid=function(){this._nv.checkValid()};yc.prototype.interfaces_=function(){return[]};yc.prototype.getClass=function(){return yc};yc.toSegmentStrings=function(t){for(var e=new se,n=t.iterator();n.hasNext();){var o=n.next();e.add(new ja(o.getCoordinates(),o))}return e};yc.checkValid=function(t){var e=new yc(t);e.checkValid()};var nh=function(t){this._mapOp=t};nh.prototype.map=function(t){for(var e=this,n=new se,o=0;o<t.getNumGeometries();o++){var l=e._mapOp.map(t.getGeometryN(o));l.isEmpty()||n.add(l)}return t.getFactory().createGeometryCollection(gn.toGeometryArray(n))};nh.prototype.interfaces_=function(){return[]};nh.prototype.getClass=function(){return nh};nh.map=function(t,e){var n=new nh(e);return n.map(t)};var qa=function(){this._op=null,this._geometryFactory=null,this._ptLocator=null,this._lineEdgesList=new se,this._resultLineList=new se;var t=arguments[0],e=arguments[1],n=arguments[2];this._op=t,this._geometryFactory=e,this._ptLocator=n};qa.prototype.collectLines=function(t){for(var e=this,n=this._op.getGraph().getEdgeEnds().iterator();n.hasNext();){var o=n.next();e.collectLineEdge(o,t,e._lineEdgesList),e.collectBoundaryTouchEdge(o,t,e._lineEdgesList)}};qa.prototype.labelIsolatedLine=function(t,e){var n=this._ptLocator.locate(t.getCoordinate(),this._op.getArgGeometry(e));t.getLabel().setLocation(e,n)};qa.prototype.build=function(t){return this.findCoveredLineEdges(),this.collectLines(t),this.buildLines(t),this._resultLineList};qa.prototype.collectLineEdge=function(t,e,n){var o=t.getLabel(),l=t.getEdge();t.isLineEdge()&&!t.isVisited()&&rn.isResultOfOp(o,e)&&!l.isCovered()&&(n.add(l),t.setVisitedEdge(!0))};qa.prototype.findCoveredLineEdges=function(){for(var t=this,e=this._op.getGraph().getNodes().iterator();e.hasNext();){var n=e.next();n.getEdges().findCoveredLineEdges()}for(var o=this._op.getGraph().getEdgeEnds().iterator();o.hasNext();){var l=o.next(),h=l.getEdge();if(l.isLineEdge()&&!h.isCoveredSet()){var _=t._op.isCoveredByA(l.getCoordinate());h.setCovered(_)}}};qa.prototype.labelIsolatedLines=function(t){for(var e=this,n=t.iterator();n.hasNext();){var o=n.next(),l=o.getLabel();o.isIsolated()&&(l.isNull(0)?e.labelIsolatedLine(o,0):e.labelIsolatedLine(o,1))}};qa.prototype.buildLines=function(t){for(var e=this,n=this._lineEdgesList.iterator();n.hasNext();){var o=n.next(),l=e._geometryFactory.createLineString(o.getCoordinates());e._resultLineList.add(l),o.setInResult(!0)}};qa.prototype.collectBoundaryTouchEdge=function(t,e,n){var o=t.getLabel();if(t.isLineEdge()||t.isVisited()||t.isInteriorAreaEdge()||t.getEdge().isInResult())return null;cn.isTrue(!(t.isInResult()||t.getSym().isInResult())||!t.getEdge().isInResult()),rn.isResultOfOp(o,e)&&e===rn.INTERSECTION&&(n.add(t.getEdge()),t.setVisitedEdge(!0))};qa.prototype.interfaces_=function(){return[]};qa.prototype.getClass=function(){return qa};var rh=function(){this._op=null,this._geometryFactory=null,this._resultPointList=new se;var t=arguments[0],e=arguments[1];this._op=t,this._geometryFactory=e};rh.prototype.filterCoveredNodeToPoint=function(t){var e=t.getCoordinate();if(!this._op.isCoveredByLA(e)){var n=this._geometryFactory.createPoint(e);this._resultPointList.add(n)}};rh.prototype.extractNonCoveredResultNodes=function(t){for(var e=this,n=this._op.getGraph().getNodes().iterator();n.hasNext();){var o=n.next();if(!o.isInResult()&&!o.isIncidentEdgeInResult()&&(o.getEdges().getDegree()===0||t===rn.INTERSECTION)){var l=o.getLabel();rn.isResultOfOp(l,t)&&e.filterCoveredNodeToPoint(o)}}};rh.prototype.build=function(t){return this.extractNonCoveredResultNodes(t),this._resultPointList};rh.prototype.interfaces_=function(){return[]};rh.prototype.getClass=function(){return rh};var Bo=function(){this._inputGeom=null,this._factory=null,this._pruneEmptyGeometry=!0,this._preserveGeometryCollectionType=!0,this._preserveCollections=!1,this._preserveType=!1};Bo.prototype.transformPoint=function(t,e){return this._factory.createPoint(this.transformCoordinates(t.getCoordinateSequence(),t))};Bo.prototype.transformPolygon=function(t,e){var n=this,o=!0,l=this.transformLinearRing(t.getExteriorRing(),t);(l===null||!(l instanceof ml)||l.isEmpty())&&(o=!1);for(var h=new se,_=0;_<t.getNumInteriorRing();_++){var u=n.transformLinearRing(t.getInteriorRingN(_),t);u===null||u.isEmpty()||(u instanceof ml||(o=!1),h.add(u))}if(o)return this._factory.createPolygon(l,h.toArray([]));var I=new se;return l!==null&&I.add(l),I.addAll(h),this._factory.buildGeometry(I)};Bo.prototype.createCoordinateSequence=function(t){return this._factory.getCoordinateSequenceFactory().create(t)};Bo.prototype.getInputGeometry=function(){return this._inputGeom};Bo.prototype.transformMultiLineString=function(t,e){for(var n=this,o=new se,l=0;l<t.getNumGeometries();l++){var h=n.transformLineString(t.getGeometryN(l),t);h!==null&&(h.isEmpty()||o.add(h))}return this._factory.buildGeometry(o)};Bo.prototype.transformCoordinates=function(t,e){return this.copy(t)};Bo.prototype.transformLineString=function(t,e){return this._factory.createLineString(this.transformCoordinates(t.getCoordinateSequence(),t))};Bo.prototype.transformMultiPoint=function(t,e){for(var n=this,o=new se,l=0;l<t.getNumGeometries();l++){var h=n.transformPoint(t.getGeometryN(l),t);h!==null&&(h.isEmpty()||o.add(h))}return this._factory.buildGeometry(o)};Bo.prototype.transformMultiPolygon=function(t,e){for(var n=this,o=new se,l=0;l<t.getNumGeometries();l++){var h=n.transformPolygon(t.getGeometryN(l),t);h!==null&&(h.isEmpty()||o.add(h))}return this._factory.buildGeometry(o)};Bo.prototype.copy=function(t){return t.copy()};Bo.prototype.transformGeometryCollection=function(t,e){for(var n=this,o=new se,l=0;l<t.getNumGeometries();l++){var h=n.transform(t.getGeometryN(l));h!==null&&(n._pruneEmptyGeometry&&h.isEmpty()||o.add(h))}return this._preserveGeometryCollectionType?this._factory.createGeometryCollection(gn.toGeometryArray(o)):this._factory.buildGeometry(o)};Bo.prototype.transform=function(t){if(this._inputGeom=t,this._factory=t.getFactory(),t instanceof Qo)return this.transformPoint(t,null);if(t instanceof up)return this.transformMultiPoint(t,null);if(t instanceof ml)return this.transformLinearRing(t,null);if(t instanceof Fr)return this.transformLineString(t,null);if(t instanceof pc)return this.transformMultiLineString(t,null);if(t instanceof di)return this.transformPolygon(t,null);if(t instanceof fl)return this.transformMultiPolygon(t,null);if(t instanceof Eo)return this.transformGeometryCollection(t,null);throw new Ir("Unknown Geometry subtype: "+t.getClass().getName())};Bo.prototype.transformLinearRing=function(t,e){var n=this.transformCoordinates(t.getCoordinateSequence(),t);if(n===null)return this._factory.createLinearRing(null);var o=n.size();return o>0&&o<4&&!this._preserveType?this._factory.createLineString(n):this._factory.createLinearRing(n)};Bo.prototype.interfaces_=function(){return[]};Bo.prototype.getClass=function(){return Bo};var bl=function t(){if(this._snapTolerance=0,this._srcPts=null,this._seg=new Re,this._allowSnappingToSourceVertices=!1,this._isClosed=!1,arguments[0]instanceof Fr&&typeof arguments[1]=="number"){var e=arguments[0],n=arguments[1];t.call(this,e.getCoordinates(),n)}else if(arguments[0]instanceof Array&&typeof arguments[1]=="number"){var o=arguments[0],l=arguments[1];this._srcPts=o,this._isClosed=t.isClosed(o),this._snapTolerance=l}};bl.prototype.snapVertices=function(t,e){for(var n=this,o=this._isClosed?t.size()-1:t.size(),l=0;l<o;l++){var h=t.get(l),_=n.findSnapForVertex(h,e);_!==null&&(t.set(l,new It(_)),l===0&&n._isClosed&&t.set(t.size()-1,new It(_)))}};bl.prototype.findSnapForVertex=function(t,e){for(var n=this,o=0;o<e.length;o++){if(t.equals2D(e[o]))return null;if(t.distance(e[o])<n._snapTolerance)return e[o]}return null};bl.prototype.snapTo=function(t){var e=new Zf(this._srcPts);this.snapVertices(e,t),this.snapSegments(e,t);var n=e.toCoordinateArray();return n};bl.prototype.snapSegments=function(t,e){var n=this;if(e.length===0)return null;var o=e.length;e[0].equals2D(e[e.length-1])&&(o=e.length-1);for(var l=0;l<o;l++){var h=e[l],_=n.findSegmentIndexToSnap(h,t);_>=0&&t.add(_+1,new It(h),!1)}};bl.prototype.findSegmentIndexToSnap=function(t,e){for(var n=this,o=Je.MAX_VALUE,l=-1,h=0;h<e.size()-1;h++){if(n._seg.p0=e.get(h),n._seg.p1=e.get(h+1),n._seg.p0.equals2D(t)||n._seg.p1.equals2D(t)){if(n._allowSnappingToSourceVertices)continue;return-1}var _=n._seg.distance(t);_<n._snapTolerance&&_<o&&(o=_,l=h)}return l};bl.prototype.setAllowSnappingToSourceVertices=function(t){this._allowSnappingToSourceVertices=t};bl.prototype.interfaces_=function(){return[]};bl.prototype.getClass=function(){return bl};bl.isClosed=function(t){return t.length<=1?!1:t[0].equals2D(t[t.length-1])};var Hr=function(t){this._srcGeom=t||null},Gv={SNAP_PRECISION_FACTOR:{configurable:!0}};Hr.prototype.snapTo=function(t,e){var n=this.extractTargetCoordinates(t),o=new jv(e,n);return o.transform(this._srcGeom)};Hr.prototype.snapToSelf=function(t,e){var n=this.extractTargetCoordinates(this._srcGeom),o=new jv(t,n,!0),l=o.transform(this._srcGeom),h=l;return e&&qe(h,Su)&&(h=l.buffer(0)),h};Hr.prototype.computeSnapTolerance=function(t){var e=this.computeMinimumSegmentLength(t),n=e/10;return n};Hr.prototype.extractTargetCoordinates=function(t){for(var e=new Oa,n=t.getCoordinates(),o=0;o<n.length;o++)e.add(n[o]);return e.toArray(new Array(0).fill(null))};Hr.prototype.computeMinimumSegmentLength=function(t){for(var e=Je.MAX_VALUE,n=0;n<t.length-1;n++){var o=t[n].distance(t[n+1]);o<e&&(e=o)}return e};Hr.prototype.interfaces_=function(){return[]};Hr.prototype.getClass=function(){return Hr};Hr.snap=function(t,e,n){var o=new Array(2).fill(null),l=new Hr(t);o[0]=l.snapTo(e,n);var h=new Hr(e);return o[1]=h.snapTo(o[0],n),o};Hr.computeOverlaySnapTolerance=function(){if(arguments.length===1){var t=arguments[0],e=Hr.computeSizeBasedSnapTolerance(t),n=t.getPrecisionModel();if(n.getType()===On.FIXED){var o=1/n.getScale()*2/1.415;o>e&&(e=o)}return e}else if(arguments.length===2){var l=arguments[0],h=arguments[1];return Math.min(Hr.computeOverlaySnapTolerance(l),Hr.computeOverlaySnapTolerance(h))}};Hr.computeSizeBasedSnapTolerance=function(t){var e=t.getEnvelopeInternal(),n=Math.min(e.getHeight(),e.getWidth()),o=n*Hr.SNAP_PRECISION_FACTOR;return o};Hr.snapToSelf=function(t,e,n){var o=new Hr(t);return o.snapToSelf(e,n)};Gv.SNAP_PRECISION_FACTOR.get=function(){return 1e-9};Object.defineProperties(Hr,Gv);var jv=function(t){function e(n,o,l){t.call(this),this._snapTolerance=n||null,this._snapPts=o||null,this._isSelfSnap=l!==void 0?l:!1}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.snapLine=function(n,o){var l=new bl(n,this._snapTolerance);return l.setAllowSnappingToSourceVertices(this._isSelfSnap),l.snapTo(o)},e.prototype.transformCoordinates=function(n,o){var l=n.toCoordinateArray(),h=this.snapLine(l,this._snapPts);return this._factory.getCoordinateSequenceFactory().create(h)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Bo),_o=function(){this._isFirst=!0,this._commonMantissaBitsCount=53,this._commonBits=0,this._commonSignExp=null};_o.prototype.getCommon=function(){return Je.longBitsToDouble(this._commonBits)};_o.prototype.add=function(t){var e=Je.doubleToLongBits(t);if(this._isFirst)return this._commonBits=e,this._commonSignExp=_o.signExpBits(this._commonBits),this._isFirst=!1,null;var n=_o.signExpBits(e);if(n!==this._commonSignExp)return this._commonBits=0,null;this._commonMantissaBitsCount=_o.numCommonMostSigMantissaBits(this._commonBits,e),this._commonBits=_o.zeroLowerBits(this._commonBits,64-(12+this._commonMantissaBitsCount))};_o.prototype.toString=function(){if(arguments.length===1){var t=arguments[0],e=Je.longBitsToDouble(t),n=Je.toBinaryString(t),o="0000000000000000000000000000000000000000000000000000000000000000"+n,l=o.substring(o.length-64),h=l.substring(0,1)+"  "+l.substring(1,12)+"(exp) "+l.substring(12)+" [ "+e+" ]";return h}};_o.prototype.interfaces_=function(){return[]};_o.prototype.getClass=function(){return _o};_o.getBit=function(t,e){var n=1<<e;return t&n?1:0};_o.signExpBits=function(t){return t>>52};_o.zeroLowerBits=function(t,e){var n=(1<<e)-1,o=~n,l=t&o;return l};_o.numCommonMostSigMantissaBits=function(t,e){for(var n=0,o=52;o>=0;o--){if(_o.getBit(t,o)!==_o.getBit(e,o))return n;n++}return 52};var Du=function(){this._commonCoord=null,this._ccFilter=new ih},d_={CommonCoordinateFilter:{configurable:!0},Translater:{configurable:!0}};Du.prototype.addCommonBits=function(t){var e=new ku(this._commonCoord);t.apply(e),t.geometryChanged()};Du.prototype.removeCommonBits=function(t){if(this._commonCoord.x===0&&this._commonCoord.y===0)return t;var e=new It(this._commonCoord);e.x=-e.x,e.y=-e.y;var n=new ku(e);return t.apply(n),t.geometryChanged(),t};Du.prototype.getCommonCoordinate=function(){return this._commonCoord};Du.prototype.add=function(t){t.apply(this._ccFilter),this._commonCoord=this._ccFilter.getCommonCoordinate()};Du.prototype.interfaces_=function(){return[]};Du.prototype.getClass=function(){return Du};d_.CommonCoordinateFilter.get=function(){return ih};d_.Translater.get=function(){return ku};Object.defineProperties(Du,d_);var ih=function(){this._commonBitsX=new _o,this._commonBitsY=new _o};ih.prototype.filter=function(t){this._commonBitsX.add(t.x),this._commonBitsY.add(t.y)};ih.prototype.getCommonCoordinate=function(){return new It(this._commonBitsX.getCommon(),this._commonBitsY.getCommon())};ih.prototype.interfaces_=function(){return[gl]};ih.prototype.getClass=function(){return ih};var ku=function(){this.trans=null;var t=arguments[0];this.trans=t};ku.prototype.filter=function(t,e){var n=t.getOrdinate(e,0)+this.trans.x,o=t.getOrdinate(e,1)+this.trans.y;t.setOrdinate(e,0,n),t.setOrdinate(e,1,o)};ku.prototype.isDone=function(){return!1};ku.prototype.isGeometryChanged=function(){return!0};ku.prototype.interfaces_=function(){return[ra]};ku.prototype.getClass=function(){return ku};var ki=function(t,e){this._geom=new Array(2).fill(null),this._snapTolerance=null,this._cbr=null,this._geom[0]=t,this._geom[1]=e,this.computeSnapTolerance()};ki.prototype.selfSnap=function(t){var e=new Hr(t),n=e.snapTo(t,this._snapTolerance);return n};ki.prototype.removeCommonBits=function(t){this._cbr=new Du,this._cbr.add(t[0]),this._cbr.add(t[1]);var e=new Array(2).fill(null);return e[0]=this._cbr.removeCommonBits(t[0].copy()),e[1]=this._cbr.removeCommonBits(t[1].copy()),e};ki.prototype.prepareResult=function(t){return this._cbr.addCommonBits(t),t};ki.prototype.getResultGeometry=function(t){var e=this.snap(this._geom),n=rn.overlayOp(e[0],e[1],t);return this.prepareResult(n)};ki.prototype.checkValid=function(t){t.isValid()||Yi.out.println("Snapped geometry is invalid")};ki.prototype.computeSnapTolerance=function(){this._snapTolerance=Hr.computeOverlaySnapTolerance(this._geom[0],this._geom[1])};ki.prototype.snap=function(t){var e=this.removeCommonBits(t),n=Hr.snap(e[0],e[1],this._snapTolerance);return n};ki.prototype.interfaces_=function(){return[]};ki.prototype.getClass=function(){return ki};ki.overlayOp=function(t,e,n){var o=new ki(t,e);return o.getResultGeometry(n)};ki.union=function(t,e){return ki.overlayOp(t,e,rn.UNION)};ki.intersection=function(t,e){return ki.overlayOp(t,e,rn.INTERSECTION)};ki.symDifference=function(t,e){return ki.overlayOp(t,e,rn.SYMDIFFERENCE)};ki.difference=function(t,e){return ki.overlayOp(t,e,rn.DIFFERENCE)};var To=function(t,e){this._geom=new Array(2).fill(null),this._geom[0]=t,this._geom[1]=e};To.prototype.getResultGeometry=function(t){var e=null,n=!1,o=null;try{e=rn.overlayOp(this._geom[0],this._geom[1],t);var l=!0;l&&(n=!0)}catch(h){if(h instanceof Zl)o=h;else throw h}finally{}if(!n)try{e=ki.overlayOp(this._geom[0],this._geom[1],t)}catch(h){throw h instanceof Zl?o:h}finally{}return e};To.prototype.interfaces_=function(){return[]};To.prototype.getClass=function(){return To};To.overlayOp=function(t,e,n){var o=new To(t,e);return o.getResultGeometry(n)};To.union=function(t,e){return To.overlayOp(t,e,rn.UNION)};To.intersection=function(t,e){return To.overlayOp(t,e,rn.INTERSECTION)};To.symDifference=function(t,e){return To.overlayOp(t,e,rn.SYMDIFFERENCE)};To.difference=function(t,e){return To.overlayOp(t,e,rn.DIFFERENCE)};var Uf=function(){this.mce=null,this.chainIndex=null;var t=arguments[0],e=arguments[1];this.mce=t,this.chainIndex=e};Uf.prototype.computeIntersections=function(t,e){this.mce.computeIntersectsForChain(this.chainIndex,t.mce,t.chainIndex,e)};Uf.prototype.interfaces_=function(){return[]};Uf.prototype.getClass=function(){return Uf};var ns=function t(){if(this._label=null,this._xValue=null,this._eventType=null,this._insertEvent=null,this._deleteEventIndex=null,this._obj=null,arguments.length===2){var e=arguments[0],n=arguments[1];this._eventType=t.DELETE,this._xValue=e,this._insertEvent=n}else if(arguments.length===3){var o=arguments[0],l=arguments[1],h=arguments[2];this._eventType=t.INSERT,this._label=o,this._xValue=l,this._obj=h}},g_={INSERT:{configurable:!0},DELETE:{configurable:!0}};ns.prototype.isDelete=function(){return this._eventType===ns.DELETE};ns.prototype.setDeleteEventIndex=function(t){this._deleteEventIndex=t};ns.prototype.getObject=function(){return this._obj};ns.prototype.compareTo=function(t){var e=t;return this._xValue<e._xValue?-1:this._xValue>e._xValue?1:this._eventType<e._eventType?-1:this._eventType>e._eventType?1:0};ns.prototype.getInsertEvent=function(){return this._insertEvent};ns.prototype.isInsert=function(){return this._eventType===ns.INSERT};ns.prototype.isSameLabel=function(t){return this._label===null?!1:this._label===t._label};ns.prototype.getDeleteEventIndex=function(){return this._deleteEventIndex};ns.prototype.interfaces_=function(){return[Vs]};ns.prototype.getClass=function(){return ns};g_.INSERT.get=function(){return 1};g_.DELETE.get=function(){return 2};Object.defineProperties(ns,g_);var Kd=function(){};Kd.prototype.interfaces_=function(){return[]};Kd.prototype.getClass=function(){return Kd};var $i=function(){this._hasIntersection=!1,this._hasProper=!1,this._hasProperInterior=!1,this._properIntersectionPoint=null,this._li=null,this._includeProper=null,this._recordIsolated=null,this._isSelfIntersection=null,this._numIntersections=0,this.numTests=0,this._bdyNodes=null,this._isDone=!1,this._isDoneWhenProperInt=!1;var t=arguments[0],e=arguments[1],n=arguments[2];this._li=t,this._includeProper=e,this._recordIsolated=n};$i.prototype.isTrivialIntersection=function(t,e,n,o){if(t===n&&this._li.getIntersectionNum()===1){if($i.isAdjacentSegments(e,o))return!0;if(t.isClosed()){var l=t.getNumPoints()-1;if(e===0&&o===l||o===0&&e===l)return!0}}return!1};$i.prototype.getProperIntersectionPoint=function(){return this._properIntersectionPoint};$i.prototype.setIsDoneIfProperInt=function(t){this._isDoneWhenProperInt=t};$i.prototype.hasProperInteriorIntersection=function(){return this._hasProperInterior};$i.prototype.isBoundaryPointInternal=function(t,e){for(var n=e.iterator();n.hasNext();){var o=n.next(),l=o.getCoordinate();if(t.isIntersection(l))return!0}return!1};$i.prototype.hasProperIntersection=function(){return this._hasProper};$i.prototype.hasIntersection=function(){return this._hasIntersection};$i.prototype.isDone=function(){return this._isDone};$i.prototype.isBoundaryPoint=function(t,e){return e===null?!1:!!(this.isBoundaryPointInternal(t,e[0])||this.isBoundaryPointInternal(t,e[1]))};$i.prototype.setBoundaryNodes=function(t,e){this._bdyNodes=new Array(2).fill(null),this._bdyNodes[0]=t,this._bdyNodes[1]=e};$i.prototype.addIntersections=function(t,e,n,o){if(t===n&&e===o)return null;this.numTests++;var l=t.getCoordinates()[e],h=t.getCoordinates()[e+1],_=n.getCoordinates()[o],u=n.getCoordinates()[o+1];this._li.computeIntersection(l,h,_,u),this._li.hasIntersection()&&(this._recordIsolated&&(t.setIsolated(!1),n.setIsolated(!1)),this._numIntersections++,this.isTrivialIntersection(t,e,n,o)||(this._hasIntersection=!0,(this._includeProper||!this._li.isProper())&&(t.addIntersections(this._li,e,0),n.addIntersections(this._li,o,1)),this._li.isProper()&&(this._properIntersectionPoint=this._li.getIntersection(0).copy(),this._hasProper=!0,this._isDoneWhenProperInt&&(this._isDone=!0),this.isBoundaryPoint(this._li,this._bdyNodes)||(this._hasProperInterior=!0))))};$i.prototype.interfaces_=function(){return[]};$i.prototype.getClass=function(){return $i};$i.isAdjacentSegments=function(t,e){return Math.abs(t-e)===1};var Fw=function(t){function e(){t.call(this),this.events=new se,this.nOverlaps=null}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.prepareEvents=function(){var n=this;oa.sort(this.events);for(var o=0;o<this.events.size();o++){var l=n.events.get(o);l.isDelete()&&l.getInsertEvent().setDeleteEventIndex(o)}},e.prototype.computeIntersections=function(){var n=this;if(arguments.length===1){var o=arguments[0];this.nOverlaps=0,this.prepareEvents();for(var l=0;l<this.events.size();l++){var h=n.events.get(l);if(h.isInsert()&&n.processOverlaps(l,h.getDeleteEventIndex(),h,o),o.isDone())break}}else if(arguments.length===3){if(arguments[2]instanceof $i&&qe(arguments[0],ea)&&qe(arguments[1],ea)){var _=arguments[0],u=arguments[1],I=arguments[2];this.addEdges(_,_),this.addEdges(u,u),this.computeIntersections(I)}else if(typeof arguments[2]=="boolean"&&qe(arguments[0],ea)&&arguments[1]instanceof $i){var w=arguments[0],D=arguments[1],k=arguments[2];k?this.addEdges(w,null):this.addEdges(w),this.computeIntersections(D)}}},e.prototype.addEdge=function(n,o){for(var l=this,h=n.getMonotoneChainEdge(),_=h.getStartIndexes(),u=0;u<_.length-1;u++){var I=new Uf(h,u),w=new ns(o,h.getMinX(u),I);l.events.add(w),l.events.add(new ns(h.getMaxX(u),w))}},e.prototype.processOverlaps=function(n,o,l,h){for(var _=this,u=l.getObject(),I=n;I<o;I++){var w=_.events.get(I);if(w.isInsert()){var D=w.getObject();l.isSameLabel(w)||(u.computeIntersections(D,h),_.nOverlaps++)}}},e.prototype.addEdges=function(){var n=this;if(arguments.length===1)for(var o=arguments[0],l=o.iterator();l.hasNext();){var h=l.next();n.addEdge(h,h)}else if(arguments.length===2)for(var _=arguments[0],u=arguments[1],I=_.iterator();I.hasNext();){var w=I.next();n.addEdge(w,u)}},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(Kd),wl=function(){this._min=Je.POSITIVE_INFINITY,this._max=Je.NEGATIVE_INFINITY},qv={NodeComparator:{configurable:!0}};wl.prototype.getMin=function(){return this._min};wl.prototype.intersects=function(t,e){return!(this._min>e||this._max<t)};wl.prototype.getMax=function(){return this._max};wl.prototype.toString=function(){return na.toLineString(new It(this._min,0),new It(this._max,0))};wl.prototype.interfaces_=function(){return[]};wl.prototype.getClass=function(){return wl};qv.NodeComparator.get=function(){return Vf};Object.defineProperties(wl,qv);var Vf=function(){};Vf.prototype.compare=function(t,e){var n=t,o=e,l=(n._min+n._max)/2,h=(o._min+o._max)/2;return l<h?-1:l>h?1:0};Vf.prototype.interfaces_=function(){return[np]};Vf.prototype.getClass=function(){return Vf};var Bw=function(t){function e(){t.call(this),this._item=null;var n=arguments[0],o=arguments[1],l=arguments[2];this._min=n,this._max=o,this._item=l}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.query=function(n,o,l){if(!this.intersects(n,o))return null;l.visitItem(this._item)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(wl),Uw=function(t){function e(){t.call(this),this._node1=null,this._node2=null;var n=arguments[0],o=arguments[1];this._node1=n,this._node2=o,this.buildExtent(this._node1,this._node2)}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.buildExtent=function(n,o){this._min=Math.min(n._min,o._min),this._max=Math.max(n._max,o._max)},e.prototype.query=function(n,o,l){if(!this.intersects(n,o))return null;this._node1!==null&&this._node1.query(n,o,l),this._node2!==null&&this._node2.query(n,o,l)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(wl),El=function(){this._leaves=new se,this._root=null,this._level=0};El.prototype.buildTree=function(){var t=this;oa.sort(this._leaves,new wl.NodeComparator);for(var e=this._leaves,n=null,o=new se;;){if(t.buildLevel(e,o),o.size()===1)return o.get(0);n=e,e=o,o=n}};El.prototype.insert=function(t,e,n){if(this._root!==null)throw new Error("Index cannot be added to once it has been queried");this._leaves.add(new Bw(t,e,n))};El.prototype.query=function(t,e,n){this.init(),this._root.query(t,e,n)};El.prototype.buildRoot=function(){if(this._root!==null)return null;this._root=this.buildTree()};El.prototype.printNode=function(t){Yi.out.println(na.toLineString(new It(t._min,this._level),new It(t._max,this._level)))};El.prototype.init=function(){if(this._root!==null)return null;this.buildRoot()};El.prototype.buildLevel=function(t,e){this._level++,e.clear();for(var n=0;n<t.size();n+=2){var o=t.get(n),l=n+1<t.size()?t.get(n):null;if(l===null)e.add(o);else{var h=new Uw(t.get(n),t.get(n+1));e.add(h)}}};El.prototype.interfaces_=function(){return[]};El.prototype.getClass=function(){return El};var gp=function(){this._items=new se};gp.prototype.visitItem=function(t){this._items.add(t)};gp.prototype.getItems=function(){return this._items};gp.prototype.interfaces_=function(){return[Tu]};gp.prototype.getClass=function(){return gp};var mp=function(){this._index=null;var t=arguments[0];if(!qe(t,Su))throw new Ir("Argument must be Polygonal");this._index=new vc(t)},m_={SegmentVisitor:{configurable:!0},IntervalIndexedGeometry:{configurable:!0}};mp.prototype.locate=function(t){var e=new ka(t),n=new _p(e);return this._index.query(t.y,t.y,n),e.getLocation()};mp.prototype.interfaces_=function(){return[fp]};mp.prototype.getClass=function(){return mp};m_.SegmentVisitor.get=function(){return _p};m_.IntervalIndexedGeometry.get=function(){return vc};Object.defineProperties(mp,m_);var _p=function(){this._counter=null;var t=arguments[0];this._counter=t};_p.prototype.visitItem=function(t){var e=t;this._counter.countSegment(e.getCoordinate(0),e.getCoordinate(1))};_p.prototype.interfaces_=function(){return[Tu]};_p.prototype.getClass=function(){return _p};var vc=function(){this._index=new El;var t=arguments[0];this.init(t)};vc.prototype.init=function(t){for(var e=this,n=qi.getLines(t),o=n.iterator();o.hasNext();){var l=o.next(),h=l.getCoordinates();e.addLine(h)}};vc.prototype.addLine=function(t){for(var e=this,n=1;n<t.length;n++){var o=new Re(t[n-1],t[n]),l=Math.min(o.p0.y,o.p1.y),h=Math.max(o.p0.y,o.p1.y);e._index.insert(l,h,o)}};vc.prototype.query=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new gp;return this._index.query(t,e,n),n.getItems()}else if(arguments.length===3){var o=arguments[0],l=arguments[1],h=arguments[2];this._index.query(o,l,h)}};vc.prototype.interfaces_=function(){return[]};vc.prototype.getClass=function(){return vc};var pf=function(t){function e(){if(t.call(this),this._parentGeom=null,this._lineEdgeMap=new Cv,this._boundaryNodeRule=null,this._useBoundaryDeterminationRule=!0,this._argIndex=null,this._boundaryNodes=null,this._hasTooFewPoints=!1,this._invalidPoint=null,this._areaPtLocator=null,this._ptLocator=new aa,arguments.length===2){var n=arguments[0],o=arguments[1],l=Fs.OGC_SFS_BOUNDARY_RULE;this._argIndex=n,this._parentGeom=o,this._boundaryNodeRule=l,o!==null&&this.add(o)}else if(arguments.length===3){var h=arguments[0],_=arguments[1],u=arguments[2];this._argIndex=h,this._parentGeom=_,this._boundaryNodeRule=u,_!==null&&this.add(_)}}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertBoundaryPoint=function(n,o){var l=this._nodes.addNode(o),h=l.getLabel(),_=1,u=Mt.NONE;u=h.getLocation(n,Kt.ON),u===Mt.BOUNDARY&&_++;var I=e.determineBoundary(this._boundaryNodeRule,_);h.setLocation(n,I)},e.prototype.computeSelfNodes=function(){if(arguments.length===2){var n=arguments[0],o=arguments[1];return this.computeSelfNodes(n,o,!1)}else if(arguments.length===3){var l=arguments[0],h=arguments[1],_=arguments[2],u=new $i(l,!0,!1);u.setIsDoneIfProperInt(_);var I=this.createEdgeSetIntersector(),w=this._parentGeom instanceof ml||this._parentGeom instanceof di||this._parentGeom instanceof fl,D=h||!w;return I.computeIntersections(this._edges,u,D),this.addSelfIntersectionNodes(this._argIndex),u}},e.prototype.computeSplitEdges=function(n){for(var o=this._edges.iterator();o.hasNext();){var l=o.next();l.eiList.addSplitEdges(n)}},e.prototype.computeEdgeIntersections=function(n,o,l){var h=new $i(o,l,!0);h.setBoundaryNodes(this.getBoundaryNodes(),n.getBoundaryNodes());var _=this.createEdgeSetIntersector();return _.computeIntersections(this._edges,n._edges,h),h},e.prototype.getGeometry=function(){return this._parentGeom},e.prototype.getBoundaryNodeRule=function(){return this._boundaryNodeRule},e.prototype.hasTooFewPoints=function(){return this._hasTooFewPoints},e.prototype.addPoint=function(){if(arguments[0]instanceof Qo){var n=arguments[0],o=n.getCoordinate();this.insertPoint(this._argIndex,o,Mt.INTERIOR)}else if(arguments[0]instanceof It){var l=arguments[0];this.insertPoint(this._argIndex,l,Mt.INTERIOR)}},e.prototype.addPolygon=function(n){var o=this;this.addPolygonRing(n.getExteriorRing(),Mt.EXTERIOR,Mt.INTERIOR);for(var l=0;l<n.getNumInteriorRing();l++){var h=n.getInteriorRingN(l);o.addPolygonRing(h,Mt.INTERIOR,Mt.EXTERIOR)}},e.prototype.addEdge=function(n){this.insertEdge(n);var o=n.getCoordinates();this.insertPoint(this._argIndex,o[0],Mt.BOUNDARY),this.insertPoint(this._argIndex,o[o.length-1],Mt.BOUNDARY)},e.prototype.addLineString=function(n){var o=mn.removeRepeatedPoints(n.getCoordinates());if(o.length<2)return this._hasTooFewPoints=!0,this._invalidPoint=o[0],null;var l=new $d(o,new Zn(this._argIndex,Mt.INTERIOR));this._lineEdgeMap.put(n,l),this.insertEdge(l),cn.isTrue(o.length>=2,"found LineString with single point"),this.insertBoundaryPoint(this._argIndex,o[0]),this.insertBoundaryPoint(this._argIndex,o[o.length-1])},e.prototype.getInvalidPoint=function(){return this._invalidPoint},e.prototype.getBoundaryPoints=function(){for(var n=this.getBoundaryNodes(),o=new Array(n.size()).fill(null),l=0,h=n.iterator();h.hasNext();){var _=h.next();o[l++]=_.getCoordinate().copy()}return o},e.prototype.getBoundaryNodes=function(){return this._boundaryNodes===null&&(this._boundaryNodes=this._nodes.getBoundaryNodes(this._argIndex)),this._boundaryNodes},e.prototype.addSelfIntersectionNode=function(n,o,l){if(this.isBoundaryNode(n,o))return null;l===Mt.BOUNDARY&&this._useBoundaryDeterminationRule?this.insertBoundaryPoint(n,o):this.insertPoint(n,o,l)},e.prototype.addPolygonRing=function(n,o,l){if(n.isEmpty())return null;var h=mn.removeRepeatedPoints(n.getCoordinates());if(h.length<4)return this._hasTooFewPoints=!0,this._invalidPoint=h[0],null;var _=o,u=l;ge.isCCW(h)&&(_=l,u=o);var I=new $d(h,new Zn(this._argIndex,Mt.BOUNDARY,_,u));this._lineEdgeMap.put(n,I),this.insertEdge(I),this.insertPoint(this._argIndex,h[0],Mt.BOUNDARY)},e.prototype.insertPoint=function(n,o,l){var h=this._nodes.addNode(o),_=h.getLabel();_===null?h._label=new Zn(n,l):_.setLocation(n,l)},e.prototype.createEdgeSetIntersector=function(){return new Fw},e.prototype.addSelfIntersectionNodes=function(n){for(var o=this,l=this._edges.iterator();l.hasNext();)for(var h=l.next(),_=h.getLabel().getLocation(n),u=h.eiList.iterator();u.hasNext();){var I=u.next();o.addSelfIntersectionNode(n,I.coord,_)}},e.prototype.add=function(){if(arguments.length===1){var n=arguments[0];if(n.isEmpty())return null;if(n instanceof fl&&(this._useBoundaryDeterminationRule=!1),n instanceof di)this.addPolygon(n);else if(n instanceof Fr)this.addLineString(n);else if(n instanceof Qo)this.addPoint(n);else if(n instanceof up)this.addCollection(n);else if(n instanceof pc)this.addCollection(n);else if(n instanceof fl)this.addCollection(n);else if(n instanceof Eo)this.addCollection(n);else throw new Error(n.getClass().getName())}else return t.prototype.add.apply(this,arguments)},e.prototype.addCollection=function(n){for(var o=this,l=0;l<n.getNumGeometries();l++){var h=n.getGeometryN(l);o.add(h)}},e.prototype.locate=function(n){return qe(this._parentGeom,Su)&&this._parentGeom.getNumGeometries()>50?(this._areaPtLocator===null&&(this._areaPtLocator=new mp(this._parentGeom)),this._areaPtLocator.locate(n)):this._ptLocator.locate(n,this._parentGeom)},e.prototype.findEdge=function(){if(arguments.length===1){var n=arguments[0];return this._lineEdgeMap.get(n)}else return t.prototype.findEdge.apply(this,arguments)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e.determineBoundary=function(n,o){return n.isInBoundary(o)?Mt.BOUNDARY:Mt.INTERIOR},e}(kr),yp=function(){if(this._li=new bc,this._resultPrecisionModel=null,this._arg=null,arguments.length===1){var t=arguments[0];this.setComputationPrecision(t.getPrecisionModel()),this._arg=new Array(1).fill(null),this._arg[0]=new pf(0,t)}else if(arguments.length===2){var e=arguments[0],n=arguments[1],o=Fs.OGC_SFS_BOUNDARY_RULE;e.getPrecisionModel().compareTo(n.getPrecisionModel())>=0?this.setComputationPrecision(e.getPrecisionModel()):this.setComputationPrecision(n.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new pf(0,e,o),this._arg[1]=new pf(1,n,o)}else if(arguments.length===3){var l=arguments[0],h=arguments[1],_=arguments[2];l.getPrecisionModel().compareTo(h.getPrecisionModel())>=0?this.setComputationPrecision(l.getPrecisionModel()):this.setComputationPrecision(h.getPrecisionModel()),this._arg=new Array(2).fill(null),this._arg[0]=new pf(0,l,_),this._arg[1]=new pf(1,h,_)}};yp.prototype.getArgGeometry=function(t){return this._arg[t].getGeometry()};yp.prototype.setComputationPrecision=function(t){this._resultPrecisionModel=t,this._li.setPrecisionModel(this._resultPrecisionModel)};yp.prototype.interfaces_=function(){return[]};yp.prototype.getClass=function(){return yp};var uc=function(){};uc.prototype.interfaces_=function(){return[]};uc.prototype.getClass=function(){return uc};uc.map=function(){if(arguments[0]instanceof Ge&&qe(arguments[1],uc.MapOp)){for(var t=arguments[0],e=arguments[1],n=new se,o=0;o<t.getNumGeometries();o++){var l=e.map(t.getGeometryN(o));l!==null&&n.add(l)}return t.getFactory().buildGeometry(n)}else if(qe(arguments[0],ci)&&qe(arguments[1],uc.MapOp)){for(var h=arguments[0],_=arguments[1],u=new se,I=h.iterator();I.hasNext();){var w=I.next(),D=_.map(w);D!==null&&u.add(D)}return u}};uc.MapOp=function(){};var rn=function(t){function e(){var n=arguments[0],o=arguments[1];t.call(this,n,o),this._ptLocator=new aa,this._geomFact=null,this._resultGeom=null,this._graph=null,this._edgeList=new sa,this._resultPolyList=new se,this._resultLineList=new se,this._resultPointList=new se,this._graph=new kr(new Rv),this._geomFact=n.getFactory()}return t&&(e.__proto__=t),e.prototype=Object.create(t&&t.prototype),e.prototype.constructor=e,e.prototype.insertUniqueEdge=function(n){var o=this._edgeList.findEqualEdge(n);if(o!==null){var l=o.getLabel(),h=n.getLabel();o.isPointwiseEqual(n)||(h=new Zn(n.getLabel()),h.flip());var _=o.getDepth();_.isNull()&&_.add(l),_.add(h),l.merge(h)}else this._edgeList.add(n)},e.prototype.getGraph=function(){return this._graph},e.prototype.cancelDuplicateResultEdges=function(){for(var n=this._graph.getEdgeEnds().iterator();n.hasNext();){var o=n.next(),l=o.getSym();o.isInResult()&&l.isInResult()&&(o.setInResult(!1),l.setInResult(!1))}},e.prototype.isCoveredByLA=function(n){return!!(this.isCovered(n,this._resultLineList)||this.isCovered(n,this._resultPolyList))},e.prototype.computeGeometry=function(n,o,l,h){var _=new se;return _.addAll(n),_.addAll(o),_.addAll(l),_.isEmpty()?e.createEmptyResult(h,this._arg[0].getGeometry(),this._arg[1].getGeometry(),this._geomFact):this._geomFact.buildGeometry(_)},e.prototype.mergeSymLabels=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var o=n.next();o.getEdges().mergeSymLabels()}},e.prototype.isCovered=function(n,o){for(var l=this,h=o.iterator();h.hasNext();){var _=h.next(),u=l._ptLocator.locate(n,_);if(u!==Mt.EXTERIOR)return!0}return!1},e.prototype.replaceCollapsedEdges=function(){for(var n=new se,o=this._edgeList.iterator();o.hasNext();){var l=o.next();l.isCollapsed()&&(o.remove(),n.add(l.getCollapsedEdge()))}this._edgeList.addAll(n)},e.prototype.updateNodeLabelling=function(){for(var n=this._graph.getNodes().iterator();n.hasNext();){var o=n.next(),l=o.getEdges().getLabel();o.getLabel().merge(l)}},e.prototype.getResultGeometry=function(n){return this.computeOverlay(n),this._resultGeom},e.prototype.insertUniqueEdges=function(n){for(var o=this,l=n.iterator();l.hasNext();){var h=l.next();o.insertUniqueEdge(h)}},e.prototype.computeOverlay=function(n){this.copyPoints(0),this.copyPoints(1),this._arg[0].computeSelfNodes(this._li,!1),this._arg[1].computeSelfNodes(this._li,!1),this._arg[0].computeEdgeIntersections(this._arg[1],this._li,!0);var o=new se;this._arg[0].computeSplitEdges(o),this._arg[1].computeSplitEdges(o),this.insertUniqueEdges(o),this.computeLabelsFromDepths(),this.replaceCollapsedEdges(),yc.checkValid(this._edgeList.getEdges()),this._graph.addEdges(this._edgeList.getEdges()),this.computeLabelling(),this.labelIncompleteNodes(),this.findResultAreaEdges(n),this.cancelDuplicateResultEdges();var l=new ts(this._geomFact);l.add(this._graph),this._resultPolyList=l.getPolygons();var h=new qa(this,this._geomFact,this._ptLocator);this._resultLineList=h.build(n);var _=new rh(this,this._geomFact,this._ptLocator);this._resultPointList=_.build(n),this._resultGeom=this.computeGeometry(this._resultPointList,this._resultLineList,this._resultPolyList,n)},e.prototype.labelIncompleteNode=function(n,o){var l=this._ptLocator.locate(n.getCoordinate(),this._arg[o].getGeometry());n.getLabel().setLocation(o,l)},e.prototype.copyPoints=function(n){for(var o=this,l=this._arg[n].getNodeIterator();l.hasNext();){var h=l.next(),_=o._graph.addNode(h.getCoordinate());_.setLabel(n,h.getLabel().getLocation(n))}},e.prototype.findResultAreaEdges=function(n){for(var o=this._graph.getEdgeEnds().iterator();o.hasNext();){var l=o.next(),h=l.getLabel();h.isArea()&&!l.isInteriorAreaEdge()&&e.isResultOfOp(h.getLocation(0,Kt.RIGHT),h.getLocation(1,Kt.RIGHT),n)&&l.setInResult(!0)}},e.prototype.computeLabelsFromDepths=function(){for(var n=this._edgeList.iterator();n.hasNext();){var o=n.next(),l=o.getLabel(),h=o.getDepth();if(!h.isNull()){h.normalize();for(var _=0;_<2;_++)!l.isNull(_)&&l.isArea()&&!h.isNull(_)&&(h.getDelta(_)===0?l.toLine(_):(cn.isTrue(!h.isNull(_,Kt.LEFT),"depth of LEFT side has not been initialized"),l.setLocation(_,Kt.LEFT,h.getLocation(_,Kt.LEFT)),cn.isTrue(!h.isNull(_,Kt.RIGHT),"depth of RIGHT side has not been initialized"),l.setLocation(_,Kt.RIGHT,h.getLocation(_,Kt.RIGHT))))}}},e.prototype.computeLabelling=function(){for(var n=this,o=this._graph.getNodes().iterator();o.hasNext();){var l=o.next();l.getEdges().computeLabelling(n._arg)}this.mergeSymLabels(),this.updateNodeLabelling()},e.prototype.labelIncompleteNodes=function(){for(var n=this,o=this._graph.getNodes().iterator();o.hasNext();){var l=o.next(),h=l.getLabel();l.isIsolated()&&(h.isNull(0)?n.labelIncompleteNode(l,0):n.labelIncompleteNode(l,1)),l.getEdges().updateLabelling(h)}},e.prototype.isCoveredByA=function(n){return!!this.isCovered(n,this._resultPolyList)},e.prototype.interfaces_=function(){return[]},e.prototype.getClass=function(){return e},e}(yp);rn.overlayOp=function(t,e,n){var o=new rn(t,e),l=o.getResultGeometry(n);return l};rn.intersection=function(t,e){if(t.isEmpty()||e.isEmpty())return rn.createEmptyResult(rn.INTERSECTION,t,e,t.getFactory());if(t.isGeometryCollection()){var n=e;return nh.map(t,{interfaces_:function(){return[uc.MapOp]},map:function(o){return o.intersection(n)}})}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),To.overlayOp(t,e,rn.INTERSECTION)};rn.symDifference=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return rn.createEmptyResult(rn.SYMDIFFERENCE,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),To.overlayOp(t,e,rn.SYMDIFFERENCE)};rn.resultDimension=function(t,e,n){var o=e.getDimension(),l=n.getDimension(),h=-1;switch(t){case rn.INTERSECTION:h=Math.min(o,l);break;case rn.UNION:h=Math.max(o,l);break;case rn.DIFFERENCE:h=o;break;case rn.SYMDIFFERENCE:h=Math.max(o,l);break}return h};rn.createEmptyResult=function(t,e,n,o){var l=null;switch(rn.resultDimension(t,e,n)){case-1:l=o.createGeometryCollection(new Array(0).fill(null));break;case 0:l=o.createPoint();break;case 1:l=o.createLineString();break;case 2:l=o.createPolygon();break}return l};rn.difference=function(t,e){return t.isEmpty()?rn.createEmptyResult(rn.DIFFERENCE,t,e,t.getFactory()):e.isEmpty()?t.copy():(t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),To.overlayOp(t,e,rn.DIFFERENCE))};rn.isResultOfOp=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=t.getLocation(0),o=t.getLocation(1);return rn.isResultOfOp(n,o,e)}else if(arguments.length===3){var l=arguments[0],h=arguments[1],_=arguments[2];switch(l===Mt.BOUNDARY&&(l=Mt.INTERIOR),h===Mt.BOUNDARY&&(h=Mt.INTERIOR),_){case rn.INTERSECTION:return l===Mt.INTERIOR&&h===Mt.INTERIOR;case rn.UNION:return l===Mt.INTERIOR||h===Mt.INTERIOR;case rn.DIFFERENCE:return l===Mt.INTERIOR&&h!==Mt.INTERIOR;case rn.SYMDIFFERENCE:return l===Mt.INTERIOR&&h!==Mt.INTERIOR||l!==Mt.INTERIOR&&h===Mt.INTERIOR}return!1}};rn.INTERSECTION=1;rn.UNION=2;rn.DIFFERENCE=3;rn.SYMDIFFERENCE=4;var wu=function(){this._g=null,this._boundaryDistanceTolerance=null,this._linework=null,this._ptLocator=new aa,this._seg=new Re;var t=arguments[0],e=arguments[1];this._g=t,this._boundaryDistanceTolerance=e,this._linework=this.extractLinework(t)};wu.prototype.isWithinToleranceOfBoundary=function(t){for(var e=this,n=0;n<this._linework.getNumGeometries();n++)for(var o=e._linework.getGeometryN(n),l=o.getCoordinateSequence(),h=0;h<l.size()-1;h++){l.getCoordinate(h,e._seg.p0),l.getCoordinate(h+1,e._seg.p1);var _=e._seg.distance(t);if(_<=e._boundaryDistanceTolerance)return!0}return!1};wu.prototype.getLocation=function(t){return this.isWithinToleranceOfBoundary(t)?Mt.BOUNDARY:this._ptLocator.locate(t,this._g)};wu.prototype.extractLinework=function(t){var e=new vp;t.apply(e);var n=e.getLinework(),o=gn.toLineStringArray(n);return t.getFactory().createMultiLineString(o)};wu.prototype.interfaces_=function(){return[]};wu.prototype.getClass=function(){return wu};var vp=function(){this._linework=null,this._linework=new se};vp.prototype.getLinework=function(){return this._linework};vp.prototype.filter=function(t){var e=this;if(t instanceof di){var n=t;this._linework.add(n.getExteriorRing());for(var o=0;o<n.getNumInteriorRing();o++)e._linework.add(n.getInteriorRingN(o))}};vp.prototype.interfaces_=function(){return[za]};vp.prototype.getClass=function(){return vp};var xc=function(){this._g=null,this._doLeft=!0,this._doRight=!0;var t=arguments[0];this._g=t};xc.prototype.extractPoints=function(t,e,n){for(var o=this,l=t.getCoordinates(),h=0;h<l.length-1;h++)o.computeOffsetPoints(l[h],l[h+1],e,n)};xc.prototype.setSidesToGenerate=function(t,e){this._doLeft=t,this._doRight=e};xc.prototype.getPoints=function(t){for(var e=this,n=new se,o=qi.getLines(this._g),l=o.iterator();l.hasNext();){var h=l.next();e.extractPoints(h,t,n)}return n};xc.prototype.computeOffsetPoints=function(t,e,n,o){var l=e.x-t.x,h=e.y-t.y,_=Math.sqrt(l*l+h*h),u=n*l/_,I=n*h/_,w=(e.x+t.x)/2,D=(e.y+t.y)/2;if(this._doLeft){var k=new It(w-I,D+u);o.add(k)}if(this._doRight){var G=new It(w+I,D-u);o.add(G)}};xc.prototype.interfaces_=function(){return[]};xc.prototype.getClass=function(){return xc};var Cs=function t(){this._geom=null,this._locFinder=null,this._location=new Array(3).fill(null),this._invalidLocation=null,this._boundaryDistanceTolerance=t.TOLERANCE,this._testCoords=new se;var e=arguments[0],n=arguments[1],o=arguments[2];this._boundaryDistanceTolerance=t.computeBoundaryDistanceTolerance(e,n),this._geom=[e,n,o],this._locFinder=[new wu(this._geom[0],this._boundaryDistanceTolerance),new wu(this._geom[1],this._boundaryDistanceTolerance),new wu(this._geom[2],this._boundaryDistanceTolerance)]},Zv={TOLERANCE:{configurable:!0}};Cs.prototype.reportResult=function(t,e,n){Yi.out.println("Overlay result invalid - A:"+Mt.toLocationSymbol(e[0])+" B:"+Mt.toLocationSymbol(e[1])+" expected:"+(n?"i":"e")+" actual:"+Mt.toLocationSymbol(e[2]))};Cs.prototype.isValid=function(t){this.addTestPts(this._geom[0]),this.addTestPts(this._geom[1]);var e=this.checkValid(t);return e};Cs.prototype.checkValid=function(){var t=this;if(arguments.length===1){for(var e=arguments[0],n=0;n<this._testCoords.size();n++){var o=t._testCoords.get(n);if(!t.checkValid(e,o))return t._invalidLocation=o,!1}return!0}else if(arguments.length===2){var l=arguments[0],h=arguments[1];return this._location[0]=this._locFinder[0].getLocation(h),this._location[1]=this._locFinder[1].getLocation(h),this._location[2]=this._locFinder[2].getLocation(h),Cs.hasLocation(this._location,Mt.BOUNDARY)?!0:this.isValidResult(l,this._location)}};Cs.prototype.addTestPts=function(t){var e=new xc(t);this._testCoords.addAll(e.getPoints(5*this._boundaryDistanceTolerance))};Cs.prototype.isValidResult=function(t,e){var n=rn.isResultOfOp(e[0],e[1],t),o=e[2]===Mt.INTERIOR,l=!(n^o);return l||this.reportResult(t,e,n),l};Cs.prototype.getInvalidLocation=function(){return this._invalidLocation};Cs.prototype.interfaces_=function(){return[]};Cs.prototype.getClass=function(){return Cs};Cs.hasLocation=function(t,e){for(var n=0;n<3;n++)if(t[n]===e)return!0;return!1};Cs.computeBoundaryDistanceTolerance=function(t,e){return Math.min(Hr.computeSizeBasedSnapTolerance(t),Hr.computeSizeBasedSnapTolerance(e))};Cs.isValid=function(t,e,n,o){var l=new Cs(t,e,o);return l.isValid(n)};Zv.TOLERANCE.get=function(){return 1e-6};Object.defineProperties(Cs,Zv);var vs=function t(e){this._geomFactory=null,this._skipEmpty=!1,this._inputGeoms=null,this._geomFactory=t.extractFactory(e),this._inputGeoms=e};vs.prototype.extractElements=function(t,e){var n=this;if(t===null)return null;for(var o=0;o<t.getNumGeometries();o++){var l=t.getGeometryN(o);n._skipEmpty&&l.isEmpty()||e.add(l)}};vs.prototype.combine=function(){for(var t=this,e=new se,n=this._inputGeoms.iterator();n.hasNext();){var o=n.next();t.extractElements(o,e)}return e.size()===0?this._geomFactory!==null?this._geomFactory.createGeometryCollection(null):null:this._geomFactory.buildGeometry(e)};vs.prototype.interfaces_=function(){return[]};vs.prototype.getClass=function(){return vs};vs.combine=function(){if(arguments.length===1){var t=arguments[0],e=new vs(t);return e.combine()}else if(arguments.length===2){var n=arguments[0],o=arguments[1],l=new vs(vs.createList(n,o));return l.combine()}else if(arguments.length===3){var h=arguments[0],_=arguments[1],u=arguments[2],I=new vs(vs.createList(h,_,u));return I.combine()}};vs.extractFactory=function(t){return t.isEmpty()?null:t.iterator().next().getFactory()};vs.createList=function(){if(arguments.length===2){var t=arguments[0],e=arguments[1],n=new se;return n.add(t),n.add(e),n}else if(arguments.length===3){var o=arguments[0],l=arguments[1],h=arguments[2],_=new se;return _.add(o),_.add(l),_.add(h),_}};var ii=function(){this._inputPolys=null,this._geomFactory=null;var t=arguments[0];this._inputPolys=t,this._inputPolys===null&&(this._inputPolys=new se)},Xv={STRTREE_NODE_CAPACITY:{configurable:!0}};ii.prototype.reduceToGeometries=function(t){for(var e=this,n=new se,o=t.iterator();o.hasNext();){var l=o.next(),h=null;qe(l,ea)?h=e.unionTree(l):l instanceof Ge&&(h=l),n.add(h)}return n};ii.prototype.extractByEnvelope=function(t,e,n){for(var o=new se,l=0;l<e.getNumGeometries();l++){var h=e.getGeometryN(l);h.getEnvelopeInternal().intersects(t)?o.add(h):n.add(h)}return this._geomFactory.buildGeometry(o)};ii.prototype.unionOptimized=function(t,e){var n=t.getEnvelopeInternal(),o=e.getEnvelopeInternal();if(!n.intersects(o)){var l=vs.combine(t,e);return l}if(t.getNumGeometries()<=1&&e.getNumGeometries()<=1)return this.unionActual(t,e);var h=n.intersection(o);return this.unionUsingEnvelopeIntersection(t,e,h)};ii.prototype.union=function(){if(this._inputPolys===null)throw new Error("union() method cannot be called twice");if(this._inputPolys.isEmpty())return null;this._geomFactory=this._inputPolys.iterator().next().getFactory();for(var t=new Lv(ii.STRTREE_NODE_CAPACITY),e=this._inputPolys.iterator();e.hasNext();){var n=e.next();t.insert(n.getEnvelopeInternal(),n)}this._inputPolys=null;var o=t.itemsTree(),l=this.unionTree(o);return l};ii.prototype.binaryUnion=function(){if(arguments.length===1){var t=arguments[0];return this.binaryUnion(t,0,t.size())}else if(arguments.length===3){var e=arguments[0],n=arguments[1],o=arguments[2];if(o-n<=1){var l=ii.getGeometry(e,n);return this.unionSafe(l,null)}else{if(o-n===2)return this.unionSafe(ii.getGeometry(e,n),ii.getGeometry(e,n+1));var h=Math.trunc((o+n)/2),_=this.binaryUnion(e,n,h),u=this.binaryUnion(e,h,o);return this.unionSafe(_,u)}}};ii.prototype.repeatedUnion=function(t){for(var e=null,n=t.iterator();n.hasNext();){var o=n.next();e===null?e=o.copy():e=e.union(o)}return e};ii.prototype.unionSafe=function(t,e){return t===null&&e===null?null:t===null?e.copy():e===null?t.copy():this.unionOptimized(t,e)};ii.prototype.unionActual=function(t,e){return ii.restrictToPolygons(t.union(e))};ii.prototype.unionTree=function(t){var e=this.reduceToGeometries(t),n=this.binaryUnion(e);return n};ii.prototype.unionUsingEnvelopeIntersection=function(t,e,n){var o=new se,l=this.extractByEnvelope(n,t,o),h=this.extractByEnvelope(n,e,o),_=this.unionActual(l,h);o.add(_);var u=vs.combine(o);return u};ii.prototype.bufferUnion=function(){if(arguments.length===1){var t=arguments[0],e=t.get(0).getFactory(),n=e.buildGeometry(t),o=n.buffer(0);return o}else if(arguments.length===2){var l=arguments[0],h=arguments[1],_=l.getFactory(),u=_.createGeometryCollection([l,h]),I=u.buffer(0);return I}};ii.prototype.interfaces_=function(){return[]};ii.prototype.getClass=function(){return ii};ii.restrictToPolygons=function(t){if(qe(t,Su))return t;var e=ql.getPolygons(t);return e.size()===1?e.get(0):t.getFactory().createMultiPolygon(gn.toPolygonArray(e))};ii.getGeometry=function(t,e){return e>=t.size()?null:t.get(e)};ii.union=function(t){var e=new ii(t);return e.union()};Xv.STRTREE_NODE_CAPACITY.get=function(){return 4};Object.defineProperties(ii,Xv);var Jd=function(){};Jd.prototype.interfaces_=function(){return[]};Jd.prototype.getClass=function(){return Jd};Jd.union=function(t,e){if(t.isEmpty()||e.isEmpty()){if(t.isEmpty()&&e.isEmpty())return rn.createEmptyResult(rn.UNION,t,e,t.getFactory());if(t.isEmpty())return e.copy();if(e.isEmpty())return t.copy()}return t.checkNotGeometryCollection(t),t.checkNotGeometryCollection(e),To.overlayOp(t,e,rn.UNION)};function wc(){return new Qd}function Qd(){this.reset()}Qd.prototype={constructor:Qd,reset:function(){this.s=this.t=0},add:function(t){y0(Pd,t,this.t),y0(this,Pd.s,this.s),this.s?this.t+=Pd.t:this.s=Pd.t},valueOf:function(){return this.s}};var Pd=new Qd;function y0(t,e,n){var o=t.s=e+n,l=o-e,h=o-l;t.t=e-h+(n-l)}var zr=1e-6,ir=Math.PI,jl=ir/2,v0=ir/4,$l=ir*2,nc=180/ir,Aa=ir/180,bo=Math.abs,Vw=Math.atan,xp=Math.atan2,hi=Math.cos,pi=Math.sin,Cp=Math.sqrt;function Yv(t){return t>1?0:t<-1?ir:Math.acos(t)}function oh(t){return t>1?jl:t<-1?-jl:Math.asin(t)}function vf(){}function tg(t,e){t&&b0.hasOwnProperty(t.type)&&b0[t.type](t,e)}var x0={Feature:function(t,e){tg(t.geometry,e)},FeatureCollection:function(t,e){for(var n=t.features,o=-1,l=n.length;++o<l;)tg(n[o].geometry,e)}},b0={Sphere:function(t,e){e.sphere()},Point:function(t,e){t=t.coordinates,e.point(t[0],t[1],t[2])},MultiPoint:function(t,e){for(var n=t.coordinates,o=-1,l=n.length;++o<l;)t=n[o],e.point(t[0],t[1],t[2])},LineString:function(t,e){zm(t.coordinates,e,0)},MultiLineString:function(t,e){for(var n=t.coordinates,o=-1,l=n.length;++o<l;)zm(n[o],e,0)},Polygon:function(t,e){w0(t.coordinates,e)},MultiPolygon:function(t,e){for(var n=t.coordinates,o=-1,l=n.length;++o<l;)w0(n[o],e)},GeometryCollection:function(t,e){for(var n=t.geometries,o=-1,l=n.length;++o<l;)tg(n[o],e)}};function zm(t,e,n){var o=-1,l=t.length-n,h;for(e.lineStart();++o<l;)h=t[o],e.point(h[0],h[1],h[2]);e.lineEnd()}function w0(t,e){var n=-1,o=t.length;for(e.polygonStart();++n<o;)zm(t[n],e,1);e.polygonEnd()}function Gw(t,e){t&&x0.hasOwnProperty(t.type)?x0[t.type](t,e):tg(t,e)}wc();wc();function Fm(t){return[xp(t[1],t[0]),oh(t[2])]}function bp(t){var e=t[0],n=t[1],o=hi(n);return[o*hi(e),o*pi(e),pi(n)]}function Md(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function eg(t,e){return[t[1]*e[2]-t[2]*e[1],t[2]*e[0]-t[0]*e[2],t[0]*e[1]-t[1]*e[0]]}function bm(t,e){t[0]+=e[0],t[1]+=e[1],t[2]+=e[2]}function Ad(t,e){return[t[0]*e,t[1]*e,t[2]*e]}function Bm(t){var e=Cp(t[0]*t[0]+t[1]*t[1]+t[2]*t[2]);t[0]/=e,t[1]/=e,t[2]/=e}wc();function Wv(t,e){function n(o,l){return o=t(o,l),e(o[0],o[1])}return t.invert&&e.invert&&(n.invert=function(o,l){return o=e.invert(o,l),o&&t.invert(o[0],o[1])}),n}function Um(t,e){return[t>ir?t-$l:t<-ir?t+$l:t,e]}Um.invert=Um;function jw(t,e,n){return(t%=$l)?e||n?Wv(I0(t),S0(e,n)):I0(t):e||n?S0(e,n):Um}function E0(t){return function(e,n){return e+=t,[e>ir?e-$l:e<-ir?e+$l:e,n]}}function I0(t){var e=E0(t);return e.invert=E0(-t),e}function S0(t,e){var n=hi(t),o=pi(t),l=hi(e),h=pi(e);function _(u,I){var w=hi(I),D=hi(u)*w,k=pi(u)*w,G=pi(I),H=G*n+D*o;return[xp(k*l-H*h,D*n-G*o),oh(H*l+k*h)]}return _.invert=function(u,I){var w=hi(I),D=hi(u)*w,k=pi(u)*w,G=pi(I),H=G*l-k*h;return[xp(k*l+G*h,D*n+H*o),oh(H*n-D*o)]},_}function qw(t,e,n,o,l,h){if(n){var _=hi(e),u=pi(e),I=o*n;l==null?(l=e+o*$l,h=e-I/2):(l=T0(_,l),h=T0(_,h),(o>0?l<h:l>h)&&(l+=o*$l));for(var w,D=l;o>0?D>h:D<h;D-=I)w=Fm([_,-u*hi(D),-u*pi(D)]),t.point(w[0],w[1])}}function T0(t,e){e=bp(e),e[0]-=t,Bm(e);var n=Yv(-e[1]);return((-e[2]<0?-n:n)+$l-zr)%$l}function Hv(){var t=[],e;return{point:function(n,o){e.push([n,o])},lineStart:function(){t.push(e=[])},lineEnd:vf,rejoin:function(){t.length>1&&t.push(t.pop().concat(t.shift()))},result:function(){var n=t;return t=[],e=null,n}}}function Zw(t,e,n,o,l,h){var _=t[0],u=t[1],I=e[0],w=e[1],D=0,k=1,G=I-_,H=w-u,j;if(j=n-_,!(!G&&j>0)){if(j/=G,G<0){if(j<D)return;j<k&&(k=j)}else if(G>0){if(j>k)return;j>D&&(D=j)}if(j=l-_,!(!G&&j<0)){if(j/=G,G<0){if(j>k)return;j>D&&(D=j)}else if(G>0){if(j<D)return;j<k&&(k=j)}if(j=o-u,!(!H&&j>0)){if(j/=H,H<0){if(j<D)return;j<k&&(k=j)}else if(H>0){if(j>k)return;j>D&&(D=j)}if(j=h-u,!(!H&&j<0)){if(j/=H,H<0){if(j>k)return;j>D&&(D=j)}else if(H>0){if(j<D)return;j<k&&(k=j)}return D>0&&(t[0]=_+D*G,t[1]=u+D*H),k<1&&(e[0]=_+k*G,e[1]=u+k*H),!0}}}}}function zd(t,e){return bo(t[0]-e[0])<zr&&bo(t[1]-e[1])<zr}function Ld(t,e,n,o){this.x=t,this.z=e,this.o=n,this.e=o,this.v=!1,this.n=this.p=null}function $v(t,e,n,o,l){var h=[],_=[],u,I;if(t.forEach(function(j){if(!((K=j.length-1)<=0)){var K,lt=j[0],dt=j[K],xt;if(zd(lt,dt)){for(l.lineStart(),u=0;u<K;++u)l.point((lt=j[u])[0],lt[1]);l.lineEnd();return}h.push(xt=new Ld(lt,j,null,!0)),_.push(xt.o=new Ld(lt,null,xt,!1)),h.push(xt=new Ld(dt,j,null,!1)),_.push(xt.o=new Ld(dt,null,xt,!0))}}),!!h.length){for(_.sort(e),C0(h),C0(_),u=0,I=_.length;u<I;++u)_[u].e=n=!n;for(var w=h[0],D,k;;){for(var G=w,H=!0;G.v;)if((G=G.n)===w)return;D=G.z,l.lineStart();do{if(G.v=G.o.v=!0,G.e){if(H)for(u=0,I=D.length;u<I;++u)l.point((k=D[u])[0],k[1]);else o(G.x,G.n.x,1,l);G=G.n}else{if(H)for(D=G.p.z,u=D.length-1;u>=0;--u)l.point((k=D[u])[0],k[1]);else o(G.x,G.p.x,-1,l);G=G.p}G=G.o,D=G.z,H=!H}while(!G.v);l.lineEnd()}}}function C0(t){if(e=t.length){for(var e,n=0,o=t[0],l;++n<e;)o.n=l=t[n],l.p=o,o=l;o.n=l=t[0],l.p=o}}function Kv(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function Xw(t){return t.length===1&&(t=Yw(t)),{left:function(e,n,o,l){for(o==null&&(o=0),l==null&&(l=e.length);o<l;){var h=o+l>>>1;t(e[h],n)<0?o=h+1:l=h}return o},right:function(e,n,o,l){for(o==null&&(o=0),l==null&&(l=e.length);o<l;){var h=o+l>>>1;t(e[h],n)>0?l=h:o=h+1}return o}}}function Yw(t){return function(e,n){return Kv(t(e),n)}}Xw(Kv);function Jv(t){for(var e=t.length,n,o=-1,l=0,h,_;++o<e;)l+=t[o].length;for(h=new Array(l);--e>=0;)for(_=t[e],n=_.length;--n>=0;)h[--l]=_[n];return h}var xf=1e9,Dd=-xf;function Ww(t,e,n,o){function l(w,D){return t<=w&&w<=n&&e<=D&&D<=o}function h(w,D,k,G){var H=0,j=0;if(w==null||(H=_(w,k))!==(j=_(D,k))||I(w,D)<0^k>0)do G.point(H===0||H===3?t:n,H>1?o:e);while((H=(H+k+4)%4)!==j);else G.point(D[0],D[1])}function _(w,D){return bo(w[0]-t)<zr?D>0?0:3:bo(w[0]-n)<zr?D>0?2:1:bo(w[1]-e)<zr?D>0?1:0:D>0?3:2}function u(w,D){return I(w.x,D.x)}function I(w,D){var k=_(w,1),G=_(D,1);return k!==G?k-G:k===0?D[1]-w[1]:k===1?w[0]-D[0]:k===2?w[1]-D[1]:D[0]-w[0]}return function(w){var D=w,k=Hv(),G,H,j,K,lt,dt,xt,gt,yt,Nt,Gt,Ut={point:Zt,lineStart:ve,lineEnd:Ue,polygonStart:Qt,polygonEnd:ie};function Zt(Se,Ye){l(Se,Ye)&&D.point(Se,Ye)}function qt(){for(var Se=0,Ye=0,yn=H.length;Ye<yn;++Ye)for(var tr=H[Ye],Xn=1,_i=tr.length,An=tr[0],pr,wn,Yn=An[0],ur=An[1];Xn<_i;++Xn)pr=Yn,wn=ur,An=tr[Xn],Yn=An[0],ur=An[1],wn<=o?ur>o&&(Yn-pr)*(o-wn)>(ur-wn)*(t-pr)&&++Se:ur<=o&&(Yn-pr)*(o-wn)<(ur-wn)*(t-pr)&&--Se;return Se}function Qt(){D=k,G=[],H=[],Gt=!0}function ie(){var Se=qt(),Ye=Gt&&Se,yn=(G=Jv(G)).length;(Ye||yn)&&(w.polygonStart(),Ye&&(w.lineStart(),h(null,null,1,w),w.lineEnd()),yn&&$v(G,u,Se,h,w),w.polygonEnd()),D=w,G=H=j=null}function ve(){Ut.point=Rt,H&&H.push(j=[]),Nt=!0,yt=!1,xt=gt=NaN}function Ue(){G&&(Rt(K,lt),dt&&yt&&k.rejoin(),G.push(k.result())),Ut.point=Zt,yt&&D.lineEnd()}function Rt(Se,Ye){var yn=l(Se,Ye);if(H&&j.push([Se,Ye]),Nt)K=Se,lt=Ye,dt=yn,Nt=!1,yn&&(D.lineStart(),D.point(Se,Ye));else if(yn&&yt)D.point(Se,Ye);else{var tr=[xt=Math.max(Dd,Math.min(xf,xt)),gt=Math.max(Dd,Math.min(xf,gt))],Xn=[Se=Math.max(Dd,Math.min(xf,Se)),Ye=Math.max(Dd,Math.min(xf,Ye))];Zw(tr,Xn,t,e,n,o)?(yt||(D.lineStart(),D.point(tr[0],tr[1])),D.point(Xn[0],Xn[1]),yn||D.lineEnd(),Gt=!1):yn&&(D.lineStart(),D.point(Se,Ye),Gt=!1)}xt=Se,gt=Ye,yt=yn}return Ut}}var wm=wc();function Hw(t,e){var n=e[0],o=e[1],l=[pi(n),-hi(n),0],h=0,_=0;wm.reset();for(var u=0,I=t.length;u<I;++u)if(D=(w=t[u]).length)for(var w,D,k=w[D-1],G=k[0],H=k[1]/2+v0,j=pi(H),K=hi(H),lt=0;lt<D;++lt,G=xt,j=yt,K=Nt,k=dt){var dt=w[lt],xt=dt[0],gt=dt[1]/2+v0,yt=pi(gt),Nt=hi(gt),Gt=xt-G,Ut=Gt>=0?1:-1,Zt=Ut*Gt,qt=Zt>ir,Qt=j*yt;if(wm.add(xp(Qt*Ut*pi(Zt),K*Nt+Qt*hi(Zt))),h+=qt?Gt+Ut*$l:Gt,qt^G>=n^xt>=n){var ie=eg(bp(k),bp(dt));Bm(ie);var ve=eg(l,ie);Bm(ve);var Ue=(qt^Gt>=0?-1:1)*oh(ve[2]);(o>Ue||o===Ue&&(ie[0]||ie[1]))&&(_+=qt^Gt>=0?1:-1)}}return(h<-zr||h<zr&&wm<-zr)^_&1}wc();function P0(t){return t}wc();wc();var wp=1/0,ng=wp,Gf=-wp,rg=Gf,M0={point:$w,lineStart:vf,lineEnd:vf,polygonStart:vf,polygonEnd:vf,result:function(){var t=[[wp,ng],[Gf,rg]];return Gf=rg=-(ng=wp=1/0),t}};function $w(t,e){t<wp&&(wp=t),t>Gf&&(Gf=t),e<ng&&(ng=e),e>rg&&(rg=e)}wc();function Qv(t,e,n,o){return function(l,h){var _=e(h),u=l.invert(o[0],o[1]),I=Hv(),w=e(I),D=!1,k,G,H,j={point:K,lineStart:dt,lineEnd:xt,polygonStart:function(){j.point=gt,j.lineStart=yt,j.lineEnd=Nt,G=[],k=[]},polygonEnd:function(){j.point=K,j.lineStart=dt,j.lineEnd=xt,G=Jv(G);var Gt=Hw(k,u);G.length?(D||(h.polygonStart(),D=!0),$v(G,Jw,Gt,n,h)):Gt&&(D||(h.polygonStart(),D=!0),h.lineStart(),n(null,null,1,h),h.lineEnd()),D&&(h.polygonEnd(),D=!1),G=k=null},sphere:function(){h.polygonStart(),h.lineStart(),n(null,null,1,h),h.lineEnd(),h.polygonEnd()}};function K(Gt,Ut){var Zt=l(Gt,Ut);t(Gt=Zt[0],Ut=Zt[1])&&h.point(Gt,Ut)}function lt(Gt,Ut){var Zt=l(Gt,Ut);_.point(Zt[0],Zt[1])}function dt(){j.point=lt,_.lineStart()}function xt(){j.point=K,_.lineEnd()}function gt(Gt,Ut){H.push([Gt,Ut]);var Zt=l(Gt,Ut);w.point(Zt[0],Zt[1])}function yt(){w.lineStart(),H=[]}function Nt(){gt(H[0][0],H[0][1]),w.lineEnd();var Gt=w.clean(),Ut=I.result(),Zt,qt=Ut.length,Qt,ie,ve;if(H.pop(),k.push(H),H=null,!!qt){if(Gt&1){if(ie=Ut[0],(Qt=ie.length-1)>0){for(D||(h.polygonStart(),D=!0),h.lineStart(),Zt=0;Zt<Qt;++Zt)h.point((ve=ie[Zt])[0],ve[1]);h.lineEnd()}return}qt>1&&Gt&2&&Ut.push(Ut.pop().concat(Ut.shift())),G.push(Ut.filter(Kw))}}return j}}function Kw(t){return t.length>1}function Jw(t,e){return((t=t.x)[0]<0?t[1]-jl-zr:jl-t[1])-((e=e.x)[0]<0?e[1]-jl-zr:jl-e[1])}const A0=Qv(function(){return!0},Qw,eE,[-ir,-jl]);function Qw(t){var e=NaN,n=NaN,o=NaN,l;return{lineStart:function(){t.lineStart(),l=1},point:function(h,_){var u=h>0?ir:-ir,I=bo(h-e);bo(I-ir)<zr?(t.point(e,n=(n+_)/2>0?jl:-jl),t.point(o,n),t.lineEnd(),t.lineStart(),t.point(u,n),t.point(h,n),l=0):o!==u&&I>=ir&&(bo(e-o)<zr&&(e-=o*zr),bo(h-u)<zr&&(h-=u*zr),n=tE(e,n,h,_),t.point(o,n),t.lineEnd(),t.lineStart(),t.point(u,n),l=0),t.point(e=h,n=_),o=u},lineEnd:function(){t.lineEnd(),e=n=NaN},clean:function(){return 2-l}}}function tE(t,e,n,o){var l,h,_=pi(t-n);return bo(_)>zr?Vw((pi(e)*(h=hi(o))*pi(n)-pi(o)*(l=hi(e))*pi(t))/(l*h*_)):(e+o)/2}function eE(t,e,n,o){var l;if(t==null)l=n*jl,o.point(-ir,l),o.point(0,l),o.point(ir,l),o.point(ir,0),o.point(ir,-l),o.point(0,-l),o.point(-ir,-l),o.point(-ir,0),o.point(-ir,l);else if(bo(t[0]-e[0])>zr){var h=t[0]<e[0]?ir:-ir;l=n*h/2,o.point(-h,l),o.point(0,l),o.point(h,l)}else o.point(e[0],e[1])}function nE(t,e){var n=hi(t),o=n>0,l=bo(n)>zr;function h(D,k,G,H){qw(H,t,e,G,D,k)}function _(D,k){return hi(D)*hi(k)>n}function u(D){var k,G,H,j,K;return{lineStart:function(){j=H=!1,K=1},point:function(lt,dt){var xt=[lt,dt],gt,yt=_(lt,dt),Nt=o?yt?0:w(lt,dt):yt?w(lt+(lt<0?ir:-ir),dt):0;if(!k&&(j=H=yt)&&D.lineStart(),yt!==H&&(gt=I(k,xt),(!gt||zd(k,gt)||zd(xt,gt))&&(xt[0]+=zr,xt[1]+=zr,yt=_(xt[0],xt[1]))),yt!==H)K=0,yt?(D.lineStart(),gt=I(xt,k),D.point(gt[0],gt[1])):(gt=I(k,xt),D.point(gt[0],gt[1]),D.lineEnd()),k=gt;else if(l&&k&&o^yt){var Gt;!(Nt&G)&&(Gt=I(xt,k,!0))&&(K=0,o?(D.lineStart(),D.point(Gt[0][0],Gt[0][1]),D.point(Gt[1][0],Gt[1][1]),D.lineEnd()):(D.point(Gt[1][0],Gt[1][1]),D.lineEnd(),D.lineStart(),D.point(Gt[0][0],Gt[0][1])))}yt&&(!k||!zd(k,xt))&&D.point(xt[0],xt[1]),k=xt,H=yt,G=Nt},lineEnd:function(){H&&D.lineEnd(),k=null},clean:function(){return K|(j&&H)<<1}}}function I(D,k,G){var H=bp(D),j=bp(k),K=[1,0,0],lt=eg(H,j),dt=Md(lt,lt),xt=lt[0],gt=dt-xt*xt;if(!gt)return!G&&D;var yt=n*dt/gt,Nt=-n*xt/gt,Gt=eg(K,lt),Ut=Ad(K,yt),Zt=Ad(lt,Nt);bm(Ut,Zt);var qt=Gt,Qt=Md(Ut,qt),ie=Md(qt,qt),ve=Qt*Qt-ie*(Md(Ut,Ut)-1);if(!(ve<0)){var Ue=Cp(ve),Rt=Ad(qt,(-Qt-Ue)/ie);if(bm(Rt,Ut),Rt=Fm(Rt),!G)return Rt;var Se=D[0],Ye=k[0],yn=D[1],tr=k[1],Xn;Ye<Se&&(Xn=Se,Se=Ye,Ye=Xn);var _i=Ye-Se,An=bo(_i-ir)<zr,pr=An||_i<zr;if(!An&&tr<yn&&(Xn=yn,yn=tr,tr=Xn),pr?An?yn+tr>0^Rt[1]<(bo(Rt[0]-Se)<zr?yn:tr):yn<=Rt[1]&&Rt[1]<=tr:_i>ir^(Se<=Rt[0]&&Rt[0]<=Ye)){var wn=Ad(qt,(-Qt+Ue)/ie);return bm(wn,Ut),[Rt,Fm(wn)]}}}function w(D,k){var G=o?t:ir-t,H=0;return D<-G?H|=1:D>G&&(H|=2),k<-G?H|=4:k>G&&(H|=8),H}return Qv(_,u,h,o?[0,-t]:[-ir,t-ir])}function tx(t){return function(e){var n=new Vm;for(var o in t)n[o]=t[o];return n.stream=e,n}}function Vm(){}Vm.prototype={constructor:Vm,point:function(t,e){this.stream.point(t,e)},sphere:function(){this.stream.sphere()},lineStart:function(){this.stream.lineStart()},lineEnd:function(){this.stream.lineEnd()},polygonStart:function(){this.stream.polygonStart()},polygonEnd:function(){this.stream.polygonEnd()}};function ex(t,e,n){var o=e[1][0]-e[0][0],l=e[1][1]-e[0][1],h=t.clipExtent&&t.clipExtent();t.scale(150).translate([0,0]),h!=null&&t.clipExtent(null),Gw(n,t.stream(M0));var _=M0.result(),u=Math.min(o/(_[1][0]-_[0][0]),l/(_[1][1]-_[0][1])),I=+e[0][0]+(o-u*(_[1][0]+_[0][0]))/2,w=+e[0][1]+(l-u*(_[1][1]+_[0][1]))/2;return h!=null&&t.clipExtent(h),t.scale(u*150).translate([I,w])}function rE(t,e,n){return ex(t,[[0,0],e],n)}var L0=16,iE=hi(30*Aa);function D0(t,e){return+e?sE(t,e):oE(t)}function oE(t){return tx({point:function(e,n){e=t(e,n),this.stream.point(e[0],e[1])}})}function sE(t,e){function n(o,l,h,_,u,I,w,D,k,G,H,j,K,lt){var dt=w-o,xt=D-l,gt=dt*dt+xt*xt;if(gt>4*e&&K--){var yt=_+G,Nt=u+H,Gt=I+j,Ut=Cp(yt*yt+Nt*Nt+Gt*Gt),Zt=oh(Gt/=Ut),qt=bo(bo(Gt)-1)<zr||bo(h-k)<zr?(h+k)/2:xp(Nt,yt),Qt=t(qt,Zt),ie=Qt[0],ve=Qt[1],Ue=ie-o,Rt=ve-l,Se=xt*Ue-dt*Rt;(Se*Se/gt>e||bo((dt*Ue+xt*Rt)/gt-.5)>.3||_*G+u*H+I*j<iE)&&(n(o,l,h,_,u,I,ie,ve,qt,yt/=Ut,Nt/=Ut,Gt,K,lt),lt.point(ie,ve),n(ie,ve,qt,yt,Nt,Gt,w,D,k,G,H,j,K,lt))}}return function(o){var l,h,_,u,I,w,D,k,G,H,j,K,lt={point:dt,lineStart:xt,lineEnd:yt,polygonStart:function(){o.polygonStart(),lt.lineStart=Nt},polygonEnd:function(){o.polygonEnd(),lt.lineStart=xt}};function dt(Zt,qt){Zt=t(Zt,qt),o.point(Zt[0],Zt[1])}function xt(){k=NaN,lt.point=gt,o.lineStart()}function gt(Zt,qt){var Qt=bp([Zt,qt]),ie=t(Zt,qt);n(k,G,D,H,j,K,k=ie[0],G=ie[1],D=Zt,H=Qt[0],j=Qt[1],K=Qt[2],L0,o),o.point(k,G)}function yt(){lt.point=dt,o.lineEnd()}function Nt(){xt(),lt.point=Gt,lt.lineEnd=Ut}function Gt(Zt,qt){gt(l=Zt,qt),h=k,_=G,u=H,I=j,w=K,lt.point=gt}function Ut(){n(k,G,D,H,j,K,h,_,l,u,I,w,L0,o),lt.lineEnd=yt,yt()}return lt}}var aE=tx({point:function(t,e){this.stream.point(t*Aa,e*Aa)}});function lE(t){return uE(function(){return t})()}function uE(t){var e,n=150,o=480,l=250,h,_,u=0,I=0,w=0,D=0,k=0,G,H,j=null,K=A0,lt=null,dt,xt,gt,yt=P0,Nt=.5,Gt=D0(ie,Nt),Ut,Zt;function qt(Rt){return Rt=H(Rt[0]*Aa,Rt[1]*Aa),[Rt[0]*n+h,_-Rt[1]*n]}function Qt(Rt){return Rt=H.invert((Rt[0]-h)/n,(_-Rt[1])/n),Rt&&[Rt[0]*nc,Rt[1]*nc]}function ie(Rt,Se){return Rt=e(Rt,Se),[Rt[0]*n+h,_-Rt[1]*n]}qt.stream=function(Rt){return Ut&&Zt===Rt?Ut:Ut=aE(K(G,Gt(yt(Zt=Rt))))},qt.clipAngle=function(Rt){return arguments.length?(K=+Rt?nE(j=Rt*Aa,6*Aa):(j=null,A0),Ue()):j*nc},qt.clipExtent=function(Rt){return arguments.length?(yt=Rt==null?(lt=dt=xt=gt=null,P0):Ww(lt=+Rt[0][0],dt=+Rt[0][1],xt=+Rt[1][0],gt=+Rt[1][1]),Ue()):lt==null?null:[[lt,dt],[xt,gt]]},qt.scale=function(Rt){return arguments.length?(n=+Rt,ve()):n},qt.translate=function(Rt){return arguments.length?(o=+Rt[0],l=+Rt[1],ve()):[o,l]},qt.center=function(Rt){return arguments.length?(u=Rt[0]%360*Aa,I=Rt[1]%360*Aa,ve()):[u*nc,I*nc]},qt.rotate=function(Rt){return arguments.length?(w=Rt[0]%360*Aa,D=Rt[1]%360*Aa,k=Rt.length>2?Rt[2]%360*Aa:0,ve()):[w*nc,D*nc,k*nc]},qt.precision=function(Rt){return arguments.length?(Gt=D0(ie,Nt=Rt*Rt),Ue()):Cp(Nt)},qt.fitExtent=function(Rt,Se){return ex(qt,Rt,Se)},qt.fitSize=function(Rt,Se){return rE(qt,Rt,Se)};function ve(){H=Wv(G=jw(w,D,k),e);var Rt=e(u,I);return h=o-Rt[0]*n,_=l+Rt[1]*n,Ue()}function Ue(){return Ut=Zt=null,qt}return function(){return e=t.apply(this,arguments),qt.invert=e.invert&&Qt,ve()}}function nx(t){return function(e,n){var o=hi(e),l=hi(n),h=t(o*l);return[h*l*pi(e),h*pi(n)]}}function rx(t){return function(e,n){var o=Cp(e*e+n*n),l=t(o),h=pi(l),_=hi(l);return[xp(e*h,o*_),oh(o&&n*h/o)]}}var cE=nx(function(t){return Cp(2/(1+t))});cE.invert=rx(function(t){return 2*oh(t/2)});var ix=nx(function(t){return(t=Yv(t))&&t/pi(t)});ix.invert=rx(function(t){return t});function hE(){return lE(ix).scale(79.4188).clipAngle(180-.001)}function k0(t,e){return[t,e]}k0.invert=k0;function pE(t,e,n){n=n||{};var o=n.units||"kilometers",l=n.steps||8;if(!t)throw new Error("geojson is required");if(typeof n!="object")throw new Error("options must be an object");if(typeof l!="number")throw new Error("steps must be an number");if(e===void 0)throw new Error("radius is required");if(l<=0)throw new Error("steps must be greater than 0");var h=[];switch(t.type){case"GeometryCollection":return vv(t,function(_){var u=Fd(_,e,o,l);u&&h.push(u)}),Nm(h);case"FeatureCollection":return f0(t,function(_){var u=Fd(_,e,o,l);u&&f0(u,function(I){I&&h.push(I)})}),Nm(h)}return Fd(t,e,o,l)}function Fd(t,e,n,o){var l=t.properties||{},h=t.type==="Feature"?t.geometry:t;if(h.type==="GeometryCollection"){var _=[];return vv(t,function(K){var lt=Fd(K,e,n,o);lt&&_.push(lt)}),Nm(_)}var u=fE(h),I={type:h.type,coordinates:sx(h.coordinates,u)},w=new l_,D=w.read(I),k=xw(bw(e,n),"meters"),G=Zi.bufferOp(D,k,o),H=new Mv;if(G=H.write(G),!ox(G.coordinates)){var j={type:G.type,coordinates:ax(G.coordinates,u)};return ug(j,l)}}function ox(t){return Array.isArray(t[0])?ox(t[0]):isNaN(t[0])}function sx(t,e){return typeof t[0]!="object"?e(t):t.map(function(n){return sx(n,e)})}function ax(t,e){return typeof t[0]!="object"?e.invert(t):t.map(function(n){return ax(n,e)})}function fE(t){var e=Ew(t).geometry.coordinates,n=[-e[0],-e[1]];return hE().rotate(n).scale(ys)}function dE(t,e){var n=Yd(t),o=Yd(e),l=t.properties||{},h=dv.difference(n.coordinates,o.coordinates);return h.length===0?null:h.length===1?mv(h[0],l):_v(h,l)}function N0(t){let e;for(const n of t)e&&n[0]-e[0]>=180?n[0]-=360:e&&n[0]-e[0]<-180&&(n[0]+=360),e=n}function R0(t,e){const n=dE({type:"Polygon",coordinates:[[[180,90],[-180,90],[-180,-90],[180,-90],[180,90]]]},t);if(!n)return;n.properties={isMask:"y"};const o=pE(t,0);if(o.geometry.type==="Polygon")for(const l of o.geometry.coordinates)N0(l);else for(const l of o.geometry.coordinates)for(const h of l)N0(h);e({type:"FeatureCollection",features:[o,n]})}let O0={type:"FeatureCollection",features:[]};function gE(t,e,n=!0,o=!0,l={},h={},_={fill:{paint:{"fill-color":"#000","fill-opacity":.1},filter:["all",["==",["geometry-type"],"Polygon"],["has","isMask"]]},line:{layout:{"line-cap":"square"},paint:{"line-width":["case",["==",["geometry-type"],"Polygon"],2,3],"line-dasharray":[1,1],"line-color":"#3170fe"},filter:["!",["has","isMask"]]}}){let u,I=[],w,D;function k(){(_!=null&&_.fill||_!=null&&_.line)&&t.addSource("full-geom",{type:"geojson",data:O0}),_!=null&&_.fill&&t.addLayer({..._==null?void 0:_.fill,id:"full-geom-fill",type:"fill",source:"full-geom"}),_!=null&&_.line&&t.addLayer({..._==null?void 0:_.line,id:"full-geom-line",type:"line",source:"full-geom"})}t.loaded()?k():t.once("load",()=>{k()});const G=j=>{u==null||u({type:"mapClick",coordinates:[j.lngLat.lng,j.lngLat.lat]})};function H(j=!1){if(!e)throw new Error;const K=document.createElement("div");return j&&K.classList.add("marker-interactive"),new $b({props:{displayIn:"maplibre"},target:K}),new e.Marker({element:K,offset:[1,-13]})}return{setEventHandler(j){j?(u=j,t.on("click",G)):(u=void 0,t.off("click",G))},flyTo(j,K){t.flyTo({center:j,zoom:K,...l})},fitBounds(j,K,lt){t.fitBounds([[j[0],j[1]],[j[2],j[3]]],{padding:K,maxZoom:lt,...h})},indicateReverse(j){t.getCanvasContainer().style.cursor=j?"crosshair":""},setReverseMarker(j){!e||!n||(D?j?D.setLngLat(j):(D.remove(),D=void 0):j&&(D=(typeof n=="object"?new e.Marker(n):H()).setLngLat(j).addTo(t),D.getElement().classList.add("marker-reverse")))},setMarkers(j,K){if(!n)return;function lt(dt){var xt;(xt=t.getSource("full-geom"))==null||xt.setData(dt)}for(const dt of I)dt.remove();if(I.length=0,lt(O0),!!e){if(K){let dt=!1;if(K.geometry.type==="GeometryCollection"){const xt=K.geometry.geometries.filter(gt=>gt.type==="Polygon"||gt.type==="MultiPolygon");if(xt.length>0){let gt=xt.pop();for(const yt of xt)gt=ww(gt,yt);R0({...K,geometry:gt},lt),dt=!0}else{const gt=K.geometry.geometries.filter(yt=>yt.type==="LineString"||yt.type==="MultiLineString");gt.length>0&&(lt({...K,geometry:{type:"GeometryCollection",geometries:gt}}),dt=!0)}}if(!dt){if(K.geometry.type==="Polygon"||K.geometry.type==="MultiPolygon")R0(K,lt);else if(K.geometry.type==="LineString"||K.geometry.type==="MultiLineString"){lt(K);return}}n&&I.push((typeof n=="object"?new e.Marker(n):H()).setLngLat(K.center).addTo(t))}if(o)for(const dt of j??[]){if(dt===K)continue;const xt=(typeof o=="object"?new e.Marker(o):H(!0)).setLngLat(dt.center).setPopup(new e.Popup({offset:[1,-27],closeButton:!1,closeOnMove:!0,className:"maptiler-gc-popup"}).setText(dt.place_name.replace(/,.*/,""))).addTo(t),gt=xt.getElement();gt.addEventListener("click",yt=>{yt.stopPropagation(),u==null||u({type:"markerClick",id:dt.id})}),gt.addEventListener("mouseenter",()=>{u==null||u({type:"markerMouseEnter",id:dt.id}),xt.togglePopup()}),gt.addEventListener("mouseleave",()=>{u==null||u({type:"markerMouseLeave",id:dt.id}),xt.togglePopup()}),I.push(xt)}}},setSelectedMarker(j){w&&w.getElement().classList.toggle("marker-selected",!1),w=j>-1?I[j]:void 0,w==null||w.getElement().classList.toggle("marker-selected",!0)},getCenterAndZoom(){const j=t.getCenter();return[t.getZoom(),j.lng,j.lat]}}}function mE(t){let e,n;return{c(){e=cc("svg"),n=cc("path"),Xt(n,"d","M13.12.706a.982.982 0 0 0-1.391 0L6.907 5.517 2.087.696a.982.982 0 1 0-1.391 1.39l4.821 4.821L.696 11.73a.982.982 0 1 0 1.39 1.39l4.821-4.821 4.822 4.821a.982.982 0 1 0 1.39-1.39L8.298 6.908l4.821-4.822a.988.988 0 0 0 0-1.38Z"),Xt(e,"viewBox","0 0 14 14"),Xt(e,"width","13"),Xt(e,"height","13"),Xt(e,"class","svelte-en2qvf")},m(o,l){tn(o,e,l),we(e,n)},p:Tn,i:Tn,o:Tn,d(o){o&&Ke(e)}}}class lx extends mi{constructor(e){super(),gi(this,e,null,mE,si,{})}}function _E(t){let e,n;return{c(){e=cc("svg"),n=cc("path"),Xt(n,"d","M15 0C6.705 0 0 6.705 0 15C0 23.295 6.705 30 15 30C23.295 30 30 23.295 30 15C30 6.705 23.295 0 15 0ZM22.5 20.385L20.385 22.5L15 17.115L9.615 22.5L7.5 20.385L12.885 15L7.5 9.615L9.615 7.5L15 12.885L20.385 7.5L22.5 9.615L17.115 15L22.5 20.385Z"),Xt(e,"viewBox","0 0 30 30"),Xt(e,"fill","none"),Xt(e,"xmlns","http://www.w3.org/2000/svg"),Xt(e,"class","svelte-d2loi5")},m(o,l){tn(o,e,l),we(e,n)},p:Tn,i:Tn,o:Tn,d(o){o&&Ke(e)}}}class ux extends mi{constructor(e){super(),gi(this,e,null,_E,si,{})}}function yE(t){let e,n;return{c(){e=Ne("img"),zs(e.src,n=t[3]+"area.svg")||Xt(e,"src",n),Xt(e,"alt",t[6]),Xt(e,"class","svelte-ltkwvy")},m(o,l){tn(o,e,l)},p(o,l){l&8&&!zs(e.src,n=o[3]+"area.svg")&&Xt(e,"src",n),l&64&&Xt(e,"alt",o[6])},d(o){o&&Ke(e)}}}function vE(t){let e,n;return{c(){e=Ne("img"),zs(e.src,n=t[3]+"poi.svg")||Xt(e,"src",n),Xt(e,"alt",t[6]),Xt(e,"class","svelte-ltkwvy")},m(o,l){tn(o,e,l)},p(o,l){l&8&&!zs(e.src,n=o[3]+"poi.svg")&&Xt(e,"src",n),l&64&&Xt(e,"alt",o[6])},d(o){o&&Ke(e)}}}function xE(t){let e,n;return{c(){e=Ne("img"),zs(e.src,n=t[3]+"postal_code.svg")||Xt(e,"src",n),Xt(e,"alt",t[6]),Xt(e,"class","svelte-ltkwvy")},m(o,l){tn(o,e,l)},p(o,l){l&8&&!zs(e.src,n=o[3]+"postal_code.svg")&&Xt(e,"src",n),l&64&&Xt(e,"alt",o[6])},d(o){o&&Ke(e)}}}function bE(t){let e,n;return{c(){e=Ne("img"),zs(e.src,n=t[3]+"street.svg")||Xt(e,"src",n),Xt(e,"alt",t[6]),Xt(e,"class","svelte-ltkwvy")},m(o,l){tn(o,e,l)},p(o,l){l&8&&!zs(e.src,n=o[3]+"street.svg")&&Xt(e,"src",n),l&64&&Xt(e,"alt",o[6])},d(o){o&&Ke(e)}}}function wE(t){let e,n;return{c(){e=Ne("img"),zs(e.src,n=t[3]+"road.svg")||Xt(e,"src",n),Xt(e,"alt",t[6]),Xt(e,"class","svelte-ltkwvy")},m(o,l){tn(o,e,l)},p(o,l){l&8&&!zs(e.src,n=o[3]+"road.svg")&&Xt(e,"src",n),l&64&&Xt(e,"alt",o[6])},d(o){o&&Ke(e)}}}function EE(t){let e,n;return{c(){e=Ne("img"),zs(e.src,n=t[3]+"housenumber.svg")||Xt(e,"src",n),Xt(e,"alt",t[6]),Xt(e,"class","svelte-ltkwvy")},m(o,l){tn(o,e,l)},p(o,l){l&8&&!zs(e.src,n=o[3]+"housenumber.svg")&&Xt(e,"src",n),l&64&&Xt(e,"alt",o[6])},d(o){o&&Ke(e)}}}function IE(t){let e,n,o,l;return{c(){e=Ne("img"),zs(e.src,n=t[5])||Xt(e,"src",n),Xt(e,"alt",t[4]),Xt(e,"class","svelte-ltkwvy")},m(h,_){tn(h,e,_),o||(l=lr(e,"error",t[13]),o=!0)},p(h,_){_&32&&!zs(e.src,n=h[5])&&Xt(e,"src",n),_&16&&Xt(e,"alt",h[4])},d(h){h&&Ke(e),o=!1,l()}}}function z0(t){let e,n;return{c(){e=Ne("span"),n=Ai(t[6]),Xt(e,"class","secondary svelte-ltkwvy")},m(o,l){tn(o,e,l),we(e,n)},p(o,l){l&64&&Eu(n,o[6])},d(o){o&&Ke(e)}}}function SE(t){var Ut,Zt;let e,n,o,l,h,_,u,I,w=t[0].place_name.replace(/,.*/,"")+"",D,k,G=t[2]==="always"||t[2]&&!t[0].address&&((Ut=t[0].properties)==null?void 0:Ut.kind)!=="road"&&((Zt=t[0].properties)==null?void 0:Zt.kind)!=="road_relation"&&!t[0].id.startsWith("address.")&&!t[0].id.startsWith("postal_code.")&&(!t[0].id.startsWith("poi.")||!t[5]),H,j,K=t[0].place_name.replace(/[^,]*,?\s*/,"")+"",lt,dt,xt;function gt(qt,Qt){var ie,ve;return Qt&1&&(n=null),Qt&1&&(o=null),Qt&1&&(l=null),qt[5]?IE:qt[0].address?EE:((ie=qt[0].properties)==null?void 0:ie.kind)==="road"||((ve=qt[0].properties)==null?void 0:ve.kind)==="road_relation"?wE:(n==null&&(n=!!qt[0].id.startsWith("address.")),n?bE:(o==null&&(o=!!qt[0].id.startsWith("postal_code.")),o?xE:(l==null&&(l=!!qt[0].id.startsWith("poi.")),l?vE:yE)))}let yt=gt(t,-1),Nt=yt(t),Gt=G&&z0(t);return{c(){e=Ne("li"),Nt.c(),h=qn(),_=Ne("span"),u=Ne("span"),I=Ne("span"),D=Ai(w),k=qn(),Gt&&Gt.c(),H=qn(),j=Ne("span"),lt=Ai(K),Xt(I,"class","primary svelte-ltkwvy"),Xt(u,"class","svelte-ltkwvy"),Xt(j,"class","line2 svelte-ltkwvy"),Xt(_,"class","texts svelte-ltkwvy"),Xt(e,"tabindex","0"),Xt(e,"data-selected",t[1]),Xt(e,"class","svelte-ltkwvy"),oc(e,"selected",t[1])},m(qt,Qt){tn(qt,e,Qt),Nt.m(e,null),we(e,h),we(e,_),we(_,u),we(u,I),we(I,D),we(u,k),Gt&&Gt.m(u,null),we(_,H),we(_,j),we(j,lt),dt||(xt=[lr(e,"mouseenter",t[11]),lr(e,"focus",t[12])],dt=!0)},p(qt,[Qt]){var ie,ve;yt===(yt=gt(qt,Qt))&&Nt?Nt.p(qt,Qt):(Nt.d(1),Nt=yt(qt),Nt&&(Nt.c(),Nt.m(e,h))),Qt&1&&w!==(w=qt[0].place_name.replace(/,.*/,"")+"")&&Eu(D,w),Qt&37&&(G=qt[2]==="always"||qt[2]&&!qt[0].address&&((ie=qt[0].properties)==null?void 0:ie.kind)!=="road"&&((ve=qt[0].properties)==null?void 0:ve.kind)!=="road_relation"&&!qt[0].id.startsWith("address.")&&!qt[0].id.startsWith("postal_code.")&&(!qt[0].id.startsWith("poi.")||!qt[5])),G?Gt?Gt.p(qt,Qt):(Gt=z0(qt),Gt.c(),Gt.m(u,null)):Gt&&(Gt.d(1),Gt=null),Qt&1&&K!==(K=qt[0].place_name.replace(/[^,]*,?\s*/,"")+"")&&Eu(lt,K),Qt&2&&Xt(e,"data-selected",qt[1]),Qt&2&&oc(e,"selected",qt[1])},i:Tn,o:Tn,d(qt){qt&&Ke(e),Nt.d(),Gt&&Gt.d(),dt=!1,ua(xt)}}}function TE(t,e,n){var xt;let o,l,{feature:h}=e,{selected:_=!1}=e,{showPlaceType:u}=e,{missingIconsCache:I}=e,{iconsBaseUrl:w}=e;const D=(xt=h.properties)==null?void 0:xt.categories;let k,G,H=0;function j(gt){G&&I.add(G),n(9,H++,H)}function K(gt){$y.call(this,t,gt)}function lt(gt){$y.call(this,t,gt)}const dt=gt=>j(gt.currentTarget);return t.$$set=gt=>{"feature"in gt&&n(0,h=gt.feature),"selected"in gt&&n(1,_=gt.selected),"showPlaceType"in gt&&n(2,u=gt.showPlaceType),"missingIconsCache"in gt&&n(8,I=gt.missingIconsCache),"iconsBaseUrl"in gt&&n(3,w=gt.iconsBaseUrl)},t.$$.update=()=>{var gt,yt,Nt,Gt;if(t.$$.dirty&1848)do n(10,o--,o),n(4,k=D==null?void 0:D[o]),n(5,G=k?w+k.replace(/ /g,"_")+".svg":void 0);while(o>-1&&(!G||I.has(G)));t.$$.dirty&1&&n(6,l=h.id.startsWith("poi.")?(yt=(gt=h.properties)==null?void 0:gt.categories)==null?void 0:yt.join(", "):((Gt=(Nt=h.properties)==null?void 0:Nt.place_type_name)==null?void 0:Gt[0])??h.place_type[0])},n(10,o=(D==null?void 0:D.length)??0),[h,_,u,w,k,G,l,j,I,H,o,K,lt,dt]}class CE extends mi{constructor(e){super(),gi(this,e,TE,SE,si,{feature:0,selected:1,showPlaceType:2,missingIconsCache:8,iconsBaseUrl:3})}}function PE(t){let e;return{c(){e=Ne("div"),e.innerHTML='<svg viewBox="0 0 18 18" width="24" height="24" class="svelte-7cmwmc"><path fill="#333" d="M4.4 4.4l.8.8c2.1-2.1 5.5-2.1 7.6 0l.8-.8c-2.5-2.5-6.7-2.5-9.2 0z"></path><path opacity=".1" d="M12.8 12.9c-2.1 2.1-5.5 2.1-7.6 0-2.1-2.1-2.1-5.5 0-7.7l-.8-.8c-2.5 2.5-2.5 6.7 0 9.2s6.6 2.5 9.2 0 2.5-6.6 0-9.2l-.8.8c2.2 2.1 2.2 5.6 0 7.7z"></path></svg>',Xt(e,"class","svelte-7cmwmc")},m(n,o){tn(n,e,o)},p:Tn,i:Tn,o:Tn,d(n){n&&Ke(e)}}}class ME extends mi{constructor(e){super(),gi(this,e,null,PE,si,{})}}function AE(t){let e,n;return{c(){e=cc("svg"),n=cc("path"),Xt(n,"d","M30.003-26.765C13.46-26.765 0-14.158 0 1.337c0 23.286 24.535 42.952 28.39 46.04.24.192.402.316.471.376.323.282.732.424 1.142.424.41 0 .82-.142 1.142-.424.068-.06.231-.183.471-.376 3.856-3.09 28.39-22.754 28.39-46.04 0-15.495-13.46-28.102-30.003-28.102Zm1.757 12.469c4.38 0 7.858 1.052 10.431 3.158 2.595 2.105 3.89 4.913 3.89 8.422 0 2.34-.53 4.362-1.593 6.063-1.063 1.702-3.086 3.616-6.063 5.742-2.042 1.51-3.337 2.659-3.89 3.446-.532.787-.8 1.82-.8 3.096v1.914h-8.449V15.18c0-2.041.434-3.815 1.306-5.325.872-1.51 2.467-3.118 4.785-4.82 2.233-1.594 3.7-2.89 4.402-3.889a5.582 5.582 0 0 0 1.087-3.35c0-1.382-.51-2.435-1.531-3.158-1.02-.723-2.45-1.087-4.28-1.087-3.19 0-6.826 1.047-10.91 3.131l-3.472-6.986c4.742-2.659 9.77-3.992 15.087-3.992Zm-1.88 37.324c1.765 0 3.124.472 4.08 1.408.98.936 1.47 2.276 1.47 4.02 0 1.68-.49 3.007-1.47 3.985-.977.957-2.336 1.435-4.08 1.435-1.787 0-3.171-.465-4.15-1.4-.978-.958-1.47-2.298-1.47-4.02 0-1.787.48-3.14 1.436-4.054.957-.915 2.355-1.374 4.184-1.374Z"),Xt(e,"viewBox","0 0 60.006 21.412"),Xt(e,"width","14"),Xt(e,"height","20"),Xt(e,"class","svelte-en2qvf")},m(o,l){tn(o,e,l),we(e,n)},p:Tn,i:Tn,o:Tn,d(o){o&&Ke(e)}}}class LE extends mi{constructor(e){super(),gi(this,e,null,AE,si,{})}}function DE(t){let e,n;return{c(){e=cc("svg"),n=cc("path"),Xt(n,"d","M13.101 14.261 8.74 9.899a4.797 4.797 0 0 1-1.425.748 5.165 5.165 0 0 1-1.603.248c-1.446 0-2.677-.5-3.693-1.503S.495 7.164.495 5.717c0-1.446.508-2.678 1.524-3.693C3.035 1.008 4.266.5 5.712.5c1.448 0 2.672.508 3.675 1.524 1.002 1.015 1.503 2.247 1.503 3.693 0 .558-.08 1.092-.239 1.603-.159.512-.411.98-.757 1.405l4.382 4.4a.74.74 0 0 1 .229.568.81.81 0 0 1-.249.568.787.787 0 0 1-.577.239.787.787 0 0 1-.578-.239ZM5.712 9.223c.97 0 1.796-.342 2.48-1.026a3.378 3.378 0 0 0 1.026-2.48c0-.982-.34-1.818-1.016-2.509-.677-.69-1.507-1.035-2.49-1.035a3.42 3.42 0 0 0-2.509 1.035 3.42 3.42 0 0 0-1.035 2.51c0 .982.345 1.812 1.035 2.488.691.678 1.527 1.017 2.51 1.017Z"),Xt(e,"width","14"),Xt(e,"height","14"),Xt(e,"viewBox","0 0 15 15"),Xt(e,"class","svelte-en2qvf")},m(o,l){tn(o,e,l),we(e,n)},p:Tn,i:Tn,o:Tn,d(o){o&&Ke(e)}}}class kE extends mi{constructor(e){super(),gi(this,e,null,DE,si,{})}}function NE(t,e,n){const o=e[1],l=e[0],h=o-l;return t===o&&n?t:((t-l)%h+h)%h+l}function F0(t){const e=[...t];return e[2]<e[0]&&(e[2]+=360),e}let ff;async function RE(t,e,n){const o=t==null?void 0:t.getCenterAndZoom();for(const l of e??[])if(!(o&&(l.minZoom!=null&&l.minZoom>o[0]||l.maxZoom!=null&&l.maxZoom<o[0]))){if(l.type==="fixed")return l.coordinates.join(",");t:if(l.type==="client-geolocation"){if(ff&&l.cachedLocationExpiry&&ff.time+l.cachedLocationExpiry>Date.now()){if(!ff.coords)break t;return ff.coords}let h;try{return h=await new Promise((_,u)=>{n.signal.addEventListener("abort",()=>{u(Error("aborted"))}),navigator.geolocation.getCurrentPosition(I=>{_([I.coords.longitude,I.coords.latitude].map(w=>w.toFixed(6)).join(","))},I=>{u(I)},l)}),h}catch{}finally{l.cachedLocationExpiry&&(ff={time:Date.now(),coords:h})}if(n.signal.aborted)return}if(l.type==="server-geolocation")return"ip";if(o&&l.type==="map-center")return o[1].toFixed(6)+","+o[2].toFixed(6)}}function B0(t,e,n){const o=t.slice();return o[78]=e[n],o[80]=n,o}function U0(t){let e,n;return e=new ME({}),{c(){Lr(e.$$.fragment)},m(o,l){wr(e,o,l),n=!0},i(o){n||(un(e.$$.fragment,o),n=!0)},o(o){dn(e.$$.fragment,o),n=!1},d(o){Er(e,o)}}}function V0(t){let e,n,o,l,h;return n=new LE({}),{c(){e=Ne("button"),Lr(n.$$.fragment),Xt(e,"type","button"),Xt(e,"title",t[9]),Xt(e,"class","svelte-1r7dvt7"),oc(e,"active",t[0])},m(_,u){tn(_,e,u),wr(n,e,null),o=!0,l||(h=lr(e,"click",t[64]),l=!0)},p(_,u){(!o||u[0]&512)&&Xt(e,"title",_[9]),(!o||u[0]&1)&&oc(e,"active",_[0])},i(_){o||(un(n.$$.fragment,_),o=!0)},o(_){dn(n.$$.fragment,_),o=!1},d(_){_&&Ke(e),Er(n),l=!1,h()}}}function OE(t){let e,n=[],o=new Map,l,h,_,u=qd(t[13]);const I=w=>w[78].id+(w[78].address?","+w[78].address:"");for(let w=0;w<u.length;w+=1){let D=B0(t,u,w),k=I(D);o.set(k,n[w]=G0(k,D))}return{c(){e=Ne("ul");for(let w=0;w<n.length;w+=1)n[w].c();Xt(e,"class","svelte-1r7dvt7")},m(w,D){tn(w,e,D);for(let k=0;k<n.length;k+=1)n[k]&&n[k].m(e,null);l=!0,h||(_=[lr(e,"mouseleave",t[68]),lr(e,"blur",t[69])],h=!0)},p(w,D){D[0]&8940544&&(u=qd(w[13]),Jh(),n=db(n,D,I,1,w,u,o,e,fb,G0,null,B0),Qh())},i(w){if(!l){for(let D=0;D<u.length;D+=1)un(n[D]);l=!0}},o(w){for(let D=0;D<n.length;D+=1)dn(n[D]);l=!1},d(w){w&&Ke(e);for(let D=0;D<n.length;D+=1)n[D].d();h=!1,ua(_)}}}function zE(t){let e,n,o,l,h,_;return n=new ux({}),{c(){e=Ne("div"),Lr(n.$$.fragment),o=qn(),l=Ne("div"),h=Ai(t[7]),Xt(l,"class","svelte-1r7dvt7"),Xt(e,"class","no-results svelte-1r7dvt7")},m(u,I){tn(u,e,I),wr(n,e,null),we(e,o),we(e,l),we(l,h),_=!0},p(u,I){(!_||I[0]&128)&&Eu(h,u[7])},i(u){_||(un(n.$$.fragment,u),_=!0)},o(u){dn(n.$$.fragment,u),_=!1},d(u){u&&Ke(e),Er(n)}}}function FE(t){let e="",n;return{c(){n=Ai(e)},m(o,l){tn(o,n,l)},p:Tn,i:Tn,o:Tn,d(o){o&&Ke(n)}}}function BE(t){let e,n,o,l,h,_,u,I,w,D,k;return n=new ux({}),I=new lx({}),{c(){e=Ne("div"),Lr(n.$$.fragment),o=qn(),l=Ne("div"),h=Ai(t[6]),_=qn(),u=Ne("button"),Lr(I.$$.fragment),Xt(l,"class","svelte-1r7dvt7"),Xt(u,"class","svelte-1r7dvt7"),Xt(e,"class","error svelte-1r7dvt7")},m(G,H){tn(G,e,H),wr(n,e,null),we(e,o),we(e,l),we(l,h),we(e,_),we(e,u),wr(I,u,null),w=!0,D||(k=lr(u,"click",t[65]),D=!0)},p(G,H){(!w||H[0]&64)&&Eu(h,G[6])},i(G){w||(un(n.$$.fragment,G),un(I.$$.fragment,G),w=!0)},o(G){dn(n.$$.fragment,G),dn(I.$$.fragment,G),w=!1},d(G){G&&Ke(e),Er(n),Er(I),D=!1,k()}}}function G0(t,e){let n,o,l;function h(){return e[66](e[80])}function _(){return e[67](e[78])}return o=new CE({props:{feature:e[78],showPlaceType:e[10],selected:e[14]===e[80],missingIconsCache:e[19],iconsBaseUrl:e[11]}}),o.$on("mouseenter",h),o.$on("focus",_),{key:t,first:null,c(){n=nv(),Lr(o.$$.fragment),this.first=n},m(u,I){tn(u,n,I),wr(o,u,I),l=!0},p(u,I){e=u;const w={};I[0]&8192&&(w.feature=e[78]),I[0]&1024&&(w.showPlaceType=e[10]),I[0]&24576&&(w.selected=e[14]===e[80]),I[0]&2048&&(w.iconsBaseUrl=e[11]),o.$set(w)},i(u){l||(un(o.$$.fragment,u),l=!0)},o(u){dn(o.$$.fragment,u),l=!1},d(u){u&&Ke(n),Er(o,u)}}}function UE(t){let e,n,o,l,h,_,u,I,w,D,k,G,H,j,K,lt,dt,xt,gt,yt,Nt,Gt=!1;h=new kE({}),k=new lx({});let Ut=t[18]&&U0(),Zt=t[5]===!0&&V0(t);const qt=t[56].default,Qt=Bd(qt,t,t[55],null),ie=[BE,FE,zE,OE],ve=[];function Ue(Rt,Se){var Ye,yn;return Rt[17]?0:Rt[15]?((Ye=Rt[13])==null?void 0:Ye.length)===0?2:Rt[15]&&((yn=Rt[13])!=null&&yn.length)?3:-1:1}return~(lt=Ue(t))&&(dt=ve[lt]=ie[lt](t)),{c(){e=qn(),n=Ne("form"),o=Ne("div"),l=Ne("button"),Lr(h.$$.fragment),_=qn(),u=Ne("input"),I=qn(),w=Ne("div"),D=Ne("button"),Lr(k.$$.fragment),G=qn(),Ut&&Ut.c(),H=qn(),Zt&&Zt.c(),j=qn(),Qt&&Qt.c(),K=qn(),dt&&dt.c(),Xt(l,"class","search-button svelte-1r7dvt7"),Xt(l,"type","button"),Xt(u,"placeholder",t[8]),Xt(u,"aria-label",t[8]),Xt(u,"class","svelte-1r7dvt7"),Xt(D,"type","button"),Xt(D,"title",t[3]),Xt(D,"class","svelte-1r7dvt7"),Xt(w,"class","clear-button-container svelte-1r7dvt7"),oc(w,"displayable",t[1]!==""),Xt(o,"class","input-group svelte-1r7dvt7"),Xt(n,"tabindex","0"),Xt(n,"class",xt=Hy(t[2])+" svelte-1r7dvt7"),oc(n,"can-collapse",t[4]&&t[1]==="")},m(Rt,Se){tn(Rt,e,Se),tn(Rt,n,Se),we(n,o),we(o,l),wr(h,l,null),we(o,_),we(o,u),t[58](u),Iu(u,t[1]),we(o,I),we(o,w),we(w,D),wr(k,D,null),we(w,G),Ut&&Ut.m(w,null),we(o,H),Zt&&Zt.m(o,null),we(o,j),Qt&&Qt.m(o,null),we(n,K),~lt&&ve[lt].m(n,null),gt=!0,yt||(Nt=[lr(l,"click",t[57]),lr(u,"input",t[59]),lr(u,"focus",t[60]),lr(u,"blur",t[61]),lr(u,"keydown",t[21]),lr(u,"input",t[62]),lr(D,"click",t[63]),lr(n,"submit",ob(t[20]))],yt=!0)},p(Rt,Se){(!gt||Se[0]&256)&&Xt(u,"placeholder",Rt[8]),(!gt||Se[0]&256)&&Xt(u,"aria-label",Rt[8]),Se[0]&2&&u.value!==Rt[1]&&Iu(u,Rt[1]),(!gt||Se[0]&8)&&Xt(D,"title",Rt[3]),Rt[18]?Ut?Se[0]&262144&&un(Ut,1):(Ut=U0(),Ut.c(),un(Ut,1),Ut.m(w,null)):Ut&&(Jh(),dn(Ut,1,1,()=>{Ut=null}),Qh()),(!gt||Se[0]&2)&&oc(w,"displayable",Rt[1]!==""),Rt[5]===!0?Zt?(Zt.p(Rt,Se),Se[0]&32&&un(Zt,1)):(Zt=V0(Rt),Zt.c(),un(Zt,1),Zt.m(o,j)):Zt&&(Jh(),dn(Zt,1,1,()=>{Zt=null}),Qh()),Qt&&Qt.p&&(!gt||Se[1]&16777216)&&Vd(Qt,qt,Rt,Rt[55],gt?Ud(qt,Rt[55],Se,null):Gd(Rt[55]),null);let Ye=lt;lt=Ue(Rt),lt===Ye?~lt&&ve[lt].p(Rt,Se):(dt&&(Jh(),dn(ve[Ye],1,1,()=>{ve[Ye]=null}),Qh()),~lt?(dt=ve[lt],dt?dt.p(Rt,Se):(dt=ve[lt]=ie[lt](Rt),dt.c()),un(dt,1),dt.m(n,null)):dt=null),(!gt||Se[0]&4&&xt!==(xt=Hy(Rt[2])+" svelte-1r7dvt7"))&&Xt(n,"class",xt),(!gt||Se[0]&22)&&oc(n,"can-collapse",Rt[4]&&Rt[1]==="")},i(Rt){gt||(un(Gt),un(h.$$.fragment,Rt),un(k.$$.fragment,Rt),un(Ut),un(Zt),un(Qt,Rt),un(dt),gt=!0)},o(Rt){dn(Gt),dn(h.$$.fragment,Rt),dn(k.$$.fragment,Rt),dn(Ut),dn(Zt),dn(Qt,Rt),dn(dt),gt=!1},d(Rt){Rt&&(Ke(e),Ke(n)),Er(h),t[58](null),Er(k),Ut&&Ut.d(),Zt&&Zt.d(),Qt&&Qt.d(Rt),~lt&&ve[lt].d(),yt=!1,ua(Nt)}}}function VE(t,e,n){let o,{$$slots:l={},$$scope:h}=e,{class:_=void 0}=e,{apiKey:u}=e,{bbox:I=void 0}=e,{clearButtonTitle:w="clear"}=e,{clearOnBlur:D=!1}=e,{collapsed:k=!1}=e,{country:G=void 0}=e,{debounceSearch:H=200}=e,{enableReverse:j=!1}=e,{errorMessage:K="Something went wrong…"}=e,{filter:lt=()=>!0}=e,{flyTo:dt=!0}=e,{fuzzyMatch:xt=!0}=e,{language:gt=void 0}=e,{limit:yt=void 0}=e,{mapController:Nt=void 0}=e,{minLength:Gt=2}=e,{noResultsMessage:Ut="Oops! Looks like you're trying to predict something that's not quite right. We can't seem to find what you're looking for. Maybe try double-checking your spelling or try a different search term. Keep on typing - we'll do our best to get you where you need to go!"}=e,{placeholder:Zt="Search"}=e,{proximity:qt=[{type:"server-geolocation"}]}=e,{reverseActive:Qt=j==="always"}=e,{reverseButtonTitle:ie="toggle reverse geocoding"}=e,{searchValue:ve=""}=e,{showFullGeometry:Ue=!0}=e,{showPlaceType:Rt="ifNeeded"}=e,{showResultsWhileTyping:Se=!0}=e,{types:Ye=void 0}=e,{excludeTypes:yn=!1}=e,{zoom:tr=16}=e,{maxZoom:Xn=18}=e,{apiUrl:_i="https://api.maptiler.com/geocoding"}=e,{fetchParameters:An={}}=e,{iconsBaseUrl:pr="https://cdn.maptiler.com/maptiler-geocoding-control/v1.1.1/icons/"}=e,{adjustUrlQuery:wn=V=>{}}=e;function Yn(){St.focus()}function ur(){St.blur()}function Uo(V,z=!0){n(1,ve=V),z?(n(14,Gn=-1),os()):(Ki(),setTimeout(()=>{St.focus(),St.select()}))}function Ur(){n(13,_n=void 0),n(52,We=void 0),n(14,Gn=-1)}function Qe(){n(51,cr=[]),n(52,We=void 0)}let Ni=!1,_n,cr,We,js="",St,Gn=-1,Sr,Ln=[],pn,io,rs,is;const Tr=new Set,Nr=Km();og(()=>{Nt&&(Nt.setEventHandler(void 0),Nt.indicateReverse(!1),Nt.setSelectedMarker(-1),Nt.setMarkers(void 0,void 0))});function os(V){if(io&&(clearTimeout(io),io=void 0),Gn>-1&&_n)n(52,We=_n[Gn]),n(1,ve=We.place_name.replace(/,.*/,"")),n(17,Sr=void 0),n(51,cr=void 0),n(14,Gn=-1);else if(ve){const z=V||!Co();te(ve,{exact:!0}).then(()=>{n(51,cr=_n),n(52,We=void 0),z&&Ri()}).catch(B=>n(17,Sr=B))}}function Co(){return/^-?\d+(\.\d+)?,-?\d+(\.\d+)?$/.test(ve)}async function te(V,{byId:z=!1,exact:B=!1}={}){n(17,Sr=void 0),pn==null||pn.abort();const W=new AbortController;n(18,pn=W);try{const J=Co(),st=new URLSearchParams;if(gt!==void 0&&st.set("language",Array.isArray(gt)?gt.join(","):gt??""),Ye&&st.set("types",Ye.join(",")),yn&&st.set("excludeTypes",String(yn)),I&&st.set("bbox",I.map(vt=>vt.toFixed(6)).join(",")),G&&st.set("country",Array.isArray(G)?G.join(","):G),!z&&!J){const vt=await RE(Nt,qt,W);vt&&st.set("proximity",vt),(B||!Se)&&st.set("autocomplete","false"),st.set("fuzzyMatch",String(xt))}yt!==void 0&&(!J||(Ye==null?void 0:Ye.length)===1)&&st.set("limit",String(yt)),st.set("key",u),wn(st);const mt=_i+"/"+encodeURIComponent(V)+".json?"+st.toString();if(mt===js){z?(n(13,_n=void 0),n(52,We=Ln[0])):n(13,_n=Ln);return}js=mt;const ut=await fetch(mt,{signal:W.signal,...An});if(!ut.ok)throw new Error;const at=await ut.json();Nr("response",{url:mt,featureCollection:at}),z?(n(13,_n=void 0),n(52,We=at.features[0]),Ln=[We]):(n(13,_n=at.features.filter(lt)),Ln=_n,J&&St.focus())}catch(J){if(J&&typeof J=="object"&&"name"in J&&J.name==="AbortError")return;throw J}finally{W===pn&&n(18,pn=void 0)}}function Ri(){var B;if(!(cr!=null&&cr.length)||!dt)return;const V=[180,90,-180,-90],z=!cr.some(W=>!W.matching_text);for(const W of cr)if(z||!W.matching_text)for(const J of[0,1,2,3])V[J]=Math[J<2?"min":"max"](V[J],((B=W.bbox)==null?void 0:B[J])??W.center[J%2]);Nt&&cr.length>0&&(We&&V[0]===V[2]&&V[1]===V[3]?Nt.flyTo(We.center,tr):Nt.fitBounds(F0(V),50,Xn))}function Vr(V){n(0,Qt=j==="always"),Uo(NE(V[0],[-180,180],!0).toFixed(6)+","+V[1].toFixed(6))}function ss(V){if(!_n)return;let z=V.key==="ArrowDown"?1:V.key==="ArrowUp"?-1:0;z?(Gn===-1&&z===-1&&n(14,Gn=_n.length),n(14,Gn+=z),Gn>=_n.length&&n(14,Gn=-1),V.preventDefault()):["ArrowLeft","ArrowRight","Home","End"].includes(V.key)&&n(14,Gn=-1)}function Ki(V=!0){if(n(17,Sr=void 0),Se){if(io&&clearTimeout(io),ve.length<Gt)return;const z=ve;io=window.setTimeout(()=>{te(z).catch(B=>n(17,Sr=B))},V?H:0)}else n(13,_n=void 0),n(17,Sr=void 0)}function ee(V){n(52,We=V),n(1,ve=V.place_name),n(14,Gn=-1)}const on=()=>St.focus();function Ve(V){yo[V?"unshift":"push"](()=>{St=V,n(16,St)})}function yi(){ve=this.value,n(1,ve),n(12,Ni),n(26,D)}const hr=()=>n(12,Ni=!0),Xe=()=>n(12,Ni=!1),oo=()=>Ki(),Gr=()=>{n(1,ve=""),St.focus()},Ii=()=>n(0,Qt=!Qt),as=()=>n(17,Sr=void 0),Jr=V=>n(14,Gn=V),Jn=V=>ee(V),Wa=()=>n(14,Gn=-1),Vo=()=>{};return t.$$set=V=>{"class"in V&&n(2,_=V.class),"apiKey"in V&&n(24,u=V.apiKey),"bbox"in V&&n(25,I=V.bbox),"clearButtonTitle"in V&&n(3,w=V.clearButtonTitle),"clearOnBlur"in V&&n(26,D=V.clearOnBlur),"collapsed"in V&&n(4,k=V.collapsed),"country"in V&&n(27,G=V.country),"debounceSearch"in V&&n(28,H=V.debounceSearch),"enableReverse"in V&&n(5,j=V.enableReverse),"errorMessage"in V&&n(6,K=V.errorMessage),"filter"in V&&n(29,lt=V.filter),"flyTo"in V&&n(30,dt=V.flyTo),"fuzzyMatch"in V&&n(31,xt=V.fuzzyMatch),"language"in V&&n(32,gt=V.language),"limit"in V&&n(33,yt=V.limit),"mapController"in V&&n(34,Nt=V.mapController),"minLength"in V&&n(35,Gt=V.minLength),"noResultsMessage"in V&&n(7,Ut=V.noResultsMessage),"placeholder"in V&&n(8,Zt=V.placeholder),"proximity"in V&&n(36,qt=V.proximity),"reverseActive"in V&&n(0,Qt=V.reverseActive),"reverseButtonTitle"in V&&n(9,ie=V.reverseButtonTitle),"searchValue"in V&&n(1,ve=V.searchValue),"showFullGeometry"in V&&n(37,Ue=V.showFullGeometry),"showPlaceType"in V&&n(10,Rt=V.showPlaceType),"showResultsWhileTyping"in V&&n(38,Se=V.showResultsWhileTyping),"types"in V&&n(39,Ye=V.types),"excludeTypes"in V&&n(40,yn=V.excludeTypes),"zoom"in V&&n(41,tr=V.zoom),"maxZoom"in V&&n(42,Xn=V.maxZoom),"apiUrl"in V&&n(43,_i=V.apiUrl),"fetchParameters"in V&&n(44,An=V.fetchParameters),"iconsBaseUrl"in V&&n(11,pr=V.iconsBaseUrl),"adjustUrlQuery"in V&&n(45,wn=V.adjustUrlQuery),"$$scope"in V&&n(55,h=V.$$scope)},t.$$.update=()=>{if(t.$$.dirty[0]&67112960&&setTimeout(()=>{n(15,rs=Ni),D&&!Ni&&n(1,ve="")}),t.$$.dirty[0]&8194|t.$$.dirty[1]&16&&ve.length<Gt&&(n(52,We=void 0),n(13,_n=void 0),n(17,Sr=void 0),n(51,cr=_n)),t.$$.dirty[1]&2097216&&Ue&&We&&!We.address&&We.geometry.type==="Point"&&te(We.id,{byId:!0}).catch(V=>n(17,Sr=V)),t.$$.dirty[0]&1073741824|t.$$.dirty[1]&6294536&&(Nt&&We&&We.id!==is&&dt&&(!We.bbox||We.bbox[0]===We.bbox[2]&&We.bbox[1]===We.bbox[3]?Nt.flyTo(We.center,We.id.startsWith("poi.")||We.id.startsWith("address.")?Xn:tr):Nt.fitBounds(F0(We.bbox),50,Xn),n(13,_n=void 0),n(51,cr=void 0),n(14,Gn=-1)),n(53,is=We==null?void 0:We.id)),t.$$.dirty[0]&8192|t.$$.dirty[1]&1048576&&cr!==_n&&n(51,cr=void 0),t.$$.dirty[1]&3145736&&Nt&&Nt.setMarkers(cr,We),t.$$.dirty[0]&2&&n(14,Gn=-1),t.$$.dirty[0]&40961|t.$$.dirty[1]&8&&Nt&&Nt.setEventHandler(V=>{switch(V.type){case"mapClick":Qt&&Vr(V.coordinates);break;case"markerClick":{const z=_n==null?void 0:_n.find(B=>B.id===V.id);z&&ee(z)}break;case"markerMouseEnter":n(14,Gn=rs?(_n==null?void 0:_n.findIndex(z=>z.id===V.id))??-1:-1);break;case"markerMouseLeave":n(14,Gn=-1);break}}),t.$$.dirty[0]&16384|t.$$.dirty[1]&8&&(Nt==null||Nt.setSelectedMarker(Gn)),t.$$.dirty[0]&24576&&n(54,o=_n==null?void 0:_n[Gn]),t.$$.dirty[0]&2|t.$$.dirty[1]&8){const V=/^(-?\d+(?:\.\d*)?),(-?\d+(?:\.\d*)?)$/.exec(ve);Nt==null||Nt.setReverseMarker(V?[Number(V[1]),Number(V[2])]:void 0)}t.$$.dirty[1]&8388608&&Nr("select",o),t.$$.dirty[1]&2097152&&Nr("pick",We),t.$$.dirty[0]&40960&&Nr("optionsVisibilityChange",rs&&!!_n),t.$$.dirty[0]&8192&&Nr("featuresListed",_n),t.$$.dirty[1]&1048576&&Nr("featuresMarked",cr),t.$$.dirty[0]&1&&Nr("reverseToggle",Qt),t.$$.dirty[0]&2&&Nr("queryChange",ve),t.$$.dirty[0]&1|t.$$.dirty[1]&8&&Nt&&Nt.indicateReverse(Qt)},[Qt,ve,_,w,k,j,K,Ut,Zt,ie,Rt,pr,Ni,_n,Gn,rs,St,Sr,pn,Tr,os,ss,Ki,ee,u,I,D,G,H,lt,dt,xt,gt,yt,Nt,Gt,qt,Ue,Se,Ye,yn,tr,Xn,_i,An,wn,Yn,ur,Uo,Ur,Qe,cr,We,is,o,h,l,on,Ve,yi,hr,Xe,oo,Gr,Ii,as,Jr,Jn,Wa,Vo]}class GE extends mi{constructor(e){super(),gi(this,e,VE,UE,si,{class:2,apiKey:24,bbox:25,clearButtonTitle:3,clearOnBlur:26,collapsed:4,country:27,debounceSearch:28,enableReverse:5,errorMessage:6,filter:29,flyTo:30,fuzzyMatch:31,language:32,limit:33,mapController:34,minLength:35,noResultsMessage:7,placeholder:8,proximity:36,reverseActive:0,reverseButtonTitle:9,searchValue:1,showFullGeometry:37,showPlaceType:10,showResultsWhileTyping:38,types:39,excludeTypes:40,zoom:41,maxZoom:42,apiUrl:43,fetchParameters:44,iconsBaseUrl:11,adjustUrlQuery:45,focus:46,blur:47,setQuery:48,clearList:49,clearMap:50},null,[-1,-1,-1])}get focus(){return this.$$.ctx[46]}get blur(){return this.$$.ctx[47]}get setQuery(){return this.$$.ctx[48]}get clearList(){return this.$$.ctx[49]}get clearMap(){return this.$$.ctx[50]}}const Xh=[];function Nu(t,e=Tn){let n;const o=new Set;function l(u){if(si(t,u)&&(t=u,n)){const I=!Xh.length;for(const w of o)w[1](),Xh.push(w,t);if(I){for(let w=0;w<Xh.length;w+=2)Xh[w][0](Xh[w+1]);Xh.length=0}}}function h(u){l(u(t))}function _(u,I=Tn){const w=[u,I];return o.add(w),o.size===1&&(n=e(l,h)||Tn),u(t),()=>{o.delete(w),o.size===0&&n&&(n(),n=null)}}return{set:l,update:h,subscribe:_}}const Pp=Nu(null),sh=Nu(null),Gm=Nu(null),jm=Nu(null),qm=Nu(null),Zm=Nu(null),Xm=Nu(null),Ym=Nu(null),Wm=Nu(null);sh.subscribe(t=>{jm.set(null),qm.set(null),Zm.set(null),Xm.set(null),Ym.set(null),Wm.set(null)});function j0(t){let e,n,o;return n=new GE({props:{mapController:t[0],apiKey:"MZEJTanw3WpxRvt7qDfo"}}),{c(){e=Ne("div"),Lr(n.$$.fragment),Xt(e,"class","svelte-9gcjuu")},m(l,h){tn(l,e,h),wr(n,e,null),o=!0},p(l,h){const _={};h&1&&(_.mapController=l[0]),n.$set(_)},i(l){o||(un(n.$$.fragment,l),o=!0)},o(l){dn(n.$$.fragment,l),o=!1},d(l){l&&Ke(e),Er(n)}}}function jE(t){let e,n,o=t[0]&&j0(t);return{c(){o&&o.c(),e=nv()},m(l,h){o&&o.m(l,h),tn(l,e,h),n=!0},p(l,[h]){l[0]?o?(o.p(l,h),h&1&&un(o,1)):(o=j0(l),o.c(),un(o,1),o.m(e.parentNode,e)):o&&(Jh(),dn(o,1,1,()=>{o=null}),Qh())},i(l){n||(un(o),n=!0)},o(l){dn(o),n=!1},d(l){l&&Ke(e),o&&o.d(l)}}}function qE(t,e,n){let o;xs(t,Pp,h=>n(1,o=h));let l;return ig(()=>{n(0,l=gE(o,Pb))}),[l]}class BI extends mi{constructor(e){super(),gi(this,e,qE,jE,si,{})}}function cx(t,e,n){if(t!==null)for(var o,l,h,_,u,I,w,D=0,k=0,G,H=t.type,j=H==="FeatureCollection",K=H==="Feature",lt=j?t.features.length:1,dt=0;dt<lt;dt++){w=j?t.features[dt].geometry:K?t.geometry:t,G=w?w.type==="GeometryCollection":!1,u=G?w.geometries.length:1;for(var xt=0;xt<u;xt++){var gt=0,yt=0;if(_=G?w.geometries[xt]:w,_!==null){I=_.coordinates;var Nt=_.type;switch(D=n&&(Nt==="Polygon"||Nt==="MultiPolygon")?1:0,Nt){case null:break;case"Point":if(e(I,k,dt,gt,yt)===!1)return!1;k++,gt++;break;case"LineString":case"MultiPoint":for(o=0;o<I.length;o++){if(e(I[o],k,dt,gt,yt)===!1)return!1;k++,Nt==="MultiPoint"&&gt++}Nt==="LineString"&&gt++;break;case"Polygon":case"MultiLineString":for(o=0;o<I.length;o++){for(l=0;l<I[o].length-D;l++){if(e(I[o][l],k,dt,gt,yt)===!1)return!1;k++}Nt==="MultiLineString"&&gt++,Nt==="Polygon"&&yt++}Nt==="Polygon"&&gt++;break;case"MultiPolygon":for(o=0;o<I.length;o++){for(yt=0,l=0;l<I[o].length;l++){for(h=0;h<I[o][l].length-D;h++){if(e(I[o][l][h],k,dt,gt,yt)===!1)return!1;k++}yt++}gt++}break;case"GeometryCollection":for(o=0;o<_.geometries.length;o++)if(cx(_.geometries[o],e,n)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function Hm(t){var e=[1/0,1/0,-1/0,-1/0];return cx(t,function(n){e[0]>n[0]&&(e[0]=n[0]),e[1]>n[1]&&(e[1]=n[1]),e[2]<n[0]&&(e[2]=n[0]),e[3]<n[1]&&(e[3]=n[1])}),e}Hm.default=Hm;function hx(t,e){var n=document.createElement("a");n.setAttribute("href","data:text/plain;charset=utf-8, "+encodeURIComponent(e)),n.setAttribute("download",t),document.body.appendChild(n),n.click(),document.body.removeChild(n)}function wg(t,e,n){let o=["case"];for(let[l,h]of Object.entries(e))o.push(["==",["get",t],l]),o.push(h);return o.push(n),o}function px(t,e,n){return["case",["boolean",["feature-state",t],!1],n,e]}function q0(){return{type:"FeatureCollection",features:[]}}function fx(t){return Hm(t)}function ZE(t){let e=nb(Pp),n,o=!1;for(let l=Z0.length-1;l>=0;l--){let h=Z0[l];if(h==t){o=!0;break}e.getLayer(h)&&(n=h)}if(!o)throw new Error(`Layer ID ${t} not defined in layerZorder`);return n}const Z0=["boundary-layer","lane-polygons-layer","intersection-polygons-layer","lane-markings-layer","intersection-markings-layer","movements-layer","connected-roads-layer","current-way-layer","road_label"];function XE(t,e,n){let o;xs(t,Pp,yt=>n(8,o=yt));let{source:l}=e,{show:h=!0}=e,{gj:_}=e,{layerStyle:u}=e,{interactive:I=!1}=e,{hoveredFeature:w=null}=e,{clickedFeature:D=null}=e,{clickedFeaturePosition:k=null}=e,G,H,j=`${l}-layer`;ig(()=>{K(),o.addSource(l,{type:"geojson",data:_??q0()}),o.addLayer({id:j,source:l,...u},ZE(j)),h||o.setLayoutProperty(j,"visibility","none"),I&&(o.on("mousemove",j,lt),o.on("mouseleave",j,dt),o.on("click",xt))}),og(()=>{I&&(o.off("mousemove",lt),o.off("mouseleave",dt),o.off("click",xt),gt()),o.getLayer(j)&&o.removeLayer(j),o.removeSource(l)});function K(){if(_&&"features"in _)for(let[yt,Nt]of _.features.entries())Nt.id=yt+1}function lt(yt){let Nt=yt.features??[];Nt.length>0&&G!=Nt[0].id&&(gt(),G=Nt[0].id,o.setFeatureState({source:l,id:G},{hover:!0}),_&&"features"in _&&n(0,w=_.features.find(Gt=>Gt.id==G)))}function dt(){gt(),n(0,w=null),G=void 0}function xt(yt){D!==null&&o.setFeatureState({source:l,id:H},{clicked:!1});let Nt=o.queryRenderedFeatures(yt.point,{layers:[j]});Nt.length==1?(H=Nt[0].id,o.setFeatureState({source:l,id:H},{clicked:!0}),_&&"features"in _&&(n(1,D=_.features.find(Gt=>Gt.id==H)),n(2,k=yt.lngLat))):(n(1,D=null),n(2,k=null),H=void 0)}function gt(){G!==void 0&&o.setFeatureState({source:l,id:G},{hover:!1})}return t.$$set=yt=>{"source"in yt&&n(3,l=yt.source),"show"in yt&&n(4,h=yt.show),"gj"in yt&&n(5,_=yt.gj),"layerStyle"in yt&&n(6,u=yt.layerStyle),"interactive"in yt&&n(7,I=yt.interactive),"hoveredFeature"in yt&&n(0,w=yt.hoveredFeature),"clickedFeature"in yt&&n(1,D=yt.clickedFeature),"clickedFeaturePosition"in yt&&n(2,k=yt.clickedFeaturePosition)},t.$$.update=()=>{if(t.$$.dirty&296){let yt=o.getSource(l);yt&&(console.log(`GeoJSON data for ${l} changed, updating`),K(),yt.setData(_??q0()),n(0,w=null),G=void 0,n(1,D=null),n(2,k=null),H=void 0)}t.$$.dirty&272&&o.getLayer(j)&&o.setLayoutProperty(j,"visibility",h?"visible":"none")},[w,D,k,l,h,_,u,I,o]}class $f extends mi{constructor(e){super(),gi(this,e,XE,null,si,{source:3,show:4,gj:5,layerStyle:6,interactive:7,hoveredFeature:0,clickedFeature:1,clickedFeaturePosition:2})}}const YE=t=>({}),X0=t=>({}),WE=t=>({}),Y0=t=>({});function HE(t){let e,n,o,l;const h=t[1].left,_=Bd(h,t,t[0],Y0),u=t[1].main,I=Bd(u,t,t[0],X0);return{c(){e=Ne("div"),_&&_.c(),n=qn(),o=Ne("div"),I&&I.c(),Xt(e,"class","left svelte-we0xuz"),Xt(o,"class","main svelte-we0xuz")},m(w,D){tn(w,e,D),_&&_.m(e,null),tn(w,n,D),tn(w,o,D),I&&I.m(o,null),l=!0},p(w,[D]){_&&_.p&&(!l||D&1)&&Vd(_,h,w,w[0],l?Ud(h,w[0],D,WE):Gd(w[0]),Y0),I&&I.p&&(!l||D&1)&&Vd(I,u,w,w[0],l?Ud(u,w[0],D,YE):Gd(w[0]),X0)},i(w){l||(un(_,w),un(I,w),l=!0)},o(w){dn(_,w),dn(I,w),l=!1},d(w){w&&(Ke(e),Ke(n),Ke(o)),_&&_.d(w),I&&I.d(w)}}}function $E(t,e,n){let{$$slots:o={},$$scope:l}=e;return t.$$set=h=>{"$$scope"in h&&n(0,l=h.$$scope)},[l,o]}class UI extends mi{constructor(e){super(),gi(this,e,$E,HE,si,{})}}function W0(t){let e;const n=t[3].default,o=Bd(n,t,t[2],null);return{c(){o&&o.c()},m(l,h){o&&o.m(l,h),e=!0},p(l,h){o&&o.p&&(!e||h&4)&&Vd(o,n,l,l[2],e?Ud(n,l[2],h,null):Gd(l[2]),null)},i(l){e||(un(o,l),e=!0)},o(l){dn(o,l),e=!1},d(l){o&&o.d(l)}}}function KE(t){let e,n,o=t[1]&&W0(t);return{c(){e=Ne("div"),o&&o.c(),Xt(e,"class","map svelte-12dpf1u")},m(l,h){tn(l,e,h),o&&o.m(e,null),t[4](e),n=!0},p(l,[h]){l[1]?o?(o.p(l,h),h&2&&un(o,1)):(o=W0(l),o.c(),un(o,1),o.m(e,null)):o&&(Jh(),dn(o,1,1,()=>{o=null}),Qh())},i(l){n||(un(o),n=!0)},o(l){dn(o),n=!1},d(l){l&&Ke(e),o&&o.d(),t[4](null)}}}function JE(t,e,n){let{$$slots:o={},$$scope:l}=e,h,_,u=!1;ig(()=>{h=new Od.Map({container:_,style:"https://api.maptiler.com/maps/streets/style.json?key=MZEJTanw3WpxRvt7qDfo",hash:!0}),h.addControl(new Od.ScaleControl({})),h.addControl(new Od.NavigationControl({}),"bottom-right"),h.on("load",()=>{n(1,u=!0),Pp.set(h)}),new ResizeObserver(()=>{h.resize()}).observe(_)}),og(()=>{h.remove()});function I(w){yo[w?"unshift":"push"](()=>{_=w,n(0,_)})}return t.$$set=w=>{"$$scope"in w&&n(2,l=w.$$scope)},[_,u,l,o,I]}class VI extends mi{constructor(e){super(),gi(this,e,JE,KE,si,{})}}const{window:QE}=rb;function H0(t,e,n){const o=t.slice();return o[6]=e[n],o}function $0(t){let e,n=t[6]+"",o,l;return{c(){e=Ne("option"),o=Ai(n),e.__value=l=t[6],Iu(e,e.__value)},m(h,_){tn(h,e,_),we(e,o)},p(h,_){_&2&&n!==(n=h[6]+"")&&Eu(o,n),_&2&&l!==(l=h[6])&&(e.__value=l,Iu(e,e.__value))},d(h){h&&Ke(e)}}}function tI(t){let e,n,o,l,h=qd(t[1]),_=[];for(let u=0;u<h.length;u+=1)_[u]=$0(H0(t,h,u));return{c(){e=Ne("select"),n=Ne("option"),n.textContent="None";for(let u=0;u<_.length;u+=1)_[u].c();n.__value="none",Iu(n,n.__value),t[0]===void 0&&Tf(()=>t[4].call(e))},m(u,I){tn(u,e,I),we(e,n);for(let w=0;w<_.length;w+=1)_[w]&&_[w].m(e,null);jd(e,t[0],!0),o||(l=[lr(QE,"popstate",t[3]),lr(e,"change",t[4]),lr(e,"change",t[2])],o=!0)},p(u,[I]){if(I&2){h=qd(u[1]);let w;for(w=0;w<h.length;w+=1){const D=H0(u,h,w);_[w]?_[w].p(D,I):(_[w]=$0(D),_[w].c(),_[w].m(e,null))}for(;w<_.length;w+=1)_[w].d(1);_.length=h.length}I&3&&jd(e,u[0])},i:Tn,o:Tn,d(u){u&&Ke(e),ib(_,u),o=!1,ua(l)}}}function eI(t,e,n){const o=Km();let{testCase:l}=e,h=[];ig(async()=>{let w=await fetch("/osm2streets//tests.json");n(1,h=await w.json()),l!="none"&&await _()});async function _(){if(l=="none"){o("resetToNone");return}try{o("loading","Loading built-in boundary and OSM XML");let k=(await(await fetch(`/osm2streets//tests/${l}/boundary.json`)).json()).features[0],H=await(await fetch(`/osm2streets//tests/${l}/input.osm`)).text();o("load",{testCase:l,boundaryGj:k,osmXml:H})}catch(w){o("error",w.toString())}}async function u(){let w=new URLSearchParams(window.location.search).get("test")||"none";console.log(`Navigated back in history -- changing test case from ${l} to ${w}`),n(0,l=w),await _()}function I(){l=rv(this),n(0,l),n(1,h)}return t.$$set=w=>{"testCase"in w&&n(0,l=w.testCase)},[l,h,_,u,I]}class nI extends mi{constructor(e){super(),gi(this,e,eI,tI,si,{testCase:0})}}var dx={exports:{}};(function(t,e){(function(n,o){t.exports=o()})(Wh,function(){var n=function(b,M){var Z={drag:[],click:[],mousemove:[],mousedown:[],mouseup:[],mouseout:[],keydown:[],keyup:[],touchstart:[],touchmove:[],touchend:[],tap:[]},it={on:function(_t,wt,Wt){if(Z[_t]===void 0)throw new Error("Invalid event type: "+_t);Z[_t].push({selector:wt,fn:Wt})},render:function(_t){M.store.featureChanged(_t)}},ht=function(_t,wt){for(var Wt=Z[_t],ne=Wt.length;ne--;){var me=Wt[ne];if(me.selector(wt)){me.fn.call(it,wt)||M.store.render(),M.ui.updateMapClasses();break}}};return b.start.call(it),{render:b.render,stop:function(){b.stop&&b.stop()},trash:function(){b.trash&&(b.trash(),M.store.render())},combineFeatures:function(){b.combineFeatures&&b.combineFeatures()},uncombineFeatures:function(){b.uncombineFeatures&&b.uncombineFeatures()},drag:function(_t){ht("drag",_t)},click:function(_t){ht("click",_t)},mousemove:function(_t){ht("mousemove",_t)},mousedown:function(_t){ht("mousedown",_t)},mouseup:function(_t){ht("mouseup",_t)},mouseout:function(_t){ht("mouseout",_t)},keydown:function(_t){ht("keydown",_t)},keyup:function(_t){ht("keyup",_t)},touchstart:function(_t){ht("touchstart",_t)},touchmove:function(_t){ht("touchmove",_t)},touchend:function(_t){ht("touchend",_t)},tap:function(_t){ht("tap",_t)}}};function o(b){if(b.__esModule)return b;var M=b.default;if(typeof M=="function"){var Z=function it(){if(this instanceof it){var ht=[null];ht.push.apply(ht,arguments);var _t=Function.bind.apply(M,ht);return new _t}return M.apply(this,arguments)};Z.prototype=M.prototype}else Z={};return Object.defineProperty(Z,"__esModule",{value:!0}),Object.keys(b).forEach(function(it){var ht=Object.getOwnPropertyDescriptor(b,it);Object.defineProperty(Z,it,ht.get?ht:{enumerable:!0,get:function(){return b[it]}})}),Z}var l={},h={RADIUS:6378137,FLATTENING:1/298.257223563,POLAR_RADIUS:63567523142e-4},_=h;function u(b){var M=0;if(b&&b.length>0){M+=Math.abs(I(b[0]));for(var Z=1;Z<b.length;Z++)M-=Math.abs(I(b[Z]))}return M}function I(b){var M,Z,it,ht,_t,wt,Wt=0,ne=b.length;if(ne>2){for(wt=0;wt<ne;wt++)wt===ne-2?(it=ne-2,ht=ne-1,_t=0):wt===ne-1?(it=ne-1,ht=0,_t=1):(it=wt,ht=wt+1,_t=wt+2),M=b[it],Z=b[ht],Wt+=(w(b[_t][0])-w(M[0]))*Math.sin(w(Z[1]));Wt=Wt*_.RADIUS*_.RADIUS/2}return Wt}function w(b){return b*Math.PI/180}l.geometry=function b(M){var Z,it=0;switch(M.type){case"Polygon":return u(M.coordinates);case"MultiPolygon":for(Z=0;Z<M.coordinates.length;Z++)it+=u(M.coordinates[Z]);return it;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0;case"GeometryCollection":for(Z=0;Z<M.geometries.length;Z++)it+=b(M.geometries[Z]);return it}},l.ring=I;var D={CONTROL_BASE:"mapboxgl-ctrl",CONTROL_PREFIX:"mapboxgl-ctrl-",CONTROL_BUTTON:"mapbox-gl-draw_ctrl-draw-btn",CONTROL_BUTTON_LINE:"mapbox-gl-draw_line",CONTROL_BUTTON_POLYGON:"mapbox-gl-draw_polygon",CONTROL_BUTTON_POINT:"mapbox-gl-draw_point",CONTROL_BUTTON_TRASH:"mapbox-gl-draw_trash",CONTROL_BUTTON_COMBINE_FEATURES:"mapbox-gl-draw_combine",CONTROL_BUTTON_UNCOMBINE_FEATURES:"mapbox-gl-draw_uncombine",CONTROL_GROUP:"mapboxgl-ctrl-group",ATTRIBUTION:"mapboxgl-ctrl-attrib",ACTIVE_BUTTON:"active",BOX_SELECT:"mapbox-gl-draw_boxselect"},k={HOT:"mapbox-gl-draw-hot",COLD:"mapbox-gl-draw-cold"},G={ADD:"add",MOVE:"move",DRAG:"drag",POINTER:"pointer",NONE:"none"},H={POLYGON:"polygon",LINE:"line_string",POINT:"point"},j={FEATURE:"Feature",POLYGON:"Polygon",LINE_STRING:"LineString",POINT:"Point",FEATURE_COLLECTION:"FeatureCollection",MULTI_PREFIX:"Multi",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon"},K={DRAW_LINE_STRING:"draw_line_string",DRAW_POLYGON:"draw_polygon",DRAW_POINT:"draw_point",SIMPLE_SELECT:"simple_select",DIRECT_SELECT:"direct_select",STATIC:"static"},lt={CREATE:"draw.create",DELETE:"draw.delete",UPDATE:"draw.update",SELECTION_CHANGE:"draw.selectionchange",MODE_CHANGE:"draw.modechange",ACTIONABLE:"draw.actionable",RENDER:"draw.render",COMBINE_FEATURES:"draw.combine",UNCOMBINE_FEATURES:"draw.uncombine"},dt={MOVE:"move",CHANGE_COORDINATES:"change_coordinates"},xt={FEATURE:"feature",MIDPOINT:"midpoint",VERTEX:"vertex"},gt={ACTIVE:"true",INACTIVE:"false"},yt=["scrollZoom","boxZoom","dragRotate","dragPan","keyboard","doubleClickZoom","touchZoomRotate"],Nt=-85,Gt=Object.freeze({__proto__:null,classes:D,sources:k,cursors:G,types:H,geojsonTypes:j,modes:K,events:lt,updateActions:dt,meta:xt,activeStates:gt,interactions:yt,LAT_MIN:-90,LAT_RENDERED_MIN:Nt,LAT_MAX:90,LAT_RENDERED_MAX:85,LNG_MIN:-270,LNG_MAX:270}),Ut={Point:0,LineString:1,MultiLineString:1,Polygon:2};function Zt(b,M){var Z=Ut[b.geometry.type]-Ut[M.geometry.type];return Z===0&&b.geometry.type===j.POLYGON?b.area-M.area:Z}function qt(b){return b.map(function(M){return M.geometry.type===j.POLYGON&&(M.area=l.geometry({type:j.FEATURE,property:{},geometry:M.geometry})),M}).sort(Zt).map(function(M){return delete M.area,M})}function Qt(b,M){return M===void 0&&(M=0),[[b.point.x-M,b.point.y-M],[b.point.x+M,b.point.y+M]]}function ie(b){if(this._items={},this._nums={},this._length=b?b.length:0,b)for(var M=0,Z=b.length;M<Z;M++)this.add(b[M]),b[M]!==void 0&&(typeof b[M]=="string"?this._items[b[M]]=M:this._nums[b[M]]=M)}ie.prototype.add=function(b){return this.has(b)||(this._length++,typeof b=="string"?this._items[b]=this._length:this._nums[b]=this._length),this},ie.prototype.delete=function(b){return this.has(b)===!1||(this._length--,delete this._items[b],delete this._nums[b]),this},ie.prototype.has=function(b){return(typeof b=="string"||typeof b=="number")&&(this._items[b]!==void 0||this._nums[b]!==void 0)},ie.prototype.values=function(){var b=this,M=[];return Object.keys(this._items).forEach(function(Z){M.push({k:Z,v:b._items[Z]})}),Object.keys(this._nums).forEach(function(Z){M.push({k:JSON.parse(Z),v:b._nums[Z]})}),M.sort(function(Z,it){return Z.v-it.v}).map(function(Z){return Z.k})},ie.prototype.clear=function(){return this._length=0,this._items={},this._nums={},this};var ve=[xt.FEATURE,xt.MIDPOINT,xt.VERTEX],Ue={click:function(b,M,Z){return Rt(b,M,Z,Z.options.clickBuffer)},touch:function(b,M,Z){return Rt(b,M,Z,Z.options.touchBuffer)}};function Rt(b,M,Z,it){if(Z.map===null)return[];var ht=b?Qt(b,it):M,_t={};Z.options.styles&&(_t.layers=Z.options.styles.map(function(me){return me.id}));var wt=Z.map.queryRenderedFeatures(ht,_t).filter(function(me){return ve.indexOf(me.properties.meta)!==-1}),Wt=new ie,ne=[];return wt.forEach(function(me){var fe=me.properties.id;Wt.has(fe)||(Wt.add(fe),ne.push(me))}),qt(ne)}function Se(b,M){var Z=Ue.click(b,null,M),it={mouse:G.NONE};return Z[0]&&(it.mouse=Z[0].properties.active===gt.ACTIVE?G.MOVE:G.POINTER,it.feature=Z[0].properties.meta),M.events.currentModeName().indexOf("draw")!==-1&&(it.mouse=G.ADD),M.ui.queueMapClasses(it),M.ui.updateMapClasses(),Z[0]}function Ye(b,M){var Z=b.x-M.x,it=b.y-M.y;return Math.sqrt(Z*Z+it*it)}function yn(b,M,Z){Z===void 0&&(Z={});var it=Z.fineTolerance!=null?Z.fineTolerance:4,ht=Z.grossTolerance!=null?Z.grossTolerance:12,_t=Z.interval!=null?Z.interval:500;b.point=b.point||M.point,b.time=b.time||M.time;var wt=Ye(b.point,M.point);return wt<it||wt<ht&&M.time-b.time<_t}function tr(b,M,Z){Z===void 0&&(Z={});var it=Z.tolerance!=null?Z.tolerance:25,ht=Z.interval!=null?Z.interval:250;return b.point=b.point||M.point,b.time=b.time||M.time,Ye(b.point,M.point)<it&&M.time-b.time<ht}var Xn={},_i={get exports(){return Xn},set exports(b){Xn=b}}.exports=function(b,M){if(M||(M=16),b===void 0&&(b=128),b<=0)return"0";for(var Z=Math.log(Math.pow(2,b))/Math.log(M),it=2;Z===1/0;it*=2)Z=Math.log(Math.pow(2,b/it))/Math.log(M)*it;var ht=Z-Math.floor(Z),_t="";for(it=0;it<Math.floor(Z);it++)_t=Math.floor(Math.random()*M).toString(M)+_t;if(ht){var wt=Math.pow(M,ht);_t=Math.floor(Math.random()*wt).toString(M)+_t}var Wt=parseInt(_t,M);return Wt!==1/0&&Wt>=Math.pow(2,b)?_i(b,M):_t};_i.rack=function(b,M,Z){var it=function(_t){var wt=0;do{if(wt++>10){if(!Z)throw new Error("too many ID collisions, use more bits");b+=Z}var Wt=_i(b,M)}while(Object.hasOwnProperty.call(ht,Wt));return ht[Wt]=_t,Wt},ht=it.hats={};return it.get=function(_t){return it.hats[_t]},it.set=function(_t,wt){return it.hats[_t]=wt,it},it.bits=b||128,it.base=M||16,it};var An=function(b,M){this.ctx=b,this.properties=M.properties||{},this.coordinates=M.geometry.coordinates,this.id=M.id||Xn(),this.type=M.geometry.type};An.prototype.changed=function(){this.ctx.store.featureChanged(this.id)},An.prototype.incomingCoords=function(b){this.setCoordinates(b)},An.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},An.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.coordinates))},An.prototype.setProperty=function(b,M){this.properties[b]=M},An.prototype.toGeoJSON=function(){return JSON.parse(JSON.stringify({id:this.id,type:j.FEATURE,properties:this.properties,geometry:{coordinates:this.getCoordinates(),type:this.type}}))},An.prototype.internal=function(b){var M={id:this.id,meta:xt.FEATURE,"meta:type":this.type,active:gt.INACTIVE,mode:b};if(this.ctx.options.userProperties)for(var Z in this.properties)M["user_"+Z]=this.properties[Z];return{type:j.FEATURE,properties:M,geometry:{coordinates:this.getCoordinates(),type:this.type}}};var pr=function(b,M){An.call(this,b,M)};(pr.prototype=Object.create(An.prototype)).isValid=function(){return typeof this.coordinates[0]=="number"&&typeof this.coordinates[1]=="number"},pr.prototype.updateCoordinate=function(b,M,Z){this.coordinates=arguments.length===3?[M,Z]:[b,M],this.changed()},pr.prototype.getCoordinate=function(){return this.getCoordinates()};var wn=function(b,M){An.call(this,b,M)};(wn.prototype=Object.create(An.prototype)).isValid=function(){return this.coordinates.length>1},wn.prototype.addCoordinate=function(b,M,Z){this.changed();var it=parseInt(b,10);this.coordinates.splice(it,0,[M,Z])},wn.prototype.getCoordinate=function(b){var M=parseInt(b,10);return JSON.parse(JSON.stringify(this.coordinates[M]))},wn.prototype.removeCoordinate=function(b){this.changed(),this.coordinates.splice(parseInt(b,10),1)},wn.prototype.updateCoordinate=function(b,M,Z){var it=parseInt(b,10);this.coordinates[it]=[M,Z],this.changed()};var Yn=function(b,M){An.call(this,b,M),this.coordinates=this.coordinates.map(function(Z){return Z.slice(0,-1)})};(Yn.prototype=Object.create(An.prototype)).isValid=function(){return this.coordinates.length!==0&&this.coordinates.every(function(b){return b.length>2})},Yn.prototype.incomingCoords=function(b){this.coordinates=b.map(function(M){return M.slice(0,-1)}),this.changed()},Yn.prototype.setCoordinates=function(b){this.coordinates=b,this.changed()},Yn.prototype.addCoordinate=function(b,M,Z){this.changed();var it=b.split(".").map(function(ht){return parseInt(ht,10)});this.coordinates[it[0]].splice(it[1],0,[M,Z])},Yn.prototype.removeCoordinate=function(b){this.changed();var M=b.split(".").map(function(it){return parseInt(it,10)}),Z=this.coordinates[M[0]];Z&&(Z.splice(M[1],1),Z.length<3&&this.coordinates.splice(M[0],1))},Yn.prototype.getCoordinate=function(b){var M=b.split(".").map(function(it){return parseInt(it,10)}),Z=this.coordinates[M[0]];return JSON.parse(JSON.stringify(Z[M[1]]))},Yn.prototype.getCoordinates=function(){return this.coordinates.map(function(b){return b.concat([b[0]])})},Yn.prototype.updateCoordinate=function(b,M,Z){this.changed();var it=b.split("."),ht=parseInt(it[0],10),_t=parseInt(it[1],10);this.coordinates[ht]===void 0&&(this.coordinates[ht]=[]),this.coordinates[ht][_t]=[M,Z]};var ur={MultiPoint:pr,MultiLineString:wn,MultiPolygon:Yn},Uo=function(b,M,Z,it,ht){var _t=Z.split("."),wt=parseInt(_t[0],10),Wt=_t[1]?_t.slice(1).join("."):null;return b[wt][M](Wt,it,ht)},Ur=function(b,M){if(An.call(this,b,M),delete this.coordinates,this.model=ur[M.geometry.type],this.model===void 0)throw new TypeError(M.geometry.type+" is not a valid type");this.features=this._coordinatesToFeatures(M.geometry.coordinates)};function Qe(b){this.map=b.map,this.drawConfig=JSON.parse(JSON.stringify(b.options||{})),this._ctx=b}(Ur.prototype=Object.create(An.prototype))._coordinatesToFeatures=function(b){var M=this,Z=this.model.bind(this);return b.map(function(it){return new Z(M.ctx,{id:Xn(),type:j.FEATURE,properties:{},geometry:{coordinates:it,type:M.type.replace("Multi","")}})})},Ur.prototype.isValid=function(){return this.features.every(function(b){return b.isValid()})},Ur.prototype.setCoordinates=function(b){this.features=this._coordinatesToFeatures(b),this.changed()},Ur.prototype.getCoordinate=function(b){return Uo(this.features,"getCoordinate",b)},Ur.prototype.getCoordinates=function(){return JSON.parse(JSON.stringify(this.features.map(function(b){return b.type===j.POLYGON?b.getCoordinates():b.coordinates})))},Ur.prototype.updateCoordinate=function(b,M,Z){Uo(this.features,"updateCoordinate",b,M,Z),this.changed()},Ur.prototype.addCoordinate=function(b,M,Z){Uo(this.features,"addCoordinate",b,M,Z),this.changed()},Ur.prototype.removeCoordinate=function(b){Uo(this.features,"removeCoordinate",b),this.changed()},Ur.prototype.getFeatures=function(){return this.features},Qe.prototype.setSelected=function(b){return this._ctx.store.setSelected(b)},Qe.prototype.setSelectedCoordinates=function(b){var M=this;this._ctx.store.setSelectedCoordinates(b),b.reduce(function(Z,it){return Z[it.feature_id]===void 0&&(Z[it.feature_id]=!0,M._ctx.store.get(it.feature_id).changed()),Z},{})},Qe.prototype.getSelected=function(){return this._ctx.store.getSelected()},Qe.prototype.getSelectedIds=function(){return this._ctx.store.getSelectedIds()},Qe.prototype.isSelected=function(b){return this._ctx.store.isSelected(b)},Qe.prototype.getFeature=function(b){return this._ctx.store.get(b)},Qe.prototype.select=function(b){return this._ctx.store.select(b)},Qe.prototype.deselect=function(b){return this._ctx.store.deselect(b)},Qe.prototype.deleteFeature=function(b,M){return M===void 0&&(M={}),this._ctx.store.delete(b,M)},Qe.prototype.addFeature=function(b){return this._ctx.store.add(b)},Qe.prototype.clearSelectedFeatures=function(){return this._ctx.store.clearSelected()},Qe.prototype.clearSelectedCoordinates=function(){return this._ctx.store.clearSelectedCoordinates()},Qe.prototype.setActionableState=function(b){b===void 0&&(b={});var M={trash:b.trash||!1,combineFeatures:b.combineFeatures||!1,uncombineFeatures:b.uncombineFeatures||!1};return this._ctx.events.actionable(M)},Qe.prototype.changeMode=function(b,M,Z){return M===void 0&&(M={}),Z===void 0&&(Z={}),this._ctx.events.changeMode(b,M,Z)},Qe.prototype.updateUIClasses=function(b){return this._ctx.ui.queueMapClasses(b)},Qe.prototype.activateUIButton=function(b){return this._ctx.ui.setActiveButton(b)},Qe.prototype.featuresAt=function(b,M,Z){if(Z===void 0&&(Z="click"),Z!=="click"&&Z!=="touch")throw new Error("invalid buffer type");return Ue[Z](b,M,this._ctx)},Qe.prototype.newFeature=function(b){var M=b.geometry.type;return M===j.POINT?new pr(this._ctx,b):M===j.LINE_STRING?new wn(this._ctx,b):M===j.POLYGON?new Yn(this._ctx,b):new Ur(this._ctx,b)},Qe.prototype.isInstanceOf=function(b,M){if(b===j.POINT)return M instanceof pr;if(b===j.LINE_STRING)return M instanceof wn;if(b===j.POLYGON)return M instanceof Yn;if(b==="MultiFeature")return M instanceof Ur;throw new Error("Unknown feature class: "+b)},Qe.prototype.doRender=function(b){return this._ctx.store.featureChanged(b)},Qe.prototype.onSetup=function(){},Qe.prototype.onDrag=function(){},Qe.prototype.onClick=function(){},Qe.prototype.onMouseMove=function(){},Qe.prototype.onMouseDown=function(){},Qe.prototype.onMouseUp=function(){},Qe.prototype.onMouseOut=function(){},Qe.prototype.onKeyUp=function(){},Qe.prototype.onKeyDown=function(){},Qe.prototype.onTouchStart=function(){},Qe.prototype.onTouchMove=function(){},Qe.prototype.onTouchEnd=function(){},Qe.prototype.onTap=function(){},Qe.prototype.onStop=function(){},Qe.prototype.onTrash=function(){},Qe.prototype.onCombineFeature=function(){},Qe.prototype.onUncombineFeature=function(){},Qe.prototype.toDisplayFeatures=function(){throw new Error("You must overwrite toDisplayFeatures")};var Ni={drag:"onDrag",click:"onClick",mousemove:"onMouseMove",mousedown:"onMouseDown",mouseup:"onMouseUp",mouseout:"onMouseOut",keyup:"onKeyUp",keydown:"onKeyDown",touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",tap:"onTap"},_n=Object.keys(Ni);function cr(b){var M=Object.keys(b);return function(Z,it){it===void 0&&(it={});var ht={},_t=M.reduce(function(wt,Wt){return wt[Wt]=b[Wt],wt},new Qe(Z));return{start:function(){var wt=this;ht=_t.onSetup(it),_n.forEach(function(Wt){var ne,me=Ni[Wt],fe=function(){return!1};b[me]&&(fe=function(){return!0}),wt.on(Wt,fe,(ne=me,function(ae){return _t[ne](ht,ae)}))})},stop:function(){_t.onStop(ht)},trash:function(){_t.onTrash(ht)},combineFeatures:function(){_t.onCombineFeatures(ht)},uncombineFeatures:function(){_t.onUncombineFeatures(ht)},render:function(wt,Wt){_t.toDisplayFeatures(ht,wt,Wt)}}}}function We(b){return[].concat(b).filter(function(M){return M!==void 0})}function js(){var b=this;if(!(b.ctx.map&&b.ctx.map.getSource(k.HOT)!==void 0))return ne();var M=b.ctx.events.currentModeName();b.ctx.ui.queueMapClasses({mode:M});var Z=[],it=[];b.isDirty?it=b.getAllIds():(Z=b.getChangedIds().filter(function(me){return b.get(me)!==void 0}),it=b.sources.hot.filter(function(me){return me.properties.id&&Z.indexOf(me.properties.id)===-1&&b.get(me.properties.id)!==void 0}).map(function(me){return me.properties.id})),b.sources.hot=[];var ht=b.sources.cold.length;b.sources.cold=b.isDirty?[]:b.sources.cold.filter(function(me){var fe=me.properties.id||me.properties.parent;return Z.indexOf(fe)===-1});var _t=ht!==b.sources.cold.length||it.length>0;function wt(me,fe){var ae=b.get(me).internal(M);b.ctx.events.currentModeRender(ae,function(He){b.sources[fe].push(He)})}if(Z.forEach(function(me){return wt(me,"hot")}),it.forEach(function(me){return wt(me,"cold")}),_t&&b.ctx.map.getSource(k.COLD).setData({type:j.FEATURE_COLLECTION,features:b.sources.cold}),b.ctx.map.getSource(k.HOT).setData({type:j.FEATURE_COLLECTION,features:b.sources.hot}),b._emitSelectionChange&&(b.ctx.map.fire(lt.SELECTION_CHANGE,{features:b.getSelected().map(function(me){return me.toGeoJSON()}),points:b.getSelectedCoordinates().map(function(me){return{type:j.FEATURE,properties:{},geometry:{type:j.POINT,coordinates:me.coordinates}}})}),b._emitSelectionChange=!1),b._deletedFeaturesToEmit.length){var Wt=b._deletedFeaturesToEmit.map(function(me){return me.toGeoJSON()});b._deletedFeaturesToEmit=[],b.ctx.map.fire(lt.DELETE,{features:Wt})}function ne(){b.isDirty=!1,b.clearChangedIds()}ne(),b.ctx.map.fire(lt.RENDER,{})}function St(b){var M,Z=this;this._features={},this._featureIds=new ie,this._selectedFeatureIds=new ie,this._selectedCoordinates=[],this._changedFeatureIds=new ie,this._deletedFeaturesToEmit=[],this._emitSelectionChange=!1,this._mapInitialConfig={},this.ctx=b,this.sources={hot:[],cold:[]},this.render=function(){M||(M=requestAnimationFrame(function(){M=null,js.call(Z)}))},this.isDirty=!1}function Gn(b,M){var Z=b._selectedCoordinates.filter(function(it){return b._selectedFeatureIds.has(it.feature_id)});b._selectedCoordinates.length===Z.length||M.silent||(b._emitSelectionChange=!0),b._selectedCoordinates=Z}St.prototype.createRenderBatch=function(){var b=this,M=this.render,Z=0;return this.render=function(){Z++},function(){b.render=M,Z>0&&b.render()}},St.prototype.setDirty=function(){return this.isDirty=!0,this},St.prototype.featureChanged=function(b){return this._changedFeatureIds.add(b),this},St.prototype.getChangedIds=function(){return this._changedFeatureIds.values()},St.prototype.clearChangedIds=function(){return this._changedFeatureIds.clear(),this},St.prototype.getAllIds=function(){return this._featureIds.values()},St.prototype.add=function(b){return this.featureChanged(b.id),this._features[b.id]=b,this._featureIds.add(b.id),this},St.prototype.delete=function(b,M){var Z=this;return M===void 0&&(M={}),We(b).forEach(function(it){Z._featureIds.has(it)&&(Z._featureIds.delete(it),Z._selectedFeatureIds.delete(it),M.silent||Z._deletedFeaturesToEmit.indexOf(Z._features[it])===-1&&Z._deletedFeaturesToEmit.push(Z._features[it]),delete Z._features[it],Z.isDirty=!0)}),Gn(this,M),this},St.prototype.get=function(b){return this._features[b]},St.prototype.getAll=function(){var b=this;return Object.keys(this._features).map(function(M){return b._features[M]})},St.prototype.select=function(b,M){var Z=this;return M===void 0&&(M={}),We(b).forEach(function(it){Z._selectedFeatureIds.has(it)||(Z._selectedFeatureIds.add(it),Z._changedFeatureIds.add(it),M.silent||(Z._emitSelectionChange=!0))}),this},St.prototype.deselect=function(b,M){var Z=this;return M===void 0&&(M={}),We(b).forEach(function(it){Z._selectedFeatureIds.has(it)&&(Z._selectedFeatureIds.delete(it),Z._changedFeatureIds.add(it),M.silent||(Z._emitSelectionChange=!0))}),Gn(this,M),this},St.prototype.clearSelected=function(b){return b===void 0&&(b={}),this.deselect(this._selectedFeatureIds.values(),{silent:b.silent}),this},St.prototype.setSelected=function(b,M){var Z=this;return M===void 0&&(M={}),b=We(b),this.deselect(this._selectedFeatureIds.values().filter(function(it){return b.indexOf(it)===-1}),{silent:M.silent}),this.select(b.filter(function(it){return!Z._selectedFeatureIds.has(it)}),{silent:M.silent}),this},St.prototype.setSelectedCoordinates=function(b){return this._selectedCoordinates=b,this._emitSelectionChange=!0,this},St.prototype.clearSelectedCoordinates=function(){return this._selectedCoordinates=[],this._emitSelectionChange=!0,this},St.prototype.getSelectedIds=function(){return this._selectedFeatureIds.values()},St.prototype.getSelected=function(){var b=this;return this._selectedFeatureIds.values().map(function(M){return b.get(M)})},St.prototype.getSelectedCoordinates=function(){var b=this;return this._selectedCoordinates.map(function(M){return{coordinates:b.get(M.feature_id).getCoordinate(M.coord_path)}})},St.prototype.isSelected=function(b){return this._selectedFeatureIds.has(b)},St.prototype.setFeatureProperty=function(b,M,Z){this.get(b).setProperty(M,Z),this.featureChanged(b)},St.prototype.storeMapConfig=function(){var b=this;yt.forEach(function(M){b.ctx.map[M]&&(b._mapInitialConfig[M]=b.ctx.map[M].isEnabled())})},St.prototype.restoreMapConfig=function(){var b=this;Object.keys(this._mapInitialConfig).forEach(function(M){b._mapInitialConfig[M]?b.ctx.map[M].enable():b.ctx.map[M].disable()})},St.prototype.getInitialConfigValue=function(b){return this._mapInitialConfig[b]===void 0||this._mapInitialConfig[b]};var Sr=function(){for(var b=arguments,M={},Z=0;Z<arguments.length;Z++){var it=b[Z];for(var ht in it)Ln.call(it,ht)&&(M[ht]=it[ht])}return M},Ln=Object.prototype.hasOwnProperty,pn=["mode","feature","mouse"];function io(b){var M=null,Z=null,it={onRemove:function(){return b.map.off("load",it.connect),clearInterval(Z),it.removeLayers(),b.store.restoreMapConfig(),b.ui.removeButtons(),b.events.removeEventListeners(),b.ui.clearMapClasses(),b.map=null,b.container=null,b.store=null,M&&M.parentNode&&M.parentNode.removeChild(M),M=null,this},connect:function(){b.map.off("load",it.connect),clearInterval(Z),it.addLayers(),b.store.storeMapConfig(),b.events.addEventListeners()},onAdd:function(ht){var _t=ht.fire;return ht.fire=function(wt,Wt){var ne=arguments;return _t.length===1&&arguments.length!==1&&(ne=[Sr({},{type:wt},Wt)]),_t.apply(ht,ne)},b.map=ht,b.events=function(wt){var Wt=Object.keys(wt.options.modes).reduce(function(Ot,Pe){return Ot[Pe]=cr(wt.options.modes[Pe]),Ot},{}),ne={},me={},fe={},ae=null,He=null;fe.drag=function(Ot,Pe){Pe({point:Ot.point,time:new Date().getTime()})?(wt.ui.queueMapClasses({mouse:G.DRAG}),He.drag(Ot)):Ot.originalEvent.stopPropagation()},fe.mousedrag=function(Ot){fe.drag(Ot,function(Pe){return!yn(ne,Pe)})},fe.touchdrag=function(Ot){fe.drag(Ot,function(Pe){return!tr(me,Pe)})},fe.mousemove=function(Ot){if((Ot.originalEvent.buttons!==void 0?Ot.originalEvent.buttons:Ot.originalEvent.which)===1)return fe.mousedrag(Ot);var Pe=Se(Ot,wt);Ot.featureTarget=Pe,He.mousemove(Ot)},fe.mousedown=function(Ot){ne={time:new Date().getTime(),point:Ot.point};var Pe=Se(Ot,wt);Ot.featureTarget=Pe,He.mousedown(Ot)},fe.mouseup=function(Ot){var Pe=Se(Ot,wt);Ot.featureTarget=Pe,yn(ne,{point:Ot.point,time:new Date().getTime()})?He.click(Ot):He.mouseup(Ot)},fe.mouseout=function(Ot){He.mouseout(Ot)},fe.touchstart=function(Ot){if(Ot.originalEvent.preventDefault(),wt.options.touchEnabled){me={time:new Date().getTime(),point:Ot.point};var Pe=Ue.touch(Ot,null,wt)[0];Ot.featureTarget=Pe,He.touchstart(Ot)}},fe.touchmove=function(Ot){if(Ot.originalEvent.preventDefault(),wt.options.touchEnabled)return He.touchmove(Ot),fe.touchdrag(Ot)},fe.touchend=function(Ot){if(Ot.originalEvent.preventDefault(),wt.options.touchEnabled){var Pe=Ue.touch(Ot,null,wt)[0];Ot.featureTarget=Pe,tr(me,{time:new Date().getTime(),point:Ot.point})?He.tap(Ot):He.touchend(Ot)}};var fr=function(Ot){return!(Ot===8||Ot===46||Ot>=48&&Ot<=57)};function sn(Ot,Pe,fn){fn===void 0&&(fn={}),He.stop();var Xr=Wt[Ot];if(Xr===void 0)throw new Error(Ot+" is not valid");ae=Ot;var vr=Xr(wt,Pe);He=n(vr,wt),fn.silent||wt.map.fire(lt.MODE_CHANGE,{mode:Ot}),wt.store.setDirty(),wt.store.render()}fe.keydown=function(Ot){(Ot.srcElement||Ot.target).classList[0]==="mapboxgl-canvas"&&(Ot.keyCode!==8&&Ot.keyCode!==46||!wt.options.controls.trash?fr(Ot.keyCode)?He.keydown(Ot):Ot.keyCode===49&&wt.options.controls.point?sn(K.DRAW_POINT):Ot.keyCode===50&&wt.options.controls.line_string?sn(K.DRAW_LINE_STRING):Ot.keyCode===51&&wt.options.controls.polygon&&sn(K.DRAW_POLYGON):(Ot.preventDefault(),He.trash()))},fe.keyup=function(Ot){fr(Ot.keyCode)&&He.keyup(Ot)},fe.zoomend=function(){wt.store.changeZoom()},fe.data=function(Ot){if(Ot.dataType==="style"){var Pe=wt.setup,fn=wt.map,Xr=wt.options,vr=wt.store;Xr.styles.some(function(ga){return fn.getLayer(ga.id)})||(Pe.addLayers(),vr.setDirty(),vr.render())}};var Zr={trash:!1,combineFeatures:!1,uncombineFeatures:!1};return{start:function(){ae=wt.options.defaultMode,He=n(Wt[ae](wt),wt)},changeMode:sn,actionable:function(Ot){var Pe=!1;Object.keys(Ot).forEach(function(fn){if(Zr[fn]===void 0)throw new Error("Invalid action type");Zr[fn]!==Ot[fn]&&(Pe=!0),Zr[fn]=Ot[fn]}),Pe&&wt.map.fire(lt.ACTIONABLE,{actions:Zr})},currentModeName:function(){return ae},currentModeRender:function(Ot,Pe){return He.render(Ot,Pe)},fire:function(Ot,Pe){fe[Ot]&&fe[Ot](Pe)},addEventListeners:function(){wt.map.on("mousemove",fe.mousemove),wt.map.on("mousedown",fe.mousedown),wt.map.on("mouseup",fe.mouseup),wt.map.on("data",fe.data),wt.map.on("touchmove",fe.touchmove),wt.map.on("touchstart",fe.touchstart),wt.map.on("touchend",fe.touchend),wt.container.addEventListener("mouseout",fe.mouseout),wt.options.keybindings&&(wt.container.addEventListener("keydown",fe.keydown),wt.container.addEventListener("keyup",fe.keyup))},removeEventListeners:function(){wt.map.off("mousemove",fe.mousemove),wt.map.off("mousedown",fe.mousedown),wt.map.off("mouseup",fe.mouseup),wt.map.off("data",fe.data),wt.map.off("touchmove",fe.touchmove),wt.map.off("touchstart",fe.touchstart),wt.map.off("touchend",fe.touchend),wt.container.removeEventListener("mouseout",fe.mouseout),wt.options.keybindings&&(wt.container.removeEventListener("keydown",fe.keydown),wt.container.removeEventListener("keyup",fe.keyup))},trash:function(Ot){He.trash(Ot)},combineFeatures:function(){He.combineFeatures()},uncombineFeatures:function(){He.uncombineFeatures()},getMode:function(){return ae}}}(b),b.ui=function(wt){var Wt={},ne=null,me={mode:null,feature:null,mouse:null},fe={mode:null,feature:null,mouse:null};function ae(Ot){fe=Sr(fe,Ot)}function He(){var Ot,Pe;if(wt.container){var fn=[],Xr=[];pn.forEach(function(vr){fe[vr]!==me[vr]&&(fn.push(vr+"-"+me[vr]),fe[vr]!==null&&Xr.push(vr+"-"+fe[vr]))}),fn.length>0&&(Ot=wt.container.classList).remove.apply(Ot,fn),Xr.length>0&&(Pe=wt.container.classList).add.apply(Pe,Xr),me=Sr(me,fe)}}function fr(Ot,Pe){Pe===void 0&&(Pe={});var fn=document.createElement("button");return fn.className=D.CONTROL_BUTTON+" "+Pe.className,fn.setAttribute("title",Pe.title),Pe.container.appendChild(fn),fn.addEventListener("click",function(Xr){if(Xr.preventDefault(),Xr.stopPropagation(),Xr.target===ne)return sn(),void Pe.onDeactivate();Zr(Ot),Pe.onActivate()},!0),fn}function sn(){ne&&(ne.classList.remove(D.ACTIVE_BUTTON),ne=null)}function Zr(Ot){sn();var Pe=Wt[Ot];Pe&&Pe&&Ot!=="trash"&&(Pe.classList.add(D.ACTIVE_BUTTON),ne=Pe)}return{setActiveButton:Zr,queueMapClasses:ae,updateMapClasses:He,clearMapClasses:function(){ae({mode:null,feature:null,mouse:null}),He()},addButtons:function(){var Ot=wt.options.controls,Pe=document.createElement("div");return Pe.className=D.CONTROL_GROUP+" "+D.CONTROL_BASE,Ot&&(Ot[H.LINE]&&(Wt[H.LINE]=fr(H.LINE,{container:Pe,className:D.CONTROL_BUTTON_LINE,title:"LineString tool "+(wt.options.keybindings?"(l)":""),onActivate:function(){return wt.events.changeMode(K.DRAW_LINE_STRING)},onDeactivate:function(){return wt.events.trash()}})),Ot[H.POLYGON]&&(Wt[H.POLYGON]=fr(H.POLYGON,{container:Pe,className:D.CONTROL_BUTTON_POLYGON,title:"Polygon tool "+(wt.options.keybindings?"(p)":""),onActivate:function(){return wt.events.changeMode(K.DRAW_POLYGON)},onDeactivate:function(){return wt.events.trash()}})),Ot[H.POINT]&&(Wt[H.POINT]=fr(H.POINT,{container:Pe,className:D.CONTROL_BUTTON_POINT,title:"Marker tool "+(wt.options.keybindings?"(m)":""),onActivate:function(){return wt.events.changeMode(K.DRAW_POINT)},onDeactivate:function(){return wt.events.trash()}})),Ot.trash&&(Wt.trash=fr("trash",{container:Pe,className:D.CONTROL_BUTTON_TRASH,title:"Delete",onActivate:function(){wt.events.trash()}})),Ot.combine_features&&(Wt.combine_features=fr("combineFeatures",{container:Pe,className:D.CONTROL_BUTTON_COMBINE_FEATURES,title:"Combine",onActivate:function(){wt.events.combineFeatures()}})),Ot.uncombine_features&&(Wt.uncombine_features=fr("uncombineFeatures",{container:Pe,className:D.CONTROL_BUTTON_UNCOMBINE_FEATURES,title:"Uncombine",onActivate:function(){wt.events.uncombineFeatures()}}))),Pe},removeButtons:function(){Object.keys(Wt).forEach(function(Ot){var Pe=Wt[Ot];Pe.parentNode&&Pe.parentNode.removeChild(Pe),delete Wt[Ot]})}}}(b),b.container=ht.getContainer(),b.store=new St(b),M=b.ui.addButtons(),b.options.boxSelect&&(ht.boxZoom.disable(),ht.dragPan.disable(),ht.dragPan.enable()),ht.loaded()?it.connect():(ht.on("load",it.connect),Z=setInterval(function(){ht.loaded()&&it.connect()},16)),b.events.start(),M},addLayers:function(){b.map.addSource(k.COLD,{data:{type:j.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.map.addSource(k.HOT,{data:{type:j.FEATURE_COLLECTION,features:[]},type:"geojson"}),b.options.styles.forEach(function(ht){b.map.addLayer(ht)}),b.store.setDirty(!0),b.store.render()},removeLayers:function(){b.options.styles.forEach(function(ht){b.map.getLayer(ht.id)&&b.map.removeLayer(ht.id)}),b.map.getSource(k.COLD)&&b.map.removeSource(k.COLD),b.map.getSource(k.HOT)&&b.map.removeSource(k.HOT)}};return b.setup=it,it}var rs=[{id:"gl-draw-polygon-fill-inactive",type:"fill",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],paint:{"fill-color":"#3bb2d0","fill-outline-color":"#3bb2d0","fill-opacity":.1}},{id:"gl-draw-polygon-fill-active",type:"fill",filter:["all",["==","active","true"],["==","$type","Polygon"]],paint:{"fill-color":"#fbb03b","fill-outline-color":"#fbb03b","fill-opacity":.1}},{id:"gl-draw-polygon-midpoint",type:"circle",filter:["all",["==","$type","Point"],["==","meta","midpoint"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-stroke-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","Polygon"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-polygon-stroke-active",type:"line",filter:["all",["==","active","true"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-line-inactive",type:"line",filter:["all",["==","active","false"],["==","$type","LineString"],["!=","mode","static"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#3bb2d0","line-width":2}},{id:"gl-draw-line-active",type:"line",filter:["all",["==","$type","LineString"],["==","active","true"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#fbb03b","line-dasharray":[.2,2],"line-width":2}},{id:"gl-draw-polygon-and-line-vertex-stroke-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-color":"#fff"}},{id:"gl-draw-polygon-and-line-vertex-inactive",type:"circle",filter:["all",["==","meta","vertex"],["==","$type","Point"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#fbb03b"}},{id:"gl-draw-point-point-stroke-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":5,"circle-opacity":1,"circle-color":"#fff"}},{id:"gl-draw-point-inactive",type:"circle",filter:["all",["==","active","false"],["==","$type","Point"],["==","meta","feature"],["!=","mode","static"]],paint:{"circle-radius":3,"circle-color":"#3bb2d0"}},{id:"gl-draw-point-stroke-active",type:"circle",filter:["all",["==","$type","Point"],["==","active","true"],["!=","meta","midpoint"]],paint:{"circle-radius":7,"circle-color":"#fff"}},{id:"gl-draw-point-active",type:"circle",filter:["all",["==","$type","Point"],["!=","meta","midpoint"],["==","active","true"]],paint:{"circle-radius":5,"circle-color":"#fbb03b"}},{id:"gl-draw-polygon-fill-static",type:"fill",filter:["all",["==","mode","static"],["==","$type","Polygon"]],paint:{"fill-color":"#404040","fill-outline-color":"#404040","fill-opacity":.1}},{id:"gl-draw-polygon-stroke-static",type:"line",filter:["all",["==","mode","static"],["==","$type","Polygon"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-line-static",type:"line",filter:["all",["==","mode","static"],["==","$type","LineString"]],layout:{"line-cap":"round","line-join":"round"},paint:{"line-color":"#404040","line-width":2}},{id:"gl-draw-point-static",type:"circle",filter:["all",["==","mode","static"],["==","$type","Point"]],paint:{"circle-radius":5,"circle-color":"#404040"}}];function is(b){return function(M){var Z=M.featureTarget;return!!Z&&!!Z.properties&&Z.properties.meta===b}}function Tr(b){return!!b.originalEvent&&!!b.originalEvent.shiftKey&&b.originalEvent.button===0}function Nr(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===gt.ACTIVE&&b.featureTarget.properties.meta===xt.FEATURE}function os(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.active===gt.INACTIVE&&b.featureTarget.properties.meta===xt.FEATURE}function Co(b){return b.featureTarget===void 0}function te(b){return!!b.featureTarget&&!!b.featureTarget.properties&&b.featureTarget.properties.meta===xt.FEATURE}function Ri(b){var M=b.featureTarget;return!!M&&!!M.properties&&M.properties.meta===xt.VERTEX}function Vr(b){return!!b.originalEvent&&b.originalEvent.shiftKey===!0}function ss(b){return b.keyCode===27}function Ki(b){return b.keyCode===13}var ee=Object.freeze({__proto__:null,isOfMetaType:is,isShiftMousedown:Tr,isActiveFeature:Nr,isInactiveFeature:os,noTarget:Co,isFeature:te,isVertex:Ri,isShiftDown:Vr,isEscapeKey:ss,isEnterKey:Ki,isTrue:function(){return!0}}),on=Ve;function Ve(b,M){this.x=b,this.y=M}function yi(b,M){var Z=M.getBoundingClientRect();return new on(b.clientX-Z.left-(M.clientLeft||0),b.clientY-Z.top-(M.clientTop||0))}function hr(b,M,Z,it){return{type:j.FEATURE,properties:{meta:xt.VERTEX,parent:b,coord_path:Z,active:it?gt.ACTIVE:gt.INACTIVE},geometry:{type:j.POINT,coordinates:M}}}function Xe(b,M,Z){var it=M.geometry.coordinates,ht=Z.geometry.coordinates;if(it[1]>85||it[1]<Nt||ht[1]>85||ht[1]<Nt)return null;var _t={lng:(it[0]+ht[0])/2,lat:(it[1]+ht[1])/2};return{type:j.FEATURE,properties:{meta:xt.MIDPOINT,parent:b,lng:_t.lng,lat:_t.lat,coord_path:Z.properties.coord_path},geometry:{type:j.POINT,coordinates:[_t.lng,_t.lat]}}}function oo(b,M,Z){M===void 0&&(M={}),Z===void 0&&(Z=null);var it,ht=b.geometry,_t=ht.type,wt=ht.coordinates,Wt=b.properties&&b.properties.id,ne=[];function me(ae,He){var fr="",sn=null;ae.forEach(function(Zr,Ot){var Pe=He!=null?He+"."+Ot:String(Ot),fn=hr(Wt,Zr,Pe,fe(Pe));if(M.midpoints&&sn){var Xr=Xe(Wt,sn,fn);Xr&&ne.push(Xr)}sn=fn;var vr=JSON.stringify(Zr);fr!==vr&&ne.push(fn),Ot===0&&(fr=vr)})}function fe(ae){return!!M.selectedPaths&&M.selectedPaths.indexOf(ae)!==-1}return _t===j.POINT?ne.push(hr(Wt,wt,Z,fe(Z))):_t===j.POLYGON?wt.forEach(function(ae,He){me(ae,Z!==null?Z+"."+He:String(He))}):_t===j.LINE_STRING?me(wt,Z):_t.indexOf(j.MULTI_PREFIX)===0&&(it=_t.replace(j.MULTI_PREFIX,""),wt.forEach(function(ae,He){var fr={type:j.FEATURE,properties:b.properties,geometry:{type:it,coordinates:ae}};ne=ne.concat(oo(fr,M,He))})),ne}Ve.prototype={clone:function(){return new Ve(this.x,this.y)},add:function(b){return this.clone()._add(b)},sub:function(b){return this.clone()._sub(b)},multByPoint:function(b){return this.clone()._multByPoint(b)},divByPoint:function(b){return this.clone()._divByPoint(b)},mult:function(b){return this.clone()._mult(b)},div:function(b){return this.clone()._div(b)},rotate:function(b){return this.clone()._rotate(b)},rotateAround:function(b,M){return this.clone()._rotateAround(b,M)},matMult:function(b){return this.clone()._matMult(b)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(b){return this.x===b.x&&this.y===b.y},dist:function(b){return Math.sqrt(this.distSqr(b))},distSqr:function(b){var M=b.x-this.x,Z=b.y-this.y;return M*M+Z*Z},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(b){return Math.atan2(this.y-b.y,this.x-b.x)},angleWith:function(b){return this.angleWithSep(b.x,b.y)},angleWithSep:function(b,M){return Math.atan2(this.x*M-this.y*b,this.x*b+this.y*M)},_matMult:function(b){var M=b[0]*this.x+b[1]*this.y,Z=b[2]*this.x+b[3]*this.y;return this.x=M,this.y=Z,this},_add:function(b){return this.x+=b.x,this.y+=b.y,this},_sub:function(b){return this.x-=b.x,this.y-=b.y,this},_mult:function(b){return this.x*=b,this.y*=b,this},_div:function(b){return this.x/=b,this.y/=b,this},_multByPoint:function(b){return this.x*=b.x,this.y*=b.y,this},_divByPoint:function(b){return this.x/=b.x,this.y/=b.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var b=this.y;return this.y=this.x,this.x=-b,this},_rotate:function(b){var M=Math.cos(b),Z=Math.sin(b),it=M*this.x-Z*this.y,ht=Z*this.x+M*this.y;return this.x=it,this.y=ht,this},_rotateAround:function(b,M){var Z=Math.cos(b),it=Math.sin(b),ht=M.x+Z*(this.x-M.x)-it*(this.y-M.y),_t=M.y+it*(this.x-M.x)+Z*(this.y-M.y);return this.x=ht,this.y=_t,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ve.convert=function(b){return b instanceof Ve?b:Array.isArray(b)?new Ve(b[0],b[1]):b};var Gr={enable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b._ctx&&b._ctx.store&&b._ctx.store.getInitialConfigValue&&b._ctx.store.getInitialConfigValue("doubleClickZoom")&&b.map.doubleClickZoom.enable()},0)},disable:function(b){setTimeout(function(){b.map&&b.map.doubleClickZoom&&b.map.doubleClickZoom.disable()},0)}},Ii={},as={get exports(){return Ii},set exports(b){Ii=b}},Jr=function(b){if(!b||!b.type)return null;var M=Jn[b.type];if(!M)return null;if(M==="geometry")return{type:"FeatureCollection",features:[{type:"Feature",properties:{},geometry:b}]};if(M==="feature")return{type:"FeatureCollection",features:[b]};if(M==="featurecollection")return b},Jn={Point:"geometry",MultiPoint:"geometry",LineString:"geometry",MultiLineString:"geometry",Polygon:"geometry",MultiPolygon:"geometry",GeometryCollection:"geometry",Feature:"feature",FeatureCollection:"featurecollection"},Wa=Object.freeze({__proto__:null,default:function b(M){switch(M&&M.type||null){case"FeatureCollection":return M.features=M.features.reduce(function(Z,it){return Z.concat(b(it))},[]),M;case"Feature":return M.geometry?b(M.geometry).map(function(Z){var it={type:"Feature",properties:JSON.parse(JSON.stringify(M.properties)),geometry:Z};return M.id!==void 0&&(it.id=M.id),it}):[M];case"MultiPoint":return M.coordinates.map(function(Z){return{type:"Point",coordinates:Z}});case"MultiPolygon":return M.coordinates.map(function(Z){return{type:"Polygon",coordinates:Z}});case"MultiLineString":return M.coordinates.map(function(Z){return{type:"LineString",coordinates:Z}});case"GeometryCollection":return M.geometries.map(b).reduce(function(Z,it){return Z.concat(it)},[]);case"Point":case"Polygon":case"LineString":return[M]}}}),Vo=Jr,V=o(Wa),z=function(b){return function M(Z){return Array.isArray(Z)&&Z.length&&typeof Z[0]=="number"?[Z]:Z.reduce(function(it,ht){return Array.isArray(ht)&&Array.isArray(ht[0])?it.concat(M(ht)):(it.push(ht),it)},[])}(b)};V instanceof Function||(V=V.default);var B={},W={get exports(){return B},set exports(b){B=b}}.exports=function(b){return new J(b)};function J(b){this.value=b}function st(b,M,Z){var it=[],ht=[],_t=!0;return function wt(Wt){var ne=Z?mt(Wt):Wt,me={},fe=!0,ae={node:ne,node_:Wt,path:[].concat(it),parent:ht[ht.length-1],parents:ht,key:it.slice(-1)[0],isRoot:it.length===0,level:it.length,circular:null,update:function(sn,Zr){ae.isRoot||(ae.parent.node[ae.key]=sn),ae.node=sn,Zr&&(fe=!1)},delete:function(sn){delete ae.parent.node[ae.key],sn&&(fe=!1)},remove:function(sn){vt(ae.parent.node)?ae.parent.node.splice(ae.key,1):delete ae.parent.node[ae.key],sn&&(fe=!1)},keys:null,before:function(sn){me.before=sn},after:function(sn){me.after=sn},pre:function(sn){me.pre=sn},post:function(sn){me.post=sn},stop:function(){_t=!1},block:function(){fe=!1}};if(!_t)return ae;function He(){if(typeof ae.node=="object"&&ae.node!==null){ae.keys&&ae.node_===ae.node||(ae.keys=ut(ae.node)),ae.isLeaf=ae.keys.length==0;for(var sn=0;sn<ht.length;sn++)if(ht[sn].node_===Wt){ae.circular=ht[sn];break}}else ae.isLeaf=!0,ae.keys=null;ae.notLeaf=!ae.isLeaf,ae.notRoot=!ae.isRoot}He();var fr=M.call(ae,ae.node);return fr!==void 0&&ae.update&&ae.update(fr),me.before&&me.before.call(ae,ae.node),fe&&(typeof ae.node!="object"||ae.node===null||ae.circular||(ht.push(ae),He(),zt(ae.keys,function(sn,Zr){it.push(sn),me.pre&&me.pre.call(ae,ae.node[sn],sn);var Ot=wt(ae.node[sn]);Z&&Bt.call(ae.node,sn)&&(ae.node[sn]=Ot.node),Ot.isLast=Zr==ae.keys.length-1,Ot.isFirst=Zr==0,me.post&&me.post.call(ae,Ot),it.pop()}),ht.pop()),me.after&&me.after.call(ae,ae.node)),ae}(b).node}function mt(b){if(typeof b=="object"&&b!==null){var M;if(vt(b))M=[];else if(at(b)==="[object Date]")M=new Date(b.getTime?b.getTime():b);else if(function(ht){return at(ht)==="[object RegExp]"}(b))M=new RegExp(b);else if(function(ht){return at(ht)==="[object Error]"}(b))M={message:b.message};else if(function(ht){return at(ht)==="[object Boolean]"}(b))M=new Boolean(b);else if(function(ht){return at(ht)==="[object Number]"}(b))M=new Number(b);else if(function(ht){return at(ht)==="[object String]"}(b))M=new String(b);else if(Object.create&&Object.getPrototypeOf)M=Object.create(Object.getPrototypeOf(b));else if(b.constructor===Object)M={};else{var Z=b.constructor&&b.constructor.prototype||b.__proto__||{},it=function(){};it.prototype=Z,M=new it}return zt(ut(b),function(ht){M[ht]=b[ht]}),M}return b}J.prototype.get=function(b){for(var M=this.value,Z=0;Z<b.length;Z++){var it=b[Z];if(!M||!Bt.call(M,it)){M=void 0;break}M=M[it]}return M},J.prototype.has=function(b){for(var M=this.value,Z=0;Z<b.length;Z++){var it=b[Z];if(!M||!Bt.call(M,it))return!1;M=M[it]}return!0},J.prototype.set=function(b,M){for(var Z=this.value,it=0;it<b.length-1;it++){var ht=b[it];Bt.call(Z,ht)||(Z[ht]={}),Z=Z[ht]}return Z[b[it]]=M,M},J.prototype.map=function(b){return st(this.value,b,!0)},J.prototype.forEach=function(b){return this.value=st(this.value,b,!1),this.value},J.prototype.reduce=function(b,M){var Z=arguments.length===1,it=Z?this.value:M;return this.forEach(function(ht){this.isRoot&&Z||(it=b.call(this,it,ht))}),it},J.prototype.paths=function(){var b=[];return this.forEach(function(M){b.push(this.path)}),b},J.prototype.nodes=function(){var b=[];return this.forEach(function(M){b.push(this.node)}),b},J.prototype.clone=function(){var b=[],M=[];return function Z(it){for(var ht=0;ht<b.length;ht++)if(b[ht]===it)return M[ht];if(typeof it=="object"&&it!==null){var _t=mt(it);return b.push(it),M.push(_t),zt(ut(it),function(wt){_t[wt]=Z(it[wt])}),b.pop(),M.pop(),_t}return it}(this.value)};var ut=Object.keys||function(b){var M=[];for(var Z in b)M.push(Z);return M};function at(b){return Object.prototype.toString.call(b)}var vt=Array.isArray||function(b){return Object.prototype.toString.call(b)==="[object Array]"},zt=function(b,M){if(b.forEach)return b.forEach(M);for(var Z=0;Z<b.length;Z++)M(b[Z],Z,b)};zt(ut(J.prototype),function(b){W[b]=function(M){var Z=[].slice.call(arguments,1),it=new J(M);return it[b].apply(it,Z)}});var Bt=Object.hasOwnProperty||function(b,M){return M in b},Vt=Ee;function Ee(b){if(!(this instanceof Ee))return new Ee(b);this._bbox=b||[1/0,1/0,-1/0,-1/0],this._valid=!!b}Ee.prototype.include=function(b){return this._valid=!0,this._bbox[0]=Math.min(this._bbox[0],b[0]),this._bbox[1]=Math.min(this._bbox[1],b[1]),this._bbox[2]=Math.max(this._bbox[2],b[0]),this._bbox[3]=Math.max(this._bbox[3],b[1]),this},Ee.prototype.equals=function(b){var M;return M=b instanceof Ee?b.bbox():b,this._bbox[0]==M[0]&&this._bbox[1]==M[1]&&this._bbox[2]==M[2]&&this._bbox[3]==M[3]},Ee.prototype.center=function(b){return this._valid?[(this._bbox[0]+this._bbox[2])/2,(this._bbox[1]+this._bbox[3])/2]:null},Ee.prototype.union=function(b){var M;return this._valid=!0,M=b instanceof Ee?b.bbox():b,this._bbox[0]=Math.min(this._bbox[0],M[0]),this._bbox[1]=Math.min(this._bbox[1],M[1]),this._bbox[2]=Math.max(this._bbox[2],M[2]),this._bbox[3]=Math.max(this._bbox[3],M[3]),this},Ee.prototype.bbox=function(){return this._valid?this._bbox:null},Ee.prototype.contains=function(b){if(!b)return this._fastContains();if(!this._valid)return null;var M=b[0],Z=b[1];return this._bbox[0]<=M&&this._bbox[1]<=Z&&this._bbox[2]>=M&&this._bbox[3]>=Z},Ee.prototype.intersect=function(b){return this._valid?(M=b instanceof Ee?b.bbox():b,!(this._bbox[0]>M[2]||this._bbox[2]<M[0]||this._bbox[3]<M[1]||this._bbox[1]>M[3])):null;var M},Ee.prototype._fastContains=function(){if(!this._valid)return new Function("return null;");var b="return "+this._bbox[0]+"<= ll[0] &&"+this._bbox[1]+"<= ll[1] &&"+this._bbox[2]+">= ll[0] &&"+this._bbox[3]+">= ll[1]";return new Function("ll",b)},Ee.prototype.polygon=function(){return this._valid?{type:"Polygon",coordinates:[[[this._bbox[0],this._bbox[1]],[this._bbox[2],this._bbox[1]],[this._bbox[2],this._bbox[3]],[this._bbox[0],this._bbox[3]],[this._bbox[0],this._bbox[1]]]]}:null};var $e=function(b){if(!b)return[];var M=V(Vo(b)),Z=[];return M.features.forEach(function(it){it.geometry&&(Z=Z.concat(z(it.geometry.coordinates)))}),Z},Ce=B,ke=Vt,Ze={features:["FeatureCollection"],coordinates:["Point","MultiPoint","LineString","MultiLineString","Polygon","MultiPolygon"],geometry:["Feature"],geometries:["GeometryCollection"]},En=Object.keys(Ze);function hn(b){for(var M=ke(),Z=$e(b),it=0;it<Z.length;it++)M.include(Z[it]);return M}as.exports=function(b){return hn(b).bbox()},Ii.polygon=function(b){return hn(b).polygon()},Ii.bboxify=function(b){return Ce(b).map(function(M){M&&En.some(function(Z){return!!M[Z]&&Ze[Z].indexOf(M.type)!==-1})&&(M.bbox=hn(M).bbox(),this.update(M))})};var In=-90;function Wn(b,M){var Z=In,it=90,ht=In,_t=90,wt=270,Wt=-270;b.forEach(function(me){var fe=Ii(me),ae=fe[1],He=fe[3],fr=fe[0],sn=fe[2];ae>Z&&(Z=ae),He<it&&(it=He),He>ht&&(ht=He),ae<_t&&(_t=ae),fr<wt&&(wt=fr),sn>Wt&&(Wt=sn)});var ne=M;return Z+ne.lat>85&&(ne.lat=85-Z),ht+ne.lat>90&&(ne.lat=90-ht),it+ne.lat<-85&&(ne.lat=-85-it),_t+ne.lat<In&&(ne.lat=In-_t),wt+ne.lng<=-270&&(ne.lng+=360*Math.ceil(Math.abs(ne.lng)/360)),Wt+ne.lng>=270&&(ne.lng-=360*Math.ceil(Math.abs(ne.lng)/360)),ne}function Rr(b,M){var Z=Wn(b.map(function(it){return it.toGeoJSON()}),M);b.forEach(function(it){var ht,_t=it.getCoordinates(),wt=function(ne){var me={lng:ne[0]+Z.lng,lat:ne[1]+Z.lat};return[me.lng,me.lat]},Wt=function(ne){return ne.map(function(me){return wt(me)})};it.type===j.POINT?ht=wt(_t):it.type===j.LINE_STRING||it.type===j.MULTI_POINT?ht=_t.map(wt):it.type===j.POLYGON||it.type===j.MULTI_LINE_STRING?ht=_t.map(Wt):it.type===j.MULTI_POLYGON&&(ht=_t.map(function(ne){return ne.map(function(me){return Wt(me)})})),it.incomingCoords(ht)})}var Te={onSetup:function(b){var M=this,Z={dragMoveLocation:null,boxSelectStartLocation:null,boxSelectElement:void 0,boxSelecting:!1,canBoxSelect:!1,dragMoving:!1,canDragMove:!1,initiallySelectedFeatureIds:b.featureIds||[]};return this.setSelected(Z.initiallySelectedFeatureIds.filter(function(it){return M.getFeature(it)!==void 0})),this.fireActionable(),this.setActionableState({combineFeatures:!0,uncombineFeatures:!0,trash:!0}),Z},fireUpdate:function(){this.map.fire(lt.UPDATE,{action:dt.MOVE,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(){var b=this,M=this.getSelected(),Z=M.filter(function(Wt){return b.isInstanceOf("MultiFeature",Wt)}),it=!1;if(M.length>1){it=!0;var ht=M[0].type.replace("Multi","");M.forEach(function(Wt){Wt.type.replace("Multi","")!==ht&&(it=!1)})}var _t=Z.length>0,wt=M.length>0;this.setActionableState({combineFeatures:it,uncombineFeatures:_t,trash:wt})},getUniqueIds:function(b){return b.length?b.map(function(M){return M.properties.id}).filter(function(M){return M!==void 0}).reduce(function(M,Z){return M.add(Z),M},new ie).values():[]},stopExtendedInteractions:function(b){b.boxSelectElement&&(b.boxSelectElement.parentNode&&b.boxSelectElement.parentNode.removeChild(b.boxSelectElement),b.boxSelectElement=null),this.map.dragPan.enable(),b.boxSelecting=!1,b.canBoxSelect=!1,b.dragMoving=!1,b.canDragMove=!1},onStop:function(){Gr.enable(this)},onMouseMove:function(b){return this.stopExtendedInteractions(b),!0},onMouseOut:function(b){return!b.dragMoving||this.fireUpdate()}};Te.onTap=Te.onClick=function(b,M){return Co(M)?this.clickAnywhere(b,M):is(xt.VERTEX)(M)?this.clickOnVertex(b,M):te(M)?this.clickOnFeature(b,M):void 0},Te.clickAnywhere=function(b){var M=this,Z=this.getSelectedIds();Z.length&&(this.clearSelectedFeatures(),Z.forEach(function(it){return M.doRender(it)})),Gr.enable(this),this.stopExtendedInteractions(b)},Te.clickOnVertex=function(b,M){this.changeMode(K.DIRECT_SELECT,{featureId:M.featureTarget.properties.parent,coordPath:M.featureTarget.properties.coord_path,startPos:M.lngLat}),this.updateUIClasses({mouse:G.MOVE})},Te.startOnActiveFeature=function(b,M){this.stopExtendedInteractions(b),this.map.dragPan.disable(),this.doRender(M.featureTarget.properties.id),b.canDragMove=!0,b.dragMoveLocation=M.lngLat},Te.clickOnFeature=function(b,M){var Z=this;Gr.disable(this),this.stopExtendedInteractions(b);var it=Vr(M),ht=this.getSelectedIds(),_t=M.featureTarget.properties.id,wt=this.isSelected(_t);if(!it&&wt&&this.getFeature(_t).type!==j.POINT)return this.changeMode(K.DIRECT_SELECT,{featureId:_t});wt&&it?(this.deselect(_t),this.updateUIClasses({mouse:G.POINTER}),ht.length===1&&Gr.enable(this)):!wt&&it?(this.select(_t),this.updateUIClasses({mouse:G.MOVE})):wt||it||(ht.forEach(function(Wt){return Z.doRender(Wt)}),this.setSelected(_t),this.updateUIClasses({mouse:G.MOVE})),this.doRender(_t)},Te.onMouseDown=function(b,M){return Nr(M)?this.startOnActiveFeature(b,M):this.drawConfig.boxSelect&&Tr(M)?this.startBoxSelect(b,M):void 0},Te.startBoxSelect=function(b,M){this.stopExtendedInteractions(b),this.map.dragPan.disable(),b.boxSelectStartLocation=yi(M.originalEvent,this.map.getContainer()),b.canBoxSelect=!0},Te.onTouchStart=function(b,M){if(Nr(M))return this.startOnActiveFeature(b,M)},Te.onDrag=function(b,M){return b.canDragMove?this.dragMove(b,M):this.drawConfig.boxSelect&&b.canBoxSelect?this.whileBoxSelect(b,M):void 0},Te.whileBoxSelect=function(b,M){b.boxSelecting=!0,this.updateUIClasses({mouse:G.ADD}),b.boxSelectElement||(b.boxSelectElement=document.createElement("div"),b.boxSelectElement.classList.add(D.BOX_SELECT),this.map.getContainer().appendChild(b.boxSelectElement));var Z=yi(M.originalEvent,this.map.getContainer()),it=Math.min(b.boxSelectStartLocation.x,Z.x),ht=Math.max(b.boxSelectStartLocation.x,Z.x),_t=Math.min(b.boxSelectStartLocation.y,Z.y),wt=Math.max(b.boxSelectStartLocation.y,Z.y),Wt="translate("+it+"px, "+_t+"px)";b.boxSelectElement.style.transform=Wt,b.boxSelectElement.style.WebkitTransform=Wt,b.boxSelectElement.style.width=ht-it+"px",b.boxSelectElement.style.height=wt-_t+"px"},Te.dragMove=function(b,M){b.dragMoving=!0,M.originalEvent.stopPropagation();var Z={lng:M.lngLat.lng-b.dragMoveLocation.lng,lat:M.lngLat.lat-b.dragMoveLocation.lat};Rr(this.getSelected(),Z),b.dragMoveLocation=M.lngLat},Te.onTouchEnd=Te.onMouseUp=function(b,M){var Z=this;if(b.dragMoving)this.fireUpdate();else if(b.boxSelecting){var it=[b.boxSelectStartLocation,yi(M.originalEvent,this.map.getContainer())],ht=this.featuresAt(null,it,"click"),_t=this.getUniqueIds(ht).filter(function(wt){return!Z.isSelected(wt)});_t.length&&(this.select(_t),_t.forEach(function(wt){return Z.doRender(wt)}),this.updateUIClasses({mouse:G.MOVE}))}this.stopExtendedInteractions(b)},Te.toDisplayFeatures=function(b,M,Z){M.properties.active=this.isSelected(M.properties.id)?gt.ACTIVE:gt.INACTIVE,Z(M),this.fireActionable(),M.properties.active===gt.ACTIVE&&M.geometry.type!==j.POINT&&oo(M).forEach(Z)},Te.onTrash=function(){this.deleteFeature(this.getSelectedIds()),this.fireActionable()},Te.onCombineFeatures=function(){var b=this.getSelected();if(!(b.length===0||b.length<2)){for(var M=[],Z=[],it=b[0].type.replace("Multi",""),ht=0;ht<b.length;ht++){var _t=b[ht];if(_t.type.replace("Multi","")!==it)return;_t.type.includes("Multi")?_t.getCoordinates().forEach(function(Wt){M.push(Wt)}):M.push(_t.getCoordinates()),Z.push(_t.toGeoJSON())}if(Z.length>1){var wt=this.newFeature({type:j.FEATURE,properties:Z[0].properties,geometry:{type:"Multi"+it,coordinates:M}});this.addFeature(wt),this.deleteFeature(this.getSelectedIds(),{silent:!0}),this.setSelected([wt.id]),this.map.fire(lt.COMBINE_FEATURES,{createdFeatures:[wt.toGeoJSON()],deletedFeatures:Z})}this.fireActionable()}},Te.onUncombineFeatures=function(){var b=this,M=this.getSelected();if(M.length!==0){for(var Z=[],it=[],ht=function(wt){var Wt=M[wt];b.isInstanceOf("MultiFeature",Wt)&&(Wt.getFeatures().forEach(function(ne){b.addFeature(ne),ne.properties=Wt.properties,Z.push(ne.toGeoJSON()),b.select([ne.id])}),b.deleteFeature(Wt.id,{silent:!0}),it.push(Wt.toGeoJSON()))},_t=0;_t<M.length;_t++)ht(_t);Z.length>1&&this.map.fire(lt.UNCOMBINE_FEATURES,{createdFeatures:Z,deletedFeatures:it}),this.fireActionable()}};var _r=is(xt.VERTEX),pa=is(xt.MIDPOINT),yr={fireUpdate:function(){this.map.fire(lt.UPDATE,{action:dt.CHANGE_COORDINATES,features:this.getSelected().map(function(b){return b.toGeoJSON()})})},fireActionable:function(b){this.setActionableState({combineFeatures:!1,uncombineFeatures:!1,trash:b.selectedCoordPaths.length>0})},startDragging:function(b,M){this.map.dragPan.disable(),b.canDragMove=!0,b.dragMoveLocation=M.lngLat},stopDragging:function(b){this.map.dragPan.enable(),b.dragMoving=!1,b.canDragMove=!1,b.dragMoveLocation=null},onVertex:function(b,M){this.startDragging(b,M);var Z=M.featureTarget.properties,it=b.selectedCoordPaths.indexOf(Z.coord_path);Vr(M)||it!==-1?Vr(M)&&it===-1&&b.selectedCoordPaths.push(Z.coord_path):b.selectedCoordPaths=[Z.coord_path];var ht=this.pathsToCoordinates(b.featureId,b.selectedCoordPaths);this.setSelectedCoordinates(ht)},onMidpoint:function(b,M){this.startDragging(b,M);var Z=M.featureTarget.properties;b.feature.addCoordinate(Z.coord_path,Z.lng,Z.lat),this.fireUpdate(),b.selectedCoordPaths=[Z.coord_path]},pathsToCoordinates:function(b,M){return M.map(function(Z){return{feature_id:b,coord_path:Z}})},onFeature:function(b,M){b.selectedCoordPaths.length===0?this.startDragging(b,M):this.stopDragging(b)},dragFeature:function(b,M,Z){Rr(this.getSelected(),Z),b.dragMoveLocation=M.lngLat},dragVertex:function(b,M,Z){for(var it=b.selectedCoordPaths.map(function(Wt){return b.feature.getCoordinate(Wt)}),ht=Wn(it.map(function(Wt){return{type:j.FEATURE,properties:{},geometry:{type:j.POINT,coordinates:Wt}}}),Z),_t=0;_t<it.length;_t++){var wt=it[_t];b.feature.updateCoordinate(b.selectedCoordPaths[_t],wt[0]+ht.lng,wt[1]+ht.lat)}},clickNoTarget:function(){this.changeMode(K.SIMPLE_SELECT)},clickInactive:function(){this.changeMode(K.SIMPLE_SELECT)},clickActiveFeature:function(b){b.selectedCoordPaths=[],this.clearSelectedCoordinates(),b.feature.changed()},onSetup:function(b){var M=b.featureId,Z=this.getFeature(M);if(!Z)throw new Error("You must provide a featureId to enter direct_select mode");if(Z.type===j.POINT)throw new TypeError("direct_select mode doesn't handle point features");var it={featureId:M,feature:Z,dragMoveLocation:b.startPos||null,dragMoving:!1,canDragMove:!1,selectedCoordPaths:b.coordPath?[b.coordPath]:[]};return this.setSelectedCoordinates(this.pathsToCoordinates(M,it.selectedCoordPaths)),this.setSelected(M),Gr.disable(this),this.setActionableState({trash:!0}),it},onStop:function(){Gr.enable(this),this.clearSelectedCoordinates()},toDisplayFeatures:function(b,M,Z){b.featureId===M.properties.id?(M.properties.active=gt.ACTIVE,Z(M),oo(M,{map:this.map,midpoints:!0,selectedPaths:b.selectedCoordPaths}).forEach(Z)):(M.properties.active=gt.INACTIVE,Z(M)),this.fireActionable(b)},onTrash:function(b){b.selectedCoordPaths.sort(function(M,Z){return Z.localeCompare(M,"en",{numeric:!0})}).forEach(function(M){return b.feature.removeCoordinate(M)}),this.fireUpdate(),b.selectedCoordPaths=[],this.clearSelectedCoordinates(),this.fireActionable(b),b.feature.isValid()===!1&&(this.deleteFeature([b.featureId]),this.changeMode(K.SIMPLE_SELECT,{}))},onMouseMove:function(b,M){var Z=Nr(M),it=_r(M),ht=b.selectedCoordPaths.length===0;return Z&&ht||it&&!ht?this.updateUIClasses({mouse:G.MOVE}):this.updateUIClasses({mouse:G.NONE}),this.stopDragging(b),!0},onMouseOut:function(b){return b.dragMoving&&this.fireUpdate(),!0}};yr.onTouchStart=yr.onMouseDown=function(b,M){return _r(M)?this.onVertex(b,M):Nr(M)?this.onFeature(b,M):pa(M)?this.onMidpoint(b,M):void 0},yr.onDrag=function(b,M){if(b.canDragMove===!0){b.dragMoving=!0,M.originalEvent.stopPropagation();var Z={lng:M.lngLat.lng-b.dragMoveLocation.lng,lat:M.lngLat.lat-b.dragMoveLocation.lat};b.selectedCoordPaths.length>0?this.dragVertex(b,M,Z):this.dragFeature(b,M,Z),b.dragMoveLocation=M.lngLat}},yr.onClick=function(b,M){return Co(M)?this.clickNoTarget(b,M):Nr(M)?this.clickActiveFeature(b,M):os(M)?this.clickInactive(b,M):void this.stopDragging(b)},yr.onTap=function(b,M){return Co(M)?this.clickNoTarget(b,M):Nr(M)?this.clickActiveFeature(b,M):os(M)?this.clickInactive(b,M):void 0},yr.onTouchEnd=yr.onMouseUp=function(b){b.dragMoving&&this.fireUpdate(),this.stopDragging(b)};var Or={};function Ji(b,M){return!!b.lngLat&&b.lngLat.lng===M[0]&&b.lngLat.lat===M[1]}Or.onSetup=function(){var b=this.newFeature({type:j.FEATURE,properties:{},geometry:{type:j.POINT,coordinates:[]}});return this.addFeature(b),this.clearSelectedFeatures(),this.updateUIClasses({mouse:G.ADD}),this.activateUIButton(H.POINT),this.setActionableState({trash:!0}),{point:b}},Or.stopDrawingAndRemove=function(b){this.deleteFeature([b.point.id],{silent:!0}),this.changeMode(K.SIMPLE_SELECT)},Or.onTap=Or.onClick=function(b,M){this.updateUIClasses({mouse:G.MOVE}),b.point.updateCoordinate("",M.lngLat.lng,M.lngLat.lat),this.map.fire(lt.CREATE,{features:[b.point.toGeoJSON()]}),this.changeMode(K.SIMPLE_SELECT,{featureIds:[b.point.id]})},Or.onStop=function(b){this.activateUIButton(),b.point.getCoordinate().length||this.deleteFeature([b.point.id],{silent:!0})},Or.toDisplayFeatures=function(b,M,Z){var it=M.properties.id===b.point.id;if(M.properties.active=it?gt.ACTIVE:gt.INACTIVE,!it)return Z(M)},Or.onTrash=Or.stopDrawingAndRemove,Or.onKeyUp=function(b,M){if(ss(M)||Ki(M))return this.stopDrawingAndRemove(b,M)};var Go={onSetup:function(){var b=this.newFeature({type:j.FEATURE,properties:{},geometry:{type:j.POLYGON,coordinates:[[]]}});return this.addFeature(b),this.clearSelectedFeatures(),Gr.disable(this),this.updateUIClasses({mouse:G.ADD}),this.activateUIButton(H.POLYGON),this.setActionableState({trash:!0}),{polygon:b,currentVertexPosition:0}},clickAnywhere:function(b,M){if(b.currentVertexPosition>0&&Ji(M,b.polygon.coordinates[0][b.currentVertexPosition-1]))return this.changeMode(K.SIMPLE_SELECT,{featureIds:[b.polygon.id]});this.updateUIClasses({mouse:G.ADD}),b.polygon.updateCoordinate("0."+b.currentVertexPosition,M.lngLat.lng,M.lngLat.lat),b.currentVertexPosition++,b.polygon.updateCoordinate("0."+b.currentVertexPosition,M.lngLat.lng,M.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(K.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},onMouseMove:function(b,M){b.polygon.updateCoordinate("0."+b.currentVertexPosition,M.lngLat.lng,M.lngLat.lat),Ri(M)&&this.updateUIClasses({mouse:G.POINTER})}};Go.onTap=Go.onClick=function(b,M){return Ri(M)?this.clickOnVertex(b,M):this.clickAnywhere(b,M)},Go.onKeyUp=function(b,M){ss(M)?(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(K.SIMPLE_SELECT)):Ki(M)&&this.changeMode(K.SIMPLE_SELECT,{featureIds:[b.polygon.id]})},Go.onStop=function(b){this.updateUIClasses({mouse:G.NONE}),Gr.enable(this),this.activateUIButton(),this.getFeature(b.polygon.id)!==void 0&&(b.polygon.removeCoordinate("0."+b.currentVertexPosition),b.polygon.isValid()?this.map.fire(lt.CREATE,{features:[b.polygon.toGeoJSON()]}):(this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(K.SIMPLE_SELECT,{},{silent:!0})))},Go.toDisplayFeatures=function(b,M,Z){var it=M.properties.id===b.polygon.id;if(M.properties.active=it?gt.ACTIVE:gt.INACTIVE,!it)return Z(M);if(M.geometry.coordinates.length!==0){var ht=M.geometry.coordinates[0].length;if(!(ht<3)){if(M.properties.meta=xt.FEATURE,Z(hr(b.polygon.id,M.geometry.coordinates[0][0],"0.0",!1)),ht>3){var _t=M.geometry.coordinates[0].length-3;Z(hr(b.polygon.id,M.geometry.coordinates[0][_t],"0."+_t,!1))}if(ht<=4){var wt=[[M.geometry.coordinates[0][0][0],M.geometry.coordinates[0][0][1]],[M.geometry.coordinates[0][1][0],M.geometry.coordinates[0][1][1]]];if(Z({type:j.FEATURE,properties:M.properties,geometry:{coordinates:wt,type:j.LINE_STRING}}),ht===3)return}return Z(M)}}},Go.onTrash=function(b){this.deleteFeature([b.polygon.id],{silent:!0}),this.changeMode(K.SIMPLE_SELECT)};var Ps={onSetup:function(b){var M,Z,it=(b=b||{}).featureId,ht="forward";if(it){if(!(M=this.getFeature(it)))throw new Error("Could not find a feature with the provided featureId");var _t=b.from;if(_t&&_t.type==="Feature"&&_t.geometry&&_t.geometry.type==="Point"&&(_t=_t.geometry),_t&&_t.type==="Point"&&_t.coordinates&&_t.coordinates.length===2&&(_t=_t.coordinates),!_t||!Array.isArray(_t))throw new Error("Please use the `from` property to indicate which point to continue the line from");var wt=M.coordinates.length-1;if(M.coordinates[wt][0]===_t[0]&&M.coordinates[wt][1]===_t[1])Z=wt+1,M.addCoordinate.apply(M,[Z].concat(M.coordinates[wt]));else{if(M.coordinates[0][0]!==_t[0]||M.coordinates[0][1]!==_t[1])throw new Error("`from` should match the point at either the start or the end of the provided LineString");ht="backwards",Z=0,M.addCoordinate.apply(M,[Z].concat(M.coordinates[0]))}}else M=this.newFeature({type:j.FEATURE,properties:{},geometry:{type:j.LINE_STRING,coordinates:[]}}),Z=0,this.addFeature(M);return this.clearSelectedFeatures(),Gr.disable(this),this.updateUIClasses({mouse:G.ADD}),this.activateUIButton(H.LINE),this.setActionableState({trash:!0}),{line:M,currentVertexPosition:Z,direction:ht}},clickAnywhere:function(b,M){if(b.currentVertexPosition>0&&Ji(M,b.line.coordinates[b.currentVertexPosition-1])||b.direction==="backwards"&&Ji(M,b.line.coordinates[b.currentVertexPosition+1]))return this.changeMode(K.SIMPLE_SELECT,{featureIds:[b.line.id]});this.updateUIClasses({mouse:G.ADD}),b.line.updateCoordinate(b.currentVertexPosition,M.lngLat.lng,M.lngLat.lat),b.direction==="forward"?(b.currentVertexPosition++,b.line.updateCoordinate(b.currentVertexPosition,M.lngLat.lng,M.lngLat.lat)):b.line.addCoordinate(0,M.lngLat.lng,M.lngLat.lat)},clickOnVertex:function(b){return this.changeMode(K.SIMPLE_SELECT,{featureIds:[b.line.id]})},onMouseMove:function(b,M){b.line.updateCoordinate(b.currentVertexPosition,M.lngLat.lng,M.lngLat.lat),Ri(M)&&this.updateUIClasses({mouse:G.POINTER})}};Ps.onTap=Ps.onClick=function(b,M){if(Ri(M))return this.clickOnVertex(b,M);this.clickAnywhere(b,M)},Ps.onKeyUp=function(b,M){Ki(M)?this.changeMode(K.SIMPLE_SELECT,{featureIds:[b.line.id]}):ss(M)&&(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(K.SIMPLE_SELECT))},Ps.onStop=function(b){Gr.enable(this),this.activateUIButton(),this.getFeature(b.line.id)!==void 0&&(b.line.removeCoordinate(""+b.currentVertexPosition),b.line.isValid()?this.map.fire(lt.CREATE,{features:[b.line.toGeoJSON()]}):(this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(K.SIMPLE_SELECT,{},{silent:!0})))},Ps.onTrash=function(b){this.deleteFeature([b.line.id],{silent:!0}),this.changeMode(K.SIMPLE_SELECT)},Ps.toDisplayFeatures=function(b,M,Z){var it=M.properties.id===b.line.id;if(M.properties.active=it?gt.ACTIVE:gt.INACTIVE,!it)return Z(M);M.geometry.coordinates.length<2||(M.properties.meta=xt.FEATURE,Z(hr(b.line.id,M.geometry.coordinates[b.direction==="forward"?M.geometry.coordinates.length-2:1],""+(b.direction==="forward"?M.geometry.coordinates.length-2:1),!1)),Z(M))};var jr={simple_select:Te,direct_select:yr,draw_point:Or,draw_polygon:Go,draw_line_string:Ps},Ql={defaultMode:K.SIMPLE_SELECT,keybindings:!0,touchEnabled:!0,clickBuffer:2,touchBuffer:25,boxSelect:!0,displayControlsDefault:!0,styles:rs,modes:jr,controls:{},userProperties:!1},fa={point:!0,line_string:!0,polygon:!0,trash:!0,combine_features:!0,uncombine_features:!0},qr={point:!1,line_string:!1,polygon:!1,trash:!1,combine_features:!1,uncombine_features:!1};function tu(b,M){return b.map(function(Z){return Z.source?Z:Sr(Z,{id:Z.id+"."+M,source:M==="hot"?k.HOT:k.COLD})})}var so={};(function(b,M){var Z="__lodash_hash_undefined__",it=9007199254740991,ht="[object Arguments]",_t="[object Array]",wt="[object Boolean]",Wt="[object Date]",ne="[object Error]",me="[object Function]",fe="[object Map]",ae="[object Number]",He="[object Object]",fr="[object Promise]",sn="[object RegExp]",Zr="[object Set]",Ot="[object String]",Pe="[object Symbol]",fn="[object WeakMap]",Xr="[object ArrayBuffer]",vr="[object DataView]",ga=/^\[object .+?Constructor\]$/,Ou=/^(?:0|[1-9]\d*)$/,er={};er["[object Float32Array]"]=er["[object Float64Array]"]=er["[object Int8Array]"]=er["[object Int16Array]"]=er["[object Int32Array]"]=er["[object Uint8Array]"]=er["[object Uint8ClampedArray]"]=er["[object Uint16Array]"]=er["[object Uint32Array]"]=!0,er[ht]=er[_t]=er[Xr]=er[wt]=er[vr]=er[Wt]=er[ne]=er[me]=er[fe]=er[ae]=er[He]=er[sn]=er[Zr]=er[Ot]=er[fn]=!1;var Ha=typeof Wh=="object"&&Wh&&Wh.Object===Object&&Wh,Sl=typeof self=="object"&&self&&self.Object===Object&&self,jo=Ha||Sl||Function("return this")(),ao=M&&!M.nodeType&&M,lo=ao&&b&&!b.nodeType&&b,zu=lo&&lo.exports===ao,Tl=zu&&Ha.process,eu=function(){try{return Tl&&Tl.binding&&Tl.binding("util")}catch{}}(),Fu=eu&&eu.isTypedArray;function nu(Et,kt){for(var ce=-1,Fe=Et==null?0:Et.length;++ce<Fe;)if(kt(Et[ce],ce,Et))return!0;return!1}function $a(Et){var kt=-1,ce=Array(Et.size);return Et.forEach(function(Fe,nr){ce[++kt]=[nr,Fe]}),ce}function Mn(Et){var kt=-1,ce=Array(Et.size);return Et.forEach(function(Fe){ce[++kt]=Fe}),ce}var Bu,ru,Ic,fh=Array.prototype,Cl=Function.prototype,Uu=Object.prototype,Sc=jo["__core-js_shared__"],dh=Cl.toString,Ms=Uu.hasOwnProperty,gh=(Bu=/[^.]+$/.exec(Sc&&Sc.keys&&Sc.keys.IE_PROTO||""))?"Symbol(src)_1."+Bu:"",mh=Uu.toString,Tc=RegExp("^"+dh.call(Ms).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),iu=zu?jo.Buffer:void 0,Pl=jo.Symbol,Vu=jo.Uint8Array,Ka=Uu.propertyIsEnumerable,_h=fh.splice,ma=Pl?Pl.toStringTag:void 0,Gu=Object.getOwnPropertySymbols,Ja=iu?iu.isBuffer:void 0,yh=(ru=Object.keys,Ic=Object,function(Et){return ru(Ic(Et))}),_a=va(jo,"DataView"),As=va(jo,"Map"),ju=va(jo,"Promise"),ou=va(jo,"Set"),Dn=va(jo,"WeakMap"),ya=va(Object,"create"),Mp=el(_a),vh=el(As),su=el(ju),Ap=el(ou),Cc=el(Dn),Pc=Pl?Pl.prototype:void 0,Mc=Pc?Pc.valueOf:void 0;function qs(Et){var kt=-1,ce=Et==null?0:Et.length;for(this.clear();++kt<ce;){var Fe=Et[kt];this.set(Fe[0],Fe[1])}}function qo(Et){var kt=-1,ce=Et==null?0:Et.length;for(this.clear();++kt<ce;){var Fe=Et[kt];this.set(Fe[0],Fe[1])}}function Hn(Et){var kt=-1,ce=Et==null?0:Et.length;for(this.clear();++kt<ce;){var Fe=Et[kt];this.set(Fe[0],Fe[1])}}function Ml(Et){var kt=-1,ce=Et==null?0:Et.length;for(this.__data__=new Hn;++kt<ce;)this.add(Et[kt])}function en(Et){var kt=this.__data__=new qo(Et);this.size=kt.size}function qu(Et,kt){var ce=Ls(Et),Fe=!ce&&Yr(Et),nr=!ce&&!Fe&&uo(Et),an=!ce&&!Fe&&!nr&&Al(Et),dr=ce||Fe||nr||an,Cr=dr?function(Qr,us){for(var Po=-1,Oi=Array(Qr);++Po<Qr;)Oi[Po]=us(Po);return Oi}(Et.length,String):[],Xo=Cr.length;for(var Pr in Et)!kt&&!Ms.call(Et,Pr)||dr&&(Pr=="length"||nr&&(Pr=="offset"||Pr=="parent")||an&&(Pr=="buffer"||Pr=="byteLength"||Pr=="byteOffset")||lu(Pr,Xo))||Cr.push(Pr);return Cr}function $n(Et,kt){for(var ce=Et.length;ce--;)if(Nc(Et[ce][0],kt))return ce;return-1}function Fn(Et){return Et==null?Et===void 0?"[object Undefined]":"[object Null]":ma&&ma in Object(Et)?function(kt){var ce=Ms.call(kt,ma),Fe=kt[ma];try{kt[ma]=void 0;var nr=!0}catch{}var an=mh.call(kt);return nr&&(ce?kt[ma]=Fe:delete kt[ma]),an}(Et):function(kt){return mh.call(kt)}(Et)}function Qa(Et){return ls(Et)&&Fn(Et)==ht}function Ac(Et,kt,ce,Fe,nr){return Et===kt||(Et==null||kt==null||!ls(Et)&&!ls(kt)?Et!=Et&&kt!=kt:function(an,dr,Cr,Xo,Pr,Qr){var us=Ls(an),Po=Ls(dr),Oi=us?_t:Zo(an),xi=Po?_t:Zo(dr),Si=(Oi=Oi==ht?He:Oi)==He,xa=(xi=xi==ht?He:xi)==He,gr=Oi==xi;if(gr&&uo(an)){if(!uo(dr))return!1;us=!0,Si=!1}if(gr&&!Si)return Qr||(Qr=new en),us||Al(an)?Dc(an,dr,Cr,Xo,Pr,Qr):function(Bn,kn,Mo,de,Dl,zi,Ti){switch(Mo){case vr:if(Bn.byteLength!=kn.byteLength||Bn.byteOffset!=kn.byteOffset)return!1;Bn=Bn.buffer,kn=kn.buffer;case Xr:return!(Bn.byteLength!=kn.byteLength||!zi(new Vu(Bn),new Vu(kn)));case wt:case Wt:case ae:return Nc(+Bn,+kn);case ne:return Bn.name==kn.name&&Bn.message==kn.message;case sn:case Ot:return Bn==kn+"";case fe:var Zs=$a;case Zr:var le=1&de;if(Zs||(Zs=Mn),Bn.size!=kn.size&&!le)return!1;var nl=Ti.get(Bn);if(nl)return nl==kn;de|=2,Ti.set(Bn,kn);var ba=Dc(Zs(Bn),Zs(kn),de,Dl,zi,Ti);return Ti.delete(Bn),ba;case Pe:if(Mc)return Mc.call(Bn)==Mc.call(kn)}return!1}(an,dr,Oi,Cr,Xo,Pr,Qr);if(!(1&Cr)){var Yo=Si&&Ms.call(an,"__wrapped__"),xh=xa&&Ms.call(dr,"__wrapped__");if(Yo||xh){var Dp=Yo?an.value():an,kp=xh?dr.value():dr;return Qr||(Qr=new en),Pr(Dp,kp,Cr,Xo,Qr)}}return gr?(Qr||(Qr=new en),function(Bn,kn,Mo,de,Dl,zi){var Ti=1&Mo,Zs=au(Bn),le=Zs.length,nl=au(kn).length;if(le!=nl&&!Ti)return!1;for(var ba=le;ba--;){var wa=Zs[ba];if(!(Ti?wa in kn:Ms.call(kn,wa)))return!1}var uu=zi.get(Bn);if(uu&&zi.get(kn))return uu==kn;var cu=!0;zi.set(Bn,kn),zi.set(kn,Bn);for(var kl=Ti;++ba<le;){var rl=Bn[wa=Zs[ba]],hu=kn[wa];if(de)var Xu=Ti?de(hu,rl,wa,kn,Bn,zi):de(rl,hu,wa,Bn,kn,zi);if(!(Xu===void 0?rl===hu||Dl(rl,hu,Mo,de,zi):Xu)){cu=!1;break}kl||(kl=wa=="constructor")}if(cu&&!kl){var il=Bn.constructor,Nl=kn.constructor;il==Nl||!("constructor"in Bn)||!("constructor"in kn)||typeof il=="function"&&il instanceof il&&typeof Nl=="function"&&Nl instanceof Nl||(cu=!1)}return zi.delete(Bn),zi.delete(kn),cu}(an,dr,Cr,Xo,Pr,Qr)):!1}(Et,kt,ce,Fe,Ac,nr))}function Lc(Et){return!(!Oc(Et)||function(kt){return!!gh&&gh in kt}(Et))&&(Rc(Et)?Tc:ga).test(el(Et))}function Lp(Et){if(ce=(kt=Et)&&kt.constructor,Fe=typeof ce=="function"&&ce.prototype||Uu,kt!==Fe)return yh(Et);var kt,ce,Fe,nr=[];for(var an in Object(Et))Ms.call(Et,an)&&an!="constructor"&&nr.push(an);return nr}function Dc(Et,kt,ce,Fe,nr,an){var dr=1&ce,Cr=Et.length,Xo=kt.length;if(Cr!=Xo&&!(dr&&Xo>Cr))return!1;var Pr=an.get(Et);if(Pr&&an.get(kt))return Pr==kt;var Qr=-1,us=!0,Po=2&ce?new Ml:void 0;for(an.set(Et,kt),an.set(kt,Et);++Qr<Cr;){var Oi=Et[Qr],xi=kt[Qr];if(Fe)var Si=dr?Fe(xi,Oi,Qr,kt,Et,an):Fe(Oi,xi,Qr,Et,kt,an);if(Si!==void 0){if(Si)continue;us=!1;break}if(Po){if(!nu(kt,function(xa,gr){if(Yo=gr,!Po.has(Yo)&&(Oi===xa||nr(Oi,xa,ce,Fe,an)))return Po.push(gr);var Yo})){us=!1;break}}else if(Oi!==xi&&!nr(Oi,xi,ce,Fe,an)){us=!1;break}}return an.delete(Et),an.delete(kt),us}function au(Et){return function(kt,ce,Fe){var nr=ce(kt);return Ls(kt)?nr:function(an,dr){for(var Cr=-1,Xo=dr.length,Pr=an.length;++Cr<Xo;)an[Pr+Cr]=dr[Cr];return an}(nr,Fe(kt))}(Et,Ll,kc)}function tl(Et,kt){var ce,Fe,nr=Et.__data__;return((Fe=typeof(ce=kt))=="string"||Fe=="number"||Fe=="symbol"||Fe=="boolean"?ce!=="__proto__":ce===null)?nr[typeof kt=="string"?"string":"hash"]:nr.map}function va(Et,kt){var ce=function(Fe,nr){return Fe==null?void 0:Fe[nr]}(Et,kt);return Lc(ce)?ce:void 0}qs.prototype.clear=function(){this.__data__=ya?ya(null):{},this.size=0},qs.prototype.delete=function(Et){var kt=this.has(Et)&&delete this.__data__[Et];return this.size-=kt?1:0,kt},qs.prototype.get=function(Et){var kt=this.__data__;if(ya){var ce=kt[Et];return ce===Z?void 0:ce}return Ms.call(kt,Et)?kt[Et]:void 0},qs.prototype.has=function(Et){var kt=this.__data__;return ya?kt[Et]!==void 0:Ms.call(kt,Et)},qs.prototype.set=function(Et,kt){var ce=this.__data__;return this.size+=this.has(Et)?0:1,ce[Et]=ya&&kt===void 0?Z:kt,this},qo.prototype.clear=function(){this.__data__=[],this.size=0},qo.prototype.delete=function(Et){var kt=this.__data__,ce=$n(kt,Et);return!(ce<0)&&(ce==kt.length-1?kt.pop():_h.call(kt,ce,1),--this.size,!0)},qo.prototype.get=function(Et){var kt=this.__data__,ce=$n(kt,Et);return ce<0?void 0:kt[ce][1]},qo.prototype.has=function(Et){return $n(this.__data__,Et)>-1},qo.prototype.set=function(Et,kt){var ce=this.__data__,Fe=$n(ce,Et);return Fe<0?(++this.size,ce.push([Et,kt])):ce[Fe][1]=kt,this},Hn.prototype.clear=function(){this.size=0,this.__data__={hash:new qs,map:new(As||qo),string:new qs}},Hn.prototype.delete=function(Et){var kt=tl(this,Et).delete(Et);return this.size-=kt?1:0,kt},Hn.prototype.get=function(Et){return tl(this,Et).get(Et)},Hn.prototype.has=function(Et){return tl(this,Et).has(Et)},Hn.prototype.set=function(Et,kt){var ce=tl(this,Et),Fe=ce.size;return ce.set(Et,kt),this.size+=ce.size==Fe?0:1,this},Ml.prototype.add=Ml.prototype.push=function(Et){return this.__data__.set(Et,Z),this},Ml.prototype.has=function(Et){return this.__data__.has(Et)},en.prototype.clear=function(){this.__data__=new qo,this.size=0},en.prototype.delete=function(Et){var kt=this.__data__,ce=kt.delete(Et);return this.size=kt.size,ce},en.prototype.get=function(Et){return this.__data__.get(Et)},en.prototype.has=function(Et){return this.__data__.has(Et)},en.prototype.set=function(Et,kt){var ce=this.__data__;if(ce instanceof qo){var Fe=ce.__data__;if(!As||Fe.length<199)return Fe.push([Et,kt]),this.size=++ce.size,this;ce=this.__data__=new Hn(Fe)}return ce.set(Et,kt),this.size=ce.size,this};var kc=Gu?function(Et){return Et==null?[]:(Et=Object(Et),function(kt,ce){for(var Fe=-1,nr=kt==null?0:kt.length,an=0,dr=[];++Fe<nr;){var Cr=kt[Fe];ce(Cr,Fe,kt)&&(dr[an++]=Cr)}return dr}(Gu(Et),function(kt){return Ka.call(Et,kt)}))}:function(){return[]},Zo=Fn;function lu(Et,kt){return!!(kt=kt??it)&&(typeof Et=="number"||Ou.test(Et))&&Et>-1&&Et%1==0&&Et<kt}function el(Et){if(Et!=null){try{return dh.call(Et)}catch{}try{return Et+""}catch{}}return""}function Nc(Et,kt){return Et===kt||Et!=Et&&kt!=kt}(_a&&Zo(new _a(new ArrayBuffer(1)))!=vr||As&&Zo(new As)!=fe||ju&&Zo(ju.resolve())!=fr||ou&&Zo(new ou)!=Zr||Dn&&Zo(new Dn)!=fn)&&(Zo=function(Et){var kt=Fn(Et),ce=kt==He?Et.constructor:void 0,Fe=ce?el(ce):"";if(Fe)switch(Fe){case Mp:return vr;case vh:return fe;case su:return fr;case Ap:return Zr;case Cc:return fn}return kt});var Yr=Qa(function(){return arguments}())?Qa:function(Et){return ls(Et)&&Ms.call(Et,"callee")&&!Ka.call(Et,"callee")},Ls=Array.isArray,uo=Ja||function(){return!1};function Rc(Et){if(!Oc(Et))return!1;var kt=Fn(Et);return kt==me||kt=="[object GeneratorFunction]"||kt=="[object AsyncFunction]"||kt=="[object Proxy]"}function Zu(Et){return typeof Et=="number"&&Et>-1&&Et%1==0&&Et<=it}function Oc(Et){var kt=typeof Et;return Et!=null&&(kt=="object"||kt=="function")}function ls(Et){return Et!=null&&typeof Et=="object"}var Al=Fu?function(Et){return function(kt){return Et(kt)}}(Fu):function(Et){return ls(Et)&&Zu(Et.length)&&!!er[Fn(Et)]};function Ll(Et){return(kt=Et)!=null&&Zu(kt.length)&&!Rc(kt)?qu(Et):Lp(Et);var kt}b.exports=function(Et,kt){return Ac(Et,kt)}})({get exports(){return so},set exports(b){so=b}},so);var ph=so;function vi(b,M){return b.length===M.length&&JSON.stringify(b.map(function(Z){return Z}).sort())===JSON.stringify(M.map(function(Z){return Z}).sort())}var Ec={Polygon:Yn,LineString:wn,Point:pr,MultiPolygon:Ur,MultiLineString:Ur,MultiPoint:Ur},Ru=Object.freeze({__proto__:null,CommonSelectors:ee,constrainFeatureMovement:Wn,createMidPoint:Xe,createSupplementaryPoints:oo,createVertex:hr,doubleClickZoom:Gr,euclideanDistance:Ye,featuresAt:Ue,getFeatureAtAndSetCursors:Se,isClick:yn,isEventAtCoordinates:Ji,isTap:tr,mapEventToBoundingBox:Qt,ModeHandler:n,moveFeatures:Rr,sortFeatures:qt,stringSetsAreEqual:vi,StringSet:ie,theme:rs,toDenseArray:We}),da=function(b,M){var Z={options:b=function(ht){ht===void 0&&(ht={});var _t=Sr(ht);return ht.controls||(_t.controls={}),ht.displayControlsDefault===!1?_t.controls=Sr(qr,ht.controls):_t.controls=Sr(fa,ht.controls),(_t=Sr(Ql,_t)).styles=tu(_t.styles,"cold").concat(tu(_t.styles,"hot")),_t}(b)};M=function(ht,_t){return _t.modes=K,_t.getFeatureIdsAt=function(wt){return Ue.click({point:wt},null,ht).map(function(Wt){return Wt.properties.id})},_t.getSelectedIds=function(){return ht.store.getSelectedIds()},_t.getSelected=function(){return{type:j.FEATURE_COLLECTION,features:ht.store.getSelectedIds().map(function(wt){return ht.store.get(wt)}).map(function(wt){return wt.toGeoJSON()})}},_t.getSelectedPoints=function(){return{type:j.FEATURE_COLLECTION,features:ht.store.getSelectedCoordinates().map(function(wt){return{type:j.FEATURE,properties:{},geometry:{type:j.POINT,coordinates:wt.coordinates}}})}},_t.set=function(wt){if(wt.type===void 0||wt.type!==j.FEATURE_COLLECTION||!Array.isArray(wt.features))throw new Error("Invalid FeatureCollection");var Wt=ht.store.createRenderBatch(),ne=ht.store.getAllIds().slice(),me=_t.add(wt),fe=new ie(me);return(ne=ne.filter(function(ae){return!fe.has(ae)})).length&&_t.delete(ne),Wt(),me},_t.add=function(wt){var Wt=JSON.parse(JSON.stringify(Jr(wt))).features.map(function(ne){if(ne.id=ne.id||Xn(),ne.geometry===null)throw new Error("Invalid geometry: null");if(ht.store.get(ne.id)===void 0||ht.store.get(ne.id).type!==ne.geometry.type){var me=Ec[ne.geometry.type];if(me===void 0)throw new Error("Invalid geometry type: "+ne.geometry.type+".");var fe=new me(ht,ne);ht.store.add(fe)}else{var ae=ht.store.get(ne.id);ae.properties=ne.properties,ph(ae.getCoordinates(),ne.geometry.coordinates)||ae.incomingCoords(ne.geometry.coordinates)}return ne.id});return ht.store.render(),Wt},_t.get=function(wt){var Wt=ht.store.get(wt);if(Wt)return Wt.toGeoJSON()},_t.getAll=function(){return{type:j.FEATURE_COLLECTION,features:ht.store.getAll().map(function(wt){return wt.toGeoJSON()})}},_t.delete=function(wt){return ht.store.delete(wt,{silent:!0}),_t.getMode()!==K.DIRECT_SELECT||ht.store.getSelectedIds().length?ht.store.render():ht.events.changeMode(K.SIMPLE_SELECT,void 0,{silent:!0}),_t},_t.deleteAll=function(){return ht.store.delete(ht.store.getAllIds(),{silent:!0}),_t.getMode()===K.DIRECT_SELECT?ht.events.changeMode(K.SIMPLE_SELECT,void 0,{silent:!0}):ht.store.render(),_t},_t.changeMode=function(wt,Wt){return Wt===void 0&&(Wt={}),wt===K.SIMPLE_SELECT&&_t.getMode()===K.SIMPLE_SELECT?(vi(Wt.featureIds||[],ht.store.getSelectedIds())||(ht.store.setSelected(Wt.featureIds,{silent:!0}),ht.store.render()),_t):(wt===K.DIRECT_SELECT&&_t.getMode()===K.DIRECT_SELECT&&Wt.featureId===ht.store.getSelectedIds()[0]||ht.events.changeMode(wt,Wt,{silent:!0}),_t)},_t.getMode=function(){return ht.events.getMode()},_t.trash=function(){return ht.events.trash({silent:!0}),_t},_t.combineFeatures=function(){return ht.events.combineFeatures({silent:!0}),_t},_t.uncombineFeatures=function(){return ht.events.uncombineFeatures({silent:!0}),_t},_t.setFeatureProperty=function(wt,Wt,ne){return ht.store.setFeatureProperty(wt,Wt,ne),_t},_t}(Z,M),Z.api=M;var it=io(Z);return M.onAdd=it.onAdd,M.onRemove=it.onRemove,M.types=H,M.options=b,M};function Pn(b){da(b,this)}return Pn.modes=jr,Pn.constants=Gt,Pn.lib=Ru,Pn})})(dx);var rI=dx.exports;const rc=sv(rI);function iI(t){let e,n,o;return{c(){e=Ne("button"),e.textContent="Import current view",Xt(e,"type","button")},m(l,h){tn(l,e,h),n||(o=lr(e,"click",t[0]),n=!0)},p:Tn,i:Tn,o:Tn,d(l){l&&Ke(e),n=!1,o()}}}function oI(t){let e='poly:"';for(let[o,l]of t.geometry.coordinates[0])e+=`${l} ${o} `;return e=e.slice(0,-1)+'"',`https://overpass-api.de/api/interpreter?data=${`(nwr(${e}); node(w)->.x; <;); out meta;`}`}function df(t){return[t.lng,t.lat]}function sI(t,e,n){let{map:o}=e;const l=Km();let h=null;og(()=>{o!=null&&o.loaded()&&h&&o.removeControl(h)});async function _(w){try{l("loading","Loading from Overpass");let k=await(await fetch(oI(w))).text();l("load",{testCase:"none",boundaryGj:w,osmXml:k})}catch(D){l("error",D.toString())}}function u(){let w=o.getBounds();return{type:"Feature",properties:{},geometry:{coordinates:[[df(w.getSouthWest()),df(w.getNorthWest()),df(w.getNorthEast()),df(w.getSouthEast()),df(w.getSouthWest())]],type:"Polygon"}}}async function I(){if(o){if(o.getZoom()<15){l("error","Zoom in more to import");return}await _(u())}}return t.$$set=w=>{"map"in w&&n(1,o=w.map)},t.$$.update=()=>{t.$$.dirty&26&&o&&!h&&(n(3,rc.constants.classes.CONTROL_BASE="maplibregl-ctrl",rc),n(3,rc.constants.classes.CONTROL_PREFIX="maplibregl-ctrl-",rc),n(3,rc.constants.classes.CONTROL_GROUP="maplibregl-ctrl-group",rc),n(4,h=new rc({displayControlsDefault:!1,controls:{polygon:!0}})),o.addControl(h),o.on("draw.create",async w=>{let D=w.features[0];h.deleteAll(),await _(D)}))},[I,o,_,rc,h]}class aI extends mi{constructor(e){super(),gi(this,e,sI,iI,si,{map:1,importPolygon:2})}get importPolygon(){return this.$$.ctx[2]}}function lI(t){let e,n,o,l,h,_,u,I,w,D,k,G,H,j,K,lt,dt,xt,gt,yt,Nt,Gt,Ut,Zt,qt,Qt,ie;return qt=sb(t[5][0]),{c(){e=Ne("details"),n=Ne("summary"),n.textContent="Processing Options",o=qn(),l=Ne("label"),h=Ne("input"),_=Ai(`
    Debug each transformation step`),u=qn(),I=Ne("label"),w=Ne("input"),D=Ai(`
    Enable dual carriageway experiment`),k=qn(),G=Ne("label"),H=Ne("input"),j=Ai(`
    Enable sidepath zipping experiment`),K=qn(),lt=Ne("div"),dt=Ai(`Sidewalks:
    `),xt=Ne("label"),gt=Ne("input"),yt=Ai(`
      use mapped footways`),Nt=qn(),Gt=Ne("label"),Ut=Ne("input"),Zt=Ai(`
      infer on roads`),Xt(n,"class","svelte-fio7ln"),Xt(h,"type","checkbox"),Xt(l,"class","svelte-fio7ln"),Xt(w,"type","checkbox"),Xt(I,"class","svelte-fio7ln"),Xt(H,"type","checkbox"),Xt(G,"class","svelte-fio7ln"),Xt(gt,"type","radio"),gt.__value=!1,Iu(gt,gt.__value),Xt(xt,"class","svelte-fio7ln"),Xt(Ut,"type","radio"),Ut.__value=!0,Iu(Ut,Ut.__value),Xt(Gt,"class","svelte-fio7ln"),Xt(lt,"class","svelte-fio7ln"),Xt(e,"class","svelte-fio7ln"),qt.p(gt,Ut)},m(ve,Ue){tn(ve,e,Ue),we(e,n),we(e,o),we(e,l),we(l,h),h.checked=t[0].debug_each_step,we(l,_),we(e,u),we(e,I),we(I,w),w.checked=t[0].dual_carriageway_experiment,we(I,D),we(e,k),we(e,G),we(G,H),H.checked=t[0].sidepath_zipping_experiment,we(G,j),we(e,K),we(e,lt),we(lt,dt),we(lt,xt),we(xt,gt),gt.checked=gt.__value===t[0].inferred_sidewalks,we(xt,yt),we(lt,Nt),we(lt,Gt),we(Gt,Ut),Ut.checked=Ut.__value===t[0].inferred_sidewalks,we(Gt,Zt),Qt||(ie=[lr(h,"change",t[1]),lr(w,"change",t[2]),lr(H,"change",t[3]),lr(gt,"change",t[4]),lr(Ut,"change",t[6])],Qt=!0)},p(ve,[Ue]){Ue&1&&(h.checked=ve[0].debug_each_step),Ue&1&&(w.checked=ve[0].dual_carriageway_experiment),Ue&1&&(H.checked=ve[0].sidepath_zipping_experiment),Ue&1&&(gt.checked=gt.__value===ve[0].inferred_sidewalks),Ue&1&&(Ut.checked=Ut.__value===ve[0].inferred_sidewalks)},i:Tn,o:Tn,d(ve){ve&&Ke(e),qt.r(),Qt=!1,ua(ie)}}}function uI(t,e,n){let{settings:o={debug_each_step:!1,dual_carriageway_experiment:!1,sidepath_zipping_experiment:!1,inferred_sidewalks:!1}}=e;const l=[[]];function h(){o.debug_each_step=this.checked,n(0,o)}function _(){o.dual_carriageway_experiment=this.checked,n(0,o)}function u(){o.sidepath_zipping_experiment=this.checked,n(0,o)}function I(){o.inferred_sidewalks=this.__value,n(0,o)}function w(){o.inferred_sidewalks=this.__value,n(0,o)}return t.$$set=D=>{"settings"in D&&n(0,o=D.settings)},[o,h,_,u,I,l,w]}class cI extends mi{constructor(e){super(),gi(this,e,uI,lI,si,{settings:0})}}function hI(t){let e,n,o,l,h,_,u,I;return{c(){e=Ne("div"),n=Ne("button"),n.textContent="Update OSM data",o=qn(),l=Ne("button"),l.textContent="Download osm.xml",h=qn(),_=Ne("button"),_.textContent="Reset view",Xt(n,"type","button"),Xt(l,"type","button"),Xt(_,"type","button")},m(w,D){tn(w,e,D),we(e,n),we(e,o),we(e,l),we(e,h),we(e,_),u||(I=[lr(n,"click",t[6]),lr(l,"click",t[5]),lr(_,"click",t[7])],u=!0)},p:Tn,d(w){w&&Ke(e),u=!1,ua(I)}}}function pI(t){let e,n,o=t[2].msg+"",l;return{c(){e=Ne("p"),n=Ai("Error: "),l=Ai(o)},m(h,_){tn(h,e,_),we(e,n),we(e,l)},p(h,_){_&4&&o!==(o=h[2].msg+"")&&Eu(l,o)},d(h){h&&Ke(e)}}}function fI(t){let e,n=t[2].msg+"",o;return{c(){e=Ne("p"),o=Ai(n)},m(l,h){tn(l,e,h),we(e,o)},p(l,h){h&4&&n!==(n=l[2].msg+"")&&Eu(o,n)},d(l){l&&Ke(e)}}}function dI(t){let e;return{c(){e=Ne("p"),e.textContent="Use the polygon tool to select an area to import"},m(n,o){tn(n,e,o)},p:Tn,d(n){n&&Ke(e)}}}function gI(t){let e,n,o,l,h,_,u,I,w,D,k,G={map:t[4]};e=new aI({props:G}),t[12](e),e.$on("loading",t[11]),e.$on("load",t[8]),e.$on("resetToNone",t[9]),e.$on("error",t[10]);function H(yt){t[13](yt)}let j={};t[1]!==void 0&&(j.testCase=t[1]),h=new nI({props:j}),yo.push(()=>Qs(h,"testCase",H)),h.$on("loading",t[11]),h.$on("load",t[8]),h.$on("resetToNone",t[9]),h.$on("error",t[10]);function K(yt,Nt){if(yt[2].kind==="nothing")return dI;if(yt[2].kind==="loading")return fI;if(yt[2].kind==="error")return pI;if(yt[2].kind==="done")return hI}let lt=K(t),dt=lt&&lt(t);function xt(yt){t[14](yt)}let gt={};return t[0]!==void 0&&(gt.settings=t[0]),w=new cI({props:gt}),yo.push(()=>Qs(w,"settings",xt)),{c(){Lr(e.$$.fragment),n=qn(),o=Ne("fieldset"),l=Ne("legend"),Lr(h.$$.fragment),u=qn(),dt&&dt.c(),I=qn(),Lr(w.$$.fragment)},m(yt,Nt){wr(e,yt,Nt),tn(yt,n,Nt),tn(yt,o,Nt),we(o,l),wr(h,l,null),we(o,u),dt&&dt.m(o,null),tn(yt,I,Nt),wr(w,yt,Nt),k=!0},p(yt,[Nt]){const Gt={};Nt&16&&(Gt.map=yt[4]),e.$set(Gt);const Ut={};!_&&Nt&2&&(_=!0,Ut.testCase=yt[1],Js(()=>_=!1)),h.$set(Ut),lt===(lt=K(yt))&&dt?dt.p(yt,Nt):(dt&&dt.d(1),dt=lt&&lt(yt),dt&&(dt.c(),dt.m(o,null)));const Zt={};!D&&Nt&1&&(D=!0,Zt.settings=yt[0],Js(()=>D=!1)),w.$set(Zt)},i(yt){k||(un(e.$$.fragment,yt),un(h.$$.fragment,yt),un(w.$$.fragment,yt),k=!0)},o(yt){dn(e.$$.fragment,yt),dn(h.$$.fragment,yt),dn(w.$$.fragment,yt),k=!1},d(yt){yt&&(Ke(n),Ke(o),Ke(I)),t[12](null),Er(e,yt),Er(h),dt&&dt.d(),Er(w,yt)}}}function mI(t,e,n){let o;xs(t,Pp,yt=>n(4,o=yt));let l={kind:"nothing"},h,_,u=new URLSearchParams(window.location.search).get("test")||"none";function I(yt){l.kind=="done"&&yt&&(console.log("Settings changed, re-importing"),w(l.osmXml,l.boundaryGj))}function w(yt,Nt){try{n(2,l={kind:"loading",msg:"Running osm2streets"});let Gt=new ag(yt,JSON.stringify(Nt),h);n(2,l={kind:"done",boundaryGj:Nt,osmXml:yt,network:Gt}),sh.set(l.network),Gm.set(l.boundaryGj)}catch(Gt){n(2,l={kind:"error",msg:Gt.toString()})}}function D(){l.kind==="done"&&hx("osm.xml",l.osmXml)}function k(){l.kind==="done"&&_.importPolygon(l.boundaryGj)}function G(){l.kind==="done"&&o.fitBounds(fx(l.boundaryGj),{animate:!1,padding:10})}function H(yt){w(yt.detail.osmXml,yt.detail.boundaryGj),n(1,u=yt.detail.testCase)}function j(yt){n(2,l={kind:"nothing"}),sh.set(null),Gm.set(null)}function K(yt){n(2,l={kind:"error",msg:yt.detail})}function lt(yt){n(2,l={kind:"loading",msg:yt.detail})}function dt(yt){yo[yt?"unshift":"push"](()=>{_=yt,n(3,_)})}function xt(yt){u=yt,n(1,u)}function gt(yt){h=yt,n(0,h)}return t.$$.update=()=>{if(t.$$.dirty&1&&I(h),t.$$.dirty&2){let yt=new URL(window.location.href);u!="none"?yt.searchParams.set("test",u):yt.searchParams.delete("test"),window.history.pushState({},"",yt)}},[h,u,l,_,o,D,k,G,H,j,K,lt,dt,xt,gt]}class GI extends mi{constructor(e){super(),gi(this,e,mI,gI,si,{})}}function K0(t){let e,n,o,l,h;return{c(){e=Ne("button"),n=Ai("Download"),Xt(e,"type","button"),e.disabled=o=!t[1]},m(_,u){tn(_,e,u),we(e,n),l||(h=lr(e,"click",t[4]),l=!0)},p(_,u){u&2&&o!==(o=!_[1])&&(e.disabled=o)},d(_){_&&Ke(e),l=!1,h()}}}function _I(t){let e,n,o,l,h,_,u,I,w=t[3]&&K0(t);return{c(){e=Ne("div"),n=Ne("label"),o=Ne("input"),l=qn(),h=Ai(t[2]),_=qn(),w&&w.c(),Xt(o,"type","checkbox")},m(D,k){tn(D,e,k),we(e,n),we(n,o),o.checked=t[0],we(n,l),we(n,h),we(e,_),w&&w.m(e,null),u||(I=lr(o,"change",t[5]),u=!0)},p(D,[k]){k&1&&(o.checked=D[0]),k&4&&Eu(h,D[2]),D[3]?w?w.p(D,k):(w=K0(D),w.c(),w.m(e,null)):w&&(w.d(1),w=null)},i:Tn,o:Tn,d(D){D&&Ke(e),w&&w.d(),u=!1,I()}}}function yI(t,e,n){let{gj:o}=e,{name:l}=e,{show:h}=e,{downloadable:_=!0}=e;function u(){hx(`${l}.geojson`,JSON.stringify(o))}function I(){h=this.checked,n(0,h)}return t.$$set=w=>{"gj"in w&&n(1,o=w.gj),"name"in w&&n(2,l=w.name),"show"in w&&n(0,h=w.show),"downloadable"in w&&n(3,_=w.downloadable)},[h,o,l,_,u,I]}class Kf extends mi{constructor(e){super(),gi(this,e,yI,_I,si,{gj:1,name:2,show:0,downloadable:3})}}function vI(t){let e,n,o,l,h;e=new $f({props:{source:"boundary",gj:t[0],layerStyle:t[2],show:t[1]}});function _(I){t[5](I)}let u={gj:t[0],name:"Boundary"};return t[1]!==void 0&&(u.show=t[1]),o=new Kf({props:u}),yo.push(()=>Qs(o,"show",_)),{c(){Lr(e.$$.fragment),n=qn(),Lr(o.$$.fragment)},m(I,w){wr(e,I,w),tn(I,n,w),wr(o,I,w),h=!0},p(I,[w]){const D={};w&1&&(D.gj=I[0]),w&2&&(D.show=I[1]),e.$set(D);const k={};w&1&&(k.gj=I[0]),!l&&w&2&&(l=!0,k.show=I[1],Js(()=>l=!1)),o.$set(k)},i(I){h||(un(e.$$.fragment,I),un(o.$$.fragment,I),h=!0)},o(I){dn(e.$$.fragment,I),dn(o.$$.fragment,I),h=!1},d(I){I&&Ke(n),Er(e,I),Er(o,I)}}}function xI(t,e,n){let o,l;xs(t,Pp,w=>n(3,o=w)),xs(t,Gm,w=>n(4,l=w));let h,_=!0,u={type:"line",paint:{"line-color":"blue","line-width":4}};function I(w){_=w,n(1,_)}return t.$$.update=()=>{t.$$.dirty&25&&(l?(n(0,h=structuredClone(l)),o==null||o.fitBounds(fx(h),{animate:!1,padding:10})):n(0,h=void 0))},[h,_,u,o,l,I]}class bI extends mi{constructor(e){super(),gi(this,e,xI,vI,si,{})}}function wI(t){let e,n,o,l,h;e=new $f({props:{source:"intersection-markings",gj:t[0],layerStyle:t[2],show:t[1]}});function _(I){t[4](I)}let u={gj:t[0],name:"Intersection markings"};return t[1]!==void 0&&(u.show=t[1]),o=new Kf({props:u}),yo.push(()=>Qs(o,"show",_)),{c(){Lr(e.$$.fragment),n=qn(),Lr(o.$$.fragment)},m(I,w){wr(e,I,w),tn(I,n,w),wr(o,I,w),h=!0},p(I,[w]){const D={};w&1&&(D.gj=I[0]),w&2&&(D.show=I[1]),e.$set(D);const k={};w&1&&(k.gj=I[0]),!l&&w&2&&(l=!0,k.show=I[1],Js(()=>l=!1)),o.$set(k)},i(I){h||(un(e.$$.fragment,I),un(o.$$.fragment,I),h=!0)},o(I){dn(e.$$.fragment,I),dn(o.$$.fragment,I),h=!1},d(I){I&&Ke(n),Er(e,I),Er(o,I)}}}function EI(t,e,n){let o;xs(t,sh,I=>n(3,o=I));let l,h=!0,_={type:"fill",paint:{"fill-color":wg("type",{"sidewalk corner":"#CCCCCC"},"red"),"fill-opacity":.9}};function u(I){h=I,n(1,h)}return t.$$.update=()=>{t.$$.dirty&8&&(o?n(0,l=JSON.parse(o.toIntersectionMarkingsGeojson())):n(0,l=void 0))},[l,h,_,o,u]}class II extends mi{constructor(e){super(),gi(this,e,EI,wI,si,{})}}function SI(t){let e,n,o,l,h,_,u,I;function w(K){t[7](K)}function D(K){t[8](K)}function k(K){t[9](K)}let G={source:"intersection-polygons",gj:t[0],layerStyle:t[5],interactive:!0,show:t[1]};t[2]!==void 0&&(G.hoveredFeature=t[2]),t[3]!==void 0&&(G.clickedFeature=t[3]),t[4]!==void 0&&(G.clickedFeaturePosition=t[4]),e=new $f({props:G}),yo.push(()=>Qs(e,"hoveredFeature",w)),yo.push(()=>Qs(e,"clickedFeature",D)),yo.push(()=>Qs(e,"clickedFeaturePosition",k));function H(K){t[10](K)}let j={gj:t[0],name:"Intersection polygons"};return t[1]!==void 0&&(j.show=t[1]),_=new Kf({props:j}),yo.push(()=>Qs(_,"show",H)),{c(){Lr(e.$$.fragment),h=qn(),Lr(_.$$.fragment)},m(K,lt){wr(e,K,lt),tn(K,h,lt),wr(_,K,lt),I=!0},p(K,[lt]){const dt={};lt&1&&(dt.gj=K[0]),lt&2&&(dt.show=K[1]),!n&&lt&4&&(n=!0,dt.hoveredFeature=K[2],Js(()=>n=!1)),!o&&lt&8&&(o=!0,dt.clickedFeature=K[3],Js(()=>o=!1)),!l&&lt&16&&(l=!0,dt.clickedFeaturePosition=K[4],Js(()=>l=!1)),e.$set(dt);const xt={};lt&1&&(xt.gj=K[0]),!u&&lt&2&&(u=!0,xt.show=K[1],Js(()=>u=!1)),_.$set(xt)},i(K){I||(un(e.$$.fragment,K),un(_.$$.fragment,K),I=!0)},o(K){dn(e.$$.fragment,K),dn(_.$$.fragment,K),I=!1},d(K){K&&Ke(h),Er(e,K),Er(_,K)}}}function TI(t,e,n){let o,l,h,_;xs(t,sh,j=>n(6,o=j)),xs(t,qm,j=>n(2,l=j)),xs(t,Xm,j=>n(3,h=j)),xs(t,Wm,j=>n(4,_=j));let u,I=!0,w={type:"fill",filter:["==",["get","type"],"intersection"],paint:{"fill-color":wg("intersection_kind",{Connection:"#666",Intersection:"#966",Terminus:"#999",MapEdge:"#696"},"#666"),"fill-opacity":px("hover",.9,.4)}};function D(j){l=j,qm.set(l)}function k(j){h=j,Xm.set(h)}function G(j){_=j,Wm.set(_)}function H(j){I=j,n(1,I)}return t.$$.update=()=>{t.$$.dirty&64&&(o?n(0,u=JSON.parse(o.toGeojsonPlain())):n(0,u=void 0))},[u,I,l,h,_,w,o,D,k,G,H]}class CI extends mi{constructor(e){super(),gi(this,e,TI,SI,si,{})}}function PI(t){let e,n,o,l,h;e=new $f({props:{source:"lane-markings",gj:t[0],layerStyle:t[2],show:t[1]}});function _(I){t[4](I)}let u={gj:t[0],name:"Lane markings "};return t[1]!==void 0&&(u.show=t[1]),o=new Kf({props:u}),yo.push(()=>Qs(o,"show",_)),{c(){Lr(e.$$.fragment),n=qn(),Lr(o.$$.fragment)},m(I,w){wr(e,I,w),tn(I,n,w),wr(o,I,w),h=!0},p(I,[w]){const D={};w&1&&(D.gj=I[0]),w&2&&(D.show=I[1]),e.$set(D);const k={};w&1&&(k.gj=I[0]),!l&&w&2&&(l=!0,k.show=I[1],Js(()=>l=!1)),o.$set(k)},i(I){h||(un(e.$$.fragment,I),un(o.$$.fragment,I),h=!0)},o(I){dn(e.$$.fragment,I),dn(o.$$.fragment,I),h=!1},d(I){I&&Ke(n),Er(e,I),Er(o,I)}}}function MI(t,e,n){let o;xs(t,sh,I=>n(3,o=I));let l,h=!0,_={type:"fill",paint:{"fill-color":wg("type",{"center line":"yellow","lane separator":"white","lane arrow":"white","buffer edge":"white","buffer stripe":"white","vehicle stop line":"white","bike stop line":"green"},"red"),"fill-opacity":.9}};function u(I){h=I,n(1,h)}return t.$$.update=()=>{t.$$.dirty&8&&(o?n(0,l=JSON.parse(o.toLaneMarkingsGeojson())):n(0,l=void 0))},[l,h,_,o,u]}class AI extends mi{constructor(e){super(),gi(this,e,MI,PI,si,{})}}function LI(t){let e,n,o,l,h,_,u,I;function w(K){t[7](K)}function D(K){t[8](K)}function k(K){t[9](K)}let G={source:"lane-polygons",gj:t[0],layerStyle:t[5],interactive:!0,show:t[1]};t[2]!==void 0&&(G.clickedFeature=t[2]),t[3]!==void 0&&(G.hoveredFeature=t[3]),t[4]!==void 0&&(G.clickedFeaturePosition=t[4]),e=new $f({props:G}),yo.push(()=>Qs(e,"clickedFeature",w)),yo.push(()=>Qs(e,"hoveredFeature",D)),yo.push(()=>Qs(e,"clickedFeaturePosition",k));function H(K){t[10](K)}let j={gj:t[0],name:"Lane polygons"};return t[1]!==void 0&&(j.show=t[1]),_=new Kf({props:j}),yo.push(()=>Qs(_,"show",H)),{c(){Lr(e.$$.fragment),h=qn(),Lr(_.$$.fragment)},m(K,lt){wr(e,K,lt),tn(K,h,lt),wr(_,K,lt),I=!0},p(K,[lt]){const dt={};lt&1&&(dt.gj=K[0]),lt&2&&(dt.show=K[1]),!n&&lt&4&&(n=!0,dt.clickedFeature=K[2],Js(()=>n=!1)),!o&&lt&8&&(o=!0,dt.hoveredFeature=K[3],Js(()=>o=!1)),!l&&lt&16&&(l=!0,dt.clickedFeaturePosition=K[4],Js(()=>l=!1)),e.$set(dt);const xt={};lt&1&&(xt.gj=K[0]),!u&&lt&2&&(u=!0,xt.show=K[1],Js(()=>u=!1)),_.$set(xt)},i(K){I||(un(e.$$.fragment,K),un(_.$$.fragment,K),I=!0)},o(K){dn(e.$$.fragment,K),dn(_.$$.fragment,K),I=!1},d(K){K&&Ke(h),Er(e,K),Er(_,K)}}}function DI(t,e,n){let o,l,h,_;xs(t,sh,j=>n(6,o=j)),xs(t,Zm,j=>n(2,l=j)),xs(t,jm,j=>n(3,h=j)),xs(t,Ym,j=>n(4,_=j));let u,I=!0,w={type:"fill",paint:{"fill-color":wg("type",{Driving:"black",Parking:"#333333",Sidewalk:"#CCCCCC",Shoulder:"#CCCCCC",Biking:"#0F7D4B",Bus:"#BE4A4C",SharedLeftTurn:"black",Construction:"#FF6D00",LightRail:"#844204",Footway:"#DDDDE8",SharedUse:"#E5E1BB","Buffer(Planters)":"#555555"},"red"),"fill-opacity":px("hover",.9,.4)}};function D(j){l=j,Zm.set(l)}function k(j){h=j,jm.set(h)}function G(j){_=j,Ym.set(_)}function H(j){I=j,n(1,I)}return t.$$.update=()=>{t.$$.dirty&64&&(o?n(0,u=JSON.parse(o.toLanePolygonsGeojson())):n(0,u=void 0))},[u,I,l,h,_,w,o,D,k,G,H]}class kI extends mi{constructor(e){super(),gi(this,e,DI,LI,si,{})}}function NI(t){let e,n,o,l,h,_,u,I,w,D;return e=new bI({}),o=new CI({}),h=new II({}),u=new kI({}),w=new AI({}),{c(){Lr(e.$$.fragment),n=qn(),Lr(o.$$.fragment),l=qn(),Lr(h.$$.fragment),_=qn(),Lr(u.$$.fragment),I=qn(),Lr(w.$$.fragment)},m(k,G){wr(e,k,G),tn(k,n,G),wr(o,k,G),tn(k,l,G),wr(h,k,G),tn(k,_,G),wr(u,k,G),tn(k,I,G),wr(w,k,G),D=!0},p:Tn,i(k){D||(un(e.$$.fragment,k),un(o.$$.fragment,k),un(h.$$.fragment,k),un(u.$$.fragment,k),un(w.$$.fragment,k),D=!0)},o(k){dn(e.$$.fragment,k),dn(o.$$.fragment,k),dn(h.$$.fragment,k),dn(u.$$.fragment,k),dn(w.$$.fragment,k),D=!1},d(k){k&&(Ke(n),Ke(l),Ke(_),Ke(I)),Er(e,k),Er(o,k),Er(h,k),Er(u,k),Er(w,k)}}}class jI extends mi{constructor(e){super(),gi(this,e,null,NI,si,{})}}export{zI as $,lr as A,Tn as B,Pp as C,Od as D,qd as E,ib as F,Eu as G,ua as H,og as I,Wm as J,Xm as K,$f as L,Ym as M,Zm as N,UI as O,ig as P,FI as Q,GI as R,mi as S,VI as T,BI as U,jI as V,hx as W,db as X,Km as Y,Iu as Z,Sb as _,Xt as a,nv as a0,Jh as a1,Qh as a2,OI as a3,tn as b,Bd as c,Ud as d,Ne as e,dn as f,Gd as g,Ke as h,gi as i,Kf as j,yo as k,Qs as l,Lr as m,qn as n,wr as o,Js as p,Er as q,xs as r,si as s,un as t,Vd as u,qm as v,sh as w,jm as x,Ai as y,we as z};
