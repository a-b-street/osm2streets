import{S as B,i as F,s as D,p as g,y as N,M as y,H as E,a as w,B as $,D as L,ad as U,E as I,d as k,j as A,R as j,ae as Z,$ as H,af as x,a1 as V,h as ee,z as G,ag as te,K as M,e as X,N as C,g as Q,b,c as Y,t as v,P as O,x as ne,a2 as le,o as ae,T as re,a3 as se,a4 as oe,a5 as ie,a6 as ue,a8 as fe,a9 as ce,aa as de,ab as pe,ac as me,I as $e,a7 as _e,ah as ge,U as ye,V as he,W as we}from"./RenderLanePolygons-ff352a75.js";function ke(u){let e,t=u[0].size+"",n,l,a,r,s,c;return{c(){e=g("div"),n=N(t),l=N(" ways edited"),a=y(),r=g("button"),r.textContent="Download .osc",E(r,"type","button")},m(d,f){w(d,e,f),$(e,n),$(e,l),w(d,a,f),w(d,r,f),s||(c=L(r,"click",u[1]),s=!0)},p(d,[f]){f&1&&t!==(t=d[0].size+"")&&U(n,t)},i:I,o:I,d(d){d&&(k(e),k(a),k(r)),s=!1,c()}}}function be(u,e,t){let n;A(u,j,s=>t(3,n=s));let l=new Set;function a(s){l.add(s.detail),t(0,l)}function r(){let s=`<osmChange version="0.6" generator="osm2streets">
`;s+=`<create/>
`,s+=`<modify>
`;for(let c of l)s+=n.wayToXml(c),s+=`
`;s+=`</modify>
`,s+="</osmChange>",Z("lane_edits.osc",s)}return[l,r,a]}class ve extends B{constructor(e){super(),F(this,e,be,ke,D,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function P(u,e,t){const n=u.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function q(u,e){let t,n,l,a,r,s,c,d,f,p,h,i;function o(){e[5].call(l,e[12],e[13])}function _(){e[6].call(s,e[12],e[13])}function m(){return e[7](e[11])}return{key:u,first:null,c(){t=g("tr"),n=g("td"),l=g("input"),a=y(),r=g("td"),s=g("input"),c=y(),d=g("td"),f=g("button"),f.textContent="Delete",p=y(),E(l,"type","text"),E(s,"type","text"),E(f,"type","button"),this.first=t},m(W,T){w(W,t,T),$(t,n),$(n,l),G(l,e[11].key),$(t,a),$(t,r),$(r,s),G(s,e[11].value),$(t,c),$(t,d),$(d,f),$(t,p),h||(i=[L(l,"input",o),L(s,"input",_),L(f,"click",m)],h=!0)},p(W,T){e=W,T&1&&l.value!==e[11].key&&G(l,e[11].key),T&1&&s.value!==e[11].value&&G(s,e[11].value)},d(W){W&&k(t),h=!1,V(i)}}}function We(u){let e,t,n=[],l=new Map,a,r,s,c,d,f,p=H(u[0]);const h=i=>i[11].id;for(let i=0;i<p.length;i+=1){let o=P(u,p,i),_=h(o);l.set(_,n[i]=q(_,o))}return{c(){e=g("table"),t=g("tbody");for(let i=0;i<n.length;i+=1)n[i].c();a=y(),r=g("button"),r.textContent="Add new tag",s=y(),c=g("button"),c.textContent="Recalculate",E(r,"type","button"),E(c,"type","button")},m(i,o){w(i,e,o),$(e,t);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(t,null);w(i,a,o),w(i,r,o),w(i,s,o),w(i,c,o),d||(f=[L(r,"click",u[2]),L(c,"click",u[3])],d=!0)},p(i,[o]){o&3&&(p=H(i[0]),n=x(n,o,h,1,i,p,l,t,te,q,null,P))},i:I,o:I,d(i){i&&(k(e),k(a),k(r),k(s),k(c));for(let o=0;o<n.length;o+=1)n[o].d();d=!1,V(f)}}}function Me(u,e,t){let n;A(u,j,o=>t(9,n=o));const l=ee();let{way:a}=e,r=[],s=0;for(let[o,_]of Object.entries(JSON.parse(n.getOsmTagsForWay(a))))r.push({id:s++,key:o,value:_});function c(o){t(0,r=r.filter(_=>_.id!=o))}function d(){r.push({id:s++,key:"",value:""}),t(0,r)}function f(){let o={};for(let _ of r)_.key&&_.value&&(o[_.key]=_.value);n.overwriteOsmTagsForWay(a,JSON.stringify(o)),j.set(n),l("editedWay",a)}function p(o,_){o[_].key=this.value,t(0,r)}function h(o,_){o[_].value=this.value,t(0,r)}const i=o=>c(o.id);return u.$$set=o=>{"way"in o&&t(4,a=o.way)},[r,c,d,f,a,p,h,i]}class Ce extends B{constructor(e){super(),F(this,e,Me,We,D,{way:4})}}function Oe(u){let e;return{c(){e=N("Click a road to edit")},m(t,n){w(t,e,n)},p:I,i:I,o:I,d(t){t&&k(e)}}}function Se(u){let e,t,n,l,a,r=u[0],s,c,d=K(u);return{c(){e=g("a"),t=N("Way "),n=N(u[0]),a=y(),d.c(),s=X(),E(e,"href",l="http://openstreetmap.org/way/"+u[0]),E(e,"target","_blank")},m(f,p){w(f,e,p),$(e,t),$(e,n),w(f,a,p),d.m(f,p),w(f,s,p),c=!0},p(f,p){(!c||p&1)&&U(n,f[0]),(!c||p&1&&l!==(l="http://openstreetmap.org/way/"+f[0]))&&E(e,"href",l),p&1&&D(r,r=f[0])?(Q(),b(d,1,1,I),Y(),d=K(f),d.c(),v(d,1),d.m(s.parentNode,s)):d.p(f,p)},i(f){c||(v(d),c=!0)},o(f){b(d),c=!1},d(f){f&&(k(e),k(a),k(s)),d.d(f)}}}function K(u){let e,t;return e=new Ce({props:{way:u[0]}}),e.$on("editedWay",u[3]),{c(){M(e.$$.fragment)},m(n,l){C(e,n,l),t=!0},p(n,l){const a={};l&1&&(a.way=n[0]),e.$set(a)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function Te(u){let e,t,n,l,a,r,s,c,d={};e=new ve({props:d}),u[2](e);const f=[Se,Oe],p=[];function h(i,o){return i[0]?0:1}return a=h(u),r=p[a]=f[a](u),{c(){M(e.$$.fragment),t=y(),n=g("hr"),l=y(),r.c(),s=X()},m(i,o){C(e,i,o),w(i,t,o),w(i,n,o),w(i,l,o),p[a].m(i,o),w(i,s,o),c=!0},p(i,[o]){const _={};e.$set(_);let m=a;a=h(i),a===m?p[a].p(i,o):(Q(),b(p[m],1,1,()=>{p[m]=null}),Y(),r=p[a],r?r.p(i,o):(r=p[a]=f[a](i),r.c()),v(r,1),r.m(s.parentNode,s))},i(i){c||(v(e.$$.fragment,i),v(r),c=!0)},o(i){b(e.$$.fragment,i),b(r),c=!1},d(i){i&&(k(t),k(n),k(l),k(s)),u[2](null),O(e,i),p[a].d(i)}}}function Ee(u,e,t){let{way:n}=e,l;function a(s){ne[s?"unshift":"push"](()=>{l=s,t(1,l)})}const r=s=>l.handleEditedWay(s);return u.$$set=s=>{"way"in s&&t(0,n=s.way)},[n,l,a,r]}class Ie extends B{constructor(e){super(),F(this,e,Ee,Te,D,{way:0})}}function Le(u){let e,t,n,l,a,r,s,c,d,f,p,h,i,o,_,m,W,T,R;return l=new se({}),f=new oe({}),o=new Ie({props:{way:u[0]}}),{c(){e=g("div"),t=g("h1"),t.textContent="osm2streets lane editor",n=y(),M(l.$$.fragment),a=y(),r=g("p"),r.innerHTML=`Improve OSM lane tagging with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>
      and <a href="https://gitlab.com/LeLuxNet/Muv" target="_blank">Muv</a>.`,s=y(),c=g("hr"),d=y(),M(f.$$.fragment),p=y(),h=g("hr"),i=y(),M(o.$$.fragment),_=y(),m=g("hr"),W=y(),T=g("div"),T.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",E(e,"slot","left")},m(S,J){w(S,e,J),$(e,t),$(e,n),C(l,e,null),$(e,a),$(e,r),$(e,s),$(e,c),$(e,d),C(f,e,null),$(e,p),$(e,h),$(e,i),C(o,e,null),$(e,_),$(e,m),$(e,W),$(e,T),R=!0},p(S,J){const z={};J&1&&(z.way=S[0]),o.$set(z)},i(S){R||(v(l.$$.fragment,S),v(f.$$.fragment,S),v(o.$$.fragment,S),R=!0)},o(S){b(l.$$.fragment,S),b(f.$$.fragment,S),b(o.$$.fragment,S),R=!1},d(S){S&&k(e),O(l),O(f),O(o)}}}function Ne(u){let e,t;const n=[ye("current-way"),{paint:{"fill-color":"red","fill-opacity":.3}}];let l={};for(let a=0;a<n.length;a+=1)l=he(l,n[a]);return e=new we({props:l}),{c(){M(e.$$.fragment)},m(a,r){C(e,a,r),t=!0},p(a,r){const s={};e.$set(s)},i(a){t||(v(e.$$.fragment,a),t=!0)},o(a){b(e.$$.fragment,a),t=!1},d(a){O(e,a)}}}function je(u){let e,t,n,l,a,r,s,c,d,f,p,h,i,o,_;return t=new fe({}),l=new ce({}),r=new de({}),c=new pe({}),c.$on("click",u[2]),f=new me({}),h=new $e({props:{data:u[1],$$slots:{default:[Ne]},$$scope:{ctx:u}}}),o=new _e({}),{c(){e=g("div"),M(t.$$.fragment),n=y(),M(l.$$.fragment),a=y(),M(r.$$.fragment),s=y(),M(c.$$.fragment),d=y(),M(f.$$.fragment),p=y(),M(h.$$.fragment),i=y(),M(o.$$.fragment),ge(e,"display","none")},m(m,W){w(m,e,W),C(t,e,null),$(e,n),C(l,e,null),$(e,a),C(r,e,null),$(e,s),C(c,e,null),$(e,d),C(f,e,null),$(e,p),C(h,e,null),w(m,i,W),C(o,m,W),_=!0},p(m,W){const T={};W&2&&(T.data=m[1]),W&16&&(T.$$scope={dirty:W,ctx:m}),h.$set(T)},i(m){_||(v(t.$$.fragment,m),v(l.$$.fragment,m),v(r.$$.fragment,m),v(c.$$.fragment,m),v(f.$$.fragment,m),v(h.$$.fragment,m),v(o.$$.fragment,m),_=!0)},o(m){b(t.$$.fragment,m),b(l.$$.fragment,m),b(r.$$.fragment,m),b(c.$$.fragment,m),b(f.$$.fragment,m),b(h.$$.fragment,m),b(o.$$.fragment,m),_=!1},d(m){m&&(k(e),k(i)),O(t),O(l),O(r),O(c),O(f),O(h),O(o,m)}}}function De(u){let e,t,n;return t=new ie({props:{$$slots:{default:[je]},$$scope:{ctx:u}}}),{c(){e=g("div"),M(t.$$.fragment),E(e,"slot","main")},m(l,a){w(l,e,a),C(t,e,null),n=!0},p(l,a){const r={};a&18&&(r.$$scope={dirty:a,ctx:l}),t.$set(r)},i(l){n||(v(t.$$.fragment,l),n=!0)},o(l){b(t.$$.fragment,l),n=!1},d(l){l&&k(e),O(t)}}}function Re(u){let e,t;return e=new le({props:{$$slots:{main:[De],left:[Le]},$$scope:{ctx:u}}}),{c(){M(e.$$.fragment)},m(n,l){C(e,n,l),t=!0},p(n,[l]){const a={};l&19&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function Ge(u,e,t){let n,l;A(u,j,s=>t(3,l=s)),ae(async()=>{await ue()});let a=null;j.subscribe(s=>{t(0,a=null)});function r(s){let c=JSON.parse(s.detail.features[0].properties.osm_way_ids);c.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):t(0,a=BigInt(c[0]))}return u.$$.update=()=>{u.$$.dirty&9&&t(1,n=a?JSON.parse(l.getGeometryForWay(a)):re())},[a,n,r,l]}class Be extends B{constructor(e){super(),F(this,e,Ge,Re,D,{})}}new Be({target:document.getElementById("app")});
