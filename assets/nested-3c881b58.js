import{S as P,i as H,s as J,p as y,J as j,I as h,K as E,a as k,N as m,T as R,O as x,G as L,d as b,j as F,X as G,an as ne,ao as le,F as K,ap as re,$ as ee,h as ae,P as A,aq as se,z as S,e as te,A as W,g as B,b as w,c as q,t as $,C as M,x as oe,ac as ie,o as ue,Y as fe,ad as ce,ae as de,af as pe,ag as me,am as _e,ah as ge,ai as $e,aj as ye,ak as he,al as we,_ as ke,M as be,aa as ve,a0 as Ce,a3 as Se,a4 as We}from"./RenderLanePolygons-4ed0a619.js";function Me(i){let e,t=i[0].size+"",n,l,r,s,f,u,p,c;return{c(){e=y("div"),n=j(t),l=j(" ways edited"),r=h(),s=y("button"),f=j("Download .osc"),E(s,"type","button"),s.disabled=u=i[0].size==0},m(d,g){k(d,e,g),m(e,n),m(e,l),k(d,r,g),k(d,s,g),m(s,f),p||(c=R(s,"click",i[1]),p=!0)},p(d,[g]){g&1&&t!==(t=d[0].size+"")&&x(n,t),g&1&&u!==(u=d[0].size==0)&&(s.disabled=u)},i:L,o:L,d(d){d&&(b(e),b(r),b(s)),p=!1,c()}}}function Oe(i,e,t){let n,l;F(i,G,u=>t(4,n=u)),F(i,ne,u=>t(3,l=u));let r=new Set;function s(u){r.add(u.detail),t(0,r),t(3,l)}function f(){let u=`<osmChange version="0.6" generator="osm2streets">
`;u+=`<create/>
`,u+=`<modify>
`;for(let p of r)u+=n.wayToXml(p),u+=`
`;u+=`</modify>
`,u+="</osmChange>",le("lane_edits.osc",u)}return i.$$.update=()=>{i.$$.dirty&8&&l>0&&t(0,r=new Set)},[r,f,s,l]}class Te extends P{constructor(e){super(),H(this,e,Oe,Me,J,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function V(i,e,t){const n=i.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function Y(i,e){let t,n,l,r,s,f,u,p,c,d,g,o;function a(){e[5].call(l,e[12],e[13])}function _(){e[6].call(f,e[12],e[13])}function T(){return e[7](e[11])}return{key:i,first:null,c(){t=y("tr"),n=y("td"),l=y("input"),r=h(),s=y("td"),f=y("input"),u=h(),p=y("td"),c=y("button"),c.textContent="Delete",d=h(),E(l,"type","text"),E(f,"type","text"),E(c,"type","button"),this.first=t},m(I,N){k(I,t,N),m(t,n),m(n,l),A(l,e[11].key),m(t,r),m(t,s),m(s,f),A(f,e[11].value),m(t,u),m(t,p),m(p,c),m(t,d),g||(o=[R(l,"input",a),R(f,"input",_),R(c,"click",T)],g=!0)},p(I,N){e=I,N&1&&l.value!==e[11].key&&A(l,e[11].key),N&1&&f.value!==e[11].value&&A(f,e[11].value)},d(I){I&&b(t),g=!1,ee(o)}}}function Ee(i){let e,t,n=[],l=new Map,r,s,f,u,p,c,d=K(i[0]);const g=o=>o[11].id;for(let o=0;o<d.length;o+=1){let a=V(i,d,o),_=g(a);l.set(_,n[o]=Y(_,a))}return{c(){e=y("table"),t=y("tbody");for(let o=0;o<n.length;o+=1)n[o].c();r=h(),s=y("button"),s.textContent="Add new tag",f=h(),u=y("button"),u.textContent="Recalculate",E(s,"type","button"),E(u,"type","button")},m(o,a){k(o,e,a),m(e,t);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(t,null);k(o,r,a),k(o,s,a),k(o,f,a),k(o,u,a),p||(c=[R(s,"click",i[2]),R(u,"click",i[3])],p=!0)},p(o,[a]){a&3&&(d=K(o[0]),n=re(n,a,g,1,o,d,l,t,se,Y,null,V))},i:L,o:L,d(o){o&&(b(e),b(r),b(s),b(f),b(u));for(let a=0;a<n.length;a+=1)n[a].d();p=!1,ee(c)}}}function Ie(i,e,t){let n;F(i,G,a=>t(9,n=a));const l=ae();let{way:r}=e,s=[],f=0;for(let[a,_]of Object.entries(JSON.parse(n.getOsmTagsForWay(r))))s.push({id:f++,key:a,value:_});function u(a){t(0,s=s.filter(_=>_.id!=a))}function p(){s.push({id:f++,key:"",value:""}),t(0,s)}function c(){let a={};for(let _ of s)_.key&&_.value&&(a[_.key]=_.value);n.overwriteOsmTagsForWay(r,JSON.stringify(a)),G.set(n),l("editedWay",r)}function d(a,_){a[_].key=this.value,t(0,s)}function g(a,_){a[_].value=this.value,t(0,s)}const o=a=>u(a.id);return i.$$set=a=>{"way"in a&&t(4,r=a.way)},[s,u,p,c,r,d,g,o]}class Le extends P{constructor(e){super(),H(this,e,Ie,Ee,J,{way:4})}}function Ne(i){let e;return{c(){e=j("Click a road to edit")},m(t,n){k(t,e,n)},p:L,i:L,o:L,d(t){t&&b(e)}}}function je(i){let e,t,n,l,r,s=i[0],f,u,p=Q(i);return{c(){e=y("a"),t=j("Way "),n=j(i[0]),r=h(),p.c(),f=te(),E(e,"href",l="http://openstreetmap.org/way/"+i[0]),E(e,"target","_blank")},m(c,d){k(c,e,d),m(e,t),m(e,n),k(c,r,d),p.m(c,d),k(c,f,d),u=!0},p(c,d){(!u||d&1)&&x(n,c[0]),(!u||d&1&&l!==(l="http://openstreetmap.org/way/"+c[0]))&&E(e,"href",l),d&1&&J(s,s=c[0])?(B(),w(p,1,1,L),q(),p=Q(c),p.c(),$(p,1),p.m(f.parentNode,f)):p.p(c,d)},i(c){u||($(p),u=!0)},o(c){w(p),u=!1},d(c){c&&(b(e),b(r),b(f)),p.d(c)}}}function Q(i){let e,t;return e=new Le({props:{way:i[0]}}),e.$on("editedWay",i[3]),{c(){S(e.$$.fragment)},m(n,l){W(e,n,l),t=!0},p(n,l){const r={};l&1&&(r.way=n[0]),e.$set(r)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){M(e,n)}}}function Re(i){let e,t,n,l,r,s,f,u,p={};e=new Te({props:p}),i[2](e);const c=[je,Ne],d=[];function g(o,a){return o[0]?0:1}return r=g(i),s=d[r]=c[r](i),{c(){S(e.$$.fragment),t=h(),n=y("hr"),l=h(),s.c(),f=te()},m(o,a){W(e,o,a),k(o,t,a),k(o,n,a),k(o,l,a),d[r].m(o,a),k(o,f,a),u=!0},p(o,[a]){const _={};e.$set(_);let T=r;r=g(o),r===T?d[r].p(o,a):(B(),w(d[T],1,1,()=>{d[T]=null}),q(),s=d[r],s?s.p(o,a):(s=d[r]=c[r](o),s.c()),$(s,1),s.m(f.parentNode,f))},i(o){u||($(e.$$.fragment,o),$(s),u=!0)},o(o){w(e.$$.fragment,o),w(s),u=!1},d(o){o&&(b(t),b(n),b(l),b(f)),i[2](null),M(e,o),d[r].d(o)}}}function De(i,e,t){let{way:n}=e,l;function r(f){oe[f?"unshift":"push"](()=>{l=f,t(1,l)})}const s=f=>l.handleEditedWay(f);return i.$$set=f=>{"way"in f&&t(0,n=f.way)},[n,l,r,s]}class Fe extends P{constructor(e){super(),H(this,e,De,Re,J,{way:0})}}function U(i){let e,t;return e=new me({}),{c(){S(e.$$.fragment)},m(n,l){W(e,n,l),t=!0},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){M(e,n)}}}function Z(i){let e,t;return e=new _e({}),{c(){S(e.$$.fragment)},m(n,l){W(e,n,l),t=!0},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){M(e,n)}}}function Ge(i){let e,t,n,l,r,s,f,u,p,c,d,g,o,a,_,T,I,N,z;l=new ce({});let v=i[1]&&U();o=new Fe({props:{way:i[0]}});let C=i[3]&&Z();return{c(){e=y("div"),t=y("h1"),t.textContent="osm2streets lane editor",n=h(),S(l.$$.fragment),r=h(),s=y("p"),s.innerHTML=`Improve OSM lane tagging with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>
      and <a href="https://gitlab.com/LeLuxNet/Muv" target="_blank">Muv</a>.`,f=h(),u=y("hr"),p=h(),v&&v.c(),c=h(),d=y("hr"),g=h(),S(o.$$.fragment),a=h(),_=y("hr"),T=h(),I=y("div"),I.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",N=h(),C&&C.c(),E(e,"slot","left")},m(O,D){k(O,e,D),m(e,t),m(e,n),W(l,e,null),m(e,r),m(e,s),m(e,f),m(e,u),m(e,p),v&&v.m(e,null),m(e,c),m(e,d),m(e,g),W(o,e,null),m(e,a),m(e,_),m(e,T),m(e,I),m(e,N),C&&C.m(e,null),z=!0},p(O,D){O[1]?v?D&2&&$(v,1):(v=U(),v.c(),$(v,1),v.m(e,c)):v&&(B(),w(v,1,1,()=>{v=null}),q());const X={};D&1&&(X.way=O[0]),o.$set(X),O[3]?C?D&8&&$(C,1):(C=Z(),C.c(),$(C,1),C.m(e,null)):C&&(B(),w(C,1,1,()=>{C=null}),q())},i(O){z||($(l.$$.fragment,O),$(v),$(o.$$.fragment,O),$(C),z=!0)},o(O){w(l.$$.fragment,O),w(v),w(o.$$.fragment,O),w(C),z=!1},d(O){O&&b(e),M(l),v&&v.d(),M(o),C&&C.d()}}}function Je(i){let e,t;const n=[Ce("current-way"),{paint:{"fill-color":"red","fill-opacity":.3}}];let l={};for(let r=0;r<n.length;r+=1)l=Se(l,n[r]);return e=new We({props:l}),{c(){S(e.$$.fragment)},m(r,s){W(e,r,s),t=!0},p(r,s){const f={};e.$set(f)},i(r){t||($(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){M(e,r)}}}function ze(i){let e,t,n,l,r,s,f,u,p,c,d,g,o;return t=new ge({}),l=new $e({}),s=new ye({}),u=new he({props:{hoverCursor:"pointer"}}),u.$on("click",i[4]),c=new we({}),g=new ke({props:{data:i[2],$$slots:{default:[Je]},$$scope:{ctx:i}}}),{c(){e=y("div"),S(t.$$.fragment),n=h(),S(l.$$.fragment),r=h(),S(s.$$.fragment),f=h(),S(u.$$.fragment),p=h(),S(c.$$.fragment),d=h(),S(g.$$.fragment),be(e,"display","none")},m(a,_){k(a,e,_),W(t,e,null),m(e,n),W(l,e,null),m(e,r),W(s,e,null),m(e,f),W(u,e,null),m(e,p),W(c,e,null),m(e,d),W(g,e,null),o=!0},p(a,_){const T={};_&4&&(T.data=a[2]),_&64&&(T.$$scope={dirty:_,ctx:a}),g.$set(T)},i(a){o||($(t.$$.fragment,a),$(l.$$.fragment,a),$(s.$$.fragment,a),$(u.$$.fragment,a),$(c.$$.fragment,a),$(g.$$.fragment,a),o=!0)},o(a){w(t.$$.fragment,a),w(l.$$.fragment,a),w(s.$$.fragment,a),w(u.$$.fragment,a),w(c.$$.fragment,a),w(g.$$.fragment,a),o=!1},d(a){a&&b(e),M(t),M(l),M(s),M(u),M(c),M(g)}}}function Ae(i){let e,t,n;return t=new de({props:{$$slots:{default:[ze]},$$scope:{ctx:i}}}),{c(){e=y("div"),S(t.$$.fragment),E(e,"slot","main")},m(l,r){k(l,e,r),W(t,e,null),n=!0},p(l,r){const s={};r&68&&(s.$$scope={dirty:r,ctx:l}),t.$set(s)},i(l){n||($(t.$$.fragment,l),n=!0)},o(l){w(t.$$.fragment,l),n=!1},d(l){l&&b(e),M(t)}}}function Be(i){let e,t;return e=new ie({props:{$$slots:{main:[Ae],left:[Ge]},$$scope:{ctx:i}}}),{c(){S(e.$$.fragment)},m(n,l){W(e,n,l),t=!0},p(n,[l]){const r={};l&79&&(r.$$scope={dirty:l,ctx:n}),e.$set(r)},i(n){t||($(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){M(e,n)}}}function qe(i,e,t){let n,l,r;F(i,G,p=>t(5,l=p)),F(i,ve,p=>t(3,r=p));let s=!1;ue(async()=>{await pe(),t(1,s=!0)});let f=null;G.subscribe(p=>{t(0,f=null)});function u(p){let c=JSON.parse(p.detail.features[0].properties.osm_way_ids);c.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):t(0,f=BigInt(c[0]))}return i.$$.update=()=>{i.$$.dirty&33&&t(2,n=f?JSON.parse(l.getGeometryForWay(f)):fe())},[f,s,n,r,u,l]}class Pe extends P{constructor(e){super(),H(this,e,qe,Be,J,{})}}new Pe({target:document.getElementById("app")});
