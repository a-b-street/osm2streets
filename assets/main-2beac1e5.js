import{S as J,i as D,s as B,c as re,e as g,a as N,b as m,u as oe,g as le,d as ie,t as k,f as v,h as d,L as Q,j as Z,k as X,l as Y,m as C,n as h,o as L,p as x,q as S,r as j,v as ee,w as E,x as ae,y as F,z as w,A as R,B as T,C as te,D as ne,E as A,F as se,G as z,H as ue,I as fe,J as pe,K as ce,M as me,N as de,O as $e,P as _e,Q as ge,R as we,T as he,_ as ye,U as be,V as ke}from"./MainLayers-04588212.js";function ve(l){let e,r;const t=l[1].default,s=re(t,l,l[0],null);return{c(){e=g("div"),s&&s.c(),N(e,"class","svelte-eycl9h")},m(o,u){m(o,e,u),s&&s.m(e,null),r=!0},p(o,[u]){s&&s.p&&(!r||u&1)&&oe(s,t,o,o[0],r?ie(t,o[0],u,null):le(o[0]),null)},i(o){r||(k(s,o),r=!0)},o(o){v(s,o),r=!1},d(o){o&&d(e),s&&s.d(o)}}}function Ce(l,e,r){let{$$slots:t={},$$scope:s}=e;return l.$$set=o=>{"$$scope"in o&&r(0,s=o.$$scope)},[s,t]}class Le extends J{constructor(e){super(),D(this,e,Ce,ve,B,{})}}function Se(l){let e,r,t,s,o;e=new Q({props:{source:"connected-roads",gj:l[0],layerStyle:l[2],show:l[1]}});function u(i){l[5](i)}let n={gj:l[0],name:"Roads connected to intersection",downloadable:!1};return l[1]!==void 0&&(n.show=l[1]),t=new Z({props:n}),X.push(()=>Y(t,"show",u)),{c(){C(e.$$.fragment),r=h(),C(t.$$.fragment)},m(i,a){L(e,i,a),m(i,r,a),L(t,i,a),o=!0},p(i,[a]){const c={};a&1&&(c.gj=i[0]),a&2&&(c.show=i[1]),e.$set(c);const f={};a&1&&(f.gj=i[0]),!s&&a&2&&(s=!0,f.show=i[1],x(()=>s=!1)),t.$set(f)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){v(e.$$.fragment,i),v(t.$$.fragment,i),o=!1},d(i){i&&d(r),S(e,i),S(t,i)}}}function Oe(l,e,r){let t,s;j(l,ee,a=>r(3,t=a)),j(l,E,a=>r(4,s=a));let o,u=!0,n={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}};function i(a){u=a,r(1,u)}return l.$$.update=()=>{l.$$.dirty&24&&(s&&t?r(0,o=JSON.parse(s.debugRoadsConnectedToIntersectionGeojson(t.properties.id))):r(0,o=void 0))},[o,u,n,t,s,i]}class Me extends J{constructor(e){super(),D(this,e,Oe,Se,B,{})}}function Ie(l){let e,r,t,s,o;e=new Q({props:{source:"movements",gj:l[0],layerStyle:l[2],show:l[1]}});function u(i){l[5](i)}let n={gj:l[0],name:"Movement arrows",downloadable:!1};return l[1]!==void 0&&(n.show=l[1]),t=new Z({props:n}),X.push(()=>Y(t,"show",u)),{c(){C(e.$$.fragment),r=h(),C(t.$$.fragment)},m(i,a){L(e,i,a),m(i,r,a),L(t,i,a),o=!0},p(i,[a]){const c={};a&1&&(c.gj=i[0]),a&2&&(c.show=i[1]),e.$set(c);const f={};a&1&&(f.gj=i[0]),!s&&a&2&&(s=!0,f.show=i[1],x(()=>s=!1)),t.$set(f)},i(i){o||(k(e.$$.fragment,i),k(t.$$.fragment,i),o=!0)},o(i){v(e.$$.fragment,i),v(t.$$.fragment,i),o=!1},d(i){i&&d(r),S(e,i),S(t,i)}}}function je(l,e,r){let t,s;j(l,E,a=>r(3,t=a)),j(l,ae,a=>r(4,s=a));let o,u=!0,n={type:"fill",paint:{"fill-color":"blue","fill-opacity":.5}};function i(a){u=a,r(1,u)}return l.$$.update=()=>{if(l.$$.dirty&24)if(t&&s){let a=s.properties;r(0,o=JSON.parse(t.debugMovementsFromLaneGeojson(a.road,a.index)))}else r(0,o=void 0)},[o,u,n,t,s,i]}class Ne extends J{constructor(e){super(),D(this,e,je,Ie,B,{})}}function Pe(l){let e,r,t,s,o,u;return{c(){e=g("div"),r=g("label"),t=g("input"),s=F(`
    Clockwise ordering of roads`),N(t,"type","checkbox")},m(n,i){m(n,e,i),w(e,r),w(r,t),t.checked=l[0],w(r,s),o||(u=R(t,"change",l[5]),o=!0)},p(n,[i]){i&1&&(t.checked=n[0])},i:T,o:T,d(n){n&&d(e),o=!1,u()}}}function Te(l,e,r){let t,s,o;j(l,te,a=>r(2,t=a)),j(l,ee,a=>r(3,s=a)),j(l,E,a=>r(4,o=a));let u=[],n=!1;function i(){n=this.checked,r(0,n)}return l.$$.update=()=>{if(l.$$.dirty&31){for(let a of u)a.remove();if(r(1,u=[]),n&&s){let a=JSON.parse(o.debugClockwiseOrderingForIntersectionGeojson(s.properties.id));for(let c of a.features)u.push(new ne.Popup({closeButton:!1,closeOnClick:!1,focusAfterOpen:!1}).setLngLat(c.geometry.coordinates).setHTML(c.properties.label).addTo(t))}}},[n,u,t,s,o,i]}class Je extends J{constructor(e){super(),D(this,e,Te,Pe,B,{})}}function De(l){let e,r,t,s,o,u;return e=new Ne({}),t=new Je({}),o=new Me({}),{c(){C(e.$$.fragment),r=h(),C(t.$$.fragment),s=h(),C(o.$$.fragment)},m(n,i){L(e,n,i),m(n,r,i),L(t,n,i),m(n,s,i),L(o,n,i),u=!0},p:T,i(n){u||(k(e.$$.fragment,n),k(t.$$.fragment,n),k(o.$$.fragment,n),u=!0)},o(n){v(e.$$.fragment,n),v(t.$$.fragment,n),v(o.$$.fragment,n),u=!1},d(n){n&&(d(r),d(s)),S(e,n),S(t,n),S(o,n)}}}class Be extends J{constructor(e){super(),D(this,e,null,De,B,{})}}function W(l,e,r){const t=l.slice();return t[4]=e[r],t}function q(l){let e,r=l[4]+"",t,s,o;return{c(){e=g("a"),t=F(r),o=F(","),N(e,"href",s="https://www.openstreetmap.org/node/"+l[4]),N(e,"target","_blank")},m(u,n){m(u,e,n),w(e,t),m(u,o,n)},p(u,n){n&1&&r!==(r=u[4]+"")&&z(t,r),n&1&&s!==(s="https://www.openstreetmap.org/node/"+u[4])&&N(e,"href",s)},d(u){u&&(d(e),d(o))}}}function Ee(l){let e,r,t,s,o,u,n,i,a,c=A(l[0].properties.osm_node_ids),f=[];for(let p=0;p<c.length;p+=1)f[p]=q(W(l,c,p));return{c(){e=g("pre"),e.textContent=`${JSON.stringify(l[1],null,"  ")}`,r=h(),t=g("div"),s=F(`OSM nodes:
  `);for(let p=0;p<f.length;p+=1)f[p].c();o=h(),u=g("div"),n=g("button"),n.textContent="Collapse intersection",N(n,"type","button")},m(p,y){m(p,e,y),m(p,r,y),m(p,t,y),w(t,s);for(let $=0;$<f.length;$+=1)f[$]&&f[$].m(t,null);m(p,o,y),m(p,u,y),w(u,n),i||(a=R(n,"click",l[2]),i=!0)},p(p,[y]){if(y&1){c=A(p[0].properties.osm_node_ids);let $;for($=0;$<c.length;$+=1){const P=W(p,c,$);f[$]?f[$].p(P,y):(f[$]=q(P),f[$].c(),f[$].m(t,null))}for(;$<f.length;$+=1)f[$].d(1);f.length=c.length}},i:T,o:T,d(p){p&&(d(e),d(r),d(t),d(o),d(u)),se(f,p),i=!1,a()}}}function Fe(l,e,r){let t;j(l,E,n=>r(3,t=n));let{intersection:s}=e,o=structuredClone(s.properties);delete o.osm_node_ids;function u(){t.collapseIntersection(s.properties.id),E.set(t)}return l.$$set=n=>{"intersection"in n&&r(0,s=n.intersection)},[s,o,u]}class Ge extends J{constructor(e){super(),D(this,e,Fe,Ee,B,{intersection:0})}}function U(l,e,r){const t=l.slice();return t[6]=e[r],t}function V(l){let e,r,t,s,o=JSON.stringify(l[0].properties.muv,null,"  ")+"",u;return{c(){e=g("details"),r=g("summary"),r.textContent="Full Muv JSON",t=h(),s=g("pre"),u=F(o)},m(n,i){m(n,e,i),w(e,r),w(e,t),w(e,s),w(s,u)},p(n,i){i&1&&o!==(o=JSON.stringify(n[0].properties.muv,null,"  ")+"")&&z(u,o)},d(n){n&&d(e)}}}function K(l){let e,r,t=l[6]+"",s,o,u,n,i,a,c,f=l[4].getOsmTagsForWay(BigInt(l[6]))+"",p,y;return{c(){e=g("li"),r=g("a"),s=F(t),u=h(),n=g("details"),i=g("summary"),i.textContent="See OSM tags",a=h(),c=g("pre"),p=F(f),y=h(),N(r,"href",o="https://www.openstreetmap.org/way/"+l[6]),N(r,"target","_blank")},m($,P){m($,e,P),w(e,r),w(r,s),w(e,u),w(e,n),w(n,i),w(n,a),w(n,c),w(c,p),w(e,y)},p($,P){P&1&&t!==(t=$[6]+"")&&z(s,t),P&1&&o!==(o="https://www.openstreetmap.org/way/"+$[6])&&N(r,"href",o),P&1&&f!==(f=$[4].getOsmTagsForWay(BigInt($[6]))+"")&&z(p,f)},d($){$&&d(e)}}}function Re(l){let e,r,t,s,o,u,n,i,a,c,f,p,y,$,P,I=l[0].properties.muv&&V(l),G=A(l[0].properties.osm_way_ids),O=[];for(let _=0;_<G.length;_+=1)O[_]=K(U(l,G,_));return{c(){e=g("pre"),e.textContent=`${JSON.stringify(l[1],null,"  ")}`,r=h(),I&&I.c(),t=h(),s=g("hr"),o=h(),u=g("u"),u.textContent="OSM ways:",n=h(),i=g("ul");for(let _=0;_<O.length;_+=1)O[_].c();a=h(),c=g("div"),f=g("button"),f.textContent="Collapse short road",p=h(),y=g("button"),y.textContent="Zip side-path",N(f,"type","button"),N(y,"type","button")},m(_,M){m(_,e,M),m(_,r,M),I&&I.m(_,M),m(_,t,M),m(_,s,M),m(_,o,M),m(_,u,M),m(_,n,M),m(_,i,M);for(let b=0;b<O.length;b+=1)O[b]&&O[b].m(i,null);m(_,a,M),m(_,c,M),w(c,f),w(c,p),w(c,y),$||(P=[R(f,"click",l[2]),R(y,"click",l[3])],$=!0)},p(_,[M]){if(_[0].properties.muv?I?I.p(_,M):(I=V(_),I.c(),I.m(t.parentNode,t)):I&&(I.d(1),I=null),M&17){G=A(_[0].properties.osm_way_ids);let b;for(b=0;b<G.length;b+=1){const H=U(_,G,b);O[b]?O[b].p(H,M):(O[b]=K(H),O[b].c(),O[b].m(i,null))}for(;b<O.length;b+=1)O[b].d(1);O.length=G.length}},i:T,o:T,d(_){_&&(d(e),d(r),d(t),d(s),d(o),d(u),d(n),d(i),d(a),d(c)),I&&I.d(_),se(O,_),$=!1,ue(P)}}}function Ae(l,e,r){let t;j(l,E,a=>r(5,t=a));let{lane:s}=e,o=structuredClone(s.properties);delete o.osm_way_ids,delete o.muv;function u(){t.collapseShortRoad(s.properties.road),E.set(t)}function n(){t.zipSidepath(s.properties.road),E.set(t)}let i=t;return l.$$set=a=>{"lane"in a&&r(0,s=a.lane)},[s,o,u,n,i]}class ze extends J{constructor(e){super(),D(this,e,Ae,Re,B,{lane:0})}}function He(l,e,r){let t,s,o,u,n;j(l,te,a=>r(0,t=a)),j(l,pe,a=>r(1,s=a)),j(l,ce,a=>r(2,o=a)),j(l,me,a=>r(3,u=a)),j(l,de,a=>r(4,n=a));let i=new ne.Popup({closeButton:!1,closeOnClick:!1,maxWidth:"none"});return fe(()=>{i.remove()}),l.$$.update=()=>{if(l.$$.dirty&31)if(n){let a=document.createElement("div");a.style.cssText="height: 300px; overflow-y: auto;",new ze({target:a,props:{lane:n}}),i.setLngLat(u).setDOMContent(a).addTo(t)}else if(o){let a=document.createElement("div");new Ge({target:a,props:{intersection:o}}),i.setLngLat(s).setDOMContent(a).addTo(t)}else i.remove()},[t,s,o,u,n]}class We extends J{constructor(e){super(),D(this,e,He,null,B,{})}}function qe(l){let e,r,t,s,o,u,n,i,a,c,f;return s=new ge({}),c=new we({}),{c(){e=g("div"),r=g("h1"),r.textContent="osm2streets Street Explorer",t=h(),C(s.$$.fragment),o=h(),u=g("p"),u.innerHTML=`Understanding OSM streets &amp; intersections with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>
      and <a href="https://gitlab.com/LeLuxNet/Muv" target="_blank">Muv</a>.`,n=h(),i=g("hr"),a=h(),C(c.$$.fragment),N(e,"slot","left")},m(p,y){m(p,e,y),w(e,r),w(e,t),L(s,e,null),w(e,o),w(e,u),w(e,n),w(e,i),w(e,a),L(c,e,null),f=!0},p:T,i(p){f||(k(s.$$.fragment,p),k(c.$$.fragment,p),f=!0)},o(p){v(s.$$.fragment,p),v(c.$$.fragment,p),f=!1},d(p){p&&d(e),S(s),S(c)}}}function Ue(l){let e,r,t,s,o,u;return e=new ke({}),o=new Be({}),{c(){C(e.$$.fragment),r=h(),t=g("hr"),s=h(),C(o.$$.fragment)},m(n,i){L(e,n,i),m(n,r,i),m(n,t,i),m(n,s,i),L(o,n,i),u=!0},p:T,i(n){u||(k(e.$$.fragment,n),k(o.$$.fragment,n),u=!0)},o(n){v(e.$$.fragment,n),v(o.$$.fragment,n),u=!1},d(n){n&&(d(r),d(t),d(s)),S(e,n),S(o,n)}}}function Ve(l){let e,r,t,s,o,u;return e=new Le({props:{$$slots:{default:[Ue]},$$scope:{ctx:l}}}),t=new We({}),o=new be({}),{c(){C(e.$$.fragment),r=h(),C(t.$$.fragment),s=h(),C(o.$$.fragment)},m(n,i){L(e,n,i),m(n,r,i),L(t,n,i),m(n,s,i),L(o,n,i),u=!0},p(n,i){const a={};i&1&&(a.$$scope={dirty:i,ctx:n}),e.$set(a)},i(n){u||(k(e.$$.fragment,n),k(t.$$.fragment,n),k(o.$$.fragment,n),u=!0)},o(n){v(e.$$.fragment,n),v(t.$$.fragment,n),v(o.$$.fragment,n),u=!1},d(n){n&&(d(r),d(s)),S(e,n),S(t,n),S(o,n)}}}function Ke(l){let e,r,t;return r=new he({props:{$$slots:{default:[Ve]},$$scope:{ctx:l}}}),{c(){e=g("div"),C(r.$$.fragment),N(e,"slot","main")},m(s,o){m(s,e,o),L(r,e,null),t=!0},p(s,o){const u={};o&1&&(u.$$scope={dirty:o,ctx:s}),r.$set(u)},i(s){t||(k(r.$$.fragment,s),t=!0)},o(s){v(r.$$.fragment,s),t=!1},d(s){s&&d(e),S(r)}}}function Qe(l){let e,r;return e=new $e({props:{$$slots:{main:[Ke],left:[qe]},$$scope:{ctx:l}}}),{c(){C(e.$$.fragment)},m(t,s){L(e,t,s),r=!0},p(t,[s]){const o={};s&1&&(o.$$scope={dirty:s,ctx:t}),e.$set(o)},i(t){r||(k(e.$$.fragment,t),r=!0)},o(t){v(e.$$.fragment,t),r=!1},d(t){S(e,t)}}}function Ze(l){return _e(async()=>{await ye()}),[]}class Xe extends J{constructor(e){super(),D(this,e,Ze,Qe,B,{})}}new Xe({target:document.getElementById("app")});
