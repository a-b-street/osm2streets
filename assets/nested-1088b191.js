import{S as q,i as z,s as j,e as g,y as N,n as k,a as W,b as $,z as m,A as D,G as X,B as S,h,r as B,w as F,W as Z,E as G,X as K,H as P,Y as x,Z as I,_ as ee,m as C,$ as Q,o as O,a0 as U,f as w,a1 as V,t as b,q as T,k as te,L as ne,N as le,O as se,P as re,Q as ae,R as oe,T as ie,U as ue,V as fe,a2 as ce}from"./MainLayers-5dfe2449.js";function pe(i){let e,t=i[0].size+"",n,l,a,r,u,d;return{c(){e=g("div"),n=N(t),l=N(" ways edited"),a=k(),r=g("button"),r.textContent="Download .osc",W(r,"type","button")},m(_,p){$(_,e,p),m(e,n),m(e,l),$(_,a,p),$(_,r,p),u||(d=D(r,"click",i[1]),u=!0)},p(_,[p]){p&1&&t!==(t=_[0].size+"")&&X(n,t)},i:S,o:S,d(_){_&&(h(e),h(a),h(r)),u=!1,d()}}}function de(i,e,t){let n;B(i,F,u=>t(3,n=u));let l=new Set;function a(u){l.add(u.detail),t(0,l)}function r(){let u=`<osmChange version="0.6" generator="osm2streets">
`;u+=`<create/>
`,u+=`<modify>
`;for(let d of l)u+=n.wayToXml(d),u+=`
`;u+=`</modify>
`,u+="</osmChange>",Z("lane_edits.osc",u)}return[l,r,a]}class _e extends q{constructor(e){super(),z(this,e,de,pe,j,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function H(i,e,t){const n=i.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function J(i,e){let t,n,l,a,r,u,d,_,p,f,c,s;function o(){e[5].call(l,e[12],e[13])}function y(){e[6].call(u,e[12],e[13])}function E(){return e[7](e[11])}return{key:i,first:null,c(){t=g("tr"),n=g("td"),l=g("input"),a=k(),r=g("td"),u=g("input"),d=k(),_=g("td"),p=g("button"),p.textContent="Delete",f=k(),W(l,"type","text"),W(u,"type","text"),W(p,"type","button"),this.first=t},m(M,L){$(M,t,L),m(t,n),m(n,l),I(l,e[11].key),m(t,a),m(t,r),m(r,u),I(u,e[11].value),m(t,d),m(t,_),m(_,p),m(t,f),c||(s=[D(l,"input",o),D(u,"input",y),D(p,"click",E)],c=!0)},p(M,L){e=M,L&1&&l.value!==e[11].key&&I(l,e[11].key),L&1&&u.value!==e[11].value&&I(u,e[11].value)},d(M){M&&h(t),c=!1,P(s)}}}function me(i){let e,t,n=[],l=new Map,a,r,u,d,_,p,f=G(i[0]);const c=s=>s[11].id;for(let s=0;s<f.length;s+=1){let o=H(i,f,s),y=c(o);l.set(y,n[s]=J(y,o))}return{c(){e=g("table"),t=g("tbody");for(let s=0;s<n.length;s+=1)n[s].c();a=k(),r=g("button"),r.textContent="Add new tag",u=k(),d=g("button"),d.textContent="Recalculate",W(r,"type","button"),W(d,"type","button")},m(s,o){$(s,e,o),m(e,t);for(let y=0;y<n.length;y+=1)n[y]&&n[y].m(t,null);$(s,a,o),$(s,r,o),$(s,u,o),$(s,d,o),_||(p=[D(r,"click",i[2]),D(d,"click",i[3])],_=!0)},p(s,[o]){o&3&&(f=G(s[0]),n=K(n,o,c,1,s,f,l,t,ee,J,null,H))},i:S,o:S,d(s){s&&(h(e),h(a),h(r),h(u),h(d));for(let o=0;o<n.length;o+=1)n[o].d();_=!1,P(p)}}}function ye(i,e,t){let n;B(i,F,o=>t(9,n=o));const l=x();let{way:a}=e,r=[],u=0;for(let[o,y]of Object.entries(JSON.parse(n.getOsmTagsForWay(a))))r.push({id:u++,key:o,value:y});function d(o){t(0,r=r.filter(y=>y.id!=o))}function _(){r.push({id:u++,key:"",value:""}),t(0,r)}function p(){let o={};for(let y of r)y.key&&y.value&&(o[y.key]=y.value);n.overwriteOsmTagsForWay(a,JSON.stringify(o)),F.set(n),l("editedWay",a)}function f(o,y){o[y].key=this.value,t(0,r)}function c(o,y){o[y].value=this.value,t(0,r)}const s=o=>d(o.id);return i.$$set=o=>{"way"in o&&t(4,a=o.way)},[r,d,_,p,a,f,c,s]}class ge extends q{constructor(e){super(),z(this,e,ye,me,j,{way:4})}}function $e(i){let e;return{c(){e=N("Click a road to edit")},m(t,n){$(t,e,n)},p:S,i:S,o:S,d(t){t&&h(e)}}}function he(i){let e,t,n,l,a,r,u,d=i[0],_,p;r=new ne({props:{source:"current-way",gj:i[2],layerStyle:i[3]}});let f=R(i);return{c(){e=g("a"),t=N("Way "),n=N(i[0]),a=k(),C(r.$$.fragment),u=k(),f.c(),_=Q(),W(e,"href",l="http://openstreetmap.org/way/"+i[0]),W(e,"target","_blank")},m(c,s){$(c,e,s),m(e,t),m(e,n),$(c,a,s),O(r,c,s),$(c,u,s),f.m(c,s),$(c,_,s),p=!0},p(c,s){(!p||s&1)&&X(n,c[0]),(!p||s&1&&l!==(l="http://openstreetmap.org/way/"+c[0]))&&W(e,"href",l);const o={};s&4&&(o.gj=c[2]),r.$set(o),s&1&&j(d,d=c[0])?(U(),w(f,1,1,S),V(),f=R(c),f.c(),b(f,1),f.m(_.parentNode,_)):f.p(c,s)},i(c){p||(b(r.$$.fragment,c),b(f),p=!0)},o(c){w(r.$$.fragment,c),w(f),p=!1},d(c){c&&(h(e),h(a),h(u),h(_)),T(r,c),f.d(c)}}}function R(i){let e,t;return e=new ge({props:{way:i[0]}}),e.$on("editedWay",i[7]),{c(){C(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,l){const a={};l&1&&(a.way=n[0]),e.$set(a)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function ke(i){let e,t,n,l,a,r,u,d,_={};e=new _e({props:_}),i[6](e);const p=[he,$e],f=[];function c(s,o){return s[0]?0:1}return a=c(i),r=f[a]=p[a](i),{c(){C(e.$$.fragment),t=k(),n=g("hr"),l=k(),r.c(),u=Q()},m(s,o){O(e,s,o),$(s,t,o),$(s,n,o),$(s,l,o),f[a].m(s,o),$(s,u,o),d=!0},p(s,[o]){const y={};e.$set(y);let E=a;a=c(s),a===E?f[a].p(s,o):(U(),w(f[E],1,1,()=>{f[E]=null}),V(),r=f[a],r?r.p(s,o):(r=f[a]=p[a](s),r.c()),b(r,1),r.m(u.parentNode,u))},i(s){d||(b(e.$$.fragment,s),b(r),d=!0)},o(s){w(e.$$.fragment,s),w(r),d=!1},d(s){s&&(h(t),h(n),h(l),h(u)),i[6](null),T(e,s),f[a].d(s)}}}function we(i,e,t){let n,l;B(i,F,f=>t(4,n=f)),B(i,le,f=>t(5,l=f));let a,r=null,u,d={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};function _(f){te[f?"unshift":"push"](()=>{a=f,t(1,a)})}const p=f=>a.handleEditedWay(f);return i.$$.update=()=>{i.$$.dirty&49&&(t(0,r=null),t(2,u=void 0),l&&(l.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(t(0,r=BigInt(l.properties.osm_way_ids[0])),t(2,u=JSON.parse(n.getGeometryForWay(r))))))},[r,a,u,d,n,l,_,p]}class be extends q{constructor(e){super(),z(this,e,we,ke,j,{})}}function ve(i){let e,t,n,l,a,r,u,d,_,p,f,c,s,o,y,E,M,L,A;return l=new ae({}),p=new oe({}),o=new be({}),{c(){e=g("div"),t=g("h1"),t.textContent="osm2streets lane editor",n=k(),C(l.$$.fragment),a=k(),r=g("p"),r.innerHTML=`Improve OSM lane tagging with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>.`,u=k(),d=g("hr"),_=k(),C(p.$$.fragment),f=k(),c=g("hr"),s=k(),C(o.$$.fragment),y=k(),E=g("hr"),M=k(),L=g("div"),L.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",W(e,"slot","left")},m(v,Y){$(v,e,Y),m(e,t),m(e,n),O(l,e,null),m(e,a),m(e,r),m(e,u),m(e,d),m(e,_),O(p,e,null),m(e,f),m(e,c),m(e,s),O(o,e,null),m(e,y),m(e,E),m(e,M),m(e,L),A=!0},p:S,i(v){A||(b(l.$$.fragment,v),b(p.$$.fragment,v),b(o.$$.fragment,v),A=!0)},o(v){w(l.$$.fragment,v),w(p.$$.fragment,v),w(o.$$.fragment,v),A=!1},d(v){v&&h(e),T(l),T(p),T(o)}}}function We(i){let e,t,n;return t=new fe({}),{c(){e=g("div"),C(t.$$.fragment),ce(e,"display","none")},m(l,a){$(l,e,a),O(t,e,null),n=!0},p:S,i(l){n||(b(t.$$.fragment,l),n=!0)},o(l){w(t.$$.fragment,l),n=!1},d(l){l&&h(e),T(t)}}}function Se(i){let e,t,n;return t=new ie({props:{$$slots:{default:[We]},$$scope:{ctx:i}}}),{c(){e=g("div"),C(t.$$.fragment),W(e,"slot","main")},m(l,a){$(l,e,a),O(t,e,null),n=!0},p(l,a){const r={};a&1&&(r.$$scope={dirty:a,ctx:l}),t.$set(r)},i(l){n||(b(t.$$.fragment,l),n=!0)},o(l){w(t.$$.fragment,l),n=!1},d(l){l&&h(e),T(t)}}}function Ce(i){let e,t;return e=new se({props:{$$slots:{main:[Se],left:[ve]},$$scope:{ctx:i}}}),{c(){C(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,[l]){const a={};l&1&&(a.$$scope={dirty:l,ctx:n}),e.$set(a)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function Oe(i){return re(async()=>{await ue()}),[]}class Te extends q{constructor(e){super(),z(this,e,Oe,Ce,j,{})}}new Te({target:document.getElementById("app")});
