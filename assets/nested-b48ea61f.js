import{S as A,i as z,s as R,p as y,y as j,J as g,K as I,a as b,B as $,D as N,af as U,E as L,d as v,j as F,N as D,ag as te,I as X,ah as ne,M as x,h as le,z as B,ai as re,R as M,e as ee,T as O,g as q,b as k,c as H,t as h,V as S,x as ae,a3 as se,o as oe,X as ie,a4 as ue,a5 as fe,a6 as ce,a7 as de,ad as pe,a8 as me,a9 as $e,aa as _e,ab as ge,ac as ye,O as he,ae as we,aj as ke,a1 as be,Y as ve,Z as We,_ as Ce}from"./RenderLanePolygons-fe895dbc.js";function Me(u){let e,t=u[0].size+"",n,l,r,a,s,c;return{c(){e=y("div"),n=j(t),l=j(" ways edited"),r=g(),a=y("button"),a.textContent="Download .osc",I(a,"type","button")},m(d,f){b(d,e,f),$(e,n),$(e,l),b(d,r,f),b(d,a,f),s||(c=N(a,"click",u[1]),s=!0)},p(d,[f]){f&1&&t!==(t=d[0].size+"")&&U(n,t)},i:L,o:L,d(d){d&&(v(e),v(r),v(a)),s=!1,c()}}}function Oe(u,e,t){let n;F(u,D,s=>t(3,n=s));let l=new Set;function r(s){l.add(s.detail),t(0,l)}function a(){let s=`<osmChange version="0.6" generator="osm2streets">
`;s+=`<create/>
`,s+=`<modify>
`;for(let c of l)s+=n.wayToXml(c),s+=`
`;s+=`</modify>
`,s+="</osmChange>",te("lane_edits.osc",s)}return[l,a,r]}class Se extends A{constructor(e){super(),z(this,e,Oe,Me,R,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function K(u,e,t){const n=u.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function Y(u,e){let t,n,l,r,a,s,c,d,f,p,w,i;function o(){e[5].call(l,e[12],e[13])}function _(){e[6].call(s,e[12],e[13])}function m(){return e[7](e[11])}return{key:u,first:null,c(){t=y("tr"),n=y("td"),l=y("input"),r=g(),a=y("td"),s=y("input"),c=g(),d=y("td"),f=y("button"),f.textContent="Delete",p=g(),I(l,"type","text"),I(s,"type","text"),I(f,"type","button"),this.first=t},m(C,E){b(C,t,E),$(t,n),$(n,l),B(l,e[11].key),$(t,r),$(t,a),$(a,s),B(s,e[11].value),$(t,c),$(t,d),$(d,f),$(t,p),w||(i=[N(l,"input",o),N(s,"input",_),N(f,"click",m)],w=!0)},p(C,E){e=C,E&1&&l.value!==e[11].key&&B(l,e[11].key),E&1&&s.value!==e[11].value&&B(s,e[11].value)},d(C){C&&v(t),w=!1,x(i)}}}function Te(u){let e,t,n=[],l=new Map,r,a,s,c,d,f,p=X(u[0]);const w=i=>i[11].id;for(let i=0;i<p.length;i+=1){let o=K(u,p,i),_=w(o);l.set(_,n[i]=Y(_,o))}return{c(){e=y("table"),t=y("tbody");for(let i=0;i<n.length;i+=1)n[i].c();r=g(),a=y("button"),a.textContent="Add new tag",s=g(),c=y("button"),c.textContent="Recalculate",I(a,"type","button"),I(c,"type","button")},m(i,o){b(i,e,o),$(e,t);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(t,null);b(i,r,o),b(i,a,o),b(i,s,o),b(i,c,o),d||(f=[N(a,"click",u[2]),N(c,"click",u[3])],d=!0)},p(i,[o]){o&3&&(p=X(i[0]),n=ne(n,o,w,1,i,p,l,t,re,Y,null,K))},i:L,o:L,d(i){i&&(v(e),v(r),v(a),v(s),v(c));for(let o=0;o<n.length;o+=1)n[o].d();d=!1,x(f)}}}function Ee(u,e,t){let n;F(u,D,o=>t(9,n=o));const l=le();let{way:r}=e,a=[],s=0;for(let[o,_]of Object.entries(JSON.parse(n.getOsmTagsForWay(r))))a.push({id:s++,key:o,value:_});function c(o){t(0,a=a.filter(_=>_.id!=o))}function d(){a.push({id:s++,key:"",value:""}),t(0,a)}function f(){let o={};for(let _ of a)_.key&&_.value&&(o[_.key]=_.value);n.overwriteOsmTagsForWay(r,JSON.stringify(o)),D.set(n),l("editedWay",r)}function p(o,_){o[_].key=this.value,t(0,a)}function w(o,_){o[_].value=this.value,t(0,a)}const i=o=>c(o.id);return u.$$set=o=>{"way"in o&&t(4,r=o.way)},[a,c,d,f,r,p,w,i]}class Ie extends A{constructor(e){super(),z(this,e,Ee,Te,R,{way:4})}}function Le(u){let e;return{c(){e=j("Click a road to edit")},m(t,n){b(t,e,n)},p:L,i:L,o:L,d(t){t&&v(e)}}}function Ne(u){let e,t,n,l,r,a=u[0],s,c,d=Z(u);return{c(){e=y("a"),t=j("Way "),n=j(u[0]),r=g(),d.c(),s=ee(),I(e,"href",l="http://openstreetmap.org/way/"+u[0]),I(e,"target","_blank")},m(f,p){b(f,e,p),$(e,t),$(e,n),b(f,r,p),d.m(f,p),b(f,s,p),c=!0},p(f,p){(!c||p&1)&&U(n,f[0]),(!c||p&1&&l!==(l="http://openstreetmap.org/way/"+f[0]))&&I(e,"href",l),p&1&&R(a,a=f[0])?(q(),k(d,1,1,L),H(),d=Z(f),d.c(),h(d,1),d.m(s.parentNode,s)):d.p(f,p)},i(f){c||(h(d),c=!0)},o(f){k(d),c=!1},d(f){f&&(v(e),v(r),v(s)),d.d(f)}}}function Z(u){let e,t;return e=new Ie({props:{way:u[0]}}),e.$on("editedWay",u[3]),{c(){M(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,l){const r={};l&1&&(r.way=n[0]),e.$set(r)},i(n){t||(h(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){S(e,n)}}}function je(u){let e,t,n,l,r,a,s,c,d={};e=new Se({props:d}),u[2](e);const f=[Ne,Le],p=[];function w(i,o){return i[0]?0:1}return r=w(u),a=p[r]=f[r](u),{c(){M(e.$$.fragment),t=g(),n=y("hr"),l=g(),a.c(),s=ee()},m(i,o){O(e,i,o),b(i,t,o),b(i,n,o),b(i,l,o),p[r].m(i,o),b(i,s,o),c=!0},p(i,[o]){const _={};e.$set(_);let m=r;r=w(i),r===m?p[r].p(i,o):(q(),k(p[m],1,1,()=>{p[m]=null}),H(),a=p[r],a?a.p(i,o):(a=p[r]=f[r](i),a.c()),h(a,1),a.m(s.parentNode,s))},i(i){c||(h(e.$$.fragment,i),h(a),c=!0)},o(i){k(e.$$.fragment,i),k(a),c=!1},d(i){i&&(v(t),v(n),v(l),v(s)),u[2](null),S(e,i),p[r].d(i)}}}function De(u,e,t){let{way:n}=e,l;function r(s){ae[s?"unshift":"push"](()=>{l=s,t(1,l)})}const a=s=>l.handleEditedWay(s);return u.$$set=s=>{"way"in s&&t(0,n=s.way)},[n,l,r,a]}class Re extends A{constructor(e){super(),z(this,e,De,je,R,{way:0})}}function Q(u){let e,t;return e=new pe({}),{c(){M(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},i(n){t||(h(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){S(e,n)}}}function Ge(u){let e,t,n,l,r,a,s,c,d,f,p,w,i,o,_,m,C,E,P,G;l=new ue({}),f=new fe({}),o=new Re({props:{way:u[0]}});let W=u[2]&&Q();return{c(){e=y("div"),t=y("h1"),t.textContent="osm2streets lane editor",n=g(),M(l.$$.fragment),r=g(),a=y("p"),a.innerHTML=`Improve OSM lane tagging with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>
      and <a href="https://gitlab.com/LeLuxNet/Muv" target="_blank">Muv</a>.`,s=g(),c=y("hr"),d=g(),M(f.$$.fragment),p=g(),w=y("hr"),i=g(),M(o.$$.fragment),_=g(),m=y("hr"),C=g(),E=y("div"),E.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",P=g(),W&&W.c(),I(e,"slot","left")},m(T,J){b(T,e,J),$(e,t),$(e,n),O(l,e,null),$(e,r),$(e,a),$(e,s),$(e,c),$(e,d),O(f,e,null),$(e,p),$(e,w),$(e,i),O(o,e,null),$(e,_),$(e,m),$(e,C),$(e,E),$(e,P),W&&W.m(e,null),G=!0},p(T,J){const V={};J&1&&(V.way=T[0]),o.$set(V),T[2]?W?J&4&&h(W,1):(W=Q(),W.c(),h(W,1),W.m(e,null)):W&&(q(),k(W,1,1,()=>{W=null}),H())},i(T){G||(h(l.$$.fragment,T),h(f.$$.fragment,T),h(o.$$.fragment,T),h(W),G=!0)},o(T){k(l.$$.fragment,T),k(f.$$.fragment,T),k(o.$$.fragment,T),k(W),G=!1},d(T){T&&v(e),S(l),S(f),S(o),W&&W.d()}}}function Je(u){let e,t;const n=[ve("current-way"),{paint:{"fill-color":"red","fill-opacity":.3}}];let l={};for(let r=0;r<n.length;r+=1)l=We(l,n[r]);return e=new Ce({props:l}),{c(){M(e.$$.fragment)},m(r,a){O(e,r,a),t=!0},p(r,a){const s={};e.$set(s)},i(r){t||(h(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){S(e,r)}}}function Be(u){let e,t,n,l,r,a,s,c,d,f,p,w,i,o,_;return t=new me({}),l=new $e({}),a=new _e({}),c=new ge({props:{hoverCursor:"pointer"}}),c.$on("click",u[3]),f=new ye({}),w=new he({props:{data:u[1],$$slots:{default:[Je]},$$scope:{ctx:u}}}),o=new we({}),{c(){e=y("div"),M(t.$$.fragment),n=g(),M(l.$$.fragment),r=g(),M(a.$$.fragment),s=g(),M(c.$$.fragment),d=g(),M(f.$$.fragment),p=g(),M(w.$$.fragment),i=g(),M(o.$$.fragment),ke(e,"display","none")},m(m,C){b(m,e,C),O(t,e,null),$(e,n),O(l,e,null),$(e,r),O(a,e,null),$(e,s),O(c,e,null),$(e,d),O(f,e,null),$(e,p),O(w,e,null),b(m,i,C),O(o,m,C),_=!0},p(m,C){const E={};C&2&&(E.data=m[1]),C&32&&(E.$$scope={dirty:C,ctx:m}),w.$set(E)},i(m){_||(h(t.$$.fragment,m),h(l.$$.fragment,m),h(a.$$.fragment,m),h(c.$$.fragment,m),h(f.$$.fragment,m),h(w.$$.fragment,m),h(o.$$.fragment,m),_=!0)},o(m){k(t.$$.fragment,m),k(l.$$.fragment,m),k(a.$$.fragment,m),k(c.$$.fragment,m),k(f.$$.fragment,m),k(w.$$.fragment,m),k(o.$$.fragment,m),_=!1},d(m){m&&(v(e),v(i)),S(t),S(l),S(a),S(c),S(f),S(w),S(o,m)}}}function Fe(u){let e,t,n;return t=new ce({props:{$$slots:{default:[Be]},$$scope:{ctx:u}}}),{c(){e=y("div"),M(t.$$.fragment),I(e,"slot","main")},m(l,r){b(l,e,r),O(t,e,null),n=!0},p(l,r){const a={};r&34&&(a.$$scope={dirty:r,ctx:l}),t.$set(a)},i(l){n||(h(t.$$.fragment,l),n=!0)},o(l){k(t.$$.fragment,l),n=!1},d(l){l&&v(e),S(t)}}}function Ae(u){let e,t;return e=new se({props:{$$slots:{main:[Fe],left:[Ge]},$$scope:{ctx:u}}}),{c(){M(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,[l]){const r={};l&39&&(r.$$scope={dirty:l,ctx:n}),e.$set(r)},i(n){t||(h(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){S(e,n)}}}function ze(u,e,t){let n,l,r;F(u,D,c=>t(4,l=c)),F(u,be,c=>t(2,r=c)),oe(async()=>{await de()});let a=null;D.subscribe(c=>{t(0,a=null)});function s(c){let d=JSON.parse(c.detail.features[0].properties.osm_way_ids);d.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):t(0,a=BigInt(d[0]))}return u.$$.update=()=>{u.$$.dirty&17&&t(1,n=a?JSON.parse(l.getGeometryForWay(a)):ie())},[a,n,r,s,l]}class qe extends A{constructor(e){super(),z(this,e,ze,Ae,R,{})}}new qe({target:document.getElementById("app")});
