import{S as G,i as q,s as j,e as g,y as D,n as k,a as W,b as $,z as m,A as N,G as X,B as S,h,r as B,w as F,W as Z,E as z,X as K,H as P,Y as x,Z as I,$ as ee,m as C,a0 as Q,o as M,a1 as U,f as w,a2 as V,t as b,q as O,k as te,L as ne,N as le,O as se,P as re,Q as ae,R as oe,T as ie,_ as ue,V as fe,U as ce,a3 as pe}from"./MainLayers-04588212.js";function de(u){let e,t=u[0].size+"",n,s,a,l,i,d;return{c(){e=g("div"),n=D(t),s=D(" ways edited"),a=k(),l=g("button"),l.textContent="Download .osc",W(l,"type","button")},m(_,p){$(_,e,p),m(e,n),m(e,s),$(_,a,p),$(_,l,p),i||(d=N(l,"click",u[1]),i=!0)},p(_,[p]){p&1&&t!==(t=_[0].size+"")&&X(n,t)},i:S,o:S,d(_){_&&(h(e),h(a),h(l)),i=!1,d()}}}function _e(u,e,t){let n;B(u,F,i=>t(3,n=i));let s=new Set;function a(i){s.add(i.detail),t(0,s)}function l(){let i=`<osmChange version="0.6" generator="osm2streets">
`;i+=`<create/>
`,i+=`<modify>
`;for(let d of s)i+=n.wayToXml(d),i+=`
`;i+=`</modify>
`,i+="</osmChange>",Z("lane_edits.osc",i)}return[s,l,a]}class me extends G{constructor(e){super(),q(this,e,_e,de,j,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function H(u,e,t){const n=u.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function J(u,e){let t,n,s,a,l,i,d,_,p,f,c,r;function o(){e[5].call(s,e[12],e[13])}function y(){e[6].call(i,e[12],e[13])}function T(){return e[7](e[11])}return{key:u,first:null,c(){t=g("tr"),n=g("td"),s=g("input"),a=k(),l=g("td"),i=g("input"),d=k(),_=g("td"),p=g("button"),p.textContent="Delete",f=k(),W(s,"type","text"),W(i,"type","text"),W(p,"type","button"),this.first=t},m(E,L){$(E,t,L),m(t,n),m(n,s),I(s,e[11].key),m(t,a),m(t,l),m(l,i),I(i,e[11].value),m(t,d),m(t,_),m(_,p),m(t,f),c||(r=[N(s,"input",o),N(i,"input",y),N(p,"click",T)],c=!0)},p(E,L){e=E,L&1&&s.value!==e[11].key&&I(s,e[11].key),L&1&&i.value!==e[11].value&&I(i,e[11].value)},d(E){E&&h(t),c=!1,P(r)}}}function ye(u){let e,t,n=[],s=new Map,a,l,i,d,_,p,f=z(u[0]);const c=r=>r[11].id;for(let r=0;r<f.length;r+=1){let o=H(u,f,r),y=c(o);s.set(y,n[r]=J(y,o))}return{c(){e=g("table"),t=g("tbody");for(let r=0;r<n.length;r+=1)n[r].c();a=k(),l=g("button"),l.textContent="Add new tag",i=k(),d=g("button"),d.textContent="Recalculate",W(l,"type","button"),W(d,"type","button")},m(r,o){$(r,e,o),m(e,t);for(let y=0;y<n.length;y+=1)n[y]&&n[y].m(t,null);$(r,a,o),$(r,l,o),$(r,i,o),$(r,d,o),_||(p=[N(l,"click",u[2]),N(d,"click",u[3])],_=!0)},p(r,[o]){o&3&&(f=z(r[0]),n=K(n,o,c,1,r,f,s,t,ee,J,null,H))},i:S,o:S,d(r){r&&(h(e),h(a),h(l),h(i),h(d));for(let o=0;o<n.length;o+=1)n[o].d();_=!1,P(p)}}}function ge(u,e,t){let n;B(u,F,o=>t(9,n=o));const s=x();let{way:a}=e,l=[],i=0;for(let[o,y]of Object.entries(JSON.parse(n.getOsmTagsForWay(a))))l.push({id:i++,key:o,value:y});function d(o){t(0,l=l.filter(y=>y.id!=o))}function _(){l.push({id:i++,key:"",value:""}),t(0,l)}function p(){let o={};for(let y of l)y.key&&y.value&&(o[y.key]=y.value);n.overwriteOsmTagsForWay(a,JSON.stringify(o)),F.set(n),s("editedWay",a)}function f(o,y){o[y].key=this.value,t(0,l)}function c(o,y){o[y].value=this.value,t(0,l)}const r=o=>d(o.id);return u.$$set=o=>{"way"in o&&t(4,a=o.way)},[l,d,_,p,a,f,c,r]}class $e extends G{constructor(e){super(),q(this,e,ge,ye,j,{way:4})}}function he(u){let e;return{c(){e=D("Click a road to edit")},m(t,n){$(t,e,n)},p:S,i:S,o:S,d(t){t&&h(e)}}}function ke(u){let e,t,n,s,a,l,i,d=u[0],_,p;l=new ne({props:{source:"current-way",gj:u[2],layerStyle:u[3]}});let f=R(u);return{c(){e=g("a"),t=D("Way "),n=D(u[0]),a=k(),C(l.$$.fragment),i=k(),f.c(),_=Q(),W(e,"href",s="http://openstreetmap.org/way/"+u[0]),W(e,"target","_blank")},m(c,r){$(c,e,r),m(e,t),m(e,n),$(c,a,r),M(l,c,r),$(c,i,r),f.m(c,r),$(c,_,r),p=!0},p(c,r){(!p||r&1)&&X(n,c[0]),(!p||r&1&&s!==(s="http://openstreetmap.org/way/"+c[0]))&&W(e,"href",s);const o={};r&4&&(o.gj=c[2]),l.$set(o),r&1&&j(d,d=c[0])?(U(),w(f,1,1,S),V(),f=R(c),f.c(),b(f,1),f.m(_.parentNode,_)):f.p(c,r)},i(c){p||(b(l.$$.fragment,c),b(f),p=!0)},o(c){w(l.$$.fragment,c),w(f),p=!1},d(c){c&&(h(e),h(a),h(i),h(_)),O(l,c),f.d(c)}}}function R(u){let e,t;return e=new $e({props:{way:u[0]}}),e.$on("editedWay",u[7]),{c(){C(e.$$.fragment)},m(n,s){M(e,n,s),t=!0},p(n,s){const a={};s&1&&(a.way=n[0]),e.$set(a)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function we(u){let e,t,n,s,a,l,i,d,_={};e=new me({props:_}),u[6](e);const p=[ke,he],f=[];function c(r,o){return r[0]?0:1}return a=c(u),l=f[a]=p[a](u),{c(){C(e.$$.fragment),t=k(),n=g("hr"),s=k(),l.c(),i=Q()},m(r,o){M(e,r,o),$(r,t,o),$(r,n,o),$(r,s,o),f[a].m(r,o),$(r,i,o),d=!0},p(r,[o]){const y={};e.$set(y);let T=a;a=c(r),a===T?f[a].p(r,o):(U(),w(f[T],1,1,()=>{f[T]=null}),V(),l=f[a],l?l.p(r,o):(l=f[a]=p[a](r),l.c()),b(l,1),l.m(i.parentNode,i))},i(r){d||(b(e.$$.fragment,r),b(l),d=!0)},o(r){w(e.$$.fragment,r),w(l),d=!1},d(r){r&&(h(t),h(n),h(s),h(i)),u[6](null),O(e,r),f[a].d(r)}}}function be(u,e,t){let n,s;B(u,F,f=>t(4,n=f)),B(u,le,f=>t(5,s=f));let a,l=null,i,d={type:"fill",paint:{"fill-color":"red","fill-opacity":.3}};function _(f){te[f?"unshift":"push"](()=>{a=f,t(1,a)})}const p=f=>a.handleEditedWay(f);return u.$$.update=()=>{u.$$.dirty&49&&(t(0,l=null),t(2,i=void 0),s&&(s.properties.osm_way_ids.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):(t(0,l=BigInt(s.properties.osm_way_ids[0])),t(2,i=JSON.parse(n.getGeometryForWay(l))))))},[l,a,i,d,n,s,_,p]}class ve extends G{constructor(e){super(),q(this,e,be,we,j,{})}}function We(u){let e,t,n,s,a,l,i,d,_,p,f,c,r,o,y,T,E,L,A;return s=new ae({}),p=new oe({}),o=new ve({}),{c(){e=g("div"),t=g("h1"),t.textContent="osm2streets lane editor",n=k(),C(s.$$.fragment),a=k(),l=g("p"),l.innerHTML=`Improve OSM lane tagging with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>
      and <a href="https://gitlab.com/LeLuxNet/Muv" target="_blank">Muv</a>.`,i=k(),d=g("hr"),_=k(),C(p.$$.fragment),f=k(),c=g("hr"),r=k(),C(o.$$.fragment),y=k(),T=g("hr"),E=k(),L=g("div"),L.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",W(e,"slot","left")},m(v,Y){$(v,e,Y),m(e,t),m(e,n),M(s,e,null),m(e,a),m(e,l),m(e,i),m(e,d),m(e,_),M(p,e,null),m(e,f),m(e,c),m(e,r),M(o,e,null),m(e,y),m(e,T),m(e,E),m(e,L),A=!0},p:S,i(v){A||(b(s.$$.fragment,v),b(p.$$.fragment,v),b(o.$$.fragment,v),A=!0)},o(v){w(s.$$.fragment,v),w(p.$$.fragment,v),w(o.$$.fragment,v),A=!1},d(v){v&&h(e),O(s),O(p),O(o)}}}function Se(u){let e,t,n,s,a;return t=new fe({}),s=new ce({}),{c(){e=g("div"),C(t.$$.fragment),n=k(),C(s.$$.fragment),pe(e,"display","none")},m(l,i){$(l,e,i),M(t,e,null),$(l,n,i),M(s,l,i),a=!0},p:S,i(l){a||(b(t.$$.fragment,l),b(s.$$.fragment,l),a=!0)},o(l){w(t.$$.fragment,l),w(s.$$.fragment,l),a=!1},d(l){l&&(h(e),h(n)),O(t),O(s,l)}}}function Ce(u){let e,t,n;return t=new ie({props:{$$slots:{default:[Se]},$$scope:{ctx:u}}}),{c(){e=g("div"),C(t.$$.fragment),W(e,"slot","main")},m(s,a){$(s,e,a),M(t,e,null),n=!0},p(s,a){const l={};a&1&&(l.$$scope={dirty:a,ctx:s}),t.$set(l)},i(s){n||(b(t.$$.fragment,s),n=!0)},o(s){w(t.$$.fragment,s),n=!1},d(s){s&&h(e),O(t)}}}function Me(u){let e,t;return e=new se({props:{$$slots:{main:[Ce],left:[We]},$$scope:{ctx:u}}}),{c(){C(e.$$.fragment)},m(n,s){M(e,n,s),t=!0},p(n,[s]){const a={};s&1&&(a.$$scope={dirty:s,ctx:n}),e.$set(a)},i(n){t||(b(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function Oe(u){return re(async()=>{await ue()}),[]}class Te extends G{constructor(e){super(),q(this,e,Oe,Me,j,{})}}new Te({target:document.getElementById("app")});
