import{S as q,i as H,s as B,p as h,y as D,M as y,Z as L,a as b,B as _,D as j,af as x,E as N,d as v,j as A,R as G,ag as ne,a0 as K,ah as le,a2 as ee,h as re,z as J,ai as ae,K as S,e as te,N as O,g as z,b as w,c as P,t as g,P as T,x as se,a3 as oe,o as ie,T as ue,a4 as fe,a5 as ce,a6 as de,a7 as pe,ad as me,a8 as _e,a9 as $e,aa as ge,ab as ye,ac as he,I as we,ae as ke,aj as be,_ as ve,U as We,V as Ce,W as Me}from"./RenderLanePolygons-569ba75b.js";function Se(i){let e,t=i[0].size+"",n,l,r,a,s,d;return{c(){e=h("div"),n=D(t),l=D(" ways edited"),r=y(),a=h("button"),a.textContent="Download .osc",L(a,"type","button")},m(c,f){b(c,e,f),_(e,n),_(e,l),b(c,r,f),b(c,a,f),s||(d=j(a,"click",i[1]),s=!0)},p(c,[f]){f&1&&t!==(t=c[0].size+"")&&x(n,t)},i:N,o:N,d(c){c&&(v(e),v(r),v(a)),s=!1,d()}}}function Oe(i,e,t){let n;A(i,G,s=>t(3,n=s));let l=new Set;function r(s){l.add(s.detail),t(0,l)}function a(){let s=`<osmChange version="0.6" generator="osm2streets">
`;s+=`<create/>
`,s+=`<modify>
`;for(let d of l)try{s+=n.wayToXml(d),s+=`
`}catch(c){console.error(c)}s+=`</modify>
`,s+="</osmChange>",ne("lane_edits.osc",s)}return[l,a,r]}class Te extends q{constructor(e){super(),H(this,e,Oe,Se,B,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function U(i,e,t){const n=i.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function X(i,e){let t,n,l,r,a,s,d,c,f,p,k,o;function u(){e[5].call(l,e[12],e[13])}function $(){e[6].call(s,e[12],e[13])}function m(){return e[7](e[11])}return{key:i,first:null,c(){t=h("tr"),n=h("td"),l=h("input"),r=y(),a=h("td"),s=h("input"),d=y(),c=h("td"),f=h("button"),f.textContent="Delete",p=y(),L(l,"type","text"),L(s,"type","text"),L(f,"type","button"),this.first=t},m(W,I){b(W,t,I),_(t,n),_(n,l),J(l,e[11].key),_(t,r),_(t,a),_(a,s),J(s,e[11].value),_(t,d),_(t,c),_(c,f),_(t,p),k||(o=[j(l,"input",u),j(s,"input",$),j(f,"click",m)],k=!0)},p(W,I){e=W,I&1&&l.value!==e[11].key&&J(l,e[11].key),I&1&&s.value!==e[11].value&&J(s,e[11].value)},d(W){W&&v(t),k=!1,ee(o)}}}function Ee(i){let e,t,n=[],l=new Map,r,a,s,d,c,f,p=K(i[0]);const k=o=>o[11].id;for(let o=0;o<p.length;o+=1){let u=U(i,p,o),$=k(u);l.set($,n[o]=X($,u))}return{c(){e=h("table"),t=h("tbody");for(let o=0;o<n.length;o+=1)n[o].c();r=y(),a=h("button"),a.textContent="Add new tag",s=y(),d=h("button"),d.textContent="Recalculate",L(a,"type","button"),L(d,"type","button")},m(o,u){b(o,e,u),_(e,t);for(let $=0;$<n.length;$+=1)n[$]&&n[$].m(t,null);b(o,r,u),b(o,a,u),b(o,s,u),b(o,d,u),c||(f=[j(a,"click",i[2]),j(d,"click",i[3])],c=!0)},p(o,[u]){u&3&&(p=K(o[0]),n=le(n,u,k,1,o,p,l,t,ae,X,null,U))},i:N,o:N,d(o){o&&(v(e),v(r),v(a),v(s),v(d));for(let u=0;u<n.length;u+=1)n[u].d();c=!1,ee(f)}}}function Ie(i,e,t){let n;A(i,G,u=>t(9,n=u));const l=re();let{way:r}=e,a=[],s=0;for(let[u,$]of Object.entries(JSON.parse(n.getOsmTagsForWay(r))))a.push({id:s++,key:u,value:$});function d(u){t(0,a=a.filter($=>$.id!=u))}function c(){a.push({id:s++,key:"",value:""}),t(0,a)}function f(){let u={};for(let $ of a)$.key&&$.value&&(u[$.key]=$.value);n.overwriteOsmTagsForWay(r,JSON.stringify(u)),G.set(n),l("editedWay",r)}function p(u,$){u[$].key=this.value,t(0,a)}function k(u,$){u[$].value=this.value,t(0,a)}const o=u=>d(u.id);return i.$$set=u=>{"way"in u&&t(4,r=u.way)},[a,d,c,f,r,p,k,o]}class Le extends q{constructor(e){super(),H(this,e,Ie,Ee,B,{way:4})}}function Ne(i){let e;return{c(){e=D("Click a road to edit")},m(t,n){b(t,e,n)},p:N,i:N,o:N,d(t){t&&v(e)}}}function je(i){let e,t,n,l,r,a=i[0],s,d,c=Z(i);return{c(){e=h("a"),t=D("Way "),n=D(i[0]),r=y(),c.c(),s=te(),L(e,"href",l="http://openstreetmap.org/way/"+i[0]),L(e,"target","_blank")},m(f,p){b(f,e,p),_(e,t),_(e,n),b(f,r,p),c.m(f,p),b(f,s,p),d=!0},p(f,p){(!d||p&1)&&x(n,f[0]),(!d||p&1&&l!==(l="http://openstreetmap.org/way/"+f[0]))&&L(e,"href",l),p&1&&B(a,a=f[0])?(z(),w(c,1,1,N),P(),c=Z(f),c.c(),g(c,1),c.m(s.parentNode,s)):c.p(f,p)},i(f){d||(g(c),d=!0)},o(f){w(c),d=!1},d(f){f&&(v(e),v(r),v(s)),c.d(f)}}}function Z(i){let e,t;return e=new Le({props:{way:i[0]}}),e.$on("editedWay",i[3]),{c(){S(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,l){const r={};l&1&&(r.way=n[0]),e.$set(r)},i(n){t||(g(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function Re(i){let e,t,n,l,r,a,s,d,c={};e=new Te({props:c}),i[2](e);const f=[je,Ne],p=[];function k(o,u){return o[0]?0:1}return r=k(i),a=p[r]=f[r](i),{c(){S(e.$$.fragment),t=y(),n=h("hr"),l=y(),a.c(),s=te()},m(o,u){O(e,o,u),b(o,t,u),b(o,n,u),b(o,l,u),p[r].m(o,u),b(o,s,u),d=!0},p(o,[u]){const $={};e.$set($);let m=r;r=k(o),r===m?p[r].p(o,u):(z(),w(p[m],1,1,()=>{p[m]=null}),P(),a=p[r],a?a.p(o,u):(a=p[r]=f[r](o),a.c()),g(a,1),a.m(s.parentNode,s))},i(o){d||(g(e.$$.fragment,o),g(a),d=!0)},o(o){w(e.$$.fragment,o),w(a),d=!1},d(o){o&&(v(t),v(n),v(l),v(s)),i[2](null),T(e,o),p[r].d(o)}}}function De(i,e,t){let{way:n}=e,l;function r(s){se[s?"unshift":"push"](()=>{l=s,t(1,l)})}const a=s=>l.handleEditedWay(s);return i.$$set=s=>{"way"in s&&t(0,n=s.way)},[n,l,r,a]}class Ge extends q{constructor(e){super(),H(this,e,De,Re,B,{way:0})}}function Q(i){let e,t;return e=new pe({}),{c(){S(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},i(n){t||(g(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function Y(i){let e,t;return e=new me({}),{c(){S(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},i(n){t||(g(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function Be(i){let e,t,n,l,r,a,s,d,c,f,p,k,o,u,$,m,W,I,F;l=new fe({});let C=i[1]&&Q();o=new Ge({props:{way:i[0]}});let M=i[3]&&Y();return{c(){e=h("div"),t=h("h1"),t.textContent="osm2streets lane editor",n=y(),S(l.$$.fragment),r=y(),a=h("p"),a.innerHTML=`Improve OSM lane tagging with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>
      and <a href="https://gitlab.com/LeLuxNet/Muv" target="_blank">Muv</a>.`,s=y(),d=h("hr"),c=y(),C&&C.c(),f=y(),p=h("hr"),k=y(),S(o.$$.fragment),u=y(),$=h("hr"),m=y(),W=h("div"),W.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",I=y(),M&&M.c(),L(e,"slot","left")},m(E,R){b(E,e,R),_(e,t),_(e,n),O(l,e,null),_(e,r),_(e,a),_(e,s),_(e,d),_(e,c),C&&C.m(e,null),_(e,f),_(e,p),_(e,k),O(o,e,null),_(e,u),_(e,$),_(e,m),_(e,W),_(e,I),M&&M.m(e,null),F=!0},p(E,R){E[1]?C?R&2&&g(C,1):(C=Q(),C.c(),g(C,1),C.m(e,f)):C&&(z(),w(C,1,1,()=>{C=null}),P());const V={};R&1&&(V.way=E[0]),o.$set(V),E[3]?M?R&8&&g(M,1):(M=Y(),M.c(),g(M,1),M.m(e,null)):M&&(z(),w(M,1,1,()=>{M=null}),P())},i(E){F||(g(l.$$.fragment,E),g(C),g(o.$$.fragment,E),g(M),F=!0)},o(E){w(l.$$.fragment,E),w(C),w(o.$$.fragment,E),w(M),F=!1},d(E){E&&v(e),T(l),C&&C.d(),T(o),M&&M.d()}}}function Fe(i){let e,t;const n=[We("current-way"),{paint:{"fill-color":"red","fill-opacity":.3}}];let l={};for(let r=0;r<n.length;r+=1)l=Ce(l,n[r]);return e=new Me({props:l}),{c(){S(e.$$.fragment)},m(r,a){O(e,r,a),t=!0},p(r,a){const s={};e.$set(s)},i(r){t||(g(e.$$.fragment,r),t=!0)},o(r){w(e.$$.fragment,r),t=!1},d(r){T(e,r)}}}function Je(i){let e,t,n,l,r,a,s,d,c,f,p,k,o,u,$;return t=new _e({}),l=new $e({}),a=new ge({}),d=new ye({props:{hoverCursor:"pointer"}}),d.$on("click",i[4]),f=new he({}),k=new we({props:{data:i[2],$$slots:{default:[Fe]},$$scope:{ctx:i}}}),u=new ke({}),{c(){e=h("div"),S(t.$$.fragment),n=y(),S(l.$$.fragment),r=y(),S(a.$$.fragment),s=y(),S(d.$$.fragment),c=y(),S(f.$$.fragment),p=y(),S(k.$$.fragment),o=y(),S(u.$$.fragment),be(e,"display","none")},m(m,W){b(m,e,W),O(t,e,null),_(e,n),O(l,e,null),_(e,r),O(a,e,null),_(e,s),O(d,e,null),_(e,c),O(f,e,null),_(e,p),O(k,e,null),b(m,o,W),O(u,m,W),$=!0},p(m,W){const I={};W&4&&(I.data=m[2]),W&64&&(I.$$scope={dirty:W,ctx:m}),k.$set(I)},i(m){$||(g(t.$$.fragment,m),g(l.$$.fragment,m),g(a.$$.fragment,m),g(d.$$.fragment,m),g(f.$$.fragment,m),g(k.$$.fragment,m),g(u.$$.fragment,m),$=!0)},o(m){w(t.$$.fragment,m),w(l.$$.fragment,m),w(a.$$.fragment,m),w(d.$$.fragment,m),w(f.$$.fragment,m),w(k.$$.fragment,m),w(u.$$.fragment,m),$=!1},d(m){m&&(v(e),v(o)),T(t),T(l),T(a),T(d),T(f),T(k),T(u,m)}}}function Ae(i){let e,t,n;return t=new ce({props:{$$slots:{default:[Je]},$$scope:{ctx:i}}}),{c(){e=h("div"),S(t.$$.fragment),L(e,"slot","main")},m(l,r){b(l,e,r),O(t,e,null),n=!0},p(l,r){const a={};r&68&&(a.$$scope={dirty:r,ctx:l}),t.$set(a)},i(l){n||(g(t.$$.fragment,l),n=!0)},o(l){w(t.$$.fragment,l),n=!1},d(l){l&&v(e),T(t)}}}function ze(i){let e,t;return e=new oe({props:{$$slots:{main:[Ae],left:[Be]},$$scope:{ctx:i}}}),{c(){S(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,[l]){const r={};l&79&&(r.$$scope={dirty:l,ctx:n}),e.$set(r)},i(n){t||(g(e.$$.fragment,n),t=!0)},o(n){w(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function Pe(i,e,t){let n,l,r;A(i,G,c=>t(5,l=c)),A(i,ve,c=>t(3,r=c));let a=!1;ie(async()=>{await de(),t(1,a=!0)});let s=null;G.subscribe(c=>{t(0,s=null)});function d(c){let f=JSON.parse(c.detail.features[0].properties.osm_way_ids);f.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):t(0,s=BigInt(f[0]))}return i.$$.update=()=>{i.$$.dirty&33&&t(2,n=s?JSON.parse(l.getGeometryForWay(s)):ue())},[s,a,n,r,d,l]}class qe extends q{constructor(e){super(),H(this,e,Pe,ze,B,{})}}new qe({target:document.getElementById("app")});
