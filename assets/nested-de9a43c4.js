import{S as H,i as P,s as z,p as h,F as N,W as w,X as L,a as b,I as m,K as R,Z as x,M as j,d as v,j as D,Q as F,ao as ne,ap as le,U as K,aq as re,$ as ee,h as ae,G as J,ar as se,z as M,e as te,A as O,g as B,b as k,c as q,t as y,C as T,x as oe,ac as ie,o as ue,R as fe,ad as ce,ae as de,af as pe,ag as me,am as _e,ah as ge,ai as $e,aj as ye,ak as we,al as he,_ as ke,an as be,Y as ve,aa as Ce,a0 as We,a3 as Se,a4 as Me}from"./RenderLanePolygons-e81177bc.js";function Oe(s){let e,t=s[0].size+"",n,l,r,a,f,i,p,c;return{c(){e=h("div"),n=N(t),l=N(" ways edited"),r=w(),a=h("button"),f=N("Download .osc"),L(a,"type","button"),a.disabled=i=s[0].size==0},m(d,$){b(d,e,$),m(e,n),m(e,l),b(d,r,$),b(d,a,$),m(a,f),p||(c=R(a,"click",s[1]),p=!0)},p(d,[$]){$&1&&t!==(t=d[0].size+"")&&x(n,t),$&1&&i!==(i=d[0].size==0)&&(a.disabled=i)},i:j,o:j,d(d){d&&(v(e),v(r),v(a)),p=!1,c()}}}function Te(s,e,t){let n,l;D(s,F,i=>t(4,n=i)),D(s,ne,i=>t(3,l=i));let r=new Set;function a(i){r.add(i.detail),t(0,r),t(3,l)}function f(){let i=`<osmChange version="0.6" generator="osm2streets">
`;i+=`<create/>
`,i+=`<modify>
`;for(let p of r)i+=n.wayToXml(p),i+=`
`;i+=`</modify>
`,i+="</osmChange>",le("lane_edits.osc",i)}return s.$$.update=()=>{s.$$.dirty&8&&l>0&&t(0,r=new Set)},[r,f,a,l]}class Ee extends H{constructor(e){super(),P(this,e,Te,Oe,z,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function Q(s,e,t){const n=s.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function U(s,e){let t,n,l,r,a,f,i,p,c,d,$,o;function u(){e[5].call(l,e[12],e[13])}function g(){e[6].call(f,e[12],e[13])}function _(){return e[7](e[11])}return{key:s,first:null,c(){t=h("tr"),n=h("td"),l=h("input"),r=w(),a=h("td"),f=h("input"),i=w(),p=h("td"),c=h("button"),c.textContent="Delete",d=w(),L(l,"type","text"),L(f,"type","text"),L(c,"type","button"),this.first=t},m(C,I){b(C,t,I),m(t,n),m(n,l),J(l,e[11].key),m(t,r),m(t,a),m(a,f),J(f,e[11].value),m(t,i),m(t,p),m(p,c),m(t,d),$||(o=[R(l,"input",u),R(f,"input",g),R(c,"click",_)],$=!0)},p(C,I){e=C,I&1&&l.value!==e[11].key&&J(l,e[11].key),I&1&&f.value!==e[11].value&&J(f,e[11].value)},d(C){C&&v(t),$=!1,ee(o)}}}function Ie(s){let e,t,n=[],l=new Map,r,a,f,i,p,c,d=K(s[0]);const $=o=>o[11].id;for(let o=0;o<d.length;o+=1){let u=Q(s,d,o),g=$(u);l.set(g,n[o]=U(g,u))}return{c(){e=h("table"),t=h("tbody");for(let o=0;o<n.length;o+=1)n[o].c();r=w(),a=h("button"),a.textContent="Add new tag",f=w(),i=h("button"),i.textContent="Recalculate",L(a,"type","button"),L(i,"type","button")},m(o,u){b(o,e,u),m(e,t);for(let g=0;g<n.length;g+=1)n[g]&&n[g].m(t,null);b(o,r,u),b(o,a,u),b(o,f,u),b(o,i,u),p||(c=[R(a,"click",s[2]),R(i,"click",s[3])],p=!0)},p(o,[u]){u&3&&(d=K(o[0]),n=re(n,u,$,1,o,d,l,t,se,U,null,Q))},i:j,o:j,d(o){o&&(v(e),v(r),v(a),v(f),v(i));for(let u=0;u<n.length;u+=1)n[u].d();p=!1,ee(c)}}}function Le(s,e,t){let n;D(s,F,u=>t(9,n=u));const l=ae();let{way:r}=e,a=[],f=0;for(let[u,g]of Object.entries(JSON.parse(n.getOsmTagsForWay(r))))a.push({id:f++,key:u,value:g});function i(u){t(0,a=a.filter(g=>g.id!=u))}function p(){a.push({id:f++,key:"",value:""}),t(0,a)}function c(){let u={};for(let g of a)g.key&&g.value&&(u[g.key]=g.value);n.overwriteOsmTagsForWay(r,JSON.stringify(u)),F.set(n),l("editedWay",r)}function d(u,g){u[g].key=this.value,t(0,a)}function $(u,g){u[g].value=this.value,t(0,a)}const o=u=>i(u.id);return s.$$set=u=>{"way"in u&&t(4,r=u.way)},[a,i,p,c,r,d,$,o]}class je extends H{constructor(e){super(),P(this,e,Le,Ie,z,{way:4})}}function Ne(s){let e;return{c(){e=N("Click a road to edit")},m(t,n){b(t,e,n)},p:j,i:j,o:j,d(t){t&&v(e)}}}function Re(s){let e,t,n,l,r,a=s[0],f,i,p=V(s);return{c(){e=h("a"),t=N("Way "),n=N(s[0]),r=w(),p.c(),f=te(),L(e,"href",l="http://openstreetmap.org/way/"+s[0]),L(e,"target","_blank")},m(c,d){b(c,e,d),m(e,t),m(e,n),b(c,r,d),p.m(c,d),b(c,f,d),i=!0},p(c,d){(!i||d&1)&&x(n,c[0]),(!i||d&1&&l!==(l="http://openstreetmap.org/way/"+c[0]))&&L(e,"href",l),d&1&&z(a,a=c[0])?(B(),k(p,1,1,j),q(),p=V(c),p.c(),y(p,1),p.m(f.parentNode,f)):p.p(c,d)},i(c){i||(y(p),i=!0)},o(c){k(p),i=!1},d(c){c&&(v(e),v(r),v(f)),p.d(c)}}}function V(s){let e,t;return e=new je({props:{way:s[0]}}),e.$on("editedWay",s[3]),{c(){M(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,l){const r={};l&1&&(r.way=n[0]),e.$set(r)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function Ge(s){let e,t,n,l,r,a,f,i,p={};e=new Ee({props:p}),s[2](e);const c=[Re,Ne],d=[];function $(o,u){return o[0]?0:1}return r=$(s),a=d[r]=c[r](s),{c(){M(e.$$.fragment),t=w(),n=h("hr"),l=w(),a.c(),f=te()},m(o,u){O(e,o,u),b(o,t,u),b(o,n,u),b(o,l,u),d[r].m(o,u),b(o,f,u),i=!0},p(o,[u]){const g={};e.$set(g);let _=r;r=$(o),r===_?d[r].p(o,u):(B(),k(d[_],1,1,()=>{d[_]=null}),q(),a=d[r],a?a.p(o,u):(a=d[r]=c[r](o),a.c()),y(a,1),a.m(f.parentNode,f))},i(o){i||(y(e.$$.fragment,o),y(a),i=!0)},o(o){k(e.$$.fragment,o),k(a),i=!1},d(o){o&&(v(t),v(n),v(l),v(f)),s[2](null),T(e,o),d[r].d(o)}}}function De(s,e,t){let{way:n}=e,l;function r(f){oe[f?"unshift":"push"](()=>{l=f,t(1,l)})}const a=f=>l.handleEditedWay(f);return s.$$set=f=>{"way"in f&&t(0,n=f.way)},[n,l,r,a]}class Fe extends H{constructor(e){super(),P(this,e,De,Ge,z,{way:0})}}function Y(s){let e,t;return e=new me({}),{c(){M(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function Z(s){let e,t;return e=new _e({}),{c(){M(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function ze(s){let e,t,n,l,r,a,f,i,p,c,d,$,o,u,g,_,C,I,A;l=new ce({});let W=s[1]&&Y();o=new Fe({props:{way:s[0]}});let S=s[3]&&Z();return{c(){e=h("div"),t=h("h1"),t.textContent="osm2streets lane editor",n=w(),M(l.$$.fragment),r=w(),a=h("p"),a.innerHTML=`Improve OSM lane tagging with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>
      and <a href="https://gitlab.com/LeLuxNet/Muv" target="_blank">Muv</a>.`,f=w(),i=h("hr"),p=w(),W&&W.c(),c=w(),d=h("hr"),$=w(),M(o.$$.fragment),u=w(),g=h("hr"),_=w(),C=h("div"),C.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",I=w(),S&&S.c(),L(e,"slot","left")},m(E,G){b(E,e,G),m(e,t),m(e,n),O(l,e,null),m(e,r),m(e,a),m(e,f),m(e,i),m(e,p),W&&W.m(e,null),m(e,c),m(e,d),m(e,$),O(o,e,null),m(e,u),m(e,g),m(e,_),m(e,C),m(e,I),S&&S.m(e,null),A=!0},p(E,G){E[1]?W?G&2&&y(W,1):(W=Y(),W.c(),y(W,1),W.m(e,c)):W&&(B(),k(W,1,1,()=>{W=null}),q());const X={};G&1&&(X.way=E[0]),o.$set(X),E[3]?S?G&8&&y(S,1):(S=Z(),S.c(),y(S,1),S.m(e,null)):S&&(B(),k(S,1,1,()=>{S=null}),q())},i(E){A||(y(l.$$.fragment,E),y(W),y(o.$$.fragment,E),y(S),A=!0)},o(E){k(l.$$.fragment,E),k(W),k(o.$$.fragment,E),k(S),A=!1},d(E){E&&v(e),T(l),W&&W.d(),T(o),S&&S.d()}}}function Ae(s){let e,t;const n=[We("current-way"),{paint:{"fill-color":"red","fill-opacity":.3}}];let l={};for(let r=0;r<n.length;r+=1)l=Se(l,n[r]);return e=new Me({props:l}),{c(){M(e.$$.fragment)},m(r,a){O(e,r,a),t=!0},p(r,a){const f={};e.$set(f)},i(r){t||(y(e.$$.fragment,r),t=!0)},o(r){k(e.$$.fragment,r),t=!1},d(r){T(e,r)}}}function Je(s){let e,t,n,l,r,a,f,i,p,c,d,$,o,u,g;return t=new ge({}),l=new $e({}),a=new ye({}),i=new we({props:{hoverCursor:"pointer"}}),i.$on("click",s[4]),c=new he({}),$=new ke({props:{data:s[2],$$slots:{default:[Ae]},$$scope:{ctx:s}}}),u=new be({}),{c(){e=h("div"),M(t.$$.fragment),n=w(),M(l.$$.fragment),r=w(),M(a.$$.fragment),f=w(),M(i.$$.fragment),p=w(),M(c.$$.fragment),d=w(),M($.$$.fragment),o=w(),M(u.$$.fragment),ve(e,"display","none")},m(_,C){b(_,e,C),O(t,e,null),m(e,n),O(l,e,null),m(e,r),O(a,e,null),m(e,f),O(i,e,null),m(e,p),O(c,e,null),m(e,d),O($,e,null),b(_,o,C),O(u,_,C),g=!0},p(_,C){const I={};C&4&&(I.data=_[2]),C&64&&(I.$$scope={dirty:C,ctx:_}),$.$set(I)},i(_){g||(y(t.$$.fragment,_),y(l.$$.fragment,_),y(a.$$.fragment,_),y(i.$$.fragment,_),y(c.$$.fragment,_),y($.$$.fragment,_),y(u.$$.fragment,_),g=!0)},o(_){k(t.$$.fragment,_),k(l.$$.fragment,_),k(a.$$.fragment,_),k(i.$$.fragment,_),k(c.$$.fragment,_),k($.$$.fragment,_),k(u.$$.fragment,_),g=!1},d(_){_&&(v(e),v(o)),T(t),T(l),T(a),T(i),T(c),T($),T(u,_)}}}function Be(s){let e,t,n;return t=new de({props:{$$slots:{default:[Je]},$$scope:{ctx:s}}}),{c(){e=h("div"),M(t.$$.fragment),L(e,"slot","main")},m(l,r){b(l,e,r),O(t,e,null),n=!0},p(l,r){const a={};r&68&&(a.$$scope={dirty:r,ctx:l}),t.$set(a)},i(l){n||(y(t.$$.fragment,l),n=!0)},o(l){k(t.$$.fragment,l),n=!1},d(l){l&&v(e),T(t)}}}function qe(s){let e,t;return e=new ie({props:{$$slots:{main:[Be],left:[ze]},$$scope:{ctx:s}}}),{c(){M(e.$$.fragment)},m(n,l){O(e,n,l),t=!0},p(n,[l]){const r={};l&79&&(r.$$scope={dirty:l,ctx:n}),e.$set(r)},i(n){t||(y(e.$$.fragment,n),t=!0)},o(n){k(e.$$.fragment,n),t=!1},d(n){T(e,n)}}}function He(s,e,t){let n,l,r;D(s,F,p=>t(5,l=p)),D(s,Ce,p=>t(3,r=p));let a=!1;ue(async()=>{await pe(),t(1,a=!0)});let f=null;F.subscribe(p=>{t(0,f=null)});function i(p){let c=JSON.parse(p.detail.features[0].properties.osm_way_ids);c.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):t(0,f=BigInt(c[0]))}return s.$$.update=()=>{s.$$.dirty&33&&t(2,n=f?JSON.parse(l.getGeometryForWay(f)):fe())},[f,a,n,r,i,l]}class Pe extends H{constructor(e){super(),P(this,e,He,qe,z,{})}}new Pe({target:document.getElementById("app")});
