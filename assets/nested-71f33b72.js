import{S as B,i as F,s as D,p as g,y as N,M as y,Z as E,a as w,B as $,D as L,ae as U,E as I,d as k,j as A,R as j,af as Y,a0 as P,ag as x,a2 as V,h as ee,z as G,ah as te,K as C,e as X,N as M,g as Z,b,c as Q,t as v,P as O,x as ne,a3 as ae,o as le,T as re,a4 as se,a5 as oe,a6 as ie,a7 as ue,a8 as fe,a9 as ce,aa as de,ab as pe,ac as me,I as $e,ad as _e,ai as ge,U as ye,V as he,W as we}from"./RenderLanePolygons-d9d06d68.js";function ke(u){let e,t=u[0].size+"",n,a,l,r,s,c;return{c(){e=g("div"),n=N(t),a=N(" ways edited"),l=y(),r=g("button"),r.textContent="Download .osc",E(r,"type","button")},m(d,f){w(d,e,f),$(e,n),$(e,a),w(d,l,f),w(d,r,f),s||(c=L(r,"click",u[1]),s=!0)},p(d,[f]){f&1&&t!==(t=d[0].size+"")&&U(n,t)},i:I,o:I,d(d){d&&(k(e),k(l),k(r)),s=!1,c()}}}function be(u,e,t){let n;A(u,j,s=>t(3,n=s));let a=new Set;function l(s){a.add(s.detail),t(0,a)}function r(){let s=`<osmChange version="0.6" generator="osm2streets">
`;s+=`<create/>
`,s+=`<modify>
`;for(let c of a)s+=n.wayToXml(c),s+=`
`;s+=`</modify>
`,s+="</osmChange>",Y("lane_edits.osc",s)}return[a,r,l]}class ve extends B{constructor(e){super(),F(this,e,be,ke,D,{handleEditedWay:2})}get handleEditedWay(){return this.$$.ctx[2]}}function q(u,e,t){const n=u.slice();return n[11]=e[t],n[12]=e,n[13]=t,n}function H(u,e){let t,n,a,l,r,s,c,d,f,p,h,i;function o(){e[5].call(a,e[12],e[13])}function _(){e[6].call(s,e[12],e[13])}function m(){return e[7](e[11])}return{key:u,first:null,c(){t=g("tr"),n=g("td"),a=g("input"),l=y(),r=g("td"),s=g("input"),c=y(),d=g("td"),f=g("button"),f.textContent="Delete",p=y(),E(a,"type","text"),E(s,"type","text"),E(f,"type","button"),this.first=t},m(W,T){w(W,t,T),$(t,n),$(n,a),G(a,e[11].key),$(t,l),$(t,r),$(r,s),G(s,e[11].value),$(t,c),$(t,d),$(d,f),$(t,p),h||(i=[L(a,"input",o),L(s,"input",_),L(f,"click",m)],h=!0)},p(W,T){e=W,T&1&&a.value!==e[11].key&&G(a,e[11].key),T&1&&s.value!==e[11].value&&G(s,e[11].value)},d(W){W&&k(t),h=!1,V(i)}}}function We(u){let e,t,n=[],a=new Map,l,r,s,c,d,f,p=P(u[0]);const h=i=>i[11].id;for(let i=0;i<p.length;i+=1){let o=q(u,p,i),_=h(o);a.set(_,n[i]=H(_,o))}return{c(){e=g("table"),t=g("tbody");for(let i=0;i<n.length;i+=1)n[i].c();l=y(),r=g("button"),r.textContent="Add new tag",s=y(),c=g("button"),c.textContent="Recalculate",E(r,"type","button"),E(c,"type","button")},m(i,o){w(i,e,o),$(e,t);for(let _=0;_<n.length;_+=1)n[_]&&n[_].m(t,null);w(i,l,o),w(i,r,o),w(i,s,o),w(i,c,o),d||(f=[L(r,"click",u[2]),L(c,"click",u[3])],d=!0)},p(i,[o]){o&3&&(p=P(i[0]),n=x(n,o,h,1,i,p,a,t,te,H,null,q))},i:I,o:I,d(i){i&&(k(e),k(l),k(r),k(s),k(c));for(let o=0;o<n.length;o+=1)n[o].d();d=!1,V(f)}}}function Ce(u,e,t){let n;A(u,j,o=>t(9,n=o));const a=ee();let{way:l}=e,r=[],s=0;for(let[o,_]of Object.entries(JSON.parse(n.getOsmTagsForWay(l))))r.push({id:s++,key:o,value:_});function c(o){t(0,r=r.filter(_=>_.id!=o))}function d(){r.push({id:s++,key:"",value:""}),t(0,r)}function f(){let o={};for(let _ of r)_.key&&_.value&&(o[_.key]=_.value);n.overwriteOsmTagsForWay(l,JSON.stringify(o)),j.set(n),a("editedWay",l)}function p(o,_){o[_].key=this.value,t(0,r)}function h(o,_){o[_].value=this.value,t(0,r)}const i=o=>c(o.id);return u.$$set=o=>{"way"in o&&t(4,l=o.way)},[r,c,d,f,l,p,h,i]}class Me extends B{constructor(e){super(),F(this,e,Ce,We,D,{way:4})}}function Oe(u){let e;return{c(){e=N("Click a road to edit")},m(t,n){w(t,e,n)},p:I,i:I,o:I,d(t){t&&k(e)}}}function Se(u){let e,t,n,a,l,r=u[0],s,c,d=K(u);return{c(){e=g("a"),t=N("Way "),n=N(u[0]),l=y(),d.c(),s=X(),E(e,"href",a="http://openstreetmap.org/way/"+u[0]),E(e,"target","_blank")},m(f,p){w(f,e,p),$(e,t),$(e,n),w(f,l,p),d.m(f,p),w(f,s,p),c=!0},p(f,p){(!c||p&1)&&U(n,f[0]),(!c||p&1&&a!==(a="http://openstreetmap.org/way/"+f[0]))&&E(e,"href",a),p&1&&D(r,r=f[0])?(Z(),b(d,1,1,I),Q(),d=K(f),d.c(),v(d,1),d.m(s.parentNode,s)):d.p(f,p)},i(f){c||(v(d),c=!0)},o(f){b(d),c=!1},d(f){f&&(k(e),k(l),k(s)),d.d(f)}}}function K(u){let e,t;return e=new Me({props:{way:u[0]}}),e.$on("editedWay",u[3]),{c(){C(e.$$.fragment)},m(n,a){M(e,n,a),t=!0},p(n,a){const l={};a&1&&(l.way=n[0]),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function Te(u){let e,t,n,a,l,r,s,c,d={};e=new ve({props:d}),u[2](e);const f=[Se,Oe],p=[];function h(i,o){return i[0]?0:1}return l=h(u),r=p[l]=f[l](u),{c(){C(e.$$.fragment),t=y(),n=g("hr"),a=y(),r.c(),s=X()},m(i,o){M(e,i,o),w(i,t,o),w(i,n,o),w(i,a,o),p[l].m(i,o),w(i,s,o),c=!0},p(i,[o]){const _={};e.$set(_);let m=l;l=h(i),l===m?p[l].p(i,o):(Z(),b(p[m],1,1,()=>{p[m]=null}),Q(),r=p[l],r?r.p(i,o):(r=p[l]=f[l](i),r.c()),v(r,1),r.m(s.parentNode,s))},i(i){c||(v(e.$$.fragment,i),v(r),c=!0)},o(i){b(e.$$.fragment,i),b(r),c=!1},d(i){i&&(k(t),k(n),k(a),k(s)),u[2](null),O(e,i),p[l].d(i)}}}function Ee(u,e,t){let{way:n}=e,a;function l(s){ne[s?"unshift":"push"](()=>{a=s,t(1,a)})}const r=s=>a.handleEditedWay(s);return u.$$set=s=>{"way"in s&&t(0,n=s.way)},[n,a,l,r]}class Ie extends B{constructor(e){super(),F(this,e,Ee,Te,D,{way:0})}}function Le(u){let e,t,n,a,l,r,s,c,d,f,p,h,i,o,_,m,W,T,R;return a=new se({}),f=new oe({}),o=new Ie({props:{way:u[0]}}),{c(){e=g("div"),t=g("h1"),t.textContent="osm2streets lane editor",n=y(),C(a.$$.fragment),l=y(),r=g("p"),r.innerHTML=`Improve OSM lane tagging with
      <a href="https://github.com/a-b-street/osm2streets" target="_blank">osm2streets</a>
      and <a href="https://gitlab.com/LeLuxNet/Muv" target="_blank">Muv</a>.`,s=y(),c=g("hr"),d=y(),C(f.$$.fragment),p=y(),h=g("hr"),i=y(),C(o.$$.fragment),_=y(),m=g("hr"),W=y(),T=g("div"),T.innerHTML="<strong>Warnings:</strong> <ul><li><strong>This tool is an early experiment</strong></li> <li>Don&#39;t use this tool without understanding OSM tagging</li> <li>Be careful around sidepaths, footways, and dual carriageways</li> <li>Don&#39;t edit a way that&#39;s partly clipped</li></ul>",E(e,"slot","left")},m(S,J){w(S,e,J),$(e,t),$(e,n),M(a,e,null),$(e,l),$(e,r),$(e,s),$(e,c),$(e,d),M(f,e,null),$(e,p),$(e,h),$(e,i),M(o,e,null),$(e,_),$(e,m),$(e,W),$(e,T),R=!0},p(S,J){const z={};J&1&&(z.way=S[0]),o.$set(z)},i(S){R||(v(a.$$.fragment,S),v(f.$$.fragment,S),v(o.$$.fragment,S),R=!0)},o(S){b(a.$$.fragment,S),b(f.$$.fragment,S),b(o.$$.fragment,S),R=!1},d(S){S&&k(e),O(a),O(f),O(o)}}}function Ne(u){let e,t;const n=[ye("current-way"),{paint:{"fill-color":"red","fill-opacity":.3}}];let a={};for(let l=0;l<n.length;l+=1)a=he(a,n[l]);return e=new we({props:a}),{c(){C(e.$$.fragment)},m(l,r){M(e,l,r),t=!0},p(l,r){const s={};e.$set(s)},i(l){t||(v(e.$$.fragment,l),t=!0)},o(l){b(e.$$.fragment,l),t=!1},d(l){O(e,l)}}}function je(u){let e,t,n,a,l,r,s,c,d,f,p,h,i,o,_;return t=new fe({}),a=new ce({}),r=new de({}),c=new pe({props:{hoverCursor:"pointer"}}),c.$on("click",u[2]),f=new me({}),h=new $e({props:{data:u[1],$$slots:{default:[Ne]},$$scope:{ctx:u}}}),o=new _e({}),{c(){e=g("div"),C(t.$$.fragment),n=y(),C(a.$$.fragment),l=y(),C(r.$$.fragment),s=y(),C(c.$$.fragment),d=y(),C(f.$$.fragment),p=y(),C(h.$$.fragment),i=y(),C(o.$$.fragment),ge(e,"display","none")},m(m,W){w(m,e,W),M(t,e,null),$(e,n),M(a,e,null),$(e,l),M(r,e,null),$(e,s),M(c,e,null),$(e,d),M(f,e,null),$(e,p),M(h,e,null),w(m,i,W),M(o,m,W),_=!0},p(m,W){const T={};W&2&&(T.data=m[1]),W&16&&(T.$$scope={dirty:W,ctx:m}),h.$set(T)},i(m){_||(v(t.$$.fragment,m),v(a.$$.fragment,m),v(r.$$.fragment,m),v(c.$$.fragment,m),v(f.$$.fragment,m),v(h.$$.fragment,m),v(o.$$.fragment,m),_=!0)},o(m){b(t.$$.fragment,m),b(a.$$.fragment,m),b(r.$$.fragment,m),b(c.$$.fragment,m),b(f.$$.fragment,m),b(h.$$.fragment,m),b(o.$$.fragment,m),_=!1},d(m){m&&(k(e),k(i)),O(t),O(a),O(r),O(c),O(f),O(h),O(o,m)}}}function De(u){let e,t,n;return t=new ie({props:{$$slots:{default:[je]},$$scope:{ctx:u}}}),{c(){e=g("div"),C(t.$$.fragment),E(e,"slot","main")},m(a,l){w(a,e,l),M(t,e,null),n=!0},p(a,l){const r={};l&18&&(r.$$scope={dirty:l,ctx:a}),t.$set(r)},i(a){n||(v(t.$$.fragment,a),n=!0)},o(a){b(t.$$.fragment,a),n=!1},d(a){a&&k(e),O(t)}}}function Re(u){let e,t;return e=new ae({props:{$$slots:{main:[De],left:[Le]},$$scope:{ctx:u}}}),{c(){C(e.$$.fragment)},m(n,a){M(e,n,a),t=!0},p(n,[a]){const l={};a&19&&(l.$$scope={dirty:a,ctx:n}),e.$set(l)},i(n){t||(v(e.$$.fragment,n),t=!0)},o(n){b(e.$$.fragment,n),t=!1},d(n){O(e,n)}}}function Ge(u,e,t){let n,a;A(u,j,s=>t(3,a=s)),le(async()=>{await ue()});let l=null;j.subscribe(s=>{t(0,l=null)});function r(s){let c=JSON.parse(s.detail.features[0].properties.osm_way_ids);c.length!=1?window.alert("This road doesn't match up with one OSM way; you can't edit it"):t(0,l=BigInt(c[0]))}return u.$$.update=()=>{u.$$.dirty&9&&t(1,n=l?JSON.parse(a.getGeometryForWay(l)):re())},[l,n,r,a]}class Be extends B{constructor(e){super(),F(this,e,Ge,Re,D,{})}}new Be({target:document.getElementById("app")});
